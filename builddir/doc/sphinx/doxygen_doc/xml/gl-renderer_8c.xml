<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="gl-renderer_8c" kind="file" language="C++">
    <compoundname>gl-renderer.c</compoundname>
    <includes local="yes">config.h</includes>
    <includes local="no">GLES2/gl2.h</includes>
    <includes local="no">GLES2/gl2ext.h</includes>
    <includes local="no">GLES3/gl3.h</includes>
    <includes local="no">stdbool.h</includes>
    <includes local="no">stdint.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">ctype.h</includes>
    <includes local="no">float.h</includes>
    <includes local="no">assert.h</includes>
    <includes local="no">linux/input.h</includes>
    <includes local="no">unistd.h</includes>
    <includes refid="linux-sync-file_8h" local="yes">linux-sync-file.h</includes>
    <includes refid="timeline_8h" local="yes">timeline.h</includes>
    <includes refid="gl-renderer_8h" local="yes">gl-renderer.h</includes>
    <includes refid="gl-renderer-internal_8h" local="yes">gl-renderer-internal.h</includes>
    <includes refid="vertex-clipping_8h" local="yes">vertex-clipping.h</includes>
    <includes refid="linux-dmabuf_8h" local="yes">linux-dmabuf.h</includes>
    <includes local="yes">linux-dmabuf-unstable-v1-server-protocol.h</includes>
    <includes refid="linux-explicit-synchronization_8h" local="yes">linux-explicit-synchronization.h</includes>
    <includes refid="pixel-formats_8h" local="yes">pixel-formats.h</includes>
    <includes local="yes">shared/fd-util.h</includes>
    <includes local="yes">shared/helpers.h</includes>
    <includes local="yes">shared/platform.h</includes>
    <includes local="yes">shared/timespec-util.h</includes>
    <includes local="yes">shared/weston-drm-fourcc.h</includes>
    <includes local="yes">shared/weston-egl-ext.h</includes>
    <incdepgraph>
      <node id="6">
        <label>stdbool.h</label>
      </node>
      <node id="20">
        <label>stdarg.h</label>
      </node>
      <node id="25">
        <label>libweston/libweston.h</label>
        <link refid="libweston_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>linux/input.h</label>
      </node>
      <node id="40">
        <label>pixel-formats.h</label>
        <link refid="pixel-formats_8h"/>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>assert.h</label>
      </node>
      <node id="11">
        <label>float.h</label>
      </node>
      <node id="43">
        <label>shared/platform.h</label>
      </node>
      <node id="38">
        <label>linux-dmabuf-unstable-v1-server-protocol.h</label>
      </node>
      <node id="7">
        <label>stdint.h</label>
      </node>
      <node id="8">
        <label>stdlib.h</label>
      </node>
      <node id="19">
        <label>libweston/weston-log.h</label>
        <link refid="weston-log_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>GLES2/gl2ext.h</label>
      </node>
      <node id="29">
        <label>wayland-server.h</label>
      </node>
      <node id="28">
        <label>xkbcommon/xkbcommon.h</label>
      </node>
      <node id="37">
        <label>linux-dmabuf.h</label>
        <link refid="linux-dmabuf_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>vertex-clipping.h</label>
        <link refid="vertex-clipping_8h"/>
      </node>
      <node id="23">
        <label>shared/helpers.h</label>
      </node>
      <node id="15">
        <label>linux-sync-file.h</label>
        <link refid="linux-sync-file_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>string.h</label>
      </node>
      <node id="5">
        <label>GLES3/gl3.h</label>
      </node>
      <node id="17">
        <label>timeline.h</label>
        <link refid="timeline_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>unistd.h</label>
      </node>
      <node id="45">
        <label>shared/weston-drm-fourcc.h</label>
      </node>
      <node id="39">
        <label>linux-explicit-synchronization.h</label>
        <link refid="linux-explicit-synchronization_8h"/>
      </node>
      <node id="1">
        <label>/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c</label>
        <link refid="gl-renderer_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>shared/weston-egl-ext.h</label>
      </node>
      <node id="24">
        <label>gl-renderer.h</label>
        <link refid="gl-renderer_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="42">
        <label>shared/fd-util.h</label>
      </node>
      <node id="31">
        <label>libweston/zalloc.h</label>
        <link refid="zalloc_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>time.h</label>
      </node>
      <node id="34">
        <label>gl-renderer-internal.h</label>
        <link refid="gl-renderer-internal_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>sys/time.h</label>
      </node>
      <node id="30">
        <label>libweston/matrix.h</label>
        <link refid="matrix_8h"/>
      </node>
      <node id="3">
        <label>GLES2/gl2.h</label>
      </node>
      <node id="27">
        <label>pixman.h</label>
      </node>
      <node id="18">
        <label>wayland-util.h</label>
      </node>
      <node id="10">
        <label>ctype.h</label>
      </node>
      <node id="22">
        <label>wayland-server-core.h</label>
      </node>
      <node id="33">
        <label>libweston-internal.h</label>
        <link refid="libweston-internal_8h"/>
      </node>
      <node id="2">
        <label>config.h</label>
      </node>
      <node id="44">
        <label>shared/timespec-util.h</label>
      </node>
      <node id="32">
        <label>backend.h</label>
        <link refid="backend_8h"/>
      </node>
      <node id="21">
        <label>stdio.h</label>
      </node>
      <node id="41">
        <label>inttypes.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structgl__border__image" prot="public">gl_border_image</innerclass>
    <innerclass refid="structgl__fbo__texture" prot="public">gl_fbo_texture</innerclass>
    <innerclass refid="structgl__output__state" prot="public">gl_output_state</innerclass>
    <innerclass refid="structegl__image" prot="public">egl_image</innerclass>
    <innerclass refid="structdmabuf__image" prot="public">dmabuf_image</innerclass>
    <innerclass refid="structdmabuf__format" prot="public">dmabuf_format</innerclass>
    <innerclass refid="structyuv__plane__descriptor" prot="public">yuv_plane_descriptor</innerclass>
    <innerclass refid="structyuv__format__descriptor" prot="public">yuv_format_descriptor</innerclass>
    <innerclass refid="structgl__surface__state" prot="public">gl_surface_state</innerclass>
    <innerclass refid="structtimeline__render__point" prot="public">timeline_render_point</innerclass>
      <sectiondef kind="define">
      <memberdef kind="define" id="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" prot="public" static="no">
        <name>BUFFER_DAMAGE_COUNT</name>
        <initializer>2</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="62" column="9" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="62" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="gl-renderer_8c_1affe776513b24d84b39af8ab0930fef7f" prot="public" static="no">
        <name>max</name>
        <param><defname>a</defname></param>
        <param><defname>b</defname></param>
        <initializer>(((a) &gt; (b)) ? (a) : (b))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="430" column="9" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="430" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="gl-renderer_8c_1ac6afabdc09a49a433ee19d8a9486056d" prot="public" static="no">
        <name>min</name>
        <param><defname>a</defname></param>
        <param><defname>b</defname></param>
        <initializer>(((a) &gt; (b)) ? (b) : (a))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="431" column="9" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="431" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="enum">
      <memberdef kind="enum" id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" prot="public" static="no" strong="no">
        <type></type>
        <name>gl_border_status</name>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" prot="public">
          <name>BORDER_STATUS_CLEAN</name>
          <initializer>= 0</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5ac2239af957c138ce5fbd1da29dcf5876" prot="public">
          <name>BORDER_TOP_DIRTY</name>
          <initializer>= 1 &lt;&lt; GL_RENDERER_BORDER_TOP</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a563a0819ed1cfa18c992f9511ffe1cd4" prot="public">
          <name>BORDER_LEFT_DIRTY</name>
          <initializer>= 1 &lt;&lt; GL_RENDERER_BORDER_LEFT</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a02c0c77acf814be2ea455f4305785b60" prot="public">
          <name>BORDER_RIGHT_DIRTY</name>
          <initializer>= 1 &lt;&lt; GL_RENDERER_BORDER_RIGHT</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a70dd320e034aa3258d657316b1b284ac" prot="public">
          <name>BORDER_BOTTOM_DIRTY</name>
          <initializer>= 1 &lt;&lt; GL_RENDERER_BORDER_BOTTOM</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5afe73d5275ac520114d310400d092b9bb" prot="public">
          <name>BORDER_ALL_DIRTY</name>
          <initializer>= 0xf</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a955e714fe630ca6d864293605a1d80da" prot="public">
          <name>BORDER_SIZE_CHANGED</name>
          <initializer>= 0x10</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="64" column="22" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="64" bodyend="72"/>
      </memberdef>
      <memberdef kind="enum" id="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519d" prot="public" static="no" strong="no">
        <type></type>
        <name>buffer_type</name>
        <enumvalue id="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" prot="public">
          <name>BUFFER_TYPE_NULL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da482261e675f08e847f2a90fff87ef135" prot="public">
          <name>BUFFER_TYPE_SOLID</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da1867b61ecc8948ec383bdaa04bf65f2a" prot="public">
          <name>BUFFER_TYPE_SHM</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da28519cfd07d43aced9d5c5ef11c40951" prot="public">
          <name>BUFFER_TYPE_EGL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="107" column="17" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="107" bodyend="112"/>
      </memberdef>
      <memberdef kind="enum" id="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519" prot="public" static="no" strong="no">
        <type></type>
        <name>import_type</name>
        <enumvalue id="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519ac27e3b406fb878587b258cd9c959ce61" prot="public">
          <name>IMPORT_TYPE_INVALID</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a778c1b8329477c7763ed59fb4ee0d141" prot="public">
          <name>IMPORT_TYPE_DIRECT</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a20c9329ebc72fc79241fd90c952643d4" prot="public">
          <name>IMPORT_TYPE_GL_CONVERSION</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="122" column="17" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="122" bodyend="126"/>
      </memberdef>
      <memberdef kind="enum" id="gl-renderer_8c_1af61174fce42866489121623510a6dbaa" prot="public" static="no" strong="no">
        <type></type>
        <name>texture_type</name>
        <enumvalue id="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa6fdaa33bbdb28cc2a6ca5697e7f16c06" prot="public">
          <name>TEXTURE_Y_XUXV_WL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1af61174fce42866489121623510a6dbaaad746f9a88303f3bc74d595c17e559212" prot="public">
          <name>TEXTURE_Y_UV_WL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa4d3f5d0cae94cbe7d56133cb61df2e31" prot="public">
          <name>TEXTURE_Y_U_V_WL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa5fb0ce2c6db847f7ae0798829d475c9d" prot="public">
          <name>TEXTURE_XYUV_WL</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="154" column="18" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="154" bodyend="159"/>
      </memberdef>
      <memberdef kind="enum" id="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302" prot="public" static="no" strong="no">
        <type></type>
        <name>timeline_render_point_type</name>
        <enumvalue id="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302af9e4612108eb99570774874565d36c0f" prot="public">
          <name>TIMELINE_RENDER_POINT_TYPE_BEGIN</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302a320783c49e602f85f5c11f36ce1e1f86" prot="public">
          <name>TIMELINE_RENDER_POINT_TYPE_END</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="210" column="32" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="210" bodyend="213"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="gl-renderer_8c_1a6b11eccba8429bd3104100e4a866f9b6" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structyuv__format__descriptor" kindref="compound">yuv_format_descriptor</ref></type>
        <definition>struct yuv_format_descriptor yuv_formats[]</definition>
        <argsstring>[]</argsstring>
        <name>yuv_formats</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2120" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2219" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="gl-renderer_8c_1a6ff180f974b5089df930be8b5fd23406" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structgl__renderer__interface" kindref="compound">gl_renderer_interface</ref></type>
        <definition>struct gl_renderer_interface gl_renderer_interface</definition>
        <argsstring></argsstring>
        <name>gl_renderer_interface</name>
        <initializer>= {
	.display_create = <ref refid="gl-renderer_8c_1aa24f0204f154a5eabb1fcca2652e77b6" kindref="member">gl_renderer_display_create</ref>,
	.output_window_create = <ref refid="gl-renderer_8c_1aec7c581b0b5456ce0c465781cc7bbd18" kindref="member">gl_renderer_output_window_create</ref>,
	.output_pbuffer_create = <ref refid="gl-renderer_8c_1afbd97b5e78fed70df49d4598d28490ef" kindref="member">gl_renderer_output_pbuffer_create</ref>,
	.<ref refid="weston-test-client-helper_8c_1a517aee233a8c3ab311347acec0eb7dfb" kindref="member">output_destroy</ref> = <ref refid="gl-renderer_8c_1ad9ff8094d61d9064badbff54ad29eedb" kindref="member">gl_renderer_output_destroy</ref>,
	.output_set_border = <ref refid="gl-renderer_8c_1aae880f0fafdc938725ae869db58c554a" kindref="member">gl_renderer_output_set_border</ref>,
	.create_fence_fd = <ref refid="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" kindref="member">gl_renderer_create_fence_fd</ref>,
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3655" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3799" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint32_t</type>
        <definition>static uint32_t gr_gl_version</definition>
        <argsstring>(uint16_t major, uint16_t minor)</argsstring>
        <name>gr_gl_version</name>
        <param>
          <type>uint16_t</type>
          <declname>major</declname>
        </param>
        <param>
          <type>uint16_t</type>
          <declname>minor</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="225" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="225" bodyend="228"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a690ae1156bf3548155179290fb0ef86f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gr_gl_version_major</definition>
        <argsstring>(uint32_t ver)</argsstring>
        <name>gr_gl_version_major</name>
        <param>
          <type>uint32_t</type>
          <declname>ver</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="231" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="231" bodyend="234"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aafdd7e372594d386d8ac23f506b0ead1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gr_gl_version_minor</definition>
        <argsstring>(uint32_t ver)</argsstring>
        <name>gr_gl_version_minor</name>
        <param>
          <type>uint32_t</type>
          <declname>ver</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="237" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="237" bodyend="240"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ae8ae9d1cc84c7a5e1b28e5affbe64cbc" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char* dump_format</definition>
        <argsstring>(uint32_t format, char out[4])</argsstring>
        <name>dump_format</name>
        <param>
          <type>uint32_t</type>
          <declname>format</declname>
        </param>
        <param>
          <type>char</type>
          <declname>out</declname>
          <array>[4]</array>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="243" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="243" bodyend="250"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>struct <ref refid="structgl__output__state" kindref="compound">gl_output_state</ref> *</type>
        <definition>static struct gl_output_state* get_output_state</definition>
        <argsstring>(struct weston_output *output)</argsstring>
        <name>get_output_state</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="253" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="253" bodyend="256"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ab64e604cc7dab39204e8bc963a8e2317" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_create_surface</definition>
        <argsstring>(struct weston_surface *surface)</argsstring>
        <name>gl_renderer_create_surface</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3046" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3046" bodyend="3084" declfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" declline="259" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>struct <ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref> *</type>
        <definition>static struct gl_surface_state* get_surface_state</definition>
        <argsstring>(struct weston_surface *surface)</argsstring>
        <name>get_surface_state</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="262" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="262" bodyend="268"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a882e8d873d5d851c1b3d1b6f306cbcc4" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool shadow_exists</definition>
        <argsstring>(const struct gl_output_state *go)</argsstring>
        <name>shadow_exists</name>
        <param>
          <type>const struct <ref refid="structgl__output__state" kindref="compound">gl_output_state</ref> *</type>
          <declname>go</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="271" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="271" bodyend="274"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a520b26cd0da6352bb678758ea5545c67" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void timeline_render_point_destroy</definition>
        <argsstring>(struct timeline_render_point *trp)</argsstring>
        <name>timeline_render_point_destroy</name>
        <param>
          <type>struct <ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref> *</type>
          <declname>trp</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="277" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="277" bodyend="283"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ad4cc0fd7794fddd11c3ea91b2e7cee05" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int timeline_render_point_handler</definition>
        <argsstring>(int fd, uint32_t mask, void *data)</argsstring>
        <name>timeline_render_point_handler</name>
        <param>
          <type>int</type>
          <declname>fd</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>mask</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="286" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="286" bodyend="305"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a311a6801d5d60a6183ea362ae2b2896d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>EGLSyncKHR</type>
        <definition>static EGLSyncKHR create_render_sync</definition>
        <argsstring>(struct gl_renderer *gr)</argsstring>
        <name>create_render_sync</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="308" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="308" bodyend="317"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a59f1b4cc1d6cb2d6e21e9129792004c7" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void timeline_submit_render_sync</definition>
        <argsstring>(struct gl_renderer *gr, struct weston_output *output, EGLSyncKHR sync, enum timeline_render_point_type type)</argsstring>
        <name>timeline_submit_render_sync</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>EGLSyncKHR</type>
          <declname>sync</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302" kindref="member">timeline_render_point_type</ref></type>
          <declname>type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="320" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="320" bodyend="357"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a49160dcc2d7db45ce16ab4f31f1c2270" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
        <definition>static struct egl_image* egl_image_create</definition>
        <argsstring>(struct gl_renderer *gr, EGLenum target, EGLClientBuffer buffer, const EGLint *attribs)</argsstring>
        <name>egl_image_create</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a3403e7aa1af3a3a900c4fb0584d680a5" kindref="member">EGLenum</ref></type>
          <declname>target</declname>
        </param>
        <param>
          <type>EGLClientBuffer</type>
          <declname>buffer</declname>
        </param>
        <param>
          <type>const <ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref> *</type>
          <declname>attribs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="360" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="360" bodyend="377"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ae2f06a72405c4e2e30c5567ffef5430b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
        <definition>static struct egl_image* egl_image_ref</definition>
        <argsstring>(struct egl_image *image)</argsstring>
        <name>egl_image_ref</name>
        <param>
          <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
          <declname>image</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="380" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="380" bodyend="385"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int egl_image_unref</definition>
        <argsstring>(struct egl_image *image)</argsstring>
        <name>egl_image_unref</name>
        <param>
          <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
          <declname>image</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="388" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="388" bodyend="402"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a02947a9d03f0d2153b470d061a218f1d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref> *</type>
        <definition>static struct dmabuf_image* dmabuf_image_create</definition>
        <argsstring>(void)</argsstring>
        <name>dmabuf_image_create</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="405" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="405" bodyend="413"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a9aa2823f0af7287f156ba09272a7fecc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void dmabuf_image_destroy</definition>
        <argsstring>(struct dmabuf_image *image)</argsstring>
        <name>dmabuf_image_destroy</name>
        <param>
          <type>struct <ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref> *</type>
          <declname>image</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="416" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="416" bodyend="428"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a7fc5a914b682f4851c6eb792cf625855" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int calculate_edges</definition>
        <argsstring>(struct weston_view *ev, pixman_box32_t *rect, pixman_box32_t *surf_rect, GLfloat *ex, GLfloat *ey)</argsstring>
        <name>calculate_edges</name>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>ev</declname>
        </param>
        <param>
          <type>pixman_box32_t *</type>
          <declname>rect</declname>
        </param>
        <param>
          <type>pixman_box32_t *</type>
          <declname>surf_rect</declname>
        </param>
        <param>
          <type>GLfloat *</type>
          <declname>ex</declname>
        </param>
        <param>
          <type>GLfloat *</type>
          <declname>ey</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="443" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="443" bodyend="503"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1afd7772291098f8d5bc4ba35ec1952ab9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool merge_down</definition>
        <argsstring>(pixman_box32_t *a, pixman_box32_t *b, pixman_box32_t *merge)</argsstring>
        <name>merge_down</name>
        <param>
          <type>pixman_box32_t *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>pixman_box32_t *</type>
          <declname>b</declname>
        </param>
        <param>
          <type>pixman_box32_t *</type>
          <declname>merge</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="506" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="506" bodyend="516"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a367125d8aeb64661e2a5b7d24b952e76" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int compress_bands</definition>
        <argsstring>(pixman_box32_t *inrects, int nrects, pixman_box32_t **outrects)</argsstring>
        <name>compress_bands</name>
        <param>
          <type>pixman_box32_t *</type>
          <declname>inrects</declname>
        </param>
        <param>
          <type>int</type>
          <declname>nrects</declname>
        </param>
        <param>
          <type>pixman_box32_t **</type>
          <declname>outrects</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="519" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="519" bodyend="551"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a5202426c9e43d635b71aae3ba7d7bb56" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int texture_region</definition>
        <argsstring>(struct weston_view *ev, pixman_region32_t *region, pixman_region32_t *surf_region)</argsstring>
        <name>texture_region</name>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>ev</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>region</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>surf_region</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="554" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="554" bodyend="639"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aeaf10b41e911de6a80a1885227a0c2b6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool gl_fbo_texture_init</definition>
        <argsstring>(struct gl_fbo_texture *fbotex, int32_t width, int32_t height, GLint internal_format, GLenum format, GLenum type)</argsstring>
        <name>gl_fbo_texture_init</name>
        <param>
          <type>struct <ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref> *</type>
          <declname>fbotex</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>width</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>height</declname>
        </param>
        <param>
          <type>GLint</type>
          <declname>internal_format</declname>
        </param>
        <param>
          <type>GLenum</type>
          <declname>format</declname>
        </param>
        <param>
          <type>GLenum</type>
          <declname>type</declname>
        </param>
        <briefdescription>
<para>Create a texture and a framebuffer object. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>fbotex</parametername>
</parameternamelist>
<parameterdescription>
<para>To be initialized. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>width</parametername>
</parameternamelist>
<parameterdescription>
<para>Texture width in pixels. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>height</parametername>
</parameternamelist>
<parameterdescription>
<para>Texture heigh in pixels. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>internal_format</parametername>
</parameternamelist>
<parameterdescription>
<para>See glTexImage2D. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>format</parametername>
</parameternamelist>
<parameterdescription>
<para>See glTexImage2D. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>type</parametername>
</parameternamelist>
<parameterdescription>
<para>See glTexImage2D. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>True on success, false otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="652" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="652" bodyend="693"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a2fc2b9f773abe95904333149ad2c931e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_fbo_texture_fini</definition>
        <argsstring>(struct gl_fbo_texture *fbotex)</argsstring>
        <name>gl_fbo_texture_fini</name>
        <param>
          <type>struct <ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref> *</type>
          <declname>fbotex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="696" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="696" bodyend="702"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a97f3834c5afed9bd6d60bd5f59434df1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_send_shader_error</definition>
        <argsstring>(struct weston_view *view)</argsstring>
        <name>gl_renderer_send_shader_error</name>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>view</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="705" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="705" bodyend="715"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a2f8cf17ec2a4d61518c9461bc0d3af32" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void triangle_fan_debug</definition>
        <argsstring>(struct gl_renderer *gr, const struct gl_shader_config *sconf, int first, int count)</argsstring>
        <name>triangle_fan_debug</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>const struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <param>
          <type>int</type>
          <declname>first</declname>
        </param>
        <param>
          <type>int</type>
          <declname>count</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="718" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="718" bodyend="768"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1afc1d8df98ce08045f594f08ea437b053" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void repaint_region</definition>
        <argsstring>(struct gl_renderer *gr, struct weston_view *ev, pixman_region32_t *region, pixman_region32_t *surf_region, const struct gl_shader_config *sconf)</argsstring>
        <name>repaint_region</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>ev</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>region</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>surf_region</declname>
        </param>
        <param>
          <type>const struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="771" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="771" bodyend="819"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a2485d1997f3d3d4c128c5b173a1fef51" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int use_output</definition>
        <argsstring>(struct weston_output *output)</argsstring>
        <name>use_output</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="822" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="822" bodyend="842"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a9dbd6118923fbeede828f8ee0df460c1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ensure_surface_buffer_is_ready</definition>
        <argsstring>(struct gl_renderer *gr, struct gl_surface_state *gs)</argsstring>
        <name>ensure_surface_buffer_is_ready</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref> *</type>
          <declname>gs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="845" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="845" bodyend="908"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a82100f30b16821b14cf4d3e97bcef6ff" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void maybe_censor_override</definition>
        <argsstring>(struct gl_shader_config *sconf, struct weston_output *output, struct weston_view *ev)</argsstring>
        <name>maybe_censor_override</name>
        <param>
          <type>struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>ev</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="920" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="920" bodyend="953"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ae0b5c16fdf73b565c63698710d01a378" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_shader_config_set_input_textures</definition>
        <argsstring>(struct gl_shader_config *sconf, struct gl_surface_state *gs)</argsstring>
        <name>gl_shader_config_set_input_textures</name>
        <param>
          <type>struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <param>
          <type>struct <ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref> *</type>
          <declname>gs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="956" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="956" bodyend="971"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a41745a7e5eb8cf17a71b494b99743d36" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool gl_shader_config_init_for_view</definition>
        <argsstring>(struct gl_shader_config *sconf, struct weston_view *view, struct weston_output *output, GLint filter)</argsstring>
        <name>gl_shader_config_init_for_view</name>
        <param>
          <type>struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>view</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>GLint</type>
          <declname>filter</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="974" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="974" bodyend="991"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a36ad39ab042011505a247995a594e775" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void draw_view</definition>
        <argsstring>(struct weston_view *ev, struct weston_output *output, pixman_region32_t *damage)</argsstring>
        <name>draw_view</name>
        <param>
          <type>struct <ref refid="structweston__view" kindref="compound">weston_view</ref> *</type>
          <declname>ev</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="994" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="994" bodyend="1089"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void repaint_views</definition>
        <argsstring>(struct weston_output *output, pixman_region32_t *damage)</argsstring>
        <name>repaint_views</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1092" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1092" bodyend="1100"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_create_fence_fd</definition>
        <argsstring>(struct weston_output *output)</argsstring>
        <name>gl_renderer_create_fence_fd</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3383" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3383" bodyend="3397" declfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" declline="1103" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ae7aa13629feed78bc17796493fef079c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void update_buffer_release_fences</definition>
        <argsstring>(struct weston_compositor *compositor, struct weston_output *output)</argsstring>
        <name>update_buffer_release_fences</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>compositor</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1110" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1110" bodyend="1167"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void draw_output_border_texture</definition>
        <argsstring>(struct gl_renderer *gr, struct gl_output_state *go, struct gl_shader_config *sconf, enum gl_renderer_border_side side, int32_t x, int32_t y, int32_t width, int32_t height)</argsstring>
        <name>draw_output_border_texture</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structgl__output__state" kindref="compound">gl_output_state</ref> *</type>
          <declname>go</declname>
        </param>
        <param>
          <type>struct <ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref> *</type>
          <declname>sconf</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403" kindref="member">gl_renderer_border_side</ref></type>
          <declname>side</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>x</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>y</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>width</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1170" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1170" bodyend="1237"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac6ff6ac3041a7d253fdd68ad98b4b265" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int output_has_borders</definition>
        <argsstring>(struct weston_output *output)</argsstring>
        <name>output_has_borders</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1240" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1240" bodyend="1248"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a2a0db6729b1a75620c5263d2d6b4811a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void draw_output_borders</definition>
        <argsstring>(struct weston_output *output, enum gl_border_status border_status)</argsstring>
        <name>draw_output_borders</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref></type>
          <declname>border_status</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1251" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1251" bodyend="1303"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a49a30139d23e9af74bb99fe05604e7d8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void output_get_border_damage</definition>
        <argsstring>(struct weston_output *output, enum gl_border_status border_status, pixman_region32_t *damage)</argsstring>
        <name>output_get_border_damage</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref></type>
          <declname>border_status</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1306" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1306" bodyend="1340"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ade544e39c643489857aed93c1a81b2fd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void output_get_damage</definition>
        <argsstring>(struct weston_output *output, pixman_region32_t *buffer_damage, uint32_t *border_damage)</argsstring>
        <name>output_get_damage</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>buffer_damage</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>border_damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1343" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1343" bodyend="1382"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aa77706f90bc8ff81603e6d9121364119" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void output_rotate_damage</definition>
        <argsstring>(struct weston_output *output, pixman_region32_t *output_damage, enum gl_border_status border_status)</argsstring>
        <name>output_rotate_damage</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>output_damage</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref></type>
          <declname>border_status</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1385" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1385" bodyend="1400"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a3181aad2ffe2a4c02d20a74d0bd05ec4" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void pixman_region_to_egl_y_invert</definition>
        <argsstring>(struct weston_output *output, struct pixman_region32 *global_region, EGLint **rects, EGLint *nrects)</argsstring>
        <name>pixman_region_to_egl_y_invert</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>struct pixman_region32 *</type>
          <declname>global_region</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref> **</type>
          <declname>rects</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref> *</type>
          <declname>nrects</declname>
        </param>
        <briefdescription>
<para>Given a region in Weston&apos;s (top-left-origin) global co-ordinate space, translate it to the co-ordinate space used by GL for our output rendering. </para>
        </briefdescription>
        <detaileddescription>
<para>This requires shifting it into output co-ordinate space: translating for output offset within the global co-ordinate space, multiplying by output scale to get buffer rather than logical size.</para>
<para>Finally, if borders are drawn around the output, we translate the area to account for the border region around the outside, and add any damage if the borders have been redrawn.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>output</parametername>
</parameternamelist>
<parameterdescription>
<para>The output whose co-ordinate space we are after </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>global_region</parametername>
</parameternamelist>
<parameterdescription>
<para>The affected region in global co-ordinate space </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername direction="out">rects</parametername>
</parameternamelist>
<parameterdescription>
<para>Y-inverted quads in {x,y,w,h} order; caller must free </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername direction="out">nrects</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of quads (4x number of co-ordinates) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1419" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1419" bodyend="1469"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a8d33d410610a2c518b0d75f600d59ec5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void blit_shadow_to_output</definition>
        <argsstring>(struct weston_output *output, pixman_region32_t *output_damage)</argsstring>
        <name>blit_shadow_to_output</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>output_damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1472" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1472" bodyend="1539"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a34db4fc09924159f0101aafee06c64ca" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_repaint_output</definition>
        <argsstring>(struct weston_output *output, pixman_region32_t *output_damage)</argsstring>
        <name>gl_renderer_repaint_output</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_region32_t *</type>
          <declname>output_damage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1550" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1550" bodyend="1717"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a27c525c114d7039365db4b428b64cb59" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_read_pixels</definition>
        <argsstring>(struct weston_output *output, pixman_format_code_t format, void *pixels, uint32_t x, uint32_t y, uint32_t width, uint32_t height)</argsstring>
        <name>gl_renderer_read_pixels</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>pixman_format_code_t</type>
          <declname>format</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>pixels</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>x</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>y</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>width</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1720" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1720" bodyend="1750"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a357c9c9246246881b1254df48d71e8c9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>GLenum</type>
        <definition>static GLenum gl_format_from_internal</definition>
        <argsstring>(GLenum internal_format)</argsstring>
        <name>gl_format_from_internal</name>
        <param>
          <type>GLenum</type>
          <declname>internal_format</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1753" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1753" bodyend="1763"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ab9a84e745915a5667f066e510a9621da" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_flush_damage</definition>
        <argsstring>(struct weston_surface *surface)</argsstring>
        <name>gl_renderer_flush_damage</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1766" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1766" bodyend="1862"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a715bd1ab3af0516ef379aea7cb8805b1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void ensure_textures</definition>
        <argsstring>(struct gl_surface_state *gs, GLenum target, int num_textures)</argsstring>
        <name>ensure_textures</name>
        <param>
          <type>struct <ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref> *</type>
          <declname>gs</declname>
        </param>
        <param>
          <type>GLenum</type>
          <declname>target</declname>
        </param>
        <param>
          <type>int</type>
          <declname>num_textures</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1865" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1865" bodyend="1882"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac15d61a7b5996056050902211f4e74c6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_attach_shm</definition>
        <argsstring>(struct weston_surface *es, struct weston_buffer *buffer, struct wl_shm_buffer *shm_buffer)</argsstring>
        <name>gl_renderer_attach_shm</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>es</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__buffer" kindref="compound">weston_buffer</ref> *</type>
          <declname>buffer</declname>
        </param>
        <param>
          <type>struct wl_shm_buffer *</type>
          <declname>shm_buffer</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="1885" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="1885" bodyend="2027"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a4eecccd4496854b60c88c9c728687f95" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_attach_egl</definition>
        <argsstring>(struct weston_surface *es, struct weston_buffer *buffer, uint32_t format)</argsstring>
        <name>gl_renderer_attach_egl</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>es</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__buffer" kindref="compound">weston_buffer</ref> *</type>
          <declname>buffer</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>format</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2030" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2030" bodyend="2109"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a753ea58196ae2dafc3e366882e82b5dd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_destroy_dmabuf</definition>
        <argsstring>(struct linux_dmabuf_buffer *dmabuf)</argsstring>
        <name>gl_renderer_destroy_dmabuf</name>
        <param>
          <type>struct <ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref> *</type>
          <declname>dmabuf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2112" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2112" bodyend="2117"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ab7539048adffcfbb62ea653abe5e483e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
        <definition>static struct egl_image* import_simple_dmabuf</definition>
        <argsstring>(struct gl_renderer *gr, struct dmabuf_attributes *attributes)</argsstring>
        <name>import_simple_dmabuf</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref> *</type>
          <declname>attributes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2120" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2120" bodyend="2217"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a125e434438aeff91612e0acc0cfaa83b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structegl__image" kindref="compound">egl_image</ref> *</type>
        <definition>static struct egl_image* import_dmabuf_single_plane</definition>
        <argsstring>(struct gl_renderer *gr, const struct dmabuf_attributes *attributes, struct yuv_plane_descriptor *descriptor)</argsstring>
        <name>import_dmabuf_single_plane</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>const struct <ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref> *</type>
          <declname>attributes</declname>
        </param>
        <param>
          <type>struct <ref refid="structyuv__plane__descriptor" kindref="compound">yuv_plane_descriptor</ref> *</type>
          <declname>descriptor</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2309" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2309" bodyend="2335"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a0278911981019055a8b9d5391769f986" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool import_yuv_dmabuf</definition>
        <argsstring>(struct gl_renderer *gr, struct dmabuf_image *image)</argsstring>
        <name>import_yuv_dmabuf</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref> *</type>
          <declname>image</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2338" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2338" bodyend="2403"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aa182dc1bbfb01f0bb59772cf08fc4361" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_query_dmabuf_modifiers_full</definition>
        <argsstring>(struct gl_renderer *gr, int format, uint64_t **modifiers, unsigned **external_only, int *num_modifiers)</argsstring>
        <name>gl_renderer_query_dmabuf_modifiers_full</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>int</type>
          <declname>format</declname>
        </param>
        <param>
          <type>uint64_t **</type>
          <declname>modifiers</declname>
        </param>
        <param>
          <type>unsigned **</type>
          <declname>external_only</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>num_modifiers</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2573" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2573" bodyend="2614" declfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" declline="2406" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a14dfa27665eaaab78aadccb2febbbfc1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref> *</type>
        <definition>static struct dmabuf_format* dmabuf_format_create</definition>
        <argsstring>(struct gl_renderer *gr, uint32_t format)</argsstring>
        <name>dmabuf_format_create</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>format</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2412" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2412" bodyend="2434"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a53e62eb0e0d93a1c8d8aa355f4f729de" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void dmabuf_format_destroy</definition>
        <argsstring>(struct dmabuf_format *format)</argsstring>
        <name>dmabuf_format_destroy</name>
        <param>
          <type>struct <ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref> *</type>
          <declname>format</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2437" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2437" bodyend="2443"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a37e95929fded66426751fc9790dbfe14" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>GLenum</type>
        <definition>static GLenum choose_texture_target</definition>
        <argsstring>(struct gl_renderer *gr, struct dmabuf_attributes *attributes)</argsstring>
        <name>choose_texture_target</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref> *</type>
          <declname>attributes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2446" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2446" bodyend="2488"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a973b2f541e84147d29d820e7c2458d82" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct <ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref> *</type>
        <definition>static struct dmabuf_image* import_dmabuf</definition>
        <argsstring>(struct gl_renderer *gr, struct linux_dmabuf_buffer *dmabuf)</argsstring>
        <name>import_dmabuf</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref> *</type>
          <declname>dmabuf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2491" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2491" bodyend="2524"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a97ae83f934c4ca1f9ed56bc303da1fd2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_query_dmabuf_formats</definition>
        <argsstring>(struct weston_compositor *wc, int **formats, int *num_formats)</argsstring>
        <name>gl_renderer_query_dmabuf_formats</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>wc</declname>
        </param>
        <param>
          <type>int **</type>
          <declname>formats</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>num_formats</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2527" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2527" bodyend="2570"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a4ea2f687149f0196c66bb147c16e350f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_query_dmabuf_modifiers</definition>
        <argsstring>(struct weston_compositor *wc, int format, uint64_t **modifiers, int *num_modifiers)</argsstring>
        <name>gl_renderer_query_dmabuf_modifiers</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>wc</declname>
        </param>
        <param>
          <type>int</type>
          <declname>format</declname>
        </param>
        <param>
          <type>uint64_t **</type>
          <declname>modifiers</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>num_modifiers</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2617" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2617" bodyend="2625"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a372d17adc0006b25c14b1b4cef44ea35" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool gl_renderer_import_dmabuf</definition>
        <argsstring>(struct weston_compositor *ec, struct linux_dmabuf_buffer *dmabuf)</argsstring>
        <name>gl_renderer_import_dmabuf</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>ec</declname>
        </param>
        <param>
          <type>struct <ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref> *</type>
          <declname>dmabuf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2628" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2628" bodyend="2662"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1acf0d76eeac0c74ba7cdc2f380aff6885" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool import_known_dmabuf</definition>
        <argsstring>(struct gl_renderer *gr, struct dmabuf_image *image)</argsstring>
        <name>import_known_dmabuf</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type>struct <ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref> *</type>
          <declname>image</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2665" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2665" bodyend="2687"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a4d050268fd3be1cc5a8343debe4303e6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool dmabuf_is_opaque</definition>
        <argsstring>(struct linux_dmabuf_buffer *dmabuf)</argsstring>
        <name>dmabuf_is_opaque</name>
        <param>
          <type>struct <ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref> *</type>
          <declname>dmabuf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2690" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2690" bodyend="2700"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a8468566a577646cfe6fb16b64c0aa581" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_attach_dmabuf</definition>
        <argsstring>(struct weston_surface *surface, struct weston_buffer *buffer, struct linux_dmabuf_buffer *dmabuf)</argsstring>
        <name>gl_renderer_attach_dmabuf</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__buffer" kindref="compound">weston_buffer</ref> *</type>
          <declname>buffer</declname>
        </param>
        <param>
          <type>struct <ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref> *</type>
          <declname>dmabuf</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2703" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2703" bodyend="2778"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a3eed0faf6171d0306e4f45ab1f4f809d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_attach</definition>
        <argsstring>(struct weston_surface *es, struct weston_buffer *buffer)</argsstring>
        <name>gl_renderer_attach</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>es</declname>
        </param>
        <param>
          <type>struct <ref refid="structweston__buffer" kindref="compound">weston_buffer</ref> *</type>
          <declname>buffer</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2781" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2781" bodyend="2834"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ab63554e4caedb0a18300ec685a7e3f10" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_surface_set_color</definition>
        <argsstring>(struct weston_surface *surface, float red, float green, float blue, float alpha)</argsstring>
        <name>gl_renderer_surface_set_color</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <param>
          <type>float</type>
          <declname>red</declname>
        </param>
        <param>
          <type>float</type>
          <declname>green</declname>
        </param>
        <param>
          <type>float</type>
          <declname>blue</declname>
        </param>
        <param>
          <type>float</type>
          <declname>alpha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2837" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2837" bodyend="2851"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a525424c31f88ecea126e2d4cfb0d7741" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_surface_get_content_size</definition>
        <argsstring>(struct weston_surface *surface, int *width, int *height)</argsstring>
        <name>gl_renderer_surface_get_content_size</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>width</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2854" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2854" bodyend="2866"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac60620d8dd8d405aaa853182c05cd714" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint32_t</type>
        <definition>static uint32_t pack_color</definition>
        <argsstring>(pixman_format_code_t format, float *c)</argsstring>
        <name>pack_color</name>
        <param>
          <type>pixman_format_code_t</type>
          <declname>format</declname>
        </param>
        <param>
          <type>float *</type>
          <declname>c</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2869" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2869" bodyend="2883"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a64d6965a90d20b5725f85a92c80d9227" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_surface_copy_content</definition>
        <argsstring>(struct weston_surface *surface, void *target, size_t size, int src_x, int src_y, int width, int height)</argsstring>
        <name>gl_renderer_surface_copy_content</name>
        <param>
          <type>struct <ref refid="structweston__surface" kindref="compound">weston_surface</ref> *</type>
          <declname>surface</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>target</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>size</declname>
        </param>
        <param>
          <type>int</type>
          <declname>src_x</declname>
        </param>
        <param>
          <type>int</type>
          <declname>src_y</declname>
        </param>
        <param>
          <type>int</type>
          <declname>width</declname>
        </param>
        <param>
          <type>int</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2886" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2886" bodyend="2994"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a4dc0bafd3ffc0f99240cb2ac8fe1255e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void surface_state_destroy</definition>
        <argsstring>(struct gl_surface_state *gs, struct gl_renderer *gr)</argsstring>
        <name>surface_state_destroy</name>
        <param>
          <type>struct <ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref> *</type>
          <declname>gs</declname>
        </param>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="2997" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="2997" bodyend="3015"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aa110a438acee8cea5b329204ad176515" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void surface_state_handle_surface_destroy</definition>
        <argsstring>(struct wl_listener *listener, void *data)</argsstring>
        <name>surface_state_handle_surface_destroy</name>
        <param>
          <type>struct wl_listener *</type>
          <declname>listener</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3018" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3018" bodyend="3029"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a821e578eb171c4c99d515ef377cadbf3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void surface_state_handle_renderer_destroy</definition>
        <argsstring>(struct wl_listener *listener, void *data)</argsstring>
        <name>surface_state_handle_renderer_destroy</name>
        <param>
          <type>struct wl_listener *</type>
          <declname>listener</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3032" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3032" bodyend="3043"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1acb1879516a5eb18d6a30d1bf77d836fc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void gl_renderer_log_extensions</definition>
        <argsstring>(const char *name, const char *extensions)</argsstring>
        <name>gl_renderer_log_extensions</name>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>extensions</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3087" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3087" bodyend="3107"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ab0422d657ecad7e39c475667db67a085" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void log_egl_info</definition>
        <argsstring>(EGLDisplay egldpy)</argsstring>
        <name>log_egl_info</name>
        <param>
          <type><ref refid="gl-renderer_8h_1a87d55554aa13accdcb0e10eab910c72e" kindref="member">EGLDisplay</ref></type>
          <declname>egldpy</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3110" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3110" bodyend="3125"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a6de923e3da984b708ab8e38b70477225" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void log_gl_info</definition>
        <argsstring>(void)</argsstring>
        <name>log_gl_info</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3128" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3128" bodyend="3146"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aae880f0fafdc938725ae869db58c554a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_output_set_border</definition>
        <argsstring>(struct weston_output *output, enum gl_renderer_border_side side, int32_t width, int32_t height, int32_t tex_width, unsigned char *data)</argsstring>
        <name>gl_renderer_output_set_border</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>enum <ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403" kindref="member">gl_renderer_border_side</ref></type>
          <declname>side</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>width</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>height</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>tex_width</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3149" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3149" bodyend="3172"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a6c4d504b0e8768523a1e604ca3d4ce5e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_setup</definition>
        <argsstring>(struct weston_compositor *ec, EGLSurface egl_surface)</argsstring>
        <name>gl_renderer_setup</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>ec</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref></type>
          <declname>egl_surface</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3655" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3655" bodyend="3797" declfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" declline="3175" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a4c6070ff1fb5b662ec5258d922446710" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref></type>
        <definition>static EGLSurface gl_renderer_create_window_surface</definition>
        <argsstring>(struct gl_renderer *gr, EGLNativeWindowType window_for_legacy, void *window_for_platform, const uint32_t *drm_formats, unsigned drm_formats_count)</argsstring>
        <name>gl_renderer_create_window_surface</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a4007ec919445bd39e1cdbf77c07fc090" kindref="member">EGLNativeWindowType</ref></type>
          <declname>window_for_legacy</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>window_for_platform</declname>
        </param>
        <param>
          <type>const uint32_t *</type>
          <declname>drm_formats</declname>
        </param>
        <param>
          <type>unsigned</type>
          <declname>drm_formats_count</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3178" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3178" bodyend="3205"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac386148038fcc182210857e50f8f0a63" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_output_create</definition>
        <argsstring>(struct weston_output *output, EGLSurface surface)</argsstring>
        <name>gl_renderer_output_create</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref></type>
          <declname>surface</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3208" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3208" bodyend="3265"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aec7c581b0b5456ce0c465781cc7bbd18" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_output_window_create</definition>
        <argsstring>(struct weston_output *output, const struct gl_renderer_output_options *options)</argsstring>
        <name>gl_renderer_output_window_create</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>const struct <ref refid="structgl__renderer__output__options" kindref="compound">gl_renderer_output_options</ref> *</type>
          <declname>options</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3268" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3268" bodyend="3291"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1afbd97b5e78fed70df49d4598d28490ef" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_output_pbuffer_create</definition>
        <argsstring>(struct weston_output *output, const struct gl_renderer_pbuffer_options *options)</argsstring>
        <name>gl_renderer_output_pbuffer_create</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>const struct <ref refid="structgl__renderer__pbuffer__options" kindref="compound">gl_renderer_pbuffer_options</ref> *</type>
          <declname>options</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3294" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3294" bodyend="3345"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ad9ff8094d61d9064badbff54ad29eedb" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_output_destroy</definition>
        <argsstring>(struct weston_output *output)</argsstring>
        <name>gl_renderer_output_destroy</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3348" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3348" bodyend="3380"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1af62a76e37d4c9106c6ef65a389b422ef" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gl_renderer_destroy</definition>
        <argsstring>(struct weston_compositor *ec)</argsstring>
        <name>gl_renderer_destroy</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>ec</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3400" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3400" bodyend="3445"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a1ecf85e437a88a60b1a36825ce407b1c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void output_handle_destroy</definition>
        <argsstring>(struct wl_listener *listener, void *data)</argsstring>
        <name>output_handle_destroy</name>
        <param>
          <type>struct wl_listener *</type>
          <declname>listener</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3448" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3448" bodyend="3459"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aa49e459d45b4a61c1d07d1efbd4f7213" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_create_pbuffer_surface</definition>
        <argsstring>(struct gl_renderer *gr)</argsstring>
        <name>gl_renderer_create_pbuffer_surface</name>
        <param>
          <type>struct <ref refid="structgl__renderer" kindref="compound">gl_renderer</ref> *</type>
          <declname>gr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3462" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3462" bodyend="3491"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1aa24f0204f154a5eabb1fcca2652e77b6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gl_renderer_display_create</definition>
        <argsstring>(struct weston_compositor *ec, const struct gl_renderer_display_options *options)</argsstring>
        <name>gl_renderer_display_create</name>
        <param>
          <type>struct <ref refid="structweston__compositor" kindref="compound">weston_compositor</ref> *</type>
          <declname>ec</declname>
        </param>
        <param>
          <type>const struct <ref refid="structgl__renderer__display__options" kindref="compound">gl_renderer_display_options</ref> *</type>
          <declname>options</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3494" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3494" bodyend="3607"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1a012bbe33b1a7b945671bbe164c5589e3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void fragment_debug_binding</definition>
        <argsstring>(struct weston_keyboard *keyboard, const struct timespec *time, uint32_t key, void *data)</argsstring>
        <name>fragment_debug_binding</name>
        <param>
          <type>struct <ref refid="structweston__keyboard" kindref="compound">weston_keyboard</ref> *</type>
          <declname>keyboard</declname>
        </param>
        <param>
          <type>const struct timespec *</type>
          <declname>time</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>key</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3610" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3610" bodyend="3622"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac655204cf05c02ce3055efae15cefa70" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void fan_debug_repaint_binding</definition>
        <argsstring>(struct weston_keyboard *keyboard, const struct timespec *time, uint32_t key, void *data)</argsstring>
        <name>fan_debug_repaint_binding</name>
        <param>
          <type>struct <ref refid="structweston__keyboard" kindref="compound">weston_keyboard</ref> *</type>
          <declname>keyboard</declname>
        </param>
        <param>
          <type>const struct timespec *</type>
          <declname>time</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>key</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3625" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3625" bodyend="3634"/>
      </memberdef>
      <memberdef kind="function" id="gl-renderer_8c_1ac83b8846440f9c04f8e527ffa2c0fa93" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint32_t</type>
        <definition>static uint32_t get_gl_version</definition>
        <argsstring>(void)</argsstring>
        <name>get_gl_version</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" line="3637" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c" bodystart="3637" bodyend="3652"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Copyright<sp/><sp/>2012<sp/>Intel<sp/>Corporation</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>Copyright<sp/><sp/>2015,2019,2021<sp/>Collabora,<sp/>Ltd.</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>Copyright<sp/><sp/>2016<sp/>NVIDIA<sp/>Corporation</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>Permission<sp/>is<sp/>hereby<sp/>granted,<sp/>free<sp/>of<sp/>charge,<sp/>to<sp/>any<sp/>person<sp/>obtaining</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>a<sp/>copy<sp/>of<sp/>this<sp/>software<sp/>and<sp/>associated<sp/>documentation<sp/>files<sp/>(the</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>&quot;Software&quot;),<sp/>to<sp/>deal<sp/>in<sp/>the<sp/>Software<sp/>without<sp/>restriction,<sp/>including</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/>without<sp/>limitation<sp/>the<sp/>rights<sp/>to<sp/>use,<sp/>copy,<sp/>modify,<sp/>merge,<sp/>publish,</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/>distribute,<sp/>sublicense,<sp/>and/or<sp/>sell<sp/>copies<sp/>of<sp/>the<sp/>Software,<sp/>and<sp/>to</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/>permit<sp/>persons<sp/>to<sp/>whom<sp/>the<sp/>Software<sp/>is<sp/>furnished<sp/>to<sp/>do<sp/>so,<sp/>subject<sp/>to</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>the<sp/>following<sp/>conditions:</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>The<sp/>above<sp/>copyright<sp/>notice<sp/>and<sp/>this<sp/>permission<sp/>notice<sp/>(including<sp/>the</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>next<sp/>paragraph)<sp/>shall<sp/>be<sp/>included<sp/>in<sp/>all<sp/>copies<sp/>or<sp/>substantial</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>portions<sp/>of<sp/>the<sp/>Software.</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/>THE<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>&quot;AS<sp/>IS&quot;,<sp/>WITHOUT<sp/>WARRANTY<sp/>OF<sp/>ANY<sp/>KIND,</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*<sp/>EXPRESS<sp/>OR<sp/>IMPLIED,<sp/>INCLUDING<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO<sp/>THE<sp/>WARRANTIES<sp/>OF</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*<sp/>MERCHANTABILITY,<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>AND</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*<sp/>NONINFRINGEMENT.<sp/><sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>AUTHORS<sp/>OR<sp/>COPYRIGHT<sp/>HOLDERS</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>CLAIM,<sp/>DAMAGES<sp/>OR<sp/>OTHER<sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>AN</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/>ACTION<sp/>OF<sp/>CONTRACT,<sp/>TORT<sp/>OR<sp/>OTHERWISE,<sp/>ARISING<sp/>FROM,<sp/>OUT<sp/>OF<sp/>OR<sp/>IN</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/>*<sp/>CONNECTION<sp/>WITH<sp/>THE<sp/>SOFTWARE<sp/>OR<sp/>THE<sp/>USE<sp/>OR<sp/>OTHER<sp/>DEALINGS<sp/>IN<sp/>THE</highlight></codeline>
<codeline lineno="25"><highlight class="comment"><sp/>*<sp/>SOFTWARE.</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;config.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;GLES2/gl2.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;GLES2/gl2ext.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;GLES3/gl3.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdbool.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdint.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ctype.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;float.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;assert.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;linux/input.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;unistd.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="linux-sync-file_8h" kindref="compound">linux-sync-file.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="timeline_8h" kindref="compound">timeline.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gl-renderer_8h" kindref="compound">gl-renderer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gl-renderer-internal_8h" kindref="compound">gl-renderer-internal.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="vertex-clipping_8h" kindref="compound">vertex-clipping.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="linux-dmabuf_8h" kindref="compound">linux-dmabuf.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;linux-dmabuf-unstable-v1-server-protocol.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="linux-explicit-synchronization_8h" kindref="compound">linux-explicit-synchronization.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="pixel-formats_8h" kindref="compound">pixel-formats.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/fd-util.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/helpers.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/platform.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/timespec-util.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/weston-drm-fourcc.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/weston-egl-ext.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>BUFFER_DAMAGE_COUNT<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" kindref="member">BORDER_STATUS_CLEAN</ref><sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5ac2239af957c138ce5fbd1da29dcf5876" kindref="member">BORDER_TOP_DIRTY</ref><sp/>=<sp/>1<sp/>&lt;&lt;<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>,</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a563a0819ed1cfa18c992f9511ffe1cd4" kindref="member">BORDER_LEFT_DIRTY</ref><sp/>=<sp/>1<sp/>&lt;&lt;<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>,</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a02c0c77acf814be2ea455f4305785b60" kindref="member">BORDER_RIGHT_DIRTY</ref><sp/>=<sp/>1<sp/>&lt;&lt;<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ae445009c67c155ec54f35959dfed248e" kindref="member">GL_RENDERER_BORDER_RIGHT</ref>,</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a70dd320e034aa3258d657316b1b284ac" kindref="member">BORDER_BOTTOM_DIRTY</ref><sp/>=<sp/>1<sp/>&lt;&lt;<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>,</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5afe73d5275ac520114d310400d092b9bb" kindref="member">BORDER_ALL_DIRTY</ref><sp/>=<sp/>0xf,</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a955e714fe630ca6d864293605a1d80da" kindref="member">BORDER_SIZE_CHANGED</ref><sp/>=<sp/>0x10</highlight></codeline>
<codeline lineno="72"><highlight class="normal">};</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74" refid="structgl__border__image" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__border__image" kindref="compound">gl_border_image</ref><sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/><ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/><ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/><ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/><ref refid="structgl__border__image_1a7a64d69b74da000da48b95ac7425edb3" kindref="member">tex_width</ref>;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="79"><highlight class="normal">};</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81" refid="structgl__fbo__texture" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref><sp/>{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/><ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref>;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/><ref refid="structgl__fbo__texture_1a6db86c9455344d4ff6f1d4de71f363ca" kindref="member">tex</ref>;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/><ref refid="structgl__fbo__texture_1aa9f44804d5d0ccbb1e214f72794b8ace" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/><ref refid="structgl__fbo__texture_1a63739da3b338ccdb9c0ce0cd1cf39cdf" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="86"><highlight class="normal">};</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88" refid="structgl__output__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/><ref refid="structgl__output__state_1acc706d22ee8bec65f987885e1126ef49" kindref="member">buffer_damage</ref>[<ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>];</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref>;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/><ref refid="structgl__output__state_1a01a050ecd39a8037c246385e97391a19" kindref="member">border_damage</ref>[<ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>];</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__border__image" kindref="compound">gl_border_image</ref><sp/><ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[4];</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/><ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref>;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state_1af8fd29926f661027db2800b4b50d28a9" kindref="member">swap_behavior_is_preserved</ref>;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__matrix" kindref="compound">weston_matrix</ref><sp/><ref refid="structgl__output__state_1a6dea590e5582d9b631ecf9d7301ef1df" kindref="member">output_matrix</ref>;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLSyncKHR<sp/><ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref>,<sp/><ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref>;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>struct<sp/>timeline_render_point::link<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_list<sp/><ref refid="structgl__output__state_1a021618cc7845f82c2af9b7efc8ac6e7b" kindref="member">timeline_render_point_list</ref>;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref><sp/><ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>;</highlight></codeline>
<codeline lineno="105"><highlight class="normal">};</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519d" kindref="member">buffer_type</ref><sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" kindref="member">BUFFER_TYPE_NULL</ref>,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da482261e675f08e847f2a90fff87ef135" kindref="member">BUFFER_TYPE_SOLID</ref>,<sp/></highlight><highlight class="comment">/*<sp/>internal<sp/>solid<sp/>color<sp/>surfaces<sp/>without<sp/>a<sp/>buffer<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da1867b61ecc8948ec383bdaa04bf65f2a" kindref="member">BUFFER_TYPE_SHM</ref>,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da28519cfd07d43aced9d5c5ef11c40951" kindref="member">BUFFER_TYPE_EGL</ref></highlight></codeline>
<codeline lineno="112"><highlight class="normal">};</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref>;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116" refid="structegl__image" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*<ref refid="structegl__image_1aed80ae0dc3949f23f121b0cee842005f" kindref="member">renderer</ref>;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLImageKHR<sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref>;</highlight></codeline>
<codeline lineno="120"><highlight class="normal">};</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519" kindref="member">import_type</ref><sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519ac27e3b406fb878587b258cd9c959ce61" kindref="member">IMPORT_TYPE_INVALID</ref>,</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a778c1b8329477c7763ed59fb4ee0d141" kindref="member">IMPORT_TYPE_DIRECT</ref>,</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a20c9329ebc72fc79241fd90c952643d4" kindref="member">IMPORT_TYPE_GL_CONVERSION</ref></highlight></codeline>
<codeline lineno="126"><highlight class="normal">};</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="structdmabuf__image" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref>;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[3];</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_list<sp/><ref refid="structdmabuf__image_1a94589b2e4d656bf47f6857fe7a8faba7" kindref="member">link</ref>;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519" kindref="member">import_type</ref><sp/><ref refid="structdmabuf__image_1aa1241e414ee6e3a0a98929816c62f8a4" kindref="member">import_type</ref>;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022" kindref="member">gl_shader_texture_variant</ref><sp/><ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref>;</highlight></codeline>
<codeline lineno="136"><highlight class="normal">};</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138" refid="structdmabuf__format" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_list<sp/><ref refid="structdmabuf__format_1a64b4aea734a37f158aa49116dec40c51" kindref="member">link</ref>;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>*<ref refid="structdmabuf__format_1ae6f4aa342e960f7bd1617208318a349b" kindref="member">modifiers</ref>;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>*<ref refid="structdmabuf__format_1a9324580bebc2667dc12aa9b9fc61ee73" kindref="member">external_only</ref>;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__format_1ab8913459d2300031bff051718e386f2c" kindref="member">num_modifiers</ref>;</highlight></codeline>
<codeline lineno="145"><highlight class="normal">};</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147" refid="structyuv__plane__descriptor" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structyuv__plane__descriptor" kindref="compound">yuv_plane_descriptor</ref><sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structyuv__plane__descriptor_1ab5483e4d6bb1fc67db5bd3a6b116afae" kindref="member">width_divisor</ref>;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structyuv__plane__descriptor_1ad69b451c8a65d94b30eda8d1b448156a" kindref="member">height_divisor</ref>;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structyuv__plane__descriptor_1af068ff993eceb8fdb1635db407f4f593" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>;</highlight></codeline>
<codeline lineno="152"><highlight class="normal">};</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaa" kindref="member">texture_type</ref><sp/>{</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa6fdaa33bbdb28cc2a6ca5697e7f16c06" kindref="member">TEXTURE_Y_XUXV_WL</ref>,</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaad746f9a88303f3bc74d595c17e559212" kindref="member">TEXTURE_Y_UV_WL</ref>,</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa4d3f5d0cae94cbe7d56133cb61df2e31" kindref="member">TEXTURE_Y_U_V_WL</ref>,</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa5fb0ce2c6db847f7ae0798829d475c9d" kindref="member">TEXTURE_XYUV_WL</ref></highlight></codeline>
<codeline lineno="159"><highlight class="normal">};</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161" refid="structyuv__format__descriptor" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structyuv__format__descriptor" kindref="compound">yuv_format_descriptor</ref><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structyuv__format__descriptor_1a4a68ea10395297d5d528b30e7c833960" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structyuv__format__descriptor_1afb902191eac1416f513bb6c1accf3889" kindref="member">input_planes</ref>;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structyuv__format__descriptor_1ada04a984c822229ed3fed4b4fda1cd81" kindref="member">output_planes</ref>;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaa" kindref="member">texture_type</ref><sp/><ref refid="structyuv__format__descriptor_1adcd8a906203726fff949da90ba12463d" kindref="member">texture_type</ref>;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structyuv__plane__descriptor" kindref="compound">yuv_plane_descriptor</ref><sp/><ref refid="structyuv__format__descriptor_1a6a4f08557d9c5e11c0fc8a743707df50" kindref="member">plane</ref>[4];</highlight></codeline>
<codeline lineno="167"><highlight class="normal">};</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169" refid="structgl__surface__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/><ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[4];</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/><ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[3];</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1ac926ebf6ccbc0f0a66529912af45fcf5" kindref="member">needs_full_upload</ref>;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/><ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>These<sp/>are<sp/>only<sp/>used<sp/>by<sp/>SHM<sp/>surfaces<sp/>to<sp/>detect<sp/>when<sp/>we<sp/>need</highlight></codeline>
<codeline lineno="178"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>do<sp/>a<sp/>full<sp/>upload<sp/>to<sp/>specify<sp/>a<sp/>new<sp/>internal<sp/>texture</highlight></codeline>
<codeline lineno="179"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>format<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[3];</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref>;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref>*<sp/><ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[3];</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022" kindref="member">gl_shader_texture_variant</ref><sp/><ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref>;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__buffer__reference" kindref="compound">weston_buffer_reference</ref><sp/><ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__buffer__release__reference" kindref="compound">weston_buffer_release_reference</ref><sp/><ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519d" kindref="member">buffer_type</ref><sp/><ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref>;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref>;<sp/></highlight><highlight class="comment">/*<sp/>in<sp/>pixels<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>;<sp/></highlight><highlight class="comment">/*<sp/>in<sp/>pixels<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref>;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref>;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Extension<sp/>needed<sp/>for<sp/>SHM<sp/>YUV<sp/>texture<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[3];<sp/></highlight><highlight class="comment">/*<sp/>offset<sp/>per<sp/>plane<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[3];<sp/><sp/></highlight><highlight class="comment">/*<sp/>horizontal<sp/>subsampling<sp/>per<sp/>plane<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[3];<sp/><sp/></highlight><highlight class="comment">/*<sp/>vertical<sp/>subsampling<sp/>per<sp/>plane<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Whether<sp/>this<sp/>surface<sp/>was<sp/>used<sp/>in<sp/>the<sp/>current<sp/>output<sp/>repaint.</highlight></codeline>
<codeline lineno="203"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Used<sp/>only<sp/>in<sp/>the<sp/>context<sp/>of<sp/>a<sp/>gl_renderer_repaint_output<sp/>call.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a7aa9c0737dd0b7ffe314e61ca5f46844" kindref="member">used_in_output_repaint</ref>;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_listener<sp/><ref refid="structgl__surface__state_1a44a38e6bdffaea7fb65e7ec9f42bfe84" kindref="member">surface_destroy_listener</ref>;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_listener<sp/><ref refid="structgl__surface__state_1ae5dc538b00961768e27100f60a3625fe" kindref="member">renderer_destroy_listener</ref>;</highlight></codeline>
<codeline lineno="208"><highlight class="normal">};</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302" kindref="member">timeline_render_point_type</ref><sp/>{</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302af9e4612108eb99570774874565d36c0f" kindref="member">TIMELINE_RENDER_POINT_TYPE_BEGIN</ref>,</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302a320783c49e602f85f5c11f36ce1e1f86" kindref="member">TIMELINE_RENDER_POINT_TYPE_END</ref></highlight></codeline>
<codeline lineno="213"><highlight class="normal">};</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215" refid="structtimeline__render__point" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref><sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_list<sp/><ref refid="structtimeline__render__point_1a285b8f98ba42fe564b3ed092725b1434" kindref="member">link</ref>;<sp/></highlight><highlight class="comment">/*<sp/>gl_output_state::timeline_render_point_list<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302" kindref="member">timeline_render_point_type</ref><sp/><ref refid="structtimeline__render__point_1aa2c768c472e0640cf6f7dfff81ec670c" kindref="member">type</ref>;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structtimeline__render__point_1a01653c69f82f064e9e3d4695b8b82ee9" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_event_source<sp/>*<ref refid="structtimeline__render__point_1ae7672690fea80d518acf923044aa855d" kindref="member">event_source</ref>;</highlight></codeline>
<codeline lineno="222"><highlight class="normal">};</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(uint16_t<sp/>major,<sp/>uint16_t<sp/>minor)</highlight></codeline>
<codeline lineno="226"><highlight class="normal">{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>((uint32_t)major<sp/>&lt;&lt;<sp/>16)<sp/>|<sp/>minor;</highlight></codeline>
<codeline lineno="228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><ref refid="gl-renderer_8c_1a690ae1156bf3548155179290fb0ef86f" kindref="member">gr_gl_version_major</ref>(uint32_t<sp/>ver)</highlight></codeline>
<codeline lineno="232"><highlight class="normal">{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ver<sp/>&gt;&gt;<sp/>16;</highlight></codeline>
<codeline lineno="234"><highlight class="normal">}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><ref refid="gl-renderer_8c_1aafdd7e372594d386d8ac23f506b0ead1" kindref="member">gr_gl_version_minor</ref>(uint32_t<sp/>ver)</highlight></codeline>
<codeline lineno="238"><highlight class="normal">{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ver<sp/>&amp;<sp/>0xffff;</highlight></codeline>
<codeline lineno="240"><highlight class="normal">}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><ref refid="gl-renderer_8c_1ae8ae9d1cc84c7a5e1b28e5affbe64cbc" kindref="member">dump_format</ref>(uint32_t<sp/>format,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>out[4])</highlight></codeline>
<codeline lineno="244"><highlight class="normal">{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>BYTE_ORDER<sp/>==<sp/>BIG_ENDIAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>format<sp/>=<sp/>__builtin_bswap32(format);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(out,<sp/>&amp;format,<sp/>4);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="250"><highlight class="normal">}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="254"><highlight class="normal">{</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*)<ref refid="structoutput" kindref="compound">output</ref>-&gt;renderer_state;</highlight></codeline>
<codeline lineno="256"><highlight class="normal">}</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><ref refid="gl-renderer_8c_1ab64e604cc7dab39204e8bc963a8e2317" kindref="member">gl_renderer_create_surface</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>)</highlight></codeline>
<codeline lineno="263"><highlight class="normal">{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structsurface" kindref="compound">surface</ref>-&gt;renderer_state)</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab64e604cc7dab39204e8bc963a8e2317" kindref="member">gl_renderer_create_surface</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*)<ref refid="structsurface" kindref="compound">surface</ref>-&gt;renderer_state;</highlight></codeline>
<codeline lineno="268"><highlight class="normal">}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><ref refid="gl-renderer_8c_1a882e8d873d5d851c1b3d1b6f306cbcc4" kindref="member">shadow_exists</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go)</highlight></codeline>
<codeline lineno="272"><highlight class="normal">{</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref><sp/>!=<sp/>0;</highlight></codeline>
<codeline lineno="274"><highlight class="normal">}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><ref refid="gl-renderer_8c_1a520b26cd0da6352bb678758ea5545c67" kindref="member">timeline_render_point_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref><sp/>*trp)</highlight></codeline>
<codeline lineno="278"><highlight class="normal">{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;trp-&gt;<ref refid="structtimeline__render__point_1a285b8f98ba42fe564b3ed092725b1434" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_event_source_remove(trp-&gt;<ref refid="structtimeline__render__point_1ae7672690fea80d518acf923044aa855d" kindref="member">event_source</ref>);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(trp-&gt;<ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(trp);</highlight></codeline>
<codeline lineno="283"><highlight class="normal">}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><ref refid="gl-renderer_8c_1ad4cc0fd7794fddd11c3ea91b2e7cee05" kindref="member">timeline_render_point_handler</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd,<sp/>uint32_t<sp/>mask,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="287"><highlight class="normal">{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref><sp/>*trp<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tp_name<sp/>=<sp/>trp-&gt;<ref refid="structtimeline__render__point_1aa2c768c472e0640cf6f7dfff81ec670c" kindref="member">type</ref><sp/>==<sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302af9e4612108eb99570774874565d36c0f" kindref="member">TIMELINE_RENDER_POINT_TYPE_BEGIN</ref><sp/>?</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;renderer_gpu_begin&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;renderer_gpu_end&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mask<sp/>&amp;<sp/>WL_EVENT_READABLE)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">timespec<sp/>tspec<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="linux-sync-file_8c_1a8a3a2a81efb75a2bee97acb9f24d0f1b" kindref="member">weston_linux_sync_file_read_timestamp</ref>(trp-&gt;<ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>,</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;tspec)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__log_1ga3d4fa53ee35cc16bfc3e78fb964bcdd1" kindref="member">TL_POINT</ref>(trp-&gt;<ref refid="structtimeline__render__point_1a01653c69f82f064e9e3d4695b8b82ee9" kindref="member">output</ref>-&gt;<ref refid="structweston__output_1ab4b884d4d420d4254723d12f7650e878" kindref="member">compositor</ref>,<sp/>tp_name,<sp/><ref refid="timeline_8h_1a24fad23a0781aab216ac9a6c845c7740" kindref="member">TLP_GPU</ref>(&amp;tspec),</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="timeline_8h_1a11f747612f1496b3fa2464323c77d153" kindref="member">TLP_OUTPUT</ref>(trp-&gt;<ref refid="structtimeline__render__point_1a01653c69f82f064e9e3d4695b8b82ee9" kindref="member">output</ref>),<sp/><ref refid="group__log_1ga54b3c5c32cc5f3527c9a3d11e0d9f54d" kindref="member">TLP_END</ref>);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a520b26cd0da6352bb678758ea5545c67" kindref="member">timeline_render_point_destroy</ref>(trp);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="305"><highlight class="normal">}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>EGLSyncKHR</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><ref refid="gl-renderer_8c_1a311a6801d5d60a6183ea362ae2b2896d" kindref="member">create_render_sync</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr)</highlight></codeline>
<codeline lineno="309"><highlight class="normal">{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>attribs[]<sp/>=<sp/>{<sp/>EGL_NONE<sp/>};</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a565fad372070dd5710626b6a7c1fea5c" kindref="member">has_native_fence_sync</ref>)</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>EGL_NO_SYNC_KHR;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>gr-&gt;<ref refid="structgl__renderer_1a0d32e80810899d87319869d417efc5e3" kindref="member">create_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>EGL_SYNC_NATIVE_FENCE_ANDROID,</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs);</highlight></codeline>
<codeline lineno="317"><highlight class="normal">}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><ref refid="gl-renderer_8c_1a59f1b4cc1d6cb2d6e21e9129792004c7" kindref="member">timeline_submit_render_sync</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLSyncKHR<sp/>sync,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302" kindref="member">timeline_render_point_type</ref><sp/>type)</highlight></codeline>
<codeline lineno="324"><highlight class="normal">{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_event_loop<sp/>*loop;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref><sp/>*trp;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structweston__log__scope_1aa2f05b02a0c471f5dbcf7d78816aa045" kindref="member">weston_log_scope_is_enabled</ref>(gr-&gt;<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref>-&gt;<ref refid="structweston__compositor_1adfcfd084e55976891e8a742c3c2490af" kindref="member">timeline</ref>)<sp/>||</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!gr-&gt;<ref refid="structgl__renderer_1a565fad372070dd5710626b6a7c1fea5c" kindref="member">has_native_fence_sync</ref><sp/>||</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sync<sp/>==<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loop<sp/>=<sp/>wl_display_get_event_loop(gr-&gt;<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref>-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref><sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a32d839fb862a9fb6c723d8d03297bf0e" kindref="member">dup_native_fence_fd</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>sync);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref><sp/>==<sp/>EGL_NO_NATIVE_FENCE_FD_ANDROID)</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*trp);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trp<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp-&gt;<ref refid="structtimeline__render__point_1aa2c768c472e0640cf6f7dfff81ec670c" kindref="member">type</ref><sp/>=<sp/><ref refid="structtimeline__render__point_1aa2c768c472e0640cf6f7dfff81ec670c" kindref="member">type</ref>;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp-&gt;<ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref><sp/>=<sp/><ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp-&gt;<ref refid="structtimeline__render__point_1a01653c69f82f064e9e3d4695b8b82ee9" kindref="member">output</ref><sp/>=<sp/><ref refid="structtimeline__render__point_1a01653c69f82f064e9e3d4695b8b82ee9" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp-&gt;<ref refid="structtimeline__render__point_1ae7672690fea80d518acf923044aa855d" kindref="member">event_source</ref><sp/>=<sp/>wl_event_loop_add_fd(loop,<sp/><ref refid="structtimeline__render__point_1a6da4972dbf321c7809698de32f48a00b" kindref="member">fd</ref>,</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WL_EVENT_READABLE,</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ad4cc0fd7794fddd11c3ea91b2e7cee05" kindref="member">timeline_render_point_handler</ref>,</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trp);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_insert(&amp;go-&gt;<ref refid="structgl__output__state_1a021618cc7845f82c2af9b7efc8ac6e7b" kindref="member">timeline_render_point_list</ref>,<sp/>&amp;trp-&gt;<ref refid="structtimeline__render__point_1a285b8f98ba42fe564b3ed092725b1434" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="357"><highlight class="normal">}</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref>*</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><ref refid="gl-renderer_8c_1a49160dcc2d7db45ce16ab4f31f1c2270" kindref="member">egl_image_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,<sp/><ref refid="gl-renderer_8h_1a3403e7aa1af3a3a900c4fb0584d680a5" kindref="member">EGLenum</ref><sp/>target,</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLClientBuffer<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>*attribs)</highlight></codeline>
<codeline lineno="362"><highlight class="normal">{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*img;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*img);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img-&gt;<ref refid="structegl__image_1aed80ae0dc3949f23f121b0cee842005f" kindref="member">renderer</ref><sp/>=<sp/>gr;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img-&gt;<ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img-&gt;<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref><sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a2cfb8e070f960ca36b2524aef7ae0816" kindref="member">create_image</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>EGL_NO_CONTEXT,</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>,<sp/>attribs);</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(img-&gt;<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref><sp/>==<sp/>EGL_NO_IMAGE_KHR)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(img);</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>img;</highlight></codeline>
<codeline lineno="377"><highlight class="normal">}</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref>*</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><ref refid="gl-renderer_8c_1ae2f06a72405c4e2e30c5567ffef5430b" kindref="member">egl_image_ref</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>)</highlight></codeline>
<codeline lineno="381"><highlight class="normal">{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>-&gt;refcount++;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="385"><highlight class="normal">}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>)</highlight></codeline>
<codeline lineno="389"><highlight class="normal">{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/>image-&gt;<ref refid="structegl__image_1aed80ae0dc3949f23f121b0cee842005f" kindref="member">renderer</ref>;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(image-&gt;<ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref><sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref>--;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(image-&gt;<ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref><sp/>&gt;<sp/>0)</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>image-&gt;<ref refid="structegl__image_1a4014f68c22194648182be202a48a245f" kindref="member">refcount</ref>;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a40c0fa4fd0b6cfae3ab6c70b31d6f525" kindref="member">destroy_image</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>image-&gt;<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(image);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="402"><highlight class="normal">}</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref>*</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><ref refid="gl-renderer_8c_1a02947a9d03f0d2153b470d061a218f1d" kindref="member">dmabuf_image_create</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="406"><highlight class="normal">{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*img;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*img);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;img-&gt;<ref refid="structdmabuf__image_1a94589b2e4d656bf47f6857fe7a8faba7" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>img;</highlight></codeline>
<codeline lineno="413"><highlight class="normal">}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><ref refid="gl-renderer_8c_1a9aa2823f0af7287f156ba09272a7fecc" kindref="member">dmabuf_image_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image)</highlight></codeline>
<codeline lineno="417"><highlight class="normal">{</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref>;<sp/>++i)</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(image-&gt;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>)</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-dmabuf_8c_1a21027f0ac30b114a8ade4f4283f2fe52" kindref="member">linux_dmabuf_buffer_set_user_data</ref>(image-&gt;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>,<sp/>NULL,<sp/>NULL);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;image-&gt;<ref refid="structdmabuf__image_1a94589b2e4d656bf47f6857fe7a8faba7" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(image);</highlight></codeline>
<codeline lineno="428"><highlight class="normal">}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>max(a,<sp/>b)<sp/>(((a)<sp/>&gt;<sp/>(b))<sp/>?<sp/>(a)<sp/>:<sp/>(b))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>min(a,<sp/>b)<sp/>(((a)<sp/>&gt;<sp/>(b))<sp/>?<sp/>(b)<sp/>:<sp/>(a))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="434"><highlight class="comment"><sp/>*<sp/>Compute<sp/>the<sp/>boundary<sp/>vertices<sp/>of<sp/>the<sp/>intersection<sp/>of<sp/>the<sp/>global<sp/>coordinate</highlight></codeline>
<codeline lineno="435"><highlight class="comment"><sp/>*<sp/>aligned<sp/>rectangle<sp/>&apos;rect&apos;,<sp/>and<sp/>an<sp/>arbitrary<sp/>quadrilateral<sp/>produced<sp/>from</highlight></codeline>
<codeline lineno="436"><highlight class="comment"><sp/>*<sp/>&apos;surf_rect&apos;<sp/>when<sp/>transformed<sp/>from<sp/>surface<sp/>coordinates<sp/>into<sp/>global<sp/>coordinates.</highlight></codeline>
<codeline lineno="437"><highlight class="comment"><sp/>*<sp/>The<sp/>vertices<sp/>are<sp/>written<sp/>to<sp/>&apos;ex&apos;<sp/>and<sp/>&apos;ey&apos;,<sp/>and<sp/>the<sp/>return<sp/>value<sp/>is<sp/>the</highlight></codeline>
<codeline lineno="438"><highlight class="comment"><sp/>*<sp/>number<sp/>of<sp/>vertices.<sp/>Vertices<sp/>are<sp/>produced<sp/>in<sp/>clockwise<sp/>winding<sp/>order.</highlight></codeline>
<codeline lineno="439"><highlight class="comment"><sp/>*<sp/>Guarantees<sp/>to<sp/>produce<sp/>either<sp/>zero<sp/>vertices,<sp/>or<sp/>3-8<sp/>vertices<sp/>with<sp/>non-zero</highlight></codeline>
<codeline lineno="440"><highlight class="comment"><sp/>*<sp/>polygon<sp/>area.</highlight></codeline>
<codeline lineno="441"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><ref refid="gl-renderer_8c_1a7fc5a914b682f4851c6eb792cf625855" kindref="member">calculate_edges</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*ev,<sp/>pixman_box32_t<sp/>*rect,</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*surf_rect,<sp/>GLfloat<sp/>*ex,<sp/>GLfloat<sp/>*ey)</highlight></codeline>
<codeline lineno="445"><highlight class="normal">{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structclip__context" kindref="compound">clip_context</ref><sp/>ctx;</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>n;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>min_x,<sp/>max_x,<sp/>min_y,<sp/>max_y;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structpolygon8" kindref="compound">polygon8</ref><sp/>surf<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>surf_rect-&gt;x1,<sp/>surf_rect-&gt;x2,<sp/>surf_rect-&gt;x2,<sp/>surf_rect-&gt;x1<sp/>},</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>surf_rect-&gt;y1,<sp/>surf_rect-&gt;y1,<sp/>surf_rect-&gt;y2,<sp/>surf_rect-&gt;y2<sp/>},</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.clip.x1<sp/>=<sp/>rect-&gt;x1;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.clip.y1<sp/>=<sp/>rect-&gt;y1;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.clip.x2<sp/>=<sp/>rect-&gt;x2;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.clip.y2<sp/>=<sp/>rect-&gt;y2;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>transform<sp/>surface<sp/>to<sp/>screen<sp/>space:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>surf.<ref refid="structpolygon8_1afd03a44a5ef1bcb84b9870194746df75" kindref="member">n</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a1666f1b9cb32183712d16d893af00dae" kindref="member">weston_view_to_global_float</ref>(ev,<sp/>surf.<ref refid="structpolygon8_1afa55ed76396a42e950e7ac6524985479" kindref="member">x</ref>[i],<sp/>surf.<ref refid="structpolygon8_1a978b26eb8f59cfc6a49665af7170fdc0" kindref="member">y</ref>[i],</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;surf.<ref refid="structpolygon8_1afa55ed76396a42e950e7ac6524985479" kindref="member">x</ref>[i],<sp/>&amp;surf.<ref refid="structpolygon8_1a978b26eb8f59cfc6a49665af7170fdc0" kindref="member">y</ref>[i]);</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>find<sp/>bounding<sp/>box:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_x<sp/>=<sp/>max_x<sp/>=<sp/>surf.<ref refid="structpolygon8_1afa55ed76396a42e950e7ac6524985479" kindref="member">x</ref>[0];</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_y<sp/>=<sp/>max_y<sp/>=<sp/>surf.<ref refid="structpolygon8_1a978b26eb8f59cfc6a49665af7170fdc0" kindref="member">y</ref>[0];</highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>surf.<ref refid="structpolygon8_1afd03a44a5ef1bcb84b9870194746df75" kindref="member">n</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_x<sp/>=<sp/><ref refid="gl-renderer_8c_1ac6afabdc09a49a433ee19d8a9486056d" kindref="member">min</ref>(min_x,<sp/>surf.<ref refid="structpolygon8_1afa55ed76396a42e950e7ac6524985479" kindref="member">x</ref>[i]);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_x<sp/>=<sp/><ref refid="gl-renderer_8c_1affe776513b24d84b39af8ab0930fef7f" kindref="member">max</ref>(max_x,<sp/>surf.<ref refid="structpolygon8_1afa55ed76396a42e950e7ac6524985479" kindref="member">x</ref>[i]);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_y<sp/>=<sp/><ref refid="gl-renderer_8c_1ac6afabdc09a49a433ee19d8a9486056d" kindref="member">min</ref>(min_y,<sp/>surf.<ref refid="structpolygon8_1a978b26eb8f59cfc6a49665af7170fdc0" kindref="member">y</ref>[i]);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_y<sp/>=<sp/><ref refid="gl-renderer_8c_1affe776513b24d84b39af8ab0930fef7f" kindref="member">max</ref>(max_y,<sp/>surf.<ref refid="structpolygon8_1a978b26eb8f59cfc6a49665af7170fdc0" kindref="member">y</ref>[i]);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>First,<sp/>simple<sp/>bounding<sp/>box<sp/>check<sp/>to<sp/>discard<sp/>early<sp/>transformed</highlight></codeline>
<codeline lineno="478"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>surface<sp/>rects<sp/>that<sp/>do<sp/>not<sp/>intersect<sp/>with<sp/>the<sp/>clip<sp/>region:</highlight></codeline>
<codeline lineno="479"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((min_x<sp/>&gt;=<sp/>ctx.clip.x2)<sp/>||<sp/>(max_x<sp/>&lt;=<sp/>ctx.clip.x1)<sp/>||</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(min_y<sp/>&gt;=<sp/>ctx.clip.y2)<sp/>||<sp/>(max_y<sp/>&lt;=<sp/>ctx.clip.y1))</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Simple<sp/>case,<sp/>bounding<sp/>box<sp/>edges<sp/>are<sp/>parallel<sp/>to<sp/>surface<sp/>edges,</highlight></codeline>
<codeline lineno="485"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>there<sp/>will<sp/>be<sp/>only<sp/>four<sp/>edges.<sp/><sp/>We<sp/>just<sp/>need<sp/>to<sp/>clip<sp/>the<sp/>surface</highlight></codeline>
<codeline lineno="486"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>vertices<sp/>to<sp/>the<sp/>clip<sp/>rect<sp/>bounds:</highlight></codeline>
<codeline lineno="487"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ev-&gt;<ref refid="structweston__view_1a6f0357af0dd60a9bc84d7df538664f71" kindref="member">transform</ref>.<ref refid="structweston__view_1ad81ff06883a9d4720a6b9400233ab04f" kindref="member">enabled</ref>)</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="vertex-clipping_8c_1a01d6ade516504cf2779d35e5019b1f38" kindref="member">clip_simple</ref>(&amp;ctx,<sp/>&amp;surf,<sp/>ex,<sp/>ey);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Transformed<sp/>case:<sp/>use<sp/>a<sp/>general<sp/>polygon<sp/>clipping<sp/>algorithm<sp/>to</highlight></codeline>
<codeline lineno="492"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>clip<sp/>the<sp/>surface<sp/>rectangle<sp/>with<sp/>each<sp/>side<sp/>of<sp/>&apos;rect&apos;.</highlight></codeline>
<codeline lineno="493"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>algorithm<sp/>is<sp/>Sutherland-Hodgman,<sp/>as<sp/>explained<sp/>in</highlight></codeline>
<codeline lineno="494"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>http://www.codeguru.com/cpp/misc/misc/graphics/article.php/c8965/Polygon-Clipping.htm</highlight></codeline>
<codeline lineno="495"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>but<sp/>without<sp/>looking<sp/>at<sp/>any<sp/>of<sp/>that<sp/>code.</highlight></codeline>
<codeline lineno="496"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structpolygon8_1afd03a44a5ef1bcb84b9870194746df75" kindref="member">n</ref><sp/>=<sp/><ref refid="vertex-clipping_8c_1a5b8916a5086672dc5c79206ea49fc17b" kindref="member">clip_transformed</ref>(&amp;ctx,<sp/>&amp;surf,<sp/>ex,<sp/>ey);</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structpolygon8_1afd03a44a5ef1bcb84b9870194746df75" kindref="member">n</ref><sp/>&lt;<sp/>3)</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structpolygon8_1afd03a44a5ef1bcb84b9870194746df75" kindref="member">n</ref>;</highlight></codeline>
<codeline lineno="503"><highlight class="normal">}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><ref refid="gl-renderer_8c_1afd7772291098f8d5bc4ba35ec1952ab9" kindref="member">merge_down</ref>(pixman_box32_t<sp/>*a,<sp/>pixman_box32_t<sp/>*b,<sp/>pixman_box32_t<sp/>*merge)</highlight></codeline>
<codeline lineno="507"><highlight class="normal">{</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a-&gt;x1<sp/>==<sp/>b-&gt;x1<sp/>&amp;&amp;<sp/>a-&gt;x2<sp/>==<sp/>b-&gt;x2<sp/>&amp;&amp;<sp/>a-&gt;y1<sp/>==<sp/>b-&gt;y2)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>merge-&gt;x1<sp/>=<sp/>a-&gt;x1;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>merge-&gt;x2<sp/>=<sp/>a-&gt;x2;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>merge-&gt;y1<sp/>=<sp/>b-&gt;y1;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>merge-&gt;y2<sp/>=<sp/>a-&gt;y2;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><ref refid="gl-renderer_8c_1a367125d8aeb64661e2a5b7d24b952e76" kindref="member">compress_bands</ref>(pixman_box32_t<sp/>*inrects,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nrects,<sp/>pixman_box32_t<sp/>**outrects)</highlight></codeline>
<codeline lineno="520"><highlight class="normal">{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>merged<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*out,<sp/>merge_rect;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>j,<sp/>nout;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nrects)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*outrects<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="529"><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>nrects<sp/>is<sp/>an<sp/>upper<sp/>bound<sp/>-<sp/>we&apos;re<sp/>not<sp/>too<sp/>worried<sp/>about</highlight></codeline>
<codeline lineno="531"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>allocating<sp/>a<sp/>little<sp/>extra</highlight></codeline>
<codeline lineno="532"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out<sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(pixman_box32_t)<sp/>*<sp/>nrects);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[0]<sp/>=<sp/>inrects[0];</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nout<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>nrects;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nout;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>merged<sp/>=<sp/><ref refid="gl-renderer_8c_1afd7772291098f8d5bc4ba35ec1952ab9" kindref="member">merge_down</ref>(&amp;inrects[i],<sp/>&amp;out[j],<sp/>&amp;merge_rect);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(merged)<sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[j]<sp/>=<sp/>merge_rect;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!merged)<sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[nout]<sp/>=<sp/>inrects[i];</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nout++;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*outrects<sp/>=<sp/>out;</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nout;</highlight></codeline>
<codeline lineno="551"><highlight class="normal">}</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><ref refid="gl-renderer_8c_1a5202426c9e43d635b71aae3ba7d7bb56" kindref="member">texture_region</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*ev,</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*region,</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*surf_region)</highlight></codeline>
<codeline lineno="557"><highlight class="normal">{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>*v,<sp/>inv_width,<sp/>inv_height;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>,<sp/>nvtx<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*rects,<sp/>*surf_rects;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*raw_rects;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>j,<sp/>k,<sp/>nrects,<sp/>nsurf,<sp/>raw_nrects;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>used_band_compression;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>raw_rects<sp/>=<sp/>pixman_region32_rectangles(region,<sp/>&amp;raw_nrects);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>surf_rects<sp/>=<sp/>pixman_region32_rectangles(surf_region,<sp/>&amp;nsurf);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(raw_nrects<sp/>&lt;<sp/>4)<sp/>{</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used_band_compression<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nrects<sp/>=<sp/>raw_nrects;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rects<sp/>=<sp/>raw_rects;</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nrects<sp/>=<sp/><ref refid="gl-renderer_8c_1a367125d8aeb64661e2a5b7d24b952e76" kindref="member">compress_bands</ref>(raw_rects,<sp/>raw_nrects,<sp/>&amp;rects);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used_band_compression<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>worst<sp/>case<sp/>we<sp/>can<sp/>have<sp/>8<sp/>vertices<sp/>per<sp/>rect<sp/>(ie.<sp/>clipped<sp/>into</highlight></codeline>
<codeline lineno="579"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>an<sp/>octagon):</highlight></codeline>
<codeline lineno="580"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>wl_array_add(&amp;gr-&gt;<ref refid="structgl__renderer_1adac0baf7ccf72aec5f5f8af6e578851d" kindref="member">vertices</ref>,<sp/>nrects<sp/>*<sp/>nsurf<sp/>*<sp/>8<sp/>*<sp/>4<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*v);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref><sp/>=<sp/>wl_array_add(&amp;gr-&gt;<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>,<sp/>nrects<sp/>*<sp/>nsurf<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>);</highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>inv_width<sp/>=<sp/>1.0<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref>;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>inv_height<sp/>=<sp/>1.0<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>nrects;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*rect<sp/>=<sp/>&amp;rects[i];</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>nsurf;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*surf_rect<sp/>=<sp/>&amp;surf_rects[j];</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>sx,<sp/>sy,<sp/>bx,<sp/>by;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>ex[8],<sp/>ey[8];<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>edge<sp/>points<sp/>in<sp/>screen<sp/>space<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n;</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>transformed<sp/>surface,<sp/>after<sp/>clipping<sp/>to<sp/>the<sp/>clip<sp/>region,</highlight></codeline>
<codeline lineno="596"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>can<sp/>have<sp/>as<sp/>many<sp/>as<sp/>eight<sp/>sides,<sp/>emitted<sp/>as<sp/>a<sp/>triangle-fan.</highlight></codeline>
<codeline lineno="597"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>first<sp/>vertex<sp/>in<sp/>the<sp/>triangle<sp/>fan<sp/>can<sp/>be<sp/>chosen<sp/>arbitrarily,</highlight></codeline>
<codeline lineno="598"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>since<sp/>the<sp/>area<sp/>is<sp/>guaranteed<sp/>to<sp/>be<sp/>convex.</highlight></codeline>
<codeline lineno="599"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="600"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>If<sp/>a<sp/>corner<sp/>of<sp/>the<sp/>transformed<sp/>surface<sp/>falls<sp/>outside<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="601"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>clip<sp/>region,<sp/>instead<sp/>of<sp/>emitting<sp/>one<sp/>vertex<sp/>for<sp/>the<sp/>corner</highlight></codeline>
<codeline lineno="602"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>of<sp/>the<sp/>surface,<sp/>up<sp/>to<sp/>two<sp/>are<sp/>emitted<sp/>for<sp/>two<sp/>corresponding</highlight></codeline>
<codeline lineno="603"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>intersection<sp/>point(s)<sp/>between<sp/>the<sp/>surface<sp/>and<sp/>the<sp/>clip<sp/>region.</highlight></codeline>
<codeline lineno="604"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="605"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>To<sp/>do<sp/>this,<sp/>we<sp/>first<sp/>calculate<sp/>the<sp/>(up<sp/>to<sp/>eight)<sp/>points<sp/>that</highlight></codeline>
<codeline lineno="606"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>form<sp/>the<sp/>intersection<sp/>of<sp/>the<sp/>clip<sp/>rect<sp/>and<sp/>the<sp/>transformed</highlight></codeline>
<codeline lineno="607"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>surface.</highlight></codeline>
<codeline lineno="608"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/><ref refid="gl-renderer_8c_1a7fc5a914b682f4851c6eb792cf625855" kindref="member">calculate_edges</ref>(ev,<sp/>rect,<sp/>surf_rect,<sp/>ex,<sp/>ey);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>3)</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>emit<sp/>edge<sp/>points:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>n;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a29e66a2344e0ea20637f84c0650ed90d" kindref="member">weston_view_from_global_float</ref>(ev,<sp/>ex[k],<sp/>ey[k],</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;sx,<sp/>&amp;sy);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>position:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(v++)<sp/>=<sp/>ex[k];</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(v++)<sp/>=<sp/>ey[k];</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>texcoord:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a4feb46d02393c29f583d77410b940895" kindref="member">weston_surface_to_buffer_float</ref>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>,</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sx,<sp/>sy,</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;bx,<sp/>&amp;by);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(v++)<sp/>=<sp/>bx<sp/>*<sp/>inv_width;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref>)<sp/>{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(v++)<sp/>=<sp/>by<sp/>*<sp/>inv_height;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(v++)<sp/>=<sp/>(gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>-<sp/>by)<sp/>*<sp/>inv_height;</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>[nvtx++]<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used_band_compression)</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(rects);</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nvtx;</highlight></codeline>
<codeline lineno="639"><highlight class="normal">}</highlight></codeline>
<codeline lineno="640"><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><ref refid="gl-renderer_8c_1aeaf10b41e911de6a80a1885227a0c2b6" kindref="member">gl_fbo_texture_init</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref><sp/>*fbotex,</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>width,</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>height,</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLint<sp/>internal_format,</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>format,</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>type)</highlight></codeline>
<codeline lineno="658"><highlight class="normal">{</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fb_status;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/>shadow_fbo;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/>shadow_tex;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenTextures(1,<sp/>&amp;shadow_tex);</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>shadow_tex);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexImage2D(GL_TEXTURE_2D,<sp/>0,<sp/>internal_format,<sp/>width,<sp/>height,<sp/>0,</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>format,<sp/>type,<sp/>NULL);</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(GL_TEXTURE_2D,<sp/>GL_TEXTURE_MIN_FILTER,<sp/>GL_NEAREST);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(GL_TEXTURE_2D,<sp/>GL_TEXTURE_MAG_FILTER,<sp/>GL_NEAREST);</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>0);</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenFramebuffers(1,<sp/>&amp;shadow_fbo);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>shadow_fbo);</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glFramebufferTexture2D(GL_FRAMEBUFFER,<sp/>GL_COLOR_ATTACHMENT0,</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_TEXTURE_2D,<sp/>shadow_tex,<sp/>0);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fb_status<sp/>=<sp/>glCheckFramebufferStatus(GL_FRAMEBUFFER);</highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>0);</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fb_status<sp/>!=<sp/>GL_FRAMEBUFFER_COMPLETE)<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteFramebuffers(1,<sp/>&amp;shadow_fbo);</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(1,<sp/>&amp;shadow_tex);</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref><sp/>=<sp/>shadow_fbo;</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1a6db86c9455344d4ff6f1d4de71f363ca" kindref="member">tex</ref><sp/>=<sp/>shadow_tex;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1aa9f44804d5d0ccbb1e214f72794b8ace" kindref="member">width</ref><sp/>=<sp/>width;</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1a63739da3b338ccdb9c0ce0cd1cf39cdf" kindref="member">height</ref><sp/>=<sp/>height;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="693"><highlight class="normal">}</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><ref refid="gl-renderer_8c_1a2fc2b9f773abe95904333149ad2c931e" kindref="member">gl_fbo_texture_fini</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__fbo__texture" kindref="compound">gl_fbo_texture</ref><sp/>*fbotex)</highlight></codeline>
<codeline lineno="697"><highlight class="normal">{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteFramebuffers(1,<sp/>&amp;fbotex-&gt;<ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref>);</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(1,<sp/>&amp;fbotex-&gt;<ref refid="structgl__fbo__texture_1a6db86c9455344d4ff6f1d4de71f363ca" kindref="member">tex</ref>);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fbotex-&gt;<ref refid="structgl__fbo__texture_1a6db86c9455344d4ff6f1d4de71f363ca" kindref="member">tex</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="702"><highlight class="normal">}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><ref refid="gl-renderer_8c_1a97f3834c5afed9bd6d60bd5f59434df1" kindref="member">gl_renderer_send_shader_error</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view)</highlight></codeline>
<codeline lineno="706"><highlight class="normal">{</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_resource<sp/>*resource<sp/>=<sp/>view-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a1a91ebdf5cc858c25db4a1aca78fa990" kindref="member">resource</ref>;</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!resource)</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_client_post_implementation_error(wl_resource_get_client(resource),</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Weston<sp/>GL-renderer<sp/>shader<sp/>failed<sp/>for<sp/>wl_surface@%u&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_resource_get_id(resource));</highlight></codeline>
<codeline lineno="715"><highlight class="normal">}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><ref refid="gl-renderer_8c_1a2f8cf17ec2a4d61518c9461bc0d3af32" kindref="member">triangle_fan_debug</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf,</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>first,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>count)</highlight></codeline>
<codeline lineno="721"><highlight class="normal">{</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLushort<sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref>;</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLushort<sp/>*index;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nelems;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>color_idx<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>alt;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLfloat<sp/>*col;</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLfloat<sp/>color[][4]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>1.0,<sp/>0.0,<sp/>0.0,<sp/>1.0<sp/>},</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>0.0,<sp/>1.0,<sp/>0.0,<sp/>1.0<sp/>},</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>0.0,<sp/>0.0,<sp/>1.0,<sp/>1.0<sp/>},</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{<sp/>1.0,<sp/>1.0,<sp/>1.0,<sp/>1.0<sp/>},</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>col<sp/>=<sp/>color[color_idx++<sp/>%<sp/>ARRAY_LENGTH(color)];</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>alt<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref>)<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a08ac3754c3c2d767709be2b349315339" kindref="member">SHADER_VARIANT_SOLID</ref>,</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.projection<sp/>=<sp/>sconf-&gt;<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>,</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.view_alpha<sp/>=<sp/>1.0f,</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.unicolor<sp/>=<sp/>{<sp/>col[0],<sp/>col[1],<sp/>col[2],<sp/>col[3]<sp/>},</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>&amp;alt);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nelems<sp/>=<sp/>(count<sp/>-<sp/>1<sp/>+<sp/>count<sp/>-<sp/>2)<sp/>*<sp/>2;</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref><sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(GLushort)<sp/>*<sp/>nelems);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index<sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>;</highlight></codeline>
<codeline lineno="752"><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>count;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*index++<sp/>=<sp/>first;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*index++<sp/>=<sp/>first<sp/>+<sp/>i;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>2;<sp/>i<sp/>&lt;<sp/>count;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*index++<sp/>=<sp/>first<sp/>+<sp/>i<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*index++<sp/>=<sp/>first<sp/>+<sp/>i;</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDrawElements(GL_LINES,<sp/>nelems,<sp/>GL_UNSIGNED_SHORT,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>);</highlight></codeline>
<codeline lineno="764"><highlight class="normal"></highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="structbuffer" kindref="compound">buffer</ref>);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>sconf);</highlight></codeline>
<codeline lineno="768"><highlight class="normal">}</highlight></codeline>
<codeline lineno="769"><highlight class="normal"></highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><ref refid="gl-renderer_8c_1afc1d8df98ce08045f594f08ea437b053" kindref="member">repaint_region</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*ev,</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*region,</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*surf_region,</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf)</highlight></codeline>
<codeline lineno="776"><highlight class="normal">{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>*v;</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*vtxcnt;</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>first,<sp/>nfans;</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>final<sp/>region<sp/>to<sp/>be<sp/>painted<sp/>is<sp/>the<sp/>intersection<sp/>of</highlight></codeline>
<codeline lineno="782"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>&apos;region&apos;<sp/>and<sp/>&apos;surf_region&apos;.<sp/>However,<sp/>&apos;region&apos;<sp/>is<sp/>in<sp/>the<sp/>global</highlight></codeline>
<codeline lineno="783"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>coordinates,<sp/>and<sp/>&apos;surf_region&apos;<sp/>is<sp/>in<sp/>the<sp/>surface-local</highlight></codeline>
<codeline lineno="784"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>coordinates.<sp/>texture_region()<sp/>will<sp/>iterate<sp/>over<sp/>all<sp/>pairs<sp/>of</highlight></codeline>
<codeline lineno="785"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>rectangles<sp/>from<sp/>both<sp/>regions,<sp/>compute<sp/>the<sp/>intersection</highlight></codeline>
<codeline lineno="786"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>polygon<sp/>for<sp/>each<sp/>pair,<sp/>and<sp/>store<sp/>it<sp/>as<sp/>a<sp/>triangle<sp/>fan<sp/>if</highlight></codeline>
<codeline lineno="787"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>it<sp/>has<sp/>a<sp/>non-zero<sp/>area<sp/>(at<sp/>least<sp/>3<sp/>vertices,<sp/>actually).</highlight></codeline>
<codeline lineno="788"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nfans<sp/>=<sp/><ref refid="gl-renderer_8c_1a5202426c9e43d635b71aae3ba7d7bb56" kindref="member">texture_region</ref>(ev,<sp/>region,<sp/>surf_region);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1adac0baf7ccf72aec5f5f8af6e578851d" kindref="member">vertices</ref>.data;</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vtxcnt<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>.data;</highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>position:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(0,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>4<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*v,<sp/>&amp;v[0]);</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>texcoord:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(1,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>4<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*v,<sp/>&amp;v[2]);</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>sconf))<sp/>{</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a97f3834c5afed9bd6d60bd5f59434df1" kindref="member">gl_renderer_send_shader_error</ref>(ev);</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>continue<sp/>drawing<sp/>with<sp/>the<sp/>fallback<sp/>shader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="806"><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0,<sp/>first<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>nfans;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDrawArrays(GL_TRIANGLE_FAN,<sp/>first,<sp/>vtxcnt[i]);</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref>)</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a2f8cf17ec2a4d61518c9461bc0d3af32" kindref="member">triangle_fan_debug</ref>(gr,<sp/>sconf,<sp/>first,<sp/>vtxcnt[i]);</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>first<sp/>+=<sp/>vtxcnt[i];</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1adac0baf7ccf72aec5f5f8af6e578851d" kindref="member">vertices</ref>.size<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>.size<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="819"><highlight class="normal">}</highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><ref refid="gl-renderer_8c_1a2485d1997f3d3d4c128c5b173a1fef51" kindref="member">use_output</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="823"><highlight class="normal">{</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>errored;</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLBoolean<sp/>ret;</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>eglMakeCurrent(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,<sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref>);</highlight></codeline>
<codeline lineno="831"><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>EGL_FALSE)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errored)</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errored<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>make<sp/>EGL<sp/>context<sp/>current.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="842"><highlight class="normal">}</highlight></codeline>
<codeline lineno="843"><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><ref refid="gl-renderer_8c_1a9dbd6118923fbeede828f8ee0df460c1" kindref="member">ensure_surface_buffer_is_ready</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs)</highlight></codeline>
<codeline lineno="847"><highlight class="normal">{</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>attribs[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_SYNC_NATIVE_FENCE_FD_ANDROID,</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-1,</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NONE</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>;</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>.<ref refid="structweston__buffer__reference_1a87b175662a988253c4f12a2f25ce04e9" kindref="member">buffer</ref>;</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLSyncKHR<sp/>sync;</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>wait_ret;</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>destroy_ret;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structbuffer" kindref="compound">buffer</ref>)</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="861"><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;acquire_fence_fd<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>should<sp/>only<sp/>get<sp/>a<sp/>fence<sp/>if<sp/>we<sp/>support<sp/>EGLSyncKHR,<sp/>since</highlight></codeline>
<codeline lineno="866"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>we<sp/>don&apos;t<sp/>advertise<sp/>the<sp/>explicit<sp/>sync<sp/>protocol<sp/>otherwise.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gr-&gt;<ref refid="structgl__renderer_1a565fad372070dd5710626b6a7c1fea5c" kindref="member">has_native_fence_sync</ref>);</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>should<sp/>only<sp/>get<sp/>a<sp/>fence<sp/>for<sp/>non-SHM<sp/>buffers,<sp/>since<sp/>surface</highlight></codeline>
<codeline lineno="869"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>commit<sp/>would<sp/>have<sp/>failed<sp/>otherwise.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(wl_shm_buffer_get(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;resource)<sp/>==<sp/>NULL);</highlight></codeline>
<codeline lineno="871"><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[1]<sp/>=<sp/>dup(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;acquire_fence_fd);</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attribs[1]<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-explicit-synchronization_8c_1aa6efd3c54a9ffc447caa53cba3bb7569" kindref="member">linux_explicit_synchronization_send_server_error</ref>(</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a9a1d1461621f1debc9014c345c601a08" kindref="member">synchronization_resource</ref>,</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>dup<sp/>acquire<sp/>fence&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="879"><highlight class="normal"></highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sync<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a0d32e80810899d87319869d417efc5e3" kindref="member">create_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_SYNC_NATIVE_FENCE_ANDROID,</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs);</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sync<sp/>==<sp/>EGL_NO_SYNC_KHR)<sp/>{</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-explicit-synchronization_8c_1aa6efd3c54a9ffc447caa53cba3bb7569" kindref="member">linux_explicit_synchronization_send_server_error</ref>(</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a9a1d1461621f1debc9014c345c601a08" kindref="member">synchronization_resource</ref>,</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>create<sp/>EGLSyncKHR<sp/>object&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(attribs[1]);</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="890"><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wait_ret<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a23da622f17dc46b8292eebc5243d8c34" kindref="member">wait_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>sync,<sp/>0);</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wait_ret<sp/>==<sp/>EGL_FALSE)<sp/>{</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-explicit-synchronization_8c_1aa6efd3c54a9ffc447caa53cba3bb7569" kindref="member">linux_explicit_synchronization_send_server_error</ref>(</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a9a1d1461621f1debc9014c345c601a08" kindref="member">synchronization_resource</ref>,</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>wait<sp/>on<sp/>EGLSyncKHR<sp/>object&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Continue<sp/>to<sp/>try<sp/>to<sp/>destroy<sp/>the<sp/>sync<sp/>object.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>destroy_ret<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a647a24d7c43b5e1ba3fa16268858fa6d" kindref="member">destroy_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>sync);</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(destroy_ret<sp/>==<sp/>EGL_FALSE)<sp/>{</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-explicit-synchronization_8c_1aa6efd3c54a9ffc447caa53cba3bb7569" kindref="member">linux_explicit_synchronization_send_server_error</ref>(</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a9a1d1461621f1debc9014c345c601a08" kindref="member">synchronization_resource</ref>,</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>destroy<sp/>on<sp/>EGLSyncKHR<sp/>object&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(wait_ret<sp/>==<sp/>EGL_TRUE<sp/>&amp;&amp;<sp/>destroy_ret<sp/>==<sp/>EGL_TRUE)<sp/>?<sp/>0<sp/>:<sp/>-1;</highlight></codeline>
<codeline lineno="908"><highlight class="normal">}</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/></highlight><highlight class="comment">/*<sp/>Checks<sp/>if<sp/>a<sp/>view<sp/>needs<sp/>to<sp/>be<sp/>censored<sp/>on<sp/>an<sp/>output</highlight></codeline>
<codeline lineno="912"><highlight class="comment"><sp/><sp/>*<sp/>Checks<sp/>for<sp/>2<sp/>types<sp/>of<sp/>censor<sp/>requirements</highlight></codeline>
<codeline lineno="913"><highlight class="comment"><sp/><sp/>*<sp/>-<sp/>recording_censor:<sp/>Censor<sp/>protected<sp/>view<sp/>when<sp/>a</highlight></codeline>
<codeline lineno="914"><highlight class="comment"><sp/><sp/>*<sp/><sp/><sp/>protected<sp/>view<sp/>is<sp/>captured.</highlight></codeline>
<codeline lineno="915"><highlight class="comment"><sp/><sp/>*<sp/>-<sp/>unprotected_censor:<sp/>Censor<sp/>regions<sp/>of<sp/>protected<sp/>views</highlight></codeline>
<codeline lineno="916"><highlight class="comment"><sp/><sp/>*<sp/><sp/><sp/>when<sp/>displayed<sp/>on<sp/>an<sp/>output<sp/>which<sp/>has<sp/>lower<sp/>protection<sp/>capability.</highlight></codeline>
<codeline lineno="917"><highlight class="comment"><sp/><sp/>*<sp/>If<sp/>censoring<sp/>is<sp/>needed,<sp/>smashes<sp/>the<sp/>GL<sp/>shader<sp/>config.</highlight></codeline>
<codeline lineno="918"><highlight class="comment"><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"><ref refid="gl-renderer_8c_1a82100f30b16821b14cf4d3e97bcef6ff" kindref="member">maybe_censor_override</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf,</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*ev)</highlight></codeline>
<codeline lineno="923"><highlight class="normal">{</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>alt<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a08ac3754c3c2d767709be2b349315339" kindref="member">SHADER_VARIANT_SOLID</ref>,</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.projection<sp/>=<sp/>sconf-&gt;<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>,</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.view_alpha<sp/>=<sp/>sconf-&gt;<ref refid="structgl__shader__config_1a00edad21954dc7fc7d95a035d0a1c0d5" kindref="member">view_alpha</ref>,</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.unicolor<sp/>=<sp/>{<sp/>0.40,<sp/>0.0,<sp/>0.0,<sp/>1.0<sp/>},</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>recording_censor<sp/>=</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;disable_planes<sp/>&gt;<sp/>0)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a64f9fe73b0da889194bbfee96e0aa69e" kindref="member">desired_protection</ref><sp/>&gt;<sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671ad11b3fce4f7baccb7a07a1107b23f92e" kindref="member">WESTON_HDCP_DISABLE</ref>);</highlight></codeline>
<codeline lineno="936"><highlight class="normal"></highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>unprotected_censor<sp/>=</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a64f9fe73b0da889194bbfee96e0aa69e" kindref="member">desired_protection</ref><sp/>&gt;<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_protection);</highlight></codeline>
<codeline lineno="939"><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref>)<sp/>{</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*sconf<sp/>=<sp/>alt;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="944"><highlight class="normal"></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>When<sp/>not<sp/>in<sp/>enforced<sp/>mode,<sp/>the<sp/>client<sp/>is<sp/>notified<sp/>of<sp/>the<sp/>protection<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>change,<sp/>so<sp/>content<sp/>censoring<sp/>is<sp/>not<sp/>required<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a2a8174daa5c86a0d2bae73d4cbf7a676" kindref="member">protection_mode</ref><sp/>!=</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="libweston_8h_1a149b1ac0bd76933ff03da35d64709208aa5df7c201a76deb656b1e70da4268a54" kindref="member">WESTON_SURFACE_PROTECTION_MODE_ENFORCED</ref>)</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="950"><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(recording_censor<sp/>||<sp/>unprotected_censor)</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*sconf<sp/>=<sp/>alt;</highlight></codeline>
<codeline lineno="953"><highlight class="normal">}</highlight></codeline>
<codeline lineno="954"><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="956"><highlight class="normal"><ref refid="gl-renderer_8c_1ae0b5c16fdf73b565c63698710d01a378" kindref="member">gl_shader_config_set_input_textures</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf,</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs)</highlight></codeline>
<codeline lineno="958"><highlight class="normal">{</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="960"><highlight class="normal"></highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref>;</highlight></codeline>
<codeline lineno="962"><highlight class="normal"></highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>4;<sp/>i++)</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1a9b6405eaf7f61aebc4002af123e40703" kindref="member">unicolor</ref>[i]<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[i];</highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref><sp/>&lt;=<sp/><ref refid="gl-renderer-internal_8h_1ab31a69e9420c212cb584e63ad432fc9e" kindref="member">GL_SHADER_INPUT_TEX_MAX</ref>);</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1ac4f8f92cc81a08ce6775e305ec6c6e7e" kindref="member">input_tex</ref>[i]<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[i];</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(;<sp/>i<sp/>&lt;<sp/><ref refid="gl-renderer-internal_8h_1ab31a69e9420c212cb584e63ad432fc9e" kindref="member">GL_SHADER_INPUT_TEX_MAX</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1ac4f8f92cc81a08ce6775e305ec6c6e7e" kindref="member">input_tex</ref>[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="971"><highlight class="normal">}</highlight></codeline>
<codeline lineno="972"><highlight class="normal"></highlight></codeline>
<codeline lineno="973"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="974"><highlight class="normal"><ref refid="gl-renderer_8c_1a41745a7e5eb8cf17a71b494b99743d36" kindref="member">gl_shader_config_init_for_view</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf,</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view,</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLint<sp/>filter)</highlight></codeline>
<codeline lineno="978"><highlight class="normal">{</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(view-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="981"><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*sconf<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref>)<sp/>{</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref><sp/>=<sp/>go-&gt;<ref refid="structgl__output__state_1a6dea590e5582d9b631ecf9d7301ef1df" kindref="member">output_matrix</ref>,</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.view_alpha<sp/>=<sp/>view-&gt;<ref refid="structweston__view_1a2ee87852507e80f9c33d1dbaa7749e1b" kindref="member">alpha</ref>,</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_tex_filter<sp/>=<sp/>filter,</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="987"><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae0b5c16fdf73b565c63698710d01a378" kindref="member">gl_shader_config_set_input_textures</ref>(sconf,<sp/>gs);</highlight></codeline>
<codeline lineno="989"><highlight class="normal"></highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="991"><highlight class="normal">}</highlight></codeline>
<codeline lineno="992"><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><ref refid="gl-renderer_8c_1a36ad39ab042011505a247995a594e775" kindref="member">draw_view</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*ev,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*damage)<sp/></highlight><highlight class="comment">/*<sp/>in<sp/>global<sp/>coordinates<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="996"><highlight class="normal">{</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>;</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>repaint<sp/>bounding<sp/>region<sp/>in<sp/>global<sp/>coordinates:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>repaint;</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>opaque<sp/>region<sp/>in<sp/>surface<sp/>coordinates:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>surface_opaque;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>non-opaque<sp/>region<sp/>in<sp/>surface<sp/>coordinates:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>surface_blend;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLint<sp/>filter;</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>sconf;</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>In<sp/>case<sp/>of<sp/>a<sp/>runtime<sp/>switch<sp/>of<sp/>renderers,<sp/>we<sp/>may<sp/>not<sp/>have<sp/>received</highlight></codeline>
<codeline lineno="1010"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>an<sp/>attach<sp/>for<sp/>this<sp/>surface<sp/>since<sp/>the<sp/>switch.<sp/>In<sp/>that<sp/>case<sp/>we<sp/>don&apos;t</highlight></codeline>
<codeline lineno="1011"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>have<sp/>a<sp/>valid<sp/>buffer<sp/>or<sp/>a<sp/>proper<sp/>shader<sp/>set<sp/>up<sp/>so<sp/>skip<sp/>rendering.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>==<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a5c612df3d7b7f48e919b5c9136e9ee8b" kindref="member">SHADER_VARIANT_NONE</ref><sp/>&amp;&amp;<sp/>!gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref>)</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;repaint);</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_intersect(&amp;repaint,</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;ev-&gt;<ref refid="structweston__view_1a6f0357af0dd60a9bc84d7df538664f71" kindref="member">transform</ref>.<ref refid="structweston__view_1a7425ba4bac68148bc9e5d8eaedff352d" kindref="member">boundingbox</ref>,<sp/>damage);</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_subtract(&amp;repaint,<sp/>&amp;repaint,<sp/>&amp;ev-&gt;<ref refid="structweston__view_1a7f10ad4288de845f3f42609bdf617416" kindref="member">clip</ref>);</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pixman_region32_not_empty(&amp;repaint))</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a9dbd6118923fbeede828f8ee0df460c1" kindref="member">ensure_surface_buffer_is_ready</ref>(gr,<sp/>gs)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBlendFunc(GL_ONE,<sp/>GL_ONE_MINUS_SRC_ALPHA);</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"></highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ev-&gt;<ref refid="structweston__view_1a6f0357af0dd60a9bc84d7df538664f71" kindref="member">transform</ref>.<ref refid="structweston__view_1ad81ff06883a9d4720a6b9400233ab04f" kindref="member">enabled</ref><sp/>||<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;zoom.active<sp/>||</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_scale<sp/>!=<sp/>ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1ad5175fcb5fb15c438fd9dcab2f596922" kindref="member">buffer_viewport</ref>.<ref refid="structweston__buffer__viewport_1a6cbde13161041b6a89e5eb3aea32a17d" kindref="member">buffer</ref>.<ref refid="structweston__buffer__viewport_1a88940e4f0e08988bbcf0e8039191cd25" kindref="member">scale</ref>)</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filter<sp/>=<sp/>GL_LINEAR;</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filter<sp/>=<sp/>GL_NEAREST;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer_8c_1a41745a7e5eb8cf17a71b494b99743d36" kindref="member">gl_shader_config_init_for_view</ref>(&amp;sconf,<sp/>ev,<sp/><ref refid="structoutput" kindref="compound">output</ref>,<sp/>filter))</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"></highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>blended<sp/>region<sp/>is<sp/>whole<sp/>surface<sp/>minus<sp/>opaque<sp/>region:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init_rect(&amp;surface_blend,<sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a645a3cfb49c05e33bd53f5e9896ea390" kindref="member">width</ref>,<sp/>ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a24ce05497c254ad0718c34d4fc3f68d8" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ev-&gt;<ref refid="structweston__view_1ab74e78d4ee0389b21cc3098c8ffb2421" kindref="member">geometry</ref>.<ref refid="structweston__view_1a559364a2aa2a37cf13bf355e7b1becd5" kindref="member">scissor_enabled</ref>)</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_intersect(&amp;surface_blend,<sp/>&amp;surface_blend,</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;ev-&gt;<ref refid="structweston__view_1ab74e78d4ee0389b21cc3098c8ffb2421" kindref="member">geometry</ref>.<ref refid="structweston__view_1addcf6382f9701e3eff29167aad1b1039" kindref="member">scissor</ref>);</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_subtract(&amp;surface_blend,<sp/>&amp;surface_blend,</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1ab587081c8482be3e8c68d6d806945aff" kindref="member">opaque</ref>);</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"></highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>XXX:<sp/>Should<sp/>we<sp/>be<sp/>using<sp/>ev-&gt;transform.opaque<sp/>here?<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;surface_opaque);</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ev-&gt;<ref refid="structweston__view_1ab74e78d4ee0389b21cc3098c8ffb2421" kindref="member">geometry</ref>.<ref refid="structweston__view_1a559364a2aa2a37cf13bf355e7b1becd5" kindref="member">scissor_enabled</ref>)</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_intersect(&amp;surface_opaque,</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1ab587081c8482be3e8c68d6d806945aff" kindref="member">opaque</ref>,</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;ev-&gt;<ref refid="structweston__view_1ab74e78d4ee0389b21cc3098c8ffb2421" kindref="member">geometry</ref>.<ref refid="structweston__view_1addcf6382f9701e3eff29167aad1b1039" kindref="member">scissor</ref>);</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_copy(&amp;surface_opaque,<sp/>&amp;ev-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1ab587081c8482be3e8c68d6d806945aff" kindref="member">opaque</ref>);</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a82100f30b16821b14cf4d3e97bcef6ff" kindref="member">maybe_censor_override</ref>(&amp;sconf,<sp/><ref refid="structoutput" kindref="compound">output</ref>,<sp/>ev);</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pixman_region32_not_empty(&amp;surface_opaque))<sp/>{</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>alt<sp/>=<sp/>sconf;</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(alt.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>==<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Special<sp/>case<sp/>for<sp/>RGBA<sp/>textures<sp/>with<sp/>possibly</highlight></codeline>
<codeline lineno="1062"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>bad<sp/>data<sp/>in<sp/>alpha<sp/>channel:<sp/>use<sp/>the<sp/>shader</highlight></codeline>
<codeline lineno="1063"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>that<sp/>forces<sp/>texture<sp/>alpha<sp/>=<sp/>1.0.</highlight></codeline>
<codeline lineno="1064"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Xwayland<sp/>surfaces<sp/>need<sp/>this.</highlight></codeline>
<codeline lineno="1065"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>alt.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022acf4bfe46d502a0f85581c2ee45a41dcc" kindref="member">SHADER_VARIANT_RGBX</ref>;</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"></highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ev-&gt;<ref refid="structweston__view_1a2ee87852507e80f9c33d1dbaa7749e1b" kindref="member">alpha</ref><sp/>&lt;<sp/>1.0)</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnable(GL_BLEND);</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisable(GL_BLEND);</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"></highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1afc1d8df98ce08045f594f08ea437b053" kindref="member">repaint_region</ref>(gr,<sp/>ev,<sp/>&amp;repaint,<sp/>&amp;surface_opaque,<sp/>&amp;alt);</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a7aa9c0737dd0b7ffe314e61ca5f46844" kindref="member">used_in_output_repaint</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"></highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pixman_region32_not_empty(&amp;surface_blend))<sp/>{</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnable(GL_BLEND);</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1afc1d8df98ce08045f594f08ea437b053" kindref="member">repaint_region</ref>(gr,<sp/>ev,<sp/>&amp;repaint,<sp/>&amp;surface_blend,<sp/>&amp;sconf);</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a7aa9c0737dd0b7ffe314e61ca5f46844" kindref="member">used_in_output_repaint</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;surface_blend);</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;surface_opaque);</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"></highlight></codeline>
<codeline lineno="1087"><highlight class="normal">out:</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;repaint);</highlight></codeline>
<codeline lineno="1089"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"></highlight></codeline>
<codeline lineno="1091"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><ref refid="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" kindref="member">repaint_views</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,<sp/>pixman_region32_t<sp/>*damage)</highlight></codeline>
<codeline lineno="1093"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*compositor<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor;</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view;</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_reverse(view,<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1a32ac5a7b9ccbac09ec941681d12cce44" kindref="member">view_list</ref>,<sp/><ref refid="structweston__view_1a81dd60dee728758e7963f2fd0eb12cee" kindref="member">link</ref>)</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(view-&gt;<ref refid="structweston__view_1a083349493fecdb4e90d413e122c802b0" kindref="member">plane</ref><sp/>==<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1acd96fdbda4ef438f5292372ab78535ce" kindref="member">primary_plane</ref>)</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a36ad39ab042011505a247995a594e775" kindref="member">draw_view</ref>(view,<sp/><ref refid="structoutput" kindref="compound">output</ref>,<sp/>damage);</highlight></codeline>
<codeline lineno="1100"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"></highlight></codeline>
<codeline lineno="1102"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><ref refid="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" kindref="member">gl_renderer_create_fence_fd</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Updates<sp/>the<sp/>release<sp/>fences<sp/>of<sp/>surfaces<sp/>that<sp/>were<sp/>used<sp/>in<sp/>the<sp/>current<sp/>output</highlight></codeline>
<codeline lineno="1106"><highlight class="comment"><sp/>*<sp/>repaint.<sp/>Should<sp/>only<sp/>be<sp/>used<sp/>from<sp/>gl_renderer_repaint_output,<sp/>so<sp/>that<sp/>the</highlight></codeline>
<codeline lineno="1107"><highlight class="comment"><sp/>*<sp/>information<sp/>in<sp/>gl_surface_state.used_in_output_repaint<sp/>is<sp/>accurate.</highlight></codeline>
<codeline lineno="1108"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1109"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><ref refid="gl-renderer_8c_1ae7aa13629feed78bc17796493fef079c" kindref="member">update_buffer_release_fences</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*compositor,</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="1112"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view;</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_reverse(view,<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1a32ac5a7b9ccbac09ec941681d12cce44" kindref="member">view_list</ref>,<sp/><ref refid="structweston__view_1a81dd60dee728758e7963f2fd0eb12cee" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs;</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__buffer__release" kindref="compound">weston_buffer_release</ref><sp/>*<ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref>;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structweston__buffer__release_1a16a29644865618443c6bee1105322f99" kindref="member">fence_fd</ref>;</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"></highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(view-&gt;<ref refid="structweston__view_1a083349493fecdb4e90d413e122c802b0" kindref="member">plane</ref><sp/>!=<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1acd96fdbda4ef438f5292372ab78535ce" kindref="member">primary_plane</ref>)</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(view-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>.<ref refid="structweston__buffer__release__reference_1af56e0a7bde3736fa32cce5107e620d14" kindref="member">buffer_release</ref>;</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gs-&gt;<ref refid="structgl__surface__state_1a7aa9c0737dd0b7ffe314e61ca5f46844" kindref="member">used_in_output_repaint</ref><sp/>||<sp/>!<ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref>)</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structweston__buffer__release_1a16a29644865618443c6bee1105322f99" kindref="member">fence_fd</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" kindref="member">gl_renderer_create_fence_fd</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"></highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we<sp/>have<sp/>a<sp/>buffer_release<sp/>then<sp/>it<sp/>means<sp/>we<sp/>support<sp/>fences,</highlight></codeline>
<codeline lineno="1132"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>we<sp/>should<sp/>be<sp/>able<sp/>to<sp/>create<sp/>the<sp/>release<sp/>fence.<sp/>If<sp/>we</highlight></codeline>
<codeline lineno="1133"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>can&apos;t,<sp/>something<sp/>has<sp/>gone<sp/>horribly<sp/>wrong,<sp/>so<sp/>disconnect<sp/>the</highlight></codeline>
<codeline lineno="1134"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>client.</highlight></codeline>
<codeline lineno="1135"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structweston__buffer__release_1a16a29644865618443c6bee1105322f99" kindref="member">fence_fd</ref><sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-explicit-synchronization_8c_1aa6efd3c54a9ffc447caa53cba3bb7569" kindref="member">linux_explicit_synchronization_send_server_error</ref>(</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref>-&gt;resource,</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>create<sp/>release<sp/>fence&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fd_clear(&amp;<ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref>-&gt;fence_fd);</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>At<sp/>the<sp/>moment<sp/>it<sp/>is<sp/>safe<sp/>to<sp/>just<sp/>replace<sp/>the<sp/>fence_fd,</highlight></codeline>
<codeline lineno="1145"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>discarding<sp/>the<sp/>previous<sp/>one:</highlight></codeline>
<codeline lineno="1146"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="1147"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>1.<sp/>If<sp/>the<sp/>previous<sp/>fence<sp/>fd<sp/>represents<sp/>a<sp/>sync<sp/>fence<sp/>from</highlight></codeline>
<codeline lineno="1148"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>a<sp/>previous<sp/>repaint<sp/>cycle,<sp/>that<sp/>fence<sp/>fd<sp/>is<sp/>now<sp/>not</highlight></codeline>
<codeline lineno="1149"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>sufficient<sp/>to<sp/>provide<sp/>the<sp/>release<sp/>guarantee<sp/>and<sp/>should</highlight></codeline>
<codeline lineno="1150"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>be<sp/>replaced.</highlight></codeline>
<codeline lineno="1151"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="1152"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>2.<sp/>If<sp/>the<sp/>fence<sp/>fd<sp/>represents<sp/>a<sp/>sync<sp/>fence<sp/>from<sp/>another</highlight></codeline>
<codeline lineno="1153"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>output<sp/>in<sp/>the<sp/>same<sp/>repaint<sp/>cycle,<sp/>it&apos;s<sp/>fine<sp/>to<sp/>replace</highlight></codeline>
<codeline lineno="1154"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>it<sp/>since<sp/>we<sp/>are<sp/>rendering<sp/>to<sp/>all<sp/>outputs<sp/>using<sp/>the<sp/>same</highlight></codeline>
<codeline lineno="1155"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>EGL<sp/>context,<sp/>so<sp/>a<sp/>fence<sp/>issued<sp/>for<sp/>a<sp/>later<sp/>output<sp/>rendering</highlight></codeline>
<codeline lineno="1156"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>is<sp/>guaranteed<sp/>to<sp/>signal<sp/>after<sp/>fences<sp/>for<sp/>previous<sp/>output</highlight></codeline>
<codeline lineno="1157"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>renderings.</highlight></codeline>
<codeline lineno="1158"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="1159"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Note<sp/>that<sp/>the<sp/>above<sp/>is<sp/>only<sp/>valid<sp/>if<sp/>the<sp/>buffer_release</highlight></codeline>
<codeline lineno="1160"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>fences<sp/>only<sp/>originate<sp/>from<sp/>the<sp/>GL<sp/>renderer,<sp/>which<sp/>guarantees</highlight></codeline>
<codeline lineno="1161"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>a<sp/>total<sp/>order<sp/>of<sp/>operations<sp/>and<sp/>fences.<sp/><sp/>If<sp/>we<sp/>introduce</highlight></codeline>
<codeline lineno="1162"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>fences<sp/>from<sp/>other<sp/>sources<sp/>(e.g.,<sp/>plane<sp/>out-fences),<sp/>we<sp/>will</highlight></codeline>
<codeline lineno="1163"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>need<sp/>to<sp/>merge<sp/>fences<sp/>instead.</highlight></codeline>
<codeline lineno="1164"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fd_update(&amp;<ref refid="wayland_8c_1ab5d416a8b42cfb1af4422880a0ad8395" kindref="member">buffer_release</ref>-&gt;fence_fd,<sp/><ref refid="structweston__buffer__release_1a16a29644865618443c6bee1105322f99" kindref="member">fence_fd</ref>);</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1167"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"></highlight></codeline>
<codeline lineno="1169"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><ref refid="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" kindref="member">draw_output_border_texture</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go,</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>*sconf,</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403" kindref="member">gl_renderer_border_side</ref><sp/>side,</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>x,<sp/>int32_t<sp/>y,</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>width,<sp/>int32_t<sp/>height)</highlight></codeline>
<codeline lineno="1176"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__border__image" kindref="compound">gl_border_image</ref><sp/>*img<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side];</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>GLushort<sp/>indices<sp/>[]<sp/>=<sp/>{<sp/>0,<sp/>1,<sp/>3,<sp/>3,<sp/>1,<sp/>2<sp/>};</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"></highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!img-&gt;<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(1,<sp/>&amp;img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>);</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"></highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenTextures(1,<sp/>&amp;img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>);</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>);</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"></highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(GL_TEXTURE_2D,</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_TEXTURE_WRAP_S,<sp/>GL_CLAMP_TO_EDGE);</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(GL_TEXTURE_2D,</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_TEXTURE_WRAP_T,<sp/>GL_CLAMP_TO_EDGE);</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>);</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"></highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref><sp/>&amp;<sp/>(1<sp/>&lt;&lt;<sp/>side))<sp/>{</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_ROW_LENGTH_EXT,<sp/>0);</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_PIXELS_EXT,<sp/>0);</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_ROWS_EXT,<sp/>0);</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexImage2D(GL_TEXTURE_2D,<sp/>0,<sp/>GL_BGRA_EXT,</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>img-&gt;<ref refid="structgl__border__image_1a7a64d69b74da000da48b95ac7425edb3" kindref="member">tex_width</ref>,<sp/>img-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,<sp/>0,</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_BGRA_EXT,<sp/>GL_UNSIGNED_BYTE,<sp/>img-&gt;<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref>);</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"></highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1a7ffff590825dc85ecb343036ba9869ab" kindref="member">input_tex_filter</ref><sp/>=<sp/>GL_NEAREST;</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf-&gt;<ref refid="structgl__shader__config_1ac4f8f92cc81a08ce6775e305ec6c6e7e" kindref="member">input_tex</ref>[0]<sp/>=<sp/>img-&gt;<ref refid="structgl__border__image_1adc531f3a65a1c2ae4a2b212c4419b1fd" kindref="member">tex</ref>;</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>sconf);</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"></highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>texcoord[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(GLfloat)img-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>/<sp/>(GLfloat)img-&gt;<ref refid="structgl__border__image_1a7a64d69b74da000da48b95ac7425edb3" kindref="member">tex_width</ref>,<sp/>0.0f,</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(GLfloat)img-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>/<sp/>(GLfloat)img-&gt;<ref refid="structgl__border__image_1a7a64d69b74da000da48b95ac7425edb3" kindref="member">tex_width</ref>,<sp/>1.0f,</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/>1.0f,</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>verts[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x,<sp/>y,</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>+<sp/><ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/>y,</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>+<sp/><ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/>y<sp/>+<sp/><ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x,<sp/>y<sp/>+<sp/><ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref></highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"></highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(0,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>verts);</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(1,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>texcoord);</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"></highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDrawElements(GL_TRIANGLES,<sp/>6,<sp/>GL_UNSIGNED_SHORT,<sp/>indices);</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="1237"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"></highlight></codeline>
<codeline lineno="1239"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><ref refid="gl-renderer_8c_1ac6ff6ac3041a7d253fdd68ad98b4b265" kindref="member">output_has_borders</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="1241"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"></highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>].<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref><sp/>||</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ae445009c67c155ec54f35959dfed248e" kindref="member">GL_RENDERER_BORDER_RIGHT</ref>].<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref><sp/>||</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>].<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref><sp/>||</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>].<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="1248"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"></highlight></codeline>
<codeline lineno="1250"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><ref refid="gl-renderer_8c_1a2a0db6729b1a75620c5263d2d6b4811a" kindref="member">draw_output_borders</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/><ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref>)</highlight></codeline>
<codeline lineno="1253"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>sconf<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>,</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.view_alpha<sp/>=<sp/>1.0f,</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__border__image" kindref="compound">gl_border_image</ref><sp/>*top,<sp/>*bottom,<sp/>*left,<sp/>*right;</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>full_width,<sp/>full_height;</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"></highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>==<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" kindref="member">BORDER_STATUS_CLEAN</ref>)</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">/*<sp/>Clean.<sp/>Nothing<sp/>to<sp/>do.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1267"><highlight class="normal"></highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>];</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bottom<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>];</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>left<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>];</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>right<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ae445009c67c155ec54f35959dfed248e" kindref="member">GL_RENDERER_BORDER_RIGHT</ref>];</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"></highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref><sp/>+<sp/>left-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>+<sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_height<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>+<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref><sp/>+<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisable(GL_BLEND);</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glViewport(0,<sp/>0,<sp/>full_width,<sp/>full_height);</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1a1a379a971f1948d4ccc8d76d58506078" kindref="member">weston_matrix_init</ref>(&amp;sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>);</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1a11705753750edc192cfd0861fdfb5b8a" kindref="member">weston_matrix_translate</ref>(&amp;sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>,</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-full_width<sp/>/<sp/>2.0,<sp/>-full_height<sp/>/<sp/>2.0,<sp/>0);</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1ae66be97d5f6b1aa202cf48c3c1f3a0e1" kindref="member">weston_matrix_scale</ref>(&amp;sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>,</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.0<sp/>/<sp/>full_width,<sp/>-2.0<sp/>/<sp/>full_height,<sp/>1);</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"></highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"></highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5ac2239af957c138ce5fbd1da29dcf5876" kindref="member">BORDER_TOP_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" kindref="member">draw_output_border_texture</ref>(gr,<sp/>go,<sp/>&amp;sconf,<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>,</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a563a0819ed1cfa18c992f9511ffe1cd4" kindref="member">BORDER_LEFT_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" kindref="member">draw_output_border_texture</ref>(gr,<sp/>go,<sp/>&amp;sconf,<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>,</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>left-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a02c0c77acf814be2ea455f4305785b60" kindref="member">BORDER_RIGHT_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" kindref="member">draw_output_border_texture</ref>(gr,<sp/>go,<sp/>&amp;sconf,<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ae445009c67c155ec54f35959dfed248e" kindref="member">GL_RENDERER_BORDER_RIGHT</ref>,</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width<sp/>-<sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a70dd320e034aa3258d657316b1b284ac" kindref="member">BORDER_BOTTOM_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af340530b13398964194d95452c7aef2a" kindref="member">draw_output_border_texture</ref>(gr,<sp/>go,<sp/>&amp;sconf,<sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>,</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>full_height<sp/>-<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width,<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1303"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"></highlight></codeline>
<codeline lineno="1305"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><ref refid="gl-renderer_8c_1a49a30139d23e9af74bb99fe05604e7d8" kindref="member">output_get_border_damage</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/>border_status,</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*damage)</highlight></codeline>
<codeline lineno="1309"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__border__image" kindref="compound">gl_border_image</ref><sp/>*top,<sp/>*bottom,<sp/>*left,<sp/>*right;</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>full_width,<sp/>full_height;</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"></highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>==<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" kindref="member">BORDER_STATUS_CLEAN</ref>)</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">/*<sp/>Clean.<sp/>Nothing<sp/>to<sp/>do.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1316"><highlight class="normal"></highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>];</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bottom<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>];</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>left<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>];</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>right<sp/>=<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ae445009c67c155ec54f35959dfed248e" kindref="member">GL_RENDERER_BORDER_RIGHT</ref>];</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref><sp/>+<sp/>left-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>+<sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_height<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>+<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref><sp/>+<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5ac2239af957c138ce5fbd1da29dcf5876" kindref="member">BORDER_TOP_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union_rect(damage,<sp/>damage,</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a563a0819ed1cfa18c992f9511ffe1cd4" kindref="member">BORDER_LEFT_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union_rect(damage,<sp/>damage,</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>left-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a02c0c77acf814be2ea455f4305785b60" kindref="member">BORDER_RIGHT_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union_rect(damage,<sp/>damage,</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width<sp/>-<sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/>top-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>right-&gt;<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(border_status<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a70dd320e034aa3258d657316b1b284ac" kindref="member">BORDER_BOTTOM_DIRTY</ref>)</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union_rect(damage,<sp/>damage,</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>full_height<sp/>-<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_width,<sp/>bottom-&gt;<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1340"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1341"><highlight class="normal"></highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><ref refid="gl-renderer_8c_1ade544e39c643489857aed93c1a81b2fd" kindref="member">output_get_damage</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*buffer_damage,<sp/>uint32_t<sp/>*border_damage)</highlight></codeline>
<codeline lineno="1345"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>buffer_age<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLBoolean<sp/>ret;</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"></highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a920185695fc95f86dd822cb5beece76a" kindref="member">has_egl_buffer_age</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>eglQuerySurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_BUFFER_AGE_EXT,<sp/>&amp;buffer_age);</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>EGL_FALSE)<sp/>{</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;buffer<sp/>age<sp/>query<sp/>failed.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1af8fd29926f661027db2800b4b50d28a9" kindref="member">swap_behavior_is_preserved</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer_age<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"></highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buffer_age<sp/>==<sp/>0<sp/>||<sp/>buffer_age<sp/>-<sp/>1<sp/>&gt;<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_copy(buffer_damage,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;region);</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*border_damage<sp/>=<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5afe73d5275ac520114d310400d092b9bb" kindref="member">BORDER_ALL_DIRTY</ref>;</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>buffer_age<sp/>-<sp/>1;<sp/>i++)</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*border_damage<sp/>|=<sp/>go-&gt;<ref refid="structgl__output__state_1a01a050ecd39a8037c246385e97391a19" kindref="member">border_damage</ref>[(go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref><sp/>+<sp/>i)<sp/>%<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>];</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"></highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*border_damage<sp/>&amp;<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a955e714fe630ca6d864293605a1d80da" kindref="member">BORDER_SIZE_CHANGED</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we&apos;ve<sp/>had<sp/>a<sp/>resize,<sp/>we<sp/>have<sp/>to<sp/>do<sp/>a<sp/>full</highlight></codeline>
<codeline lineno="1372"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>repaint.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*border_damage<sp/>|=<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5afe73d5275ac520114d310400d092b9bb" kindref="member">BORDER_ALL_DIRTY</ref>;</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_copy(buffer_damage,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;region);</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>buffer_age<sp/>-<sp/>1;<sp/>i++)</highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union(buffer_damage,</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer_damage,</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;go-&gt;<ref refid="structgl__output__state_1acc706d22ee8bec65f987885e1126ef49" kindref="member">buffer_damage</ref>[(go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref><sp/>+<sp/>i)<sp/>%<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>]);</highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1382"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"></highlight></codeline>
<codeline lineno="1384"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><ref refid="gl-renderer_8c_1aa77706f90bc8ff81603e6d9121364119" kindref="member">output_rotate_damage</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*output_damage,</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/>border_status)</highlight></codeline>
<codeline lineno="1388"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"></highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a920185695fc95f86dd822cb5beece76a" kindref="member">has_egl_buffer_age</ref>)</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"></highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref><sp/>+=<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref><sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref><sp/>%=<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>;</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"></highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_copy(&amp;go-&gt;<ref refid="structgl__output__state_1acc706d22ee8bec65f987885e1126ef49" kindref="member">buffer_damage</ref>[go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref>],<sp/>output_damage);</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a01a050ecd39a8037c246385e97391a19" kindref="member">border_damage</ref>[go-&gt;<ref refid="structgl__output__state_1a80915f4fae04e7e3b7d528ea3d7aee5f" kindref="member">buffer_damage_index</ref>]<sp/>=<sp/>border_status;</highlight></codeline>
<codeline lineno="1400"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"></highlight></codeline>
<codeline lineno="1418"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1419"><highlight class="normal"><ref refid="gl-renderer_8c_1a3181aad2ffe2a4c02d20a74d0bd05ec4" kindref="member">pixman_region_to_egl_y_invert</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>pixman_region32<sp/>*global_region,</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>**rects,</highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>*nrects)</highlight></codeline>
<codeline lineno="1423"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>transformed;</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">pixman_box32<sp/>*box;</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>buffer_height;</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>*d;</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"></highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Translate<sp/>from<sp/>global<sp/>to<sp/>output<sp/>co-ordinate<sp/>space.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;transformed);</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_copy(&amp;transformed,<sp/>global_region);</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_translate(&amp;transformed,<sp/>-<ref refid="structoutput" kindref="compound">output</ref>-&gt;<ref refid="structoutput_1acaa160777547223ba734d78e4690c24b" kindref="member">x</ref>,<sp/>-<ref refid="structoutput" kindref="compound">output</ref>-&gt;<ref refid="structoutput_1ac2c2a13096bd351fda95e72cb6f5a254" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a6edea0da779eae3aca7dd73800591528" kindref="member">weston_transformed_region</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;transform,</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_scale,</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;transformed,<sp/>&amp;transformed);</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"></highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we<sp/>have<sp/>borders<sp/>drawn<sp/>around<sp/>the<sp/>output,<sp/>shift<sp/>our<sp/>output<sp/>damage</highlight></codeline>
<codeline lineno="1441"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>account<sp/>for<sp/>borders<sp/>being<sp/>drawn<sp/>around<sp/>the<sp/>outside,<sp/>adding<sp/>any</highlight></codeline>
<codeline lineno="1442"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>damage<sp/>resulting<sp/>from<sp/>borders<sp/>being<sp/>redrawn.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1ac6ff6ac3041a7d253fdd68ad98b4b265" kindref="member">output_has_borders</ref>(<ref refid="structoutput" kindref="compound">output</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_translate(&amp;transformed,</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a49a30139d23e9af74bb99fe05604e7d8" kindref="member">output_get_border_damage</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref>,</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;transformed);</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"></highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>from<sp/>a<sp/>Pixman<sp/>region<sp/>into<sp/>{x,y,w,h}<sp/>quads,<sp/>flipping<sp/>in<sp/>the</highlight></codeline>
<codeline lineno="1452"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Y<sp/>axis<sp/>to<sp/>account<sp/>for<sp/>GL&apos;s<sp/>lower-left-origin<sp/>co-ordinate<sp/>space.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>box<sp/>=<sp/>pixman_region32_rectangles(&amp;transformed,<sp/>nrects);</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*rects<sp/>=<sp/>malloc(*nrects<sp/>*<sp/>4<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref>));</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"></highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffer_height<sp/>=<sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403adc1d72cde2a809c8e30952044600f1b4" kindref="member">GL_RENDERER_BORDER_TOP</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref><sp/>+</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>+</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"></highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d<sp/>=<sp/>*rects;</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>*nrects;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*d++<sp/>=<sp/>box[i].x1;</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*d++<sp/>=<sp/>buffer_height<sp/>-<sp/>box[i].y2;</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*d++<sp/>=<sp/>box[i].x2<sp/>-<sp/>box[i].x1;</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*d++<sp/>=<sp/>box[i].y2<sp/>-<sp/>box[i].y1;</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"></highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;transformed);</highlight></codeline>
<codeline lineno="1469"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"></highlight></codeline>
<codeline lineno="1471"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><ref refid="gl-renderer_8c_1a8d33d410610a2c518b0d75f600d59ec5" kindref="member">blit_shadow_to_output</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*output_damage)</highlight></codeline>
<codeline lineno="1474"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>sconf<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1a151154134265ce84e0e98d150fbe26a8" kindref="member">req</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__requirements_1ae4cda3f51ad416b95074ca547e619c59" kindref="member">variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>,</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.projection<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.d<sp/>=<sp/>{<sp/></highlight><highlight class="comment">/*<sp/>transpose<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.0f,<sp/><sp/>0.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/><sp/>2.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/><sp/>0.0f,<sp/>1.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-1.0f,<sp/>-1.0f,<sp/>0.0f,<sp/>1.0f</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.type<sp/>=<sp/><ref refid="matrix_8h_1a36f1c17c5d79896d6e3072add55c8c2aa2159882a3c2449030cb1d4fba1862640" kindref="member">WESTON_MATRIX_TRANSFORM_SCALE</ref><sp/>|</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1a36f1c17c5d79896d6e3072add55c8c2aa827fdf83faf73bf1af8049792f35c739" kindref="member">WESTON_MATRIX_TRANSFORM_TRANSLATE</ref>,</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.view_alpha<sp/>=<sp/>1.0f,</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_tex_filter<sp/>=<sp/>GL_NEAREST,</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_tex[0]<sp/>=<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1a6db86c9455344d4ff6f1d4de71f363ca" kindref="member">tex</ref>,</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>width<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>height<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*rects;</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_rects;</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>translated_damage;</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLfloat<sp/>verts[4<sp/>*<sp/>2];</highlight></codeline>
<codeline lineno="1502"><highlight class="normal"></highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;translated_damage);</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"></highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>&amp;sconf);</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisable(GL_BLEND);</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"></highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>output_damage<sp/>is<sp/>in<sp/>global<sp/>coordinates<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_intersect(&amp;translated_damage,<sp/>output_damage,</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;region);</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>to<sp/>output<sp/>pixel<sp/>coordinates<sp/>in-place<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="backend_8h_1a8d4a3039ba1a23bfe713131cf3b7cd5a" kindref="member">weston_output_region_from_global</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;translated_damage);</highlight></codeline>
<codeline lineno="1513"><highlight class="normal"></highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rects<sp/>=<sp/>pixman_region32_rectangles(&amp;translated_damage,<sp/>&amp;n_rects);</highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_rects;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"></highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[0]<sp/>=<sp/>rects[i].x1<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[1]<sp/>=<sp/>(height<sp/>-<sp/>rects[i].y1)<sp/>/<sp/>height;</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[2]<sp/>=<sp/>rects[i].x2<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[3]<sp/>=<sp/>(height<sp/>-<sp/>rects[i].y1)<sp/>/<sp/>height;</highlight></codeline>
<codeline lineno="1521"><highlight class="normal"></highlight></codeline>
<codeline lineno="1522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[4]<sp/>=<sp/>rects[i].x2<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[5]<sp/>=<sp/>(height<sp/>-<sp/>rects[i].y2)<sp/>/<sp/>height;</highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[6]<sp/>=<sp/>rects[i].x1<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verts[7]<sp/>=<sp/>(height<sp/>-<sp/>rects[i].y2)<sp/>/<sp/>height;</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"></highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(0,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>verts);</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="1529"><highlight class="normal"></highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>texcoord:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(1,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>verts);</highlight></codeline>
<codeline lineno="1532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="1533"><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDrawArrays(GL_TRIANGLE_FAN,<sp/>0,<sp/>4);</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"></highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>0);</highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;translated_damage);</highlight></codeline>
<codeline lineno="1539"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"></highlight></codeline>
<codeline lineno="1541"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>NOTE:<sp/>We<sp/>now<sp/>allow<sp/>falling<sp/>back<sp/>to<sp/>ARGB<sp/>gl<sp/>visuals<sp/>when<sp/>XRGB<sp/>is</highlight></codeline>
<codeline lineno="1542"><highlight class="comment"><sp/>*<sp/>unavailable,<sp/>so<sp/>we&apos;re<sp/>assuming<sp/>the<sp/>background<sp/>has<sp/>no<sp/>transparency</highlight></codeline>
<codeline lineno="1543"><highlight class="comment"><sp/>*<sp/>and<sp/>that<sp/>everything<sp/>with<sp/>a<sp/>blend,<sp/>like<sp/>drop<sp/>shadows,<sp/>will<sp/>have<sp/>something</highlight></codeline>
<codeline lineno="1544"><highlight class="comment"><sp/>*<sp/>opaque<sp/>(like<sp/>the<sp/>background)<sp/>drawn<sp/>underneath<sp/>it.</highlight></codeline>
<codeline lineno="1545"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="1546"><highlight class="comment"><sp/>*<sp/>Depending<sp/>on<sp/>the<sp/>underlying<sp/>hardware,<sp/>violating<sp/>that<sp/>assumption<sp/>could</highlight></codeline>
<codeline lineno="1547"><highlight class="comment"><sp/>*<sp/>result<sp/>in<sp/>seeing<sp/>through<sp/>to<sp/>another<sp/>display<sp/>plane.</highlight></codeline>
<codeline lineno="1548"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1549"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><ref refid="gl-renderer_8c_1a34db4fc09924159f0101aafee06c64ca" kindref="member">gl_renderer_repaint_output</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>*output_damage)</highlight></codeline>
<codeline lineno="1552"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*compositor<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor;</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref>);</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLBoolean<sp/>ret;</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>errored;</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>areas<sp/>we&apos;ve<sp/>damaged<sp/>since<sp/>we<sp/>last<sp/>used<sp/>this<sp/>buffer<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>previous_damage;</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>total<sp/>area<sp/>we<sp/>need<sp/>to<sp/>repaint<sp/>this<sp/>time<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>total_damage;</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5" kindref="member">gl_border_status</ref><sp/>border_status<sp/>=<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" kindref="member">BORDER_STATUS_CLEAN</ref>;</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view;</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"></highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a2485d1997f3d3d4c128c5b173a1fef51" kindref="member">use_output</ref>(<ref refid="structoutput" kindref="compound">output</ref>)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"></highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Clear<sp/>the<sp/>used_in_output_repaint<sp/>flag,<sp/>so<sp/>that<sp/>we<sp/>can<sp/>properly<sp/>track</highlight></codeline>
<codeline lineno="1569"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>which<sp/>surfaces<sp/>were<sp/>used<sp/>in<sp/>this<sp/>output<sp/>repaint.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_reverse(view,<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1a32ac5a7b9ccbac09ec941681d12cce44" kindref="member">view_list</ref>,<sp/><ref refid="structweston__view_1a81dd60dee728758e7963f2fd0eb12cee" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(view-&gt;<ref refid="structweston__view_1a083349493fecdb4e90d413e122c802b0" kindref="member">plane</ref><sp/>==<sp/>&amp;compositor-&gt;<ref refid="structweston__compositor_1acd96fdbda4ef438f5292372ab78535ce" kindref="member">primary_plane</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=</highlight></codeline>
<codeline lineno="1573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(view-&gt;<ref refid="structweston__view_1a378ad6a9de6d0d4f908769d106436034" kindref="member">surface</ref>);</highlight></codeline>
<codeline lineno="1574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a7aa9c0737dd0b7ffe314e61ca5f46844" kindref="member">used_in_output_repaint</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"></highlight></codeline>
<codeline lineno="1578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref><sp/>!=<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a647a24d7c43b5e1ba3fa16268858fa6d" kindref="member">destroy_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref>);</highlight></codeline>
<codeline lineno="1580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref><sp/>!=<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a647a24d7c43b5e1ba3fa16268858fa6d" kindref="member">destroy_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref>);</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"></highlight></codeline>
<codeline lineno="1583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a311a6801d5d60a6183ea362ae2b2896d" kindref="member">create_render_sync</ref>(gr);</highlight></codeline>
<codeline lineno="1584"><highlight class="normal"></highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>the<sp/>global<sp/>GL<sp/>matrix<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a6dea590e5582d9b631ecf9d7301ef1df" kindref="member">output_matrix</ref><sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;matrix;</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1a11705753750edc192cfd0861fdfb5b8a" kindref="member">weston_matrix_translate</ref>(&amp;go-&gt;<ref refid="structgl__output__state_1a6dea590e5582d9b631ecf9d7301ef1df" kindref="member">output_matrix</ref>,</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-(<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref><sp/>/<sp/>2.0),</highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-(<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>/<sp/>2.0),<sp/>0);</highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1ae66be97d5f6b1aa202cf48c3c1f3a0e1" kindref="member">weston_matrix_scale</ref>(&amp;go-&gt;<ref refid="structgl__output__state_1a6dea590e5582d9b631ecf9d7301ef1df" kindref="member">output_matrix</ref>,</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.0<sp/>/<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-2.0<sp/>/<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="1593"><highlight class="normal"></highlight></codeline>
<codeline lineno="1594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>using<sp/>shadow,<sp/>redirect<sp/>all<sp/>drawing<sp/>to<sp/>it<sp/>first.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a882e8d873d5d851c1b3d1b6f306cbcc4" kindref="member">shadow_exists</ref>(go))<sp/>{</highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>XXX:<sp/>Shadow<sp/>code<sp/>does<sp/>not<sp/>support<sp/>resizing.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref><sp/>==<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1aa9f44804d5d0ccbb1e214f72794b8ace" kindref="member">width</ref>);</highlight></codeline>
<codeline lineno="1598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>==<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1a63739da3b338ccdb9c0ce0cd1cf39cdf" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1599"><highlight class="normal"></highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1ab346dd37d3b8bb1d7bfb35575ca154c1" kindref="member">fbo</ref>);</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glViewport(0,<sp/>0,<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1aa9f44804d5d0ccbb1e214f72794b8ace" kindref="member">width</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>.<ref refid="structgl__fbo__texture_1a63739da3b338ccdb9c0ce0cd1cf39cdf" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>0);</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glViewport(go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"></highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>In<sp/>fan<sp/>debug<sp/>mode,<sp/>redraw<sp/>everything<sp/>to<sp/>make<sp/>sure<sp/>that<sp/>we<sp/>clear<sp/>any</highlight></codeline>
<codeline lineno="1611"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>fans<sp/>left<sp/>over<sp/>from<sp/>previous<sp/>draws<sp/>on<sp/>this<sp/>buffer.</highlight></codeline>
<codeline lineno="1612"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>precludes<sp/>the<sp/>use<sp/>of<sp/>EGL_EXT_swap_buffers_with_damage<sp/>and</highlight></codeline>
<codeline lineno="1613"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>EGL_KHR_partial_update,<sp/>since<sp/>we<sp/>damage<sp/>the<sp/>whole<sp/>area.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_t<sp/>undamaged;</highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;undamaged);</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_subtract(&amp;undamaged,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;region,</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_damage);</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" kindref="member">repaint_views</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;undamaged);</highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;undamaged);</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1624"><highlight class="normal"></highlight></codeline>
<codeline lineno="1625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>previous_damage<sp/>covers<sp/>regions<sp/>damaged<sp/>in<sp/>previous<sp/>paints<sp/>since<sp/>we</highlight></codeline>
<codeline lineno="1626"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>last<sp/>used<sp/>this<sp/>buffer<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;previous_damage);</highlight></codeline>
<codeline lineno="1628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;total_damage);<sp/></highlight><highlight class="comment">/*<sp/>total<sp/>area<sp/>to<sp/>redraw<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1629"><highlight class="normal"></highlight></codeline>
<codeline lineno="1630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Update<sp/>previous_damage<sp/>using<sp/>buffer_age<sp/>(if<sp/>available),<sp/>and<sp/>store</highlight></codeline>
<codeline lineno="1631"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>current<sp/>damaged<sp/>region<sp/>for<sp/>future<sp/>use.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ade544e39c643489857aed93c1a81b2fd" kindref="member">output_get_damage</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;previous_damage,<sp/>&amp;border_status);</highlight></codeline>
<codeline lineno="1633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1aa77706f90bc8ff81603e6d9121364119" kindref="member">output_rotate_damage</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>output_damage,<sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref>);</highlight></codeline>
<codeline lineno="1634"><highlight class="normal"></highlight></codeline>
<codeline lineno="1635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Redraw<sp/>both<sp/>areas<sp/>which<sp/>have<sp/>changed<sp/>since<sp/>we<sp/>last<sp/>used<sp/>this<sp/>buffer,</highlight></codeline>
<codeline lineno="1636"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>as<sp/>well<sp/>as<sp/>the<sp/>areas<sp/>we<sp/>now<sp/>want<sp/>to<sp/>repaint,<sp/>to<sp/>make<sp/>sure<sp/>the</highlight></codeline>
<codeline lineno="1637"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>buffer<sp/>is<sp/>up<sp/>to<sp/>date.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union(&amp;total_damage,<sp/>&amp;previous_damage,<sp/>output_damage);</highlight></codeline>
<codeline lineno="1639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>border_status<sp/>|=<sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref>;</highlight></codeline>
<codeline lineno="1640"><highlight class="normal"></highlight></codeline>
<codeline lineno="1641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a2165337b1603946968079eca3c47f65b" kindref="member">has_egl_partial_update</ref><sp/>&amp;&amp;<sp/>!gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_egl_rects;</highlight></codeline>
<codeline lineno="1643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>*egl_rects;</highlight></codeline>
<codeline lineno="1644"><highlight class="normal"></highlight></codeline>
<codeline lineno="1645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>partial_update,<sp/>we<sp/>need<sp/>to<sp/>pass<sp/>the<sp/>region<sp/>which<sp/>has</highlight></codeline>
<codeline lineno="1646"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>changed<sp/>since<sp/>we<sp/>last<sp/>rendered<sp/>into<sp/>this<sp/>specific<sp/>buffer;</highlight></codeline>
<codeline lineno="1647"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>this<sp/>is<sp/>total_damage.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a3181aad2ffe2a4c02d20a74d0bd05ec4" kindref="member">pixman_region_to_egl_y_invert</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;total_damage,</highlight></codeline>
<codeline lineno="1649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;egl_rects,<sp/>&amp;n_egl_rects);</highlight></codeline>
<codeline lineno="1650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a82e63a57f7717ba9560f03ce4276cd2f" kindref="member">set_damage_region</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="1651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_rects,<sp/>n_egl_rects);</highlight></codeline>
<codeline lineno="1652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(egl_rects);</highlight></codeline>
<codeline lineno="1653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1654"><highlight class="normal"></highlight></codeline>
<codeline lineno="1655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a882e8d873d5d851c1b3d1b6f306cbcc4" kindref="member">shadow_exists</ref>(go))<sp/>{</highlight></codeline>
<codeline lineno="1656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Repaint<sp/>into<sp/>shadow.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(compositor-&gt;<ref refid="structweston__compositor_1a90cacc8c057f29e53566637f6dfa3fad" kindref="member">test_data</ref>.<ref refid="structweston__testsuite__data_1a066dac74ee89927f8cd00628c892bc87" kindref="member">test_quirks</ref>.<ref refid="structweston__testsuite__quirks_1abb3769af372946baa999893d45bba17f" kindref="member">gl_force_full_redraw_of_shadow_fb</ref>)</highlight></codeline>
<codeline lineno="1658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" kindref="member">repaint_views</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;region);</highlight></codeline>
<codeline lineno="1659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" kindref="member">repaint_views</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>output_damage);</highlight></codeline>
<codeline lineno="1661"><highlight class="normal"></highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>0);</highlight></codeline>
<codeline lineno="1663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glViewport(go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="1665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="1666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>);</highlight></codeline>
<codeline lineno="1667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a8d33d410610a2c518b0d75f600d59ec5" kindref="member">blit_shadow_to_output</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;total_damage);</highlight></codeline>
<codeline lineno="1668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1af22c3211a5d7a94100f685241ac47dd2" kindref="member">repaint_views</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;total_damage);</highlight></codeline>
<codeline lineno="1670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1671"><highlight class="normal"></highlight></codeline>
<codeline lineno="1672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;total_damage);</highlight></codeline>
<codeline lineno="1673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;previous_damage);</highlight></codeline>
<codeline lineno="1674"><highlight class="normal"></highlight></codeline>
<codeline lineno="1675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a2a0db6729b1a75620c5263d2d6b4811a" kindref="member">draw_output_borders</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>border_status);</highlight></codeline>
<codeline lineno="1676"><highlight class="normal"></highlight></codeline>
<codeline lineno="1677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_emit(&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;frame_signal,<sp/>output_damage);</highlight></codeline>
<codeline lineno="1678"><highlight class="normal"></highlight></codeline>
<codeline lineno="1679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a311a6801d5d60a6183ea362ae2b2896d" kindref="member">create_render_sync</ref>(gr);</highlight></codeline>
<codeline lineno="1680"><highlight class="normal"></highlight></codeline>
<codeline lineno="1681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a6d1134d418350481ea2104ffbedb9fe9" kindref="member">swap_buffers_with_damage</ref><sp/>&amp;&amp;<sp/>!gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_egl_rects;</highlight></codeline>
<codeline lineno="1683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>*egl_rects;</highlight></codeline>
<codeline lineno="1684"><highlight class="normal"></highlight></codeline>
<codeline lineno="1685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>swap_buffers_with_damage,<sp/>we<sp/>need<sp/>to<sp/>pass<sp/>the<sp/>region</highlight></codeline>
<codeline lineno="1686"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>which<sp/>has<sp/>changed<sp/>since<sp/>the<sp/>previous<sp/>SwapBuffers<sp/>on<sp/>this</highlight></codeline>
<codeline lineno="1687"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>surface<sp/>-<sp/>this<sp/>is<sp/>output_damage.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a3181aad2ffe2a4c02d20a74d0bd05ec4" kindref="member">pixman_region_to_egl_y_invert</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>output_damage,</highlight></codeline>
<codeline lineno="1689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;egl_rects,<sp/>&amp;n_egl_rects);</highlight></codeline>
<codeline lineno="1690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a6d1134d418350481ea2104ffbedb9fe9" kindref="member">swap_buffers_with_damage</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_rects,<sp/>n_egl_rects);</highlight></codeline>
<codeline lineno="1693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(egl_rects);</highlight></codeline>
<codeline lineno="1694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>eglSwapBuffers(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>);</highlight></codeline>
<codeline lineno="1696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1697"><highlight class="normal"></highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>EGL_FALSE<sp/>&amp;&amp;<sp/>!errored)<sp/>{</highlight></codeline>
<codeline lineno="1699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errored<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>in<sp/>eglSwapBuffers.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="1702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1703"><highlight class="normal"></highlight></codeline>
<codeline lineno="1704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a26444c23d5c0fbf11ff482b0343fb889" kindref="member">BORDER_STATUS_CLEAN</ref>;</highlight></codeline>
<codeline lineno="1705"><highlight class="normal"></highlight></codeline>
<codeline lineno="1706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>have<sp/>to<sp/>submit<sp/>the<sp/>render<sp/>sync<sp/>objects<sp/>after<sp/>swap<sp/>buffers,<sp/>since</highlight></codeline>
<codeline lineno="1707"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>the<sp/>objects<sp/>get<sp/>assigned<sp/>a<sp/>valid<sp/>sync<sp/>file<sp/>fd<sp/>only<sp/>after<sp/>a<sp/>gl<sp/>flush.</highlight></codeline>
<codeline lineno="1708"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a59f1b4cc1d6cb2d6e21e9129792004c7" kindref="member">timeline_submit_render_sync</ref>(gr,<sp/><ref refid="structoutput" kindref="compound">output</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref>,</highlight></codeline>
<codeline lineno="1710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302af9e4612108eb99570774874565d36c0f" kindref="member">TIMELINE_RENDER_POINT_TYPE_BEGIN</ref>);</highlight></codeline>
<codeline lineno="1711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a59f1b4cc1d6cb2d6e21e9129792004c7" kindref="member">timeline_submit_render_sync</ref>(gr,<sp/><ref refid="structoutput" kindref="compound">output</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref>,</highlight></codeline>
<codeline lineno="1712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a83d1bf025c196d09cc4a4b4273b85302a320783c49e602f85f5c11f36ce1e1f86" kindref="member">TIMELINE_RENDER_POINT_TYPE_END</ref>);</highlight></codeline>
<codeline lineno="1713"><highlight class="normal"></highlight></codeline>
<codeline lineno="1714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae7aa13629feed78bc17796493fef079c" kindref="member">update_buffer_release_fences</ref>(compositor,<sp/><ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1715"><highlight class="normal"></highlight></codeline>
<codeline lineno="1716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1a16d71e348366428dfe68e891144b074a" kindref="member">gl_renderer_garbage_collect_programs</ref>(gr);</highlight></codeline>
<codeline lineno="1717"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1718"><highlight class="normal"></highlight></codeline>
<codeline lineno="1719"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1720"><highlight class="normal"><ref refid="gl-renderer_8c_1a27c525c114d7039365db4b428b64cb59" kindref="member">gl_renderer_read_pixels</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="1721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_format_code_t<sp/>format,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*pixels,</highlight></codeline>
<codeline lineno="1722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>x,<sp/>uint32_t<sp/>y,</highlight></codeline>
<codeline lineno="1723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>width,<sp/>uint32_t<sp/><ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>)</highlight></codeline>
<codeline lineno="1724"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>;</highlight></codeline>
<codeline lineno="1726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="1727"><highlight class="normal"></highlight></codeline>
<codeline lineno="1728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>+=<sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403a07748d90edb78d1e580311b4a37ce88e" kindref="member">GL_RENDERER_BORDER_LEFT</ref>].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="1729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y<sp/>+=<sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[<ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403ac98acda6e70392db0c8b68fd8ca35917" kindref="member">GL_RENDERER_BORDER_BOTTOM</ref>].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="1730"><highlight class="normal"></highlight></codeline>
<codeline lineno="1731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(format)<sp/>{</highlight></codeline>
<codeline lineno="1732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>PIXMAN_a8r8g8b8:</highlight></codeline>
<codeline lineno="1733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gl_format<sp/>=<sp/>GL_BGRA_EXT;</highlight></codeline>
<codeline lineno="1734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>PIXMAN_a8b8g8r8:</highlight></codeline>
<codeline lineno="1736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gl_format<sp/>=<sp/>GL_RGBA;</highlight></codeline>
<codeline lineno="1737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1741"><highlight class="normal"></highlight></codeline>
<codeline lineno="1742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a2485d1997f3d3d4c128c5b173a1fef51" kindref="member">use_output</ref>(<ref refid="structoutput" kindref="compound">output</ref>)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="1743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1744"><highlight class="normal"></highlight></codeline>
<codeline lineno="1745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_PACK_ALIGNMENT,<sp/>1);</highlight></codeline>
<codeline lineno="1746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glReadPixels(x,<sp/>y,<sp/>width,<sp/>height,<sp/>gl_format,</highlight></codeline>
<codeline lineno="1747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_UNSIGNED_BYTE,<sp/>pixels);</highlight></codeline>
<codeline lineno="1748"><highlight class="normal"></highlight></codeline>
<codeline lineno="1749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1750"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1751"><highlight class="normal"></highlight></codeline>
<codeline lineno="1752"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>GLenum</highlight></codeline>
<codeline lineno="1753"><highlight class="normal"><ref refid="gl-renderer_8c_1a357c9c9246246881b1254df48d71e8c9" kindref="member">gl_format_from_internal</ref>(GLenum<sp/>internal_format)</highlight></codeline>
<codeline lineno="1754"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(internal_format)<sp/>{</highlight></codeline>
<codeline lineno="1756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>GL_R8_EXT:</highlight></codeline>
<codeline lineno="1757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_RED_EXT;</highlight></codeline>
<codeline lineno="1758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>GL_RG8_EXT:</highlight></codeline>
<codeline lineno="1759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_RG_EXT;</highlight></codeline>
<codeline lineno="1760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>internal_format;</highlight></codeline>
<codeline lineno="1762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1763"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1764"><highlight class="normal"></highlight></codeline>
<codeline lineno="1765"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1766"><highlight class="normal"><ref refid="gl-renderer_8c_1ab9a84e745915a5667f066e510a9621da" kindref="member">gl_renderer_flush_damage</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>)</highlight></codeline>
<codeline lineno="1767"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__testsuite__quirks" kindref="compound">weston_testsuite_quirks</ref><sp/>*quirks<sp/>=</highlight></codeline>
<codeline lineno="1769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structsurface" kindref="compound">surface</ref>-&gt;compositor-&gt;test_data.test_quirks;</highlight></codeline>
<codeline lineno="1770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="1771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>.<ref refid="structweston__buffer__reference_1a87b175662a988253c4f12a2f25ce04e9" kindref="member">buffer</ref>;</highlight></codeline>
<codeline lineno="1772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__view" kindref="compound">weston_view</ref><sp/>*view;</highlight></codeline>
<codeline lineno="1773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>texture_used;</highlight></codeline>
<codeline lineno="1774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>*rectangles;</highlight></codeline>
<codeline lineno="1775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>*data;</highlight></codeline>
<codeline lineno="1776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>j,<sp/>n;</highlight></codeline>
<codeline lineno="1777"><highlight class="normal"></highlight></codeline>
<codeline lineno="1778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_union(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>,</highlight></codeline>
<codeline lineno="1779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>,<sp/>&amp;<ref refid="structsurface" kindref="compound">surface</ref>-&gt;damage);</highlight></codeline>
<codeline lineno="1780"><highlight class="normal"></highlight></codeline>
<codeline lineno="1781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structbuffer" kindref="compound">buffer</ref>)</highlight></codeline>
<codeline lineno="1782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1783"><highlight class="normal"></highlight></codeline>
<codeline lineno="1784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Avoid<sp/>upload,<sp/>if<sp/>the<sp/>texture<sp/>won&apos;t<sp/>be<sp/>used<sp/>this<sp/>time.</highlight></codeline>
<codeline lineno="1785"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>We<sp/>still<sp/>accumulate<sp/>the<sp/>damage<sp/>in<sp/>texture_damage,<sp/>and</highlight></codeline>
<codeline lineno="1786"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>hold<sp/>the<sp/>reference<sp/>to<sp/>the<sp/>buffer,<sp/>in<sp/>case<sp/>the<sp/>surface</highlight></codeline>
<codeline lineno="1787"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>migrates<sp/>back<sp/>to<sp/>the<sp/>primary<sp/>plane.</highlight></codeline>
<codeline lineno="1788"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>texture_used<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(view,<sp/>&amp;<ref refid="structsurface" kindref="compound">surface</ref>-&gt;views,<sp/><ref refid="structweston__view_1a9186967c5dedc3d58d64bd24cc6be9bb" kindref="member">surface_link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(view-&gt;<ref refid="structweston__view_1a083349493fecdb4e90d413e122c802b0" kindref="member">plane</ref><sp/>==<sp/>&amp;<ref refid="structsurface" kindref="compound">surface</ref>-&gt;compositor-&gt;primary_plane)<sp/>{</highlight></codeline>
<codeline lineno="1792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>texture_used<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!texture_used)</highlight></codeline>
<codeline lineno="1797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1798"><highlight class="normal"></highlight></codeline>
<codeline lineno="1799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pixman_region32_not_empty(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!gs-&gt;<ref refid="structgl__surface__state_1ac926ebf6ccbc0f0a66529912af45fcf5" kindref="member">needs_full_upload</ref>)</highlight></codeline>
<codeline lineno="1801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>done;</highlight></codeline>
<codeline lineno="1802"><highlight class="normal"></highlight></codeline>
<codeline lineno="1803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>wl_shm_buffer_get_data(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer);</highlight></codeline>
<codeline lineno="1804"><highlight class="normal"></highlight></codeline>
<codeline lineno="1805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="1806"><highlight class="normal"></highlight></codeline>
<codeline lineno="1807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1ac926ebf6ccbc0f0a66529912af45fcf5" kindref="member">needs_full_upload</ref><sp/>||<sp/>quirks-&gt;<ref refid="structweston__testsuite__quirks_1abd9e19201aea3d99f24f3a33bc1028bf" kindref="member">gl_force_full_upload</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_PIXELS_EXT,<sp/>0);</highlight></codeline>
<codeline lineno="1809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_ROWS_EXT,<sp/>0);</highlight></codeline>
<codeline lineno="1810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_shm_buffer_begin_access(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer);</highlight></codeline>
<codeline lineno="1811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="1812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[j]);</highlight></codeline>
<codeline lineno="1813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_ROW_LENGTH_EXT,</highlight></codeline>
<codeline lineno="1814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j]);</highlight></codeline>
<codeline lineno="1815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexImage2D(GL_TEXTURE_2D,<sp/>0,</highlight></codeline>
<codeline lineno="1816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[j],</highlight></codeline>
<codeline lineno="1817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j],</highlight></codeline>
<codeline lineno="1818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[j],</highlight></codeline>
<codeline lineno="1819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,</highlight></codeline>
<codeline lineno="1820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a357c9c9246246881b1254df48d71e8c9" kindref="member">gl_format_from_internal</ref>(gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[j]),</highlight></codeline>
<codeline lineno="1821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref>,</highlight></codeline>
<codeline lineno="1822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>+<sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[j]);</highlight></codeline>
<codeline lineno="1823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_shm_buffer_end_access(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer);</highlight></codeline>
<codeline lineno="1825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>done;</highlight></codeline>
<codeline lineno="1826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1827"><highlight class="normal"></highlight></codeline>
<codeline lineno="1828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rectangles<sp/>=<sp/>pixman_region32_rectangles(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>,<sp/>&amp;n);</highlight></codeline>
<codeline lineno="1829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_shm_buffer_begin_access(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer);</highlight></codeline>
<codeline lineno="1830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="1831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_box32_t<sp/>r;</highlight></codeline>
<codeline lineno="1832"><highlight class="normal"></highlight></codeline>
<codeline lineno="1833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r<sp/>=<sp/><ref refid="compositor_8c_1a93bb5bbf6daec9ac24e8735e22fca35d" kindref="member">weston_surface_to_buffer_rect</ref>(<ref refid="structsurface" kindref="compound">surface</ref>,<sp/>rectangles[i]);</highlight></codeline>
<codeline lineno="1834"><highlight class="normal"></highlight></codeline>
<codeline lineno="1835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="1836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[j]);</highlight></codeline>
<codeline lineno="1837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_ROW_LENGTH_EXT,</highlight></codeline>
<codeline lineno="1838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j]);</highlight></codeline>
<codeline lineno="1839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_PIXELS_EXT,</highlight></codeline>
<codeline lineno="1840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r.x1<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j]);</highlight></codeline>
<codeline lineno="1841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_UNPACK_SKIP_ROWS_EXT,</highlight></codeline>
<codeline lineno="1842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r.y1<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j]);</highlight></codeline>
<codeline lineno="1843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexSubImage2D(GL_TEXTURE_2D,<sp/>0,</highlight></codeline>
<codeline lineno="1844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r.x1<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j],</highlight></codeline>
<codeline lineno="1845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r.y1<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[j],</highlight></codeline>
<codeline lineno="1846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(r.x2<sp/>-<sp/>r.x1)<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[j],</highlight></codeline>
<codeline lineno="1847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(r.y2<sp/>-<sp/>r.y1)<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[j],</highlight></codeline>
<codeline lineno="1848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a357c9c9246246881b1254df48d71e8c9" kindref="member">gl_format_from_internal</ref>(gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[j]),</highlight></codeline>
<codeline lineno="1849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref>,</highlight></codeline>
<codeline lineno="1850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>+<sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[j]);</highlight></codeline>
<codeline lineno="1851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_shm_buffer_end_access(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer);</highlight></codeline>
<codeline lineno="1854"><highlight class="normal"></highlight></codeline>
<codeline lineno="1855"><highlight class="normal">done:</highlight></codeline>
<codeline lineno="1856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>);</highlight></codeline>
<codeline lineno="1857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>);</highlight></codeline>
<codeline lineno="1858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ac926ebf6ccbc0f0a66529912af45fcf5" kindref="member">needs_full_upload</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1859"><highlight class="normal"></highlight></codeline>
<codeline lineno="1860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a46c9d30efa62b7ca5f720b1dd83ebe12" kindref="member">weston_buffer_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="1861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a0abe1ac1aff541e5670f35fb2db85c7d" kindref="member">weston_buffer_release_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="1862"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1863"><highlight class="normal"></highlight></codeline>
<codeline lineno="1864"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1865"><highlight class="normal"><ref refid="gl-renderer_8c_1a715bd1ab3af0516ef379aea7cb8805b1" kindref="member">ensure_textures</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs,<sp/>GLenum<sp/>target,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_textures)</highlight></codeline>
<codeline lineno="1866"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="1868"><highlight class="normal"></highlight></codeline>
<codeline lineno="1869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(num_textures<sp/>&lt;=<sp/>gs-&gt;num_textures)</highlight></codeline>
<codeline lineno="1870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1871"><highlight class="normal"></highlight></codeline>
<codeline lineno="1872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="1873"><highlight class="normal"></highlight></codeline>
<codeline lineno="1874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>;<sp/>i<sp/>&lt;<sp/>num_textures;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="1875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenTextures(1,<sp/>&amp;gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[i]);</highlight></codeline>
<codeline lineno="1876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[i]);</highlight></codeline>
<codeline lineno="1877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(target,<sp/>GL_TEXTURE_WRAP_S,<sp/>GL_CLAMP_TO_EDGE);</highlight></codeline>
<codeline lineno="1878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexParameteri(target,<sp/>GL_TEXTURE_WRAP_T,<sp/>GL_CLAMP_TO_EDGE);</highlight></codeline>
<codeline lineno="1879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref><sp/>=<sp/>num_textures;</highlight></codeline>
<codeline lineno="1881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(target,<sp/>0);</highlight></codeline>
<codeline lineno="1882"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1883"><highlight class="normal"></highlight></codeline>
<codeline lineno="1884"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1885"><highlight class="normal"><ref refid="gl-renderer_8c_1ac15d61a7b5996056050902211f4e74c6" kindref="member">gl_renderer_attach_shm</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*es,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref>,</highlight></codeline>
<codeline lineno="1886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>wl_shm_buffer<sp/>*shm_buffer)</highlight></codeline>
<codeline lineno="1887"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>es-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>;</highlight></codeline>
<codeline lineno="1889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="1890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(es);</highlight></codeline>
<codeline lineno="1891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[3]<sp/>=<sp/>{0,<sp/>0,<sp/>0};</highlight></codeline>
<codeline lineno="1892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref>;</highlight></codeline>
<codeline lineno="1893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref>;</highlight></codeline>
<codeline lineno="1894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_planes;</highlight></codeline>
<codeline lineno="1895"><highlight class="normal"></highlight></codeline>
<codeline lineno="1896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;shm_buffer<sp/>=<sp/>shm_buffer;</highlight></codeline>
<codeline lineno="1897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;width<sp/>=<sp/>wl_shm_buffer_get_width(shm_buffer);</highlight></codeline>
<codeline lineno="1898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>=<sp/>wl_shm_buffer_get_height(shm_buffer);</highlight></codeline>
<codeline lineno="1899"><highlight class="normal"></highlight></codeline>
<codeline lineno="1900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[0]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[0]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[0]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1904"><highlight class="normal"></highlight></codeline>
<codeline lineno="1905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(wl_shm_buffer_get_format(shm_buffer))<sp/>{</highlight></codeline>
<codeline lineno="1906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_XRGB8888:</highlight></codeline>
<codeline lineno="1907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022acf4bfe46d502a0f85581c2ee45a41dcc" kindref="member">SHADER_VARIANT_RGBX</ref>;</highlight></codeline>
<codeline lineno="1908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer)<sp/>/<sp/>4;</highlight></codeline>
<codeline lineno="1909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_BGRA_EXT;</highlight></codeline>
<codeline lineno="1910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_ARGB8888:</highlight></codeline>
<codeline lineno="1914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>;</highlight></codeline>
<codeline lineno="1915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer)<sp/>/<sp/>4;</highlight></codeline>
<codeline lineno="1916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_BGRA_EXT;</highlight></codeline>
<codeline lineno="1917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_RGB565:</highlight></codeline>
<codeline lineno="1921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022acf4bfe46d502a0f85581c2ee45a41dcc" kindref="member">SHADER_VARIANT_RGBX</ref>;</highlight></codeline>
<codeline lineno="1922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer)<sp/>/<sp/>2;</highlight></codeline>
<codeline lineno="1923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_RGB;</highlight></codeline>
<codeline lineno="1924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_SHORT_5_6_5;</highlight></codeline>
<codeline lineno="1925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_YUV420:</highlight></codeline>
<codeline lineno="1928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a97c6403e37049f3c90e0304dcf5abd41" kindref="member">SHADER_VARIANT_Y_U_V</ref>;</highlight></codeline>
<codeline lineno="1929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer);</highlight></codeline>
<codeline lineno="1930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="1932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[1]<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[0]<sp/>+<sp/>(<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[0])<sp/>*</highlight></codeline>
<codeline lineno="1933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[0]);</highlight></codeline>
<codeline lineno="1934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[2]<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[1]<sp/>+<sp/>(<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[1])<sp/>*</highlight></codeline>
<codeline lineno="1937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[1]);</highlight></codeline>
<codeline lineno="1938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[2]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[2]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ab7dea4c1aeae5e868a156df8480facf6" kindref="member">has_gl_texture_rg</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_R8_EXT;</highlight></codeline>
<codeline lineno="1942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/>GL_R8_EXT;</highlight></codeline>
<codeline lineno="1943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2]<sp/>=<sp/>GL_R8_EXT;</highlight></codeline>
<codeline lineno="1944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_LUMINANCE;</highlight></codeline>
<codeline lineno="1946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/>GL_LUMINANCE;</highlight></codeline>
<codeline lineno="1947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2]<sp/>=<sp/>GL_LUMINANCE;</highlight></codeline>
<codeline lineno="1948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_NV12:</highlight></codeline>
<codeline lineno="1952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer);</highlight></codeline>
<codeline lineno="1953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[1]<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[0]<sp/>+<sp/>(<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[0])<sp/>*</highlight></codeline>
<codeline lineno="1956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>/<sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[0]);</highlight></codeline>
<codeline lineno="1957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ab7dea4c1aeae5e868a156df8480facf6" kindref="member">has_gl_texture_rg</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a3ec6f6f348a5d4855ee7c063ee600db0" kindref="member">SHADER_VARIANT_Y_UV</ref>;</highlight></codeline>
<codeline lineno="1961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_R8_EXT;</highlight></codeline>
<codeline lineno="1962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/>GL_RG8_EXT;</highlight></codeline>
<codeline lineno="1963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022ac460db92398d08c0279a987f7c666580" kindref="member">SHADER_VARIANT_Y_XUXV</ref>;</highlight></codeline>
<codeline lineno="1965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_LUMINANCE;</highlight></codeline>
<codeline lineno="1966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/>GL_LUMINANCE_ALPHA;</highlight></codeline>
<codeline lineno="1967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_YUYV:</highlight></codeline>
<codeline lineno="1971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022ac460db92398d08c0279a987f7c666580" kindref="member">SHADER_VARIANT_Y_XUXV</ref>;</highlight></codeline>
<codeline lineno="1972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer)<sp/>/<sp/>2;</highlight></codeline>
<codeline lineno="1973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a1fe22c5cd222d6e0f1a0ef575630e08e" kindref="member">offset</ref>[1]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1aef969b690733347cefffa62ddbd5708b" kindref="member">hsub</ref>[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="1977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a914c400eb5fdbabf10826eb7fa6aa4b0" kindref="member">vsub</ref>[1]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ab7dea4c1aeae5e868a156df8480facf6" kindref="member">has_gl_texture_rg</ref>)</highlight></codeline>
<codeline lineno="1979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_RG8_EXT;</highlight></codeline>
<codeline lineno="1980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_LUMINANCE_ALPHA;</highlight></codeline>
<codeline lineno="1982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/>GL_BGRA_EXT;</highlight></codeline>
<codeline lineno="1983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>WL_SHM_FORMAT_XYUV8888:</highlight></codeline>
<codeline lineno="1986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="1987"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>[31:0]<sp/>X:Y:Cb:Cr<sp/>8:8:8:8<sp/>little<sp/>endian</highlight></codeline>
<codeline lineno="1988"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a:b:<sp/>g:<sp/>r<sp/>in<sp/>SHADER_VARIANT_XYUV</highlight></codeline>
<codeline lineno="1989"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a2412b19e107b69d78e88f86c1c7e638f" kindref="member">SHADER_VARIANT_XYUV</ref>;</highlight></codeline>
<codeline lineno="1991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>wl_shm_buffer_get_stride(shm_buffer)<sp/>/<sp/>4;</highlight></codeline>
<codeline lineno="1992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/>GL_RGBA;</highlight></codeline>
<codeline lineno="1993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/>GL_UNSIGNED_BYTE;</highlight></codeline>
<codeline lineno="1994"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;warning:<sp/>unknown<sp/>shm<sp/>buffer<sp/>format:<sp/>%08x\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_shm_buffer_get_format(shm_buffer));</highlight></codeline>
<codeline lineno="1999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2001"><highlight class="normal"></highlight></codeline>
<codeline lineno="2002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Only<sp/>allocate<sp/>a<sp/>texture<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>match<sp/>existing<sp/>one.</highlight></codeline>
<codeline lineno="2003"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>If<sp/>a<sp/>switch<sp/>from<sp/>DRM<sp/>allocated<sp/>buffer<sp/>to<sp/>a<sp/>SHM<sp/>buffer<sp/>is</highlight></codeline>
<codeline lineno="2004"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>happening,<sp/>we<sp/>need<sp/>to<sp/>allocate<sp/>a<sp/>new<sp/>texture<sp/>buffer.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>||</highlight></codeline>
<codeline lineno="2006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>||</highlight></codeline>
<codeline lineno="2007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>||</highlight></codeline>
<codeline lineno="2008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>||</highlight></codeline>
<codeline lineno="2009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2]<sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2]<sp/>||</highlight></codeline>
<codeline lineno="2010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>!=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>||</highlight></codeline>
<codeline lineno="2011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>!=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da1867b61ecc8948ec383bdaa04bf65f2a" kindref="member">BUFFER_TYPE_SHM</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/><ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref>;</highlight></codeline>
<codeline lineno="2013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height;</highlight></codeline>
<codeline lineno="2014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0]<sp/>=<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[0];</highlight></codeline>
<codeline lineno="2015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1]<sp/>=<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[1];</highlight></codeline>
<codeline lineno="2016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2]<sp/>=<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>[2];</highlight></codeline>
<codeline lineno="2017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref><sp/>=<sp/><ref refid="structgl__surface__state_1a3aa2679e38d4a8ab0ec4575cd2374e5a" kindref="member">gl_pixel_type</ref>;</highlight></codeline>
<codeline lineno="2018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da1867b61ecc8948ec383bdaa04bf65f2a" kindref="member">BUFFER_TYPE_SHM</ref>;</highlight></codeline>
<codeline lineno="2019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ac926ebf6ccbc0f0a66529912af45fcf5" kindref="member">needs_full_upload</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2022"><highlight class="normal"></highlight></codeline>
<codeline lineno="2023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref><sp/>=<sp/>es;</highlight></codeline>
<codeline lineno="2024"><highlight class="normal"></highlight></codeline>
<codeline lineno="2025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a715bd1ab3af0516ef379aea7cb8805b1" kindref="member">ensure_textures</ref>(gs,<sp/>GL_TEXTURE_2D,<sp/>num_planes);</highlight></codeline>
<codeline lineno="2026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2027"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2028"><highlight class="normal"></highlight></codeline>
<codeline lineno="2029"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2030"><highlight class="normal"><ref refid="gl-renderer_8c_1a4eecccd4496854b60c88c9c728687f95" kindref="member">gl_renderer_attach_egl</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*es,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref>,</highlight></codeline>
<codeline lineno="2031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>format)</highlight></codeline>
<codeline lineno="2032"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>es-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>;</highlight></codeline>
<codeline lineno="2034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="2035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(es);</highlight></codeline>
<codeline lineno="2036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>attribs[3];</highlight></codeline>
<codeline lineno="2037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>target;</highlight></codeline>
<codeline lineno="2038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/>num_planes;</highlight></codeline>
<codeline lineno="2039"><highlight class="normal"></highlight></codeline>
<codeline lineno="2040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;legacy_buffer<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_buffer<sp/>*)<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;resource;</highlight></codeline>
<codeline lineno="2041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a67447b3d33820530bee82162cce9bf3a" kindref="member">query_buffer</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;legacy_buffer,</highlight></codeline>
<codeline lineno="2042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_WIDTH,<sp/>&amp;<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;width);</highlight></codeline>
<codeline lineno="2043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a67447b3d33820530bee82162cce9bf3a" kindref="member">query_buffer</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;legacy_buffer,</highlight></codeline>
<codeline lineno="2044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_HEIGHT,<sp/>&amp;<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height);</highlight></codeline>
<codeline lineno="2045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a67447b3d33820530bee82162cce9bf3a" kindref="member">query_buffer</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;legacy_buffer,</highlight></codeline>
<codeline lineno="2046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_WAYLAND_Y_INVERTED_WL,<sp/>&amp;<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;y_inverted);</highlight></codeline>
<codeline lineno="2047"><highlight class="normal"></highlight></codeline>
<codeline lineno="2048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="2049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="2050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(format)<sp/>{</highlight></codeline>
<codeline lineno="2055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_RGB:</highlight></codeline>
<codeline lineno="2056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>fallthrough<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_RGBA:</highlight></codeline>
<codeline lineno="2059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>;</highlight></codeline>
<codeline lineno="2062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_EXTERNAL_WL:</highlight></codeline>
<codeline lineno="2064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a57b140e6a8d21656322a9e9f59b4e2ac" kindref="member">SHADER_VARIANT_EXTERNAL</ref>;</highlight></codeline>
<codeline lineno="2066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_Y_UV_WL:</highlight></codeline>
<codeline lineno="2068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="2069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a3ec6f6f348a5d4855ee7c063ee600db0" kindref="member">SHADER_VARIANT_Y_UV</ref>;</highlight></codeline>
<codeline lineno="2070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_Y_U_V_WL:</highlight></codeline>
<codeline lineno="2073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="2074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a97c6403e37049f3c90e0304dcf5abd41" kindref="member">SHADER_VARIANT_Y_U_V</ref>;</highlight></codeline>
<codeline lineno="2075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EGL_TEXTURE_Y_XUXV_WL:</highlight></codeline>
<codeline lineno="2078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_planes<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="2079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022ac460db92398d08c0279a987f7c666580" kindref="member">SHADER_VARIANT_Y_XUXV</ref>;</highlight></codeline>
<codeline lineno="2080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2083"><highlight class="normal"></highlight></codeline>
<codeline lineno="2084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target<sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a07429b2605cae48fff923b01540a9bb4" kindref="member">gl_shader_texture_variant_get_target</ref>(gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref>);</highlight></codeline>
<codeline lineno="2085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a715bd1ab3af0516ef379aea7cb8805b1" kindref="member">ensure_textures</ref>(gs,<sp/>target,<sp/>num_planes);</highlight></codeline>
<codeline lineno="2086"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_planes;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="2087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[0]<sp/>=<sp/>EGL_WAYLAND_PLANE_WL;</highlight></codeline>
<codeline lineno="2088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[1]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="2089"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[2]<sp/>=<sp/>EGL_NONE;</highlight></codeline>
<codeline lineno="2090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]<sp/>=<sp/><ref refid="gl-renderer_8c_1a49160dcc2d7db45ce16ab4f31f1c2270" kindref="member">egl_image_create</ref>(gr,</highlight></codeline>
<codeline lineno="2091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_WAYLAND_BUFFER_WL,</highlight></codeline>
<codeline lineno="2092"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;legacy_buffer,</highlight></codeline>
<codeline lineno="2093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs);</highlight></codeline>
<codeline lineno="2094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i])<sp/>{</highlight></codeline>
<codeline lineno="2095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>create<sp/>img<sp/>for<sp/>plane<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>i);</highlight></codeline>
<codeline lineno="2096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>++;</highlight></codeline>
<codeline lineno="2099"><highlight class="normal"></highlight></codeline>
<codeline lineno="2100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0<sp/>+<sp/>i);</highlight></codeline>
<codeline lineno="2101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[i]);</highlight></codeline>
<codeline lineno="2102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1f32740854364dc4e30784c73689e8ec" kindref="member">image_target_texture_2d</ref>(target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]-&gt;<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>);</highlight></codeline>
<codeline lineno="2103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2104"><highlight class="normal"></highlight></codeline>
<codeline lineno="2105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;width;</highlight></codeline>
<codeline lineno="2106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height;</highlight></codeline>
<codeline lineno="2107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da28519cfd07d43aced9d5c5ef11c40951" kindref="member">BUFFER_TYPE_EGL</ref>;</highlight></codeline>
<codeline lineno="2108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;y_inverted;</highlight></codeline>
<codeline lineno="2109"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2110"><highlight class="normal"></highlight></codeline>
<codeline lineno="2111"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2112"><highlight class="normal"><ref refid="gl-renderer_8c_1a753ea58196ae2dafc3e366882e82b5dd" kindref="member">gl_renderer_destroy_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*dmabuf)</highlight></codeline>
<codeline lineno="2113"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image<sp/>=<sp/><ref refid="linux-dmabuf_8c_1ac7fe0165b8d6bc4a87d57a777e9ec203" kindref="member">linux_dmabuf_buffer_get_user_data</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>);</highlight></codeline>
<codeline lineno="2115"><highlight class="normal"></highlight></codeline>
<codeline lineno="2116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a9aa2823f0af7287f156ba09272a7fecc" kindref="member">dmabuf_image_destroy</ref>(image);</highlight></codeline>
<codeline lineno="2117"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2118"><highlight class="normal"></highlight></codeline>
<codeline lineno="2119"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*</highlight></codeline>
<codeline lineno="2120"><highlight class="normal"><ref refid="gl-renderer_8c_1ab7539048adffcfbb62ea653abe5e483e" kindref="member">import_simple_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref><sp/>*attributes)</highlight></codeline>
<codeline lineno="2122"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="2124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>attribs[50];</highlight></codeline>
<codeline lineno="2125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>atti<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>has_modifier;</highlight></codeline>
<codeline lineno="2127"><highlight class="normal"></highlight></codeline>
<codeline lineno="2128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>requires<sp/>the<sp/>Mesa<sp/>commit<sp/>in</highlight></codeline>
<codeline lineno="2129"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Mesa<sp/>10.3<sp/>(08264e5dad4df448e7718e782ad9077902089a07)<sp/>or</highlight></codeline>
<codeline lineno="2130"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Mesa<sp/>10.2.7<sp/>(55d28925e6109a4afd61f109e845a8a51bd17652).</highlight></codeline>
<codeline lineno="2131"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Otherwise<sp/>Mesa<sp/>closes<sp/>the<sp/>fd<sp/>behind<sp/>our<sp/>back<sp/>and<sp/>re-importing</highlight></codeline>
<codeline lineno="2132"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>will<sp/>fail.</highlight></codeline>
<codeline lineno="2133"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>https://bugs.freedesktop.org/show_bug.cgi?id=76188</highlight></codeline>
<codeline lineno="2134"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2135"><highlight class="normal"></highlight></codeline>
<codeline lineno="2136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_WIDTH;</highlight></codeline>
<codeline lineno="2137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1aca9083138f9bf5e7c359f57f8daec03c" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="2138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_HEIGHT;</highlight></codeline>
<codeline lineno="2139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4aea605be2fe267863b1849f1e63f44d" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="2140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_LINUX_DRM_FOURCC_EXT;</highlight></codeline>
<codeline lineno="2141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="2142"><highlight class="normal"></highlight></codeline>
<codeline lineno="2143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[0]<sp/>!=<sp/>DRM_FORMAT_MOD_INVALID)<sp/>{</highlight></codeline>
<codeline lineno="2144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1afa9e6c77669201d4f20cb4c198f46dcf" kindref="member">has_dmabuf_import_modifiers</ref>)</highlight></codeline>
<codeline lineno="2145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>has_modifier<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>has_modifier<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2150"><highlight class="normal"></highlight></codeline>
<codeline lineno="2151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE0_FD_EXT;</highlight></codeline>
<codeline lineno="2153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab8e678e82a6b79f7e7ac970201251198" kindref="member">fd</ref>[0];</highlight></codeline>
<codeline lineno="2154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE0_OFFSET_EXT;</highlight></codeline>
<codeline lineno="2155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4e2f1d01ed4094ed5bb23628326bed72" kindref="member">offset</ref>[0];</highlight></codeline>
<codeline lineno="2156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE0_PITCH_EXT;</highlight></codeline>
<codeline lineno="2157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a5ba22d828fbb58ee02f205c72a939f98" kindref="member">stride</ref>[0];</highlight></codeline>
<codeline lineno="2158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(has_modifier)<sp/>{</highlight></codeline>
<codeline lineno="2159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE0_MODIFIER_LO_EXT;</highlight></codeline>
<codeline lineno="2160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[0]<sp/>&amp;<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="2161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE0_MODIFIER_HI_EXT;</highlight></codeline>
<codeline lineno="2162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[0]<sp/>&gt;&gt;<sp/>32;</highlight></codeline>
<codeline lineno="2163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2165"><highlight class="normal"></highlight></codeline>
<codeline lineno="2166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="2167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE1_FD_EXT;</highlight></codeline>
<codeline lineno="2168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab8e678e82a6b79f7e7ac970201251198" kindref="member">fd</ref>[1];</highlight></codeline>
<codeline lineno="2169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE1_OFFSET_EXT;</highlight></codeline>
<codeline lineno="2170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4e2f1d01ed4094ed5bb23628326bed72" kindref="member">offset</ref>[1];</highlight></codeline>
<codeline lineno="2171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE1_PITCH_EXT;</highlight></codeline>
<codeline lineno="2172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a5ba22d828fbb58ee02f205c72a939f98" kindref="member">stride</ref>[1];</highlight></codeline>
<codeline lineno="2173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(has_modifier)<sp/>{</highlight></codeline>
<codeline lineno="2174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE1_MODIFIER_LO_EXT;</highlight></codeline>
<codeline lineno="2175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[1]<sp/>&amp;<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="2176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE1_MODIFIER_HI_EXT;</highlight></codeline>
<codeline lineno="2177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[1]<sp/>&gt;&gt;<sp/>32;</highlight></codeline>
<codeline lineno="2178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2180"><highlight class="normal"></highlight></codeline>
<codeline lineno="2181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>&gt;<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="2182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE2_FD_EXT;</highlight></codeline>
<codeline lineno="2183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab8e678e82a6b79f7e7ac970201251198" kindref="member">fd</ref>[2];</highlight></codeline>
<codeline lineno="2184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE2_OFFSET_EXT;</highlight></codeline>
<codeline lineno="2185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4e2f1d01ed4094ed5bb23628326bed72" kindref="member">offset</ref>[2];</highlight></codeline>
<codeline lineno="2186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE2_PITCH_EXT;</highlight></codeline>
<codeline lineno="2187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a5ba22d828fbb58ee02f205c72a939f98" kindref="member">stride</ref>[2];</highlight></codeline>
<codeline lineno="2188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(has_modifier)<sp/>{</highlight></codeline>
<codeline lineno="2189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE2_MODIFIER_LO_EXT;</highlight></codeline>
<codeline lineno="2190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[2]<sp/>&amp;<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="2191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE2_MODIFIER_HI_EXT;</highlight></codeline>
<codeline lineno="2192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[2]<sp/>&gt;&gt;<sp/>32;</highlight></codeline>
<codeline lineno="2193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2195"><highlight class="normal"></highlight></codeline>
<codeline lineno="2196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1afa9e6c77669201d4f20cb4c198f46dcf" kindref="member">has_dmabuf_import_modifiers</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>&gt;<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="2198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE3_FD_EXT;</highlight></codeline>
<codeline lineno="2199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab8e678e82a6b79f7e7ac970201251198" kindref="member">fd</ref>[3];</highlight></codeline>
<codeline lineno="2200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE3_OFFSET_EXT;</highlight></codeline>
<codeline lineno="2201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4e2f1d01ed4094ed5bb23628326bed72" kindref="member">offset</ref>[3];</highlight></codeline>
<codeline lineno="2202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE3_PITCH_EXT;</highlight></codeline>
<codeline lineno="2203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a5ba22d828fbb58ee02f205c72a939f98" kindref="member">stride</ref>[3];</highlight></codeline>
<codeline lineno="2204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE3_MODIFIER_LO_EXT;</highlight></codeline>
<codeline lineno="2205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[3]<sp/>&amp;<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="2206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_DMA_BUF_PLANE3_MODIFIER_HI_EXT;</highlight></codeline>
<codeline lineno="2207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[3]<sp/>&gt;&gt;<sp/>32;</highlight></codeline>
<codeline lineno="2208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2210"><highlight class="normal"></highlight></codeline>
<codeline lineno="2211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs[atti++]<sp/>=<sp/>EGL_NONE;</highlight></codeline>
<codeline lineno="2212"><highlight class="normal"></highlight></codeline>
<codeline lineno="2213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a49160dcc2d7db45ce16ab4f31f1c2270" kindref="member">egl_image_create</ref>(gr,<sp/>EGL_LINUX_DMA_BUF_EXT,<sp/>NULL,</highlight></codeline>
<codeline lineno="2214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attribs);</highlight></codeline>
<codeline lineno="2215"><highlight class="normal"></highlight></codeline>
<codeline lineno="2216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="2217"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2218"><highlight class="normal"></highlight></codeline>
<codeline lineno="2219"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structyuv__format__descriptor" kindref="compound">yuv_format_descriptor</ref><sp/><ref refid="gl-renderer_8c_1a6b11eccba8429bd3104100e4a866f9b6" kindref="member">yuv_formats</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="2220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="2221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structyuv__format__descriptor_1a4a68ea10395297d5d528b30e7c833960" kindref="member">format</ref><sp/>=<sp/>DRM_FORMAT_YUYV,</highlight></codeline>
<codeline lineno="2222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_planes<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_planes<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.texture_type<sp/>=<sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa6fdaa33bbdb28cc2a6ca5697e7f16c06" kindref="member">TEXTURE_Y_XUXV_WL</ref>,</highlight></codeline>
<codeline lineno="2225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight></codeline>
<codeline lineno="2226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_GR88,</highlight></codeline>
<codeline lineno="2229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_ARGB8888,</highlight></codeline>
<codeline lineno="2234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}}</highlight></codeline>
<codeline lineno="2236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_NV12,</highlight></codeline>
<codeline lineno="2238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_planes<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_planes<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.texture_type<sp/>=<sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaad746f9a88303f3bc74d595c17e559212" kindref="member">TEXTURE_Y_UV_WL</ref>,</highlight></codeline>
<codeline lineno="2241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight></codeline>
<codeline lineno="2242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_GR88,</highlight></codeline>
<codeline lineno="2250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="2251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}}</highlight></codeline>
<codeline lineno="2252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_YUV420,</highlight></codeline>
<codeline lineno="2254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_planes<sp/>=<sp/>3,</highlight></codeline>
<codeline lineno="2255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_planes<sp/>=<sp/>3,</highlight></codeline>
<codeline lineno="2256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.texture_type<sp/>=<sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa4d3f5d0cae94cbe7d56133cb61df2e31" kindref="member">TEXTURE_Y_U_V_WL</ref>,</highlight></codeline>
<codeline lineno="2257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight></codeline>
<codeline lineno="2258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="2267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="2270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="2272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}}</highlight></codeline>
<codeline lineno="2273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_YUV444,</highlight></codeline>
<codeline lineno="2275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_planes<sp/>=<sp/>3,</highlight></codeline>
<codeline lineno="2276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_planes<sp/>=<sp/>3,</highlight></codeline>
<codeline lineno="2277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.texture_type<sp/>=<sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa4d3f5d0cae94cbe7d56133cb61df2e31" kindref="member">TEXTURE_Y_U_V_WL</ref>,</highlight></codeline>
<codeline lineno="2278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight></codeline>
<codeline lineno="2279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="2288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_R8,</highlight></codeline>
<codeline lineno="2292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="2293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}}</highlight></codeline>
<codeline lineno="2294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/>{</highlight></codeline>
<codeline lineno="2295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_XYUV8888,</highlight></codeline>
<codeline lineno="2296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_planes<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_planes<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.texture_type<sp/>=<sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa5fb0ce2c6db847f7ae0798829d475c9d" kindref="member">TEXTURE_XYUV_WL</ref>,</highlight></codeline>
<codeline lineno="2299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight></codeline>
<codeline lineno="2300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.width_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.height_divisor<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="2302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format<sp/>=<sp/>DRM_FORMAT_XBGR8888,</highlight></codeline>
<codeline lineno="2303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.plane_index<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="2304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}}</highlight></codeline>
<codeline lineno="2305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2306"><highlight class="normal">};</highlight></codeline>
<codeline lineno="2307"><highlight class="normal"></highlight></codeline>
<codeline lineno="2308"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*</highlight></codeline>
<codeline lineno="2309"><highlight class="normal"><ref refid="gl-renderer_8c_1a125e434438aeff91612e0acc0cfaa83b" kindref="member">import_dmabuf_single_plane</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref><sp/>*attributes,</highlight></codeline>
<codeline lineno="2311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structyuv__plane__descriptor" kindref="compound">yuv_plane_descriptor</ref><sp/>*descriptor)</highlight></codeline>
<codeline lineno="2312"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref><sp/>plane;</highlight></codeline>
<codeline lineno="2314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="2315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fmt[4];</highlight></codeline>
<codeline lineno="2316"><highlight class="normal"></highlight></codeline>
<codeline lineno="2317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.width<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1aca9083138f9bf5e7c359f57f8daec03c" kindref="member">width</ref><sp/>/<sp/>descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ab5483e4d6bb1fc67db5bd3a6b116afae" kindref="member">width_divisor</ref>;</highlight></codeline>
<codeline lineno="2318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.height<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4aea605be2fe267863b1849f1e63f44d" kindref="member">height</ref><sp/>/<sp/>descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad69b451c8a65d94b30eda8d1b448156a" kindref="member">height_divisor</ref>;</highlight></codeline>
<codeline lineno="2319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.format<sp/>=<sp/>descriptor-&gt;<ref refid="structyuv__plane__descriptor_1af068ff993eceb8fdb1635db407f4f593" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="2320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.n_planes<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.fd[0]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab8e678e82a6b79f7e7ac970201251198" kindref="member">fd</ref>[descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>];</highlight></codeline>
<codeline lineno="2322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.offset[0]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a4e2f1d01ed4094ed5bb23628326bed72" kindref="member">offset</ref>[descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>];</highlight></codeline>
<codeline lineno="2323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.stride[0]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a5ba22d828fbb58ee02f205c72a939f98" kindref="member">stride</ref>[descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>];</highlight></codeline>
<codeline lineno="2324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane.modifier[0]<sp/>=<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>];</highlight></codeline>
<codeline lineno="2325"><highlight class="normal"></highlight></codeline>
<codeline lineno="2326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ab7539048adffcfbb62ea653abe5e483e" kindref="member">import_simple_dmabuf</ref>(gr,<sp/>&amp;plane);</highlight></codeline>
<codeline lineno="2327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>import<sp/>plane<sp/>%d<sp/>as<sp/>%.4s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>descriptor-&gt;<ref refid="structyuv__plane__descriptor_1ad352dd4da046f004a0fa36b522e2b5e1" kindref="member">plane_index</ref>,</highlight></codeline>
<codeline lineno="2330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae8ae9d1cc84c7a5e1b28e5affbe64cbc" kindref="member">dump_format</ref>(descriptor-&gt;<ref refid="structyuv__plane__descriptor_1af068ff993eceb8fdb1635db407f4f593" kindref="member">format</ref>,<sp/>fmt));</highlight></codeline>
<codeline lineno="2331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2333"><highlight class="normal"></highlight></codeline>
<codeline lineno="2334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>;</highlight></codeline>
<codeline lineno="2335"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2336"><highlight class="normal"></highlight></codeline>
<codeline lineno="2337"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2338"><highlight class="normal"><ref refid="gl-renderer_8c_1a0278911981019055a8b9d5391769f986" kindref="member">import_yuv_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>)</highlight></codeline>
<codeline lineno="2340"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="2342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="2343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="2344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structyuv__format__descriptor" kindref="compound">yuv_format_descriptor</ref><sp/>*<ref refid="structyuv__format__descriptor_1a4a68ea10395297d5d528b30e7c833960" kindref="member">format</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref><sp/>*attributes<sp/>=<sp/>&amp;image-&gt;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>;</highlight></codeline>
<codeline lineno="2346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fmt[4];</highlight></codeline>
<codeline lineno="2347"><highlight class="normal"></highlight></codeline>
<codeline lineno="2348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>ARRAY_LENGTH(<ref refid="gl-renderer_8c_1a6b11eccba8429bd3104100e4a866f9b6" kindref="member">yuv_formats</ref>);<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="2349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a6b11eccba8429bd3104100e4a866f9b6" kindref="member">yuv_formats</ref>[i].<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref><sp/>==<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref><sp/>=<sp/>&amp;<ref refid="gl-renderer_8c_1a6b11eccba8429bd3104100e4a866f9b6" kindref="member">yuv_formats</ref>[i];</highlight></codeline>
<codeline lineno="2351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2354"><highlight class="normal"></highlight></codeline>
<codeline lineno="2355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>during<sp/>import,<sp/>and<sp/>no<sp/>known<sp/>conversion<sp/>for<sp/>format<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;%.4s<sp/>in<sp/>the<sp/>renderer\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae8ae9d1cc84c7a5e1b28e5affbe64cbc" kindref="member">dump_format</ref>(attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>,<sp/>fmt));</highlight></codeline>
<codeline lineno="2359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2361"><highlight class="normal"></highlight></codeline>
<codeline lineno="2362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>!=<sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;input_planes)<sp/>{</highlight></codeline>
<codeline lineno="2363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;%.4s<sp/>dmabuf<sp/>must<sp/>contain<sp/>%d<sp/>plane%s<sp/>(%d<sp/>provided)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae8ae9d1cc84c7a5e1b28e5affbe64cbc" kindref="member">dump_format</ref>(<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;format,<sp/>fmt),</highlight></codeline>
<codeline lineno="2365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;input_planes,</highlight></codeline>
<codeline lineno="2366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;input_planes<sp/>&gt;<sp/>1)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;s&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref>);</highlight></codeline>
<codeline lineno="2368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2370"><highlight class="normal"></highlight></codeline>
<codeline lineno="2371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;output_planes;<sp/>++j)<sp/>{</highlight></codeline>
<codeline lineno="2372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[j]<sp/>=<sp/><ref refid="gl-renderer_8c_1a125e434438aeff91612e0acc0cfaa83b" kindref="member">import_dmabuf_single_plane</ref>(gr,<sp/>attributes,</highlight></codeline>
<codeline lineno="2373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;plane[j]);</highlight></codeline>
<codeline lineno="2374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[j])<sp/>{</highlight></codeline>
<codeline lineno="2375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(j)<sp/>{</highlight></codeline>
<codeline lineno="2376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[--j]);</highlight></codeline>
<codeline lineno="2377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(ret<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="2378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2382"><highlight class="normal"></highlight></codeline>
<codeline lineno="2383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref><sp/>=<sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;output_planes;</highlight></codeline>
<codeline lineno="2384"><highlight class="normal"></highlight></codeline>
<codeline lineno="2385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>-&gt;texture_type)<sp/>{</highlight></codeline>
<codeline lineno="2386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa6fdaa33bbdb28cc2a6ca5697e7f16c06" kindref="member">TEXTURE_Y_XUXV_WL</ref>:</highlight></codeline>
<codeline lineno="2387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022ac460db92398d08c0279a987f7c666580" kindref="member">SHADER_VARIANT_Y_XUXV</ref>;</highlight></codeline>
<codeline lineno="2388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaad746f9a88303f3bc74d595c17e559212" kindref="member">TEXTURE_Y_UV_WL</ref>:</highlight></codeline>
<codeline lineno="2390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a3ec6f6f348a5d4855ee7c063ee600db0" kindref="member">SHADER_VARIANT_Y_UV</ref>;</highlight></codeline>
<codeline lineno="2391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa4d3f5d0cae94cbe7d56133cb61df2e31" kindref="member">TEXTURE_Y_U_V_WL</ref>:</highlight></codeline>
<codeline lineno="2393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a97c6403e37049f3c90e0304dcf5abd41" kindref="member">SHADER_VARIANT_Y_U_V</ref>;</highlight></codeline>
<codeline lineno="2394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1af61174fce42866489121623510a6dbaaa5fb0ce2c6db847f7ae0798829d475c9d" kindref="member">TEXTURE_XYUV_WL</ref>:</highlight></codeline>
<codeline lineno="2396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a2412b19e107b69d78e88f86c1c7e638f" kindref="member">SHADER_VARIANT_XYUV</ref>;</highlight></codeline>
<codeline lineno="2397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(</highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2401"><highlight class="normal"></highlight></codeline>
<codeline lineno="2402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2403"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2404"><highlight class="normal"></highlight></codeline>
<codeline lineno="2405"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2406"><highlight class="normal"><ref refid="gl-renderer_8c_1aa182dc1bbfb01f0bb59772cf08fc4361" kindref="member">gl_renderer_query_dmabuf_modifiers_full</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>,</highlight></codeline>
<codeline lineno="2407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>**modifiers,</highlight></codeline>
<codeline lineno="2408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>**external_only,</highlight></codeline>
<codeline lineno="2409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*num_modifiers);</highlight></codeline>
<codeline lineno="2410"><highlight class="normal"></highlight></codeline>
<codeline lineno="2411"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>*</highlight></codeline>
<codeline lineno="2412"><highlight class="normal"><ref refid="gl-renderer_8c_1a14dfa27665eaaab78aadccb2febbbfc1" kindref="member">dmabuf_format_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,<sp/>uint32_t<sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="2413"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>*<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>;</highlight></codeline>
<codeline lineno="2415"><highlight class="normal"></highlight></codeline>
<codeline lineno="2416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>=<sp/>calloc(1,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>));</highlight></codeline>
<codeline lineno="2417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>)</highlight></codeline>
<codeline lineno="2418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2419"><highlight class="normal"></highlight></codeline>
<codeline lineno="2420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref><sp/>=<sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="2421"><highlight class="normal"></highlight></codeline>
<codeline lineno="2422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1aa182dc1bbfb01f0bb59772cf08fc4361" kindref="member">gl_renderer_query_dmabuf_modifiers_full</ref>(gr,<sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>,</highlight></codeline>
<codeline lineno="2423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1ae6f4aa342e960f7bd1617208318a349b" kindref="member">modifiers</ref>,</highlight></codeline>
<codeline lineno="2424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1a9324580bebc2667dc12aa9b9fc61ee73" kindref="member">external_only</ref>,</highlight></codeline>
<codeline lineno="2425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1ab8913459d2300031bff051718e386f2c" kindref="member">num_modifiers</ref>);</highlight></codeline>
<codeline lineno="2426"><highlight class="normal"></highlight></codeline>
<codeline lineno="2427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1ab8913459d2300031bff051718e386f2c" kindref="member">num_modifiers</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>);</highlight></codeline>
<codeline lineno="2429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2431"><highlight class="normal"></highlight></codeline>
<codeline lineno="2432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_insert(&amp;gr-&gt;<ref refid="structgl__renderer_1a8a61c9d9da383117bd578c325b81db91" kindref="member">dmabuf_formats</ref>,<sp/>&amp;<ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>-&gt;<ref refid="structdmabuf__format_1a64b4aea734a37f158aa49116dec40c51" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="2433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref>;</highlight></codeline>
<codeline lineno="2434"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2435"><highlight class="normal"></highlight></codeline>
<codeline lineno="2436"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2437"><highlight class="normal"><ref refid="gl-renderer_8c_1a53e62eb0e0d93a1c8d8aa355f4f729de" kindref="member">dmabuf_format_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>*<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="2438"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;modifiers);</highlight></codeline>
<codeline lineno="2440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;external_only);</highlight></codeline>
<codeline lineno="2441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;link);</highlight></codeline>
<codeline lineno="2442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>);</highlight></codeline>
<codeline lineno="2443"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2444"><highlight class="normal"></highlight></codeline>
<codeline lineno="2445"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>GLenum</highlight></codeline>
<codeline lineno="2446"><highlight class="normal"><ref refid="gl-renderer_8c_1a37e95929fded66426751fc9790dbfe14" kindref="member">choose_texture_target</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__attributes" kindref="compound">dmabuf_attributes</ref><sp/>*attributes)</highlight></codeline>
<codeline lineno="2448"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>*tmp,<sp/>*<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2450"><highlight class="normal"></highlight></codeline>
<codeline lineno="2451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(tmp,<sp/>&amp;gr-&gt;<ref refid="structgl__renderer_1a8a61c9d9da383117bd578c325b81db91" kindref="member">dmabuf_formats</ref>,<sp/><ref refid="structdmabuf__format_1a64b4aea734a37f158aa49116dec40c51" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tmp-&gt;<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref><sp/>==<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref><sp/>=<sp/>tmp;</highlight></codeline>
<codeline lineno="2454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2457"><highlight class="normal"></highlight></codeline>
<codeline lineno="2458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="2459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a14dfa27665eaaab78aadccb2febbbfc1" kindref="member">dmabuf_format_create</ref>(gr,<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref>);</highlight></codeline>
<codeline lineno="2460"><highlight class="normal"></highlight></codeline>
<codeline lineno="2461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="2463"><highlight class="normal"></highlight></codeline>
<codeline lineno="2464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;num_modifiers;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="2465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;modifiers[i]<sp/>==<sp/>attributes-&gt;<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[0])<sp/>{</highlight></codeline>
<codeline lineno="2466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>-&gt;external_only[i])</highlight></codeline>
<codeline lineno="2467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_TEXTURE_EXTERNAL_OES;</highlight></codeline>
<codeline lineno="2468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_TEXTURE_2D;</highlight></codeline>
<codeline lineno="2470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2473"><highlight class="normal"></highlight></codeline>
<codeline lineno="2474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref><sp/>&gt;<sp/>1)</highlight></codeline>
<codeline lineno="2475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_TEXTURE_EXTERNAL_OES;</highlight></codeline>
<codeline lineno="2476"><highlight class="normal"></highlight></codeline>
<codeline lineno="2477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(attributes-&gt;<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref><sp/>&amp;<sp/>~DRM_FORMAT_BIG_ENDIAN)<sp/>{</highlight></codeline>
<codeline lineno="2478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_YUYV:</highlight></codeline>
<codeline lineno="2479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_YVYU:</highlight></codeline>
<codeline lineno="2480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_UYVY:</highlight></codeline>
<codeline lineno="2481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_VYUY:</highlight></codeline>
<codeline lineno="2482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_AYUV:</highlight></codeline>
<codeline lineno="2483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DRM_FORMAT_XYUV8888:</highlight></codeline>
<codeline lineno="2484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_TEXTURE_EXTERNAL_OES;</highlight></codeline>
<codeline lineno="2485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GL_TEXTURE_2D;</highlight></codeline>
<codeline lineno="2487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2488"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2489"><highlight class="normal"></highlight></codeline>
<codeline lineno="2490"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*</highlight></codeline>
<codeline lineno="2491"><highlight class="normal"><ref refid="gl-renderer_8c_1a973b2f541e84147d29d820e7c2458d82" kindref="member">import_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>)</highlight></codeline>
<codeline lineno="2493"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>*<ref refid="structegl__image" kindref="compound">egl_image</ref>;</highlight></codeline>
<codeline lineno="2495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image;</highlight></codeline>
<codeline lineno="2496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>target;</highlight></codeline>
<codeline lineno="2497"><highlight class="normal"></highlight></codeline>
<codeline lineno="2498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image<sp/>=<sp/><ref refid="gl-renderer_8c_1a02947a9d03f0d2153b470d061a218f1d" kindref="member">dmabuf_image_create</ref>();</highlight></codeline>
<codeline lineno="2499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref><sp/>=<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>;</highlight></codeline>
<codeline lineno="2500"><highlight class="normal"></highlight></codeline>
<codeline lineno="2501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structegl__image" kindref="compound">egl_image</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ab7539048adffcfbb62ea653abe5e483e" kindref="member">import_simple_dmabuf</ref>(gr,<sp/>&amp;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>);</highlight></codeline>
<codeline lineno="2502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structegl__image" kindref="compound">egl_image</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[0]<sp/>=<sp/><ref refid="structegl__image" kindref="compound">egl_image</ref>;</highlight></codeline>
<codeline lineno="2505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1aa1241e414ee6e3a0a98929816c62f8a4" kindref="member">import_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a778c1b8329477c7763ed59fb4ee0d141" kindref="member">IMPORT_TYPE_DIRECT</ref>;</highlight></codeline>
<codeline lineno="2506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target<sp/>=<sp/><ref refid="gl-renderer_8c_1a37e95929fded66426751fc9790dbfe14" kindref="member">choose_texture_target</ref>(gr,<sp/>&amp;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>);</highlight></codeline>
<codeline lineno="2507"><highlight class="normal"></highlight></codeline>
<codeline lineno="2508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(target)<sp/>{</highlight></codeline>
<codeline lineno="2509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>GL_TEXTURE_2D:</highlight></codeline>
<codeline lineno="2510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a988b1b5cedb4a8a9ee7c73556db512f0" kindref="member">SHADER_VARIANT_RGBA</ref>;</highlight></codeline>
<codeline lineno="2511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a57b140e6a8d21656322a9e9f59b4e2ac" kindref="member">SHADER_VARIANT_EXTERNAL</ref>;</highlight></codeline>
<codeline lineno="2514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer_8c_1a0278911981019055a8b9d5391769f986" kindref="member">import_yuv_dmabuf</ref>(gr,<sp/>image))<sp/>{</highlight></codeline>
<codeline lineno="2517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a9aa2823f0af7287f156ba09272a7fecc" kindref="member">dmabuf_image_destroy</ref>(image);</highlight></codeline>
<codeline lineno="2518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1aa1241e414ee6e3a0a98929816c62f8a4" kindref="member">import_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a20c9329ebc72fc79241fd90c952643d4" kindref="member">IMPORT_TYPE_GL_CONVERSION</ref>;</highlight></codeline>
<codeline lineno="2521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2522"><highlight class="normal"></highlight></codeline>
<codeline lineno="2523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>image;</highlight></codeline>
<codeline lineno="2524"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2525"><highlight class="normal"></highlight></codeline>
<codeline lineno="2526"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2527"><highlight class="normal"><ref refid="gl-renderer_8c_1a97ae83f934c4ca1f9ed56bc303da1fd2" kindref="member">gl_renderer_query_dmabuf_formats</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*wc,</highlight></codeline>
<codeline lineno="2528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>**formats,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*num_formats)</highlight></codeline>
<codeline lineno="2529"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(wc);</highlight></codeline>
<codeline lineno="2531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fallback_formats[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="2532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_ARGB8888,</highlight></codeline>
<codeline lineno="2533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_XRGB8888,</highlight></codeline>
<codeline lineno="2534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_YUYV,</highlight></codeline>
<codeline lineno="2535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_NV12,</highlight></codeline>
<codeline lineno="2536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_YUV420,</highlight></codeline>
<codeline lineno="2537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_YUV444,</highlight></codeline>
<codeline lineno="2538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_FORMAT_XYUV8888,</highlight></codeline>
<codeline lineno="2539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="2540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fallback<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>num;</highlight></codeline>
<codeline lineno="2542"><highlight class="normal"></highlight></codeline>
<codeline lineno="2543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gr-&gt;<ref refid="structgl__renderer_1a3b0d80c232031cb4794dc6d1663dfad3" kindref="member">has_dmabuf_import</ref>);</highlight></codeline>
<codeline lineno="2544"><highlight class="normal"></highlight></codeline>
<codeline lineno="2545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1afa9e6c77669201d4f20cb4c198f46dcf" kindref="member">has_dmabuf_import_modifiers</ref><sp/>||</highlight></codeline>
<codeline lineno="2546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!gr-&gt;<ref refid="structgl__renderer_1a3ac4749c0390dcfe2446ded88cdb481b" kindref="member">query_dmabuf_formats</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>0,<sp/>NULL,<sp/>&amp;num))<sp/>{</highlight></codeline>
<codeline lineno="2547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1ab7dea4c1aeae5e868a156df8480facf6" kindref="member">has_gl_texture_rg</ref><sp/>?<sp/>ARRAY_LENGTH(fallback_formats)<sp/>:<sp/>2;</highlight></codeline>
<codeline lineno="2548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fallback<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2550"><highlight class="normal"></highlight></codeline>
<codeline lineno="2551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*formats<sp/>=<sp/>calloc(num,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="2552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*formats<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="2553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_formats<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2556"><highlight class="normal"></highlight></codeline>
<codeline lineno="2557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fallback)<sp/>{</highlight></codeline>
<codeline lineno="2558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(*formats,<sp/>fallback_formats,<sp/>num<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="2559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_formats<sp/>=<sp/>num;</highlight></codeline>
<codeline lineno="2560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2562"><highlight class="normal"></highlight></codeline>
<codeline lineno="2563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a3ac4749c0390dcfe2446ded88cdb481b" kindref="member">query_dmabuf_formats</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>num,<sp/>*formats,<sp/>&amp;num))<sp/>{</highlight></codeline>
<codeline lineno="2564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_formats<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(*formats);</highlight></codeline>
<codeline lineno="2566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2568"><highlight class="normal"></highlight></codeline>
<codeline lineno="2569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_formats<sp/>=<sp/>num;</highlight></codeline>
<codeline lineno="2570"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2571"><highlight class="normal"></highlight></codeline>
<codeline lineno="2572"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2573"><highlight class="normal"><ref refid="gl-renderer_8c_1aa182dc1bbfb01f0bb59772cf08fc4361" kindref="member">gl_renderer_query_dmabuf_modifiers_full</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>format,</highlight></codeline>
<codeline lineno="2574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>**modifiers,</highlight></codeline>
<codeline lineno="2575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>**external_only,</highlight></codeline>
<codeline lineno="2576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*num_modifiers)</highlight></codeline>
<codeline lineno="2577"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num;</highlight></codeline>
<codeline lineno="2579"><highlight class="normal"></highlight></codeline>
<codeline lineno="2580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gr-&gt;<ref refid="structgl__renderer_1a3b0d80c232031cb4794dc6d1663dfad3" kindref="member">has_dmabuf_import</ref>);</highlight></codeline>
<codeline lineno="2581"><highlight class="normal"></highlight></codeline>
<codeline lineno="2582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1afa9e6c77669201d4f20cb4c198f46dcf" kindref="member">has_dmabuf_import_modifiers</ref><sp/>||</highlight></codeline>
<codeline lineno="2583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!gr-&gt;<ref refid="structgl__renderer_1a0e7c5bacc08635380c25288a2596a360" kindref="member">query_dmabuf_modifiers</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>format,<sp/>0,<sp/>NULL,</highlight></codeline>
<codeline lineno="2584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL,<sp/>&amp;num)<sp/>||</highlight></codeline>
<codeline lineno="2585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_modifiers<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2589"><highlight class="normal"></highlight></codeline>
<codeline lineno="2590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*modifiers<sp/>=<sp/>calloc(num,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint64_t));</highlight></codeline>
<codeline lineno="2591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*modifiers<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="2592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_modifiers<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(external_only)<sp/>{</highlight></codeline>
<codeline lineno="2596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*external_only<sp/>=<sp/>calloc(num,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="2597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*external_only<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="2598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_modifiers<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(*modifiers);</highlight></codeline>
<codeline lineno="2600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a0e7c5bacc08635380c25288a2596a360" kindref="member">query_dmabuf_modifiers</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>format,</highlight></codeline>
<codeline lineno="2604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num,<sp/>*modifiers,<sp/>external_only<sp/>?</highlight></codeline>
<codeline lineno="2605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*external_only<sp/>:<sp/>NULL,<sp/>&amp;num))<sp/>{</highlight></codeline>
<codeline lineno="2606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_modifiers<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(*modifiers);</highlight></codeline>
<codeline lineno="2608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(external_only)</highlight></codeline>
<codeline lineno="2609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(*external_only);</highlight></codeline>
<codeline lineno="2610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2612"><highlight class="normal"></highlight></codeline>
<codeline lineno="2613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*num_modifiers<sp/>=<sp/>num;</highlight></codeline>
<codeline lineno="2614"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2615"><highlight class="normal"></highlight></codeline>
<codeline lineno="2616"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2617"><highlight class="normal"><ref refid="gl-renderer_8c_1a4ea2f687149f0196c66bb147c16e350f" kindref="member">gl_renderer_query_dmabuf_modifiers</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*wc,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>format,</highlight></codeline>
<codeline lineno="2618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>**modifiers,</highlight></codeline>
<codeline lineno="2619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*num_modifiers)</highlight></codeline>
<codeline lineno="2620"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(wc);</highlight></codeline>
<codeline lineno="2622"><highlight class="normal"></highlight></codeline>
<codeline lineno="2623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1aa182dc1bbfb01f0bb59772cf08fc4361" kindref="member">gl_renderer_query_dmabuf_modifiers_full</ref>(gr,<sp/>format,<sp/>modifiers,<sp/>NULL,</highlight></codeline>
<codeline lineno="2624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_modifiers);</highlight></codeline>
<codeline lineno="2625"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2626"><highlight class="normal"></highlight></codeline>
<codeline lineno="2627"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2628"><highlight class="normal"><ref refid="gl-renderer_8c_1a372d17adc0006b25c14b1b4cef44ea35" kindref="member">gl_renderer_import_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec,</highlight></codeline>
<codeline lineno="2629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*dmabuf)</highlight></codeline>
<codeline lineno="2630"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="2632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image;</highlight></codeline>
<codeline lineno="2633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="2634"><highlight class="normal"></highlight></codeline>
<codeline lineno="2635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gr-&gt;<ref refid="structgl__renderer_1a3b0d80c232031cb4794dc6d1663dfad3" kindref="member">has_dmabuf_import</ref>);</highlight></codeline>
<codeline lineno="2636"><highlight class="normal"></highlight></codeline>
<codeline lineno="2637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1ad4accfe9d382c47849a35bc3bb4affc0" kindref="member">n_planes</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="2638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>return<sp/>if<sp/>EGL<sp/>doesn&apos;t<sp/>support<sp/>import<sp/>modifiers<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[i]<sp/>!=<sp/>DRM_FORMAT_MOD_INVALID)</highlight></codeline>
<codeline lineno="2640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1afa9e6c77669201d4f20cb4c198f46dcf" kindref="member">has_dmabuf_import_modifiers</ref>)</highlight></codeline>
<codeline lineno="2641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2642"><highlight class="normal"></highlight></codeline>
<codeline lineno="2643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>return<sp/>if<sp/>modifiers<sp/>passed<sp/>are<sp/>unequal<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[i]<sp/>!=</highlight></codeline>
<codeline lineno="2645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1ab6e328e4c0816fd48290c701e9510744" kindref="member">modifier</ref>[0])</highlight></codeline>
<codeline lineno="2646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2648"><highlight class="normal"></highlight></codeline>
<codeline lineno="2649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>reject<sp/>all<sp/>flags<sp/>we<sp/>do<sp/>not<sp/>recognize<sp/>or<sp/>handle<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1adb394e9536714c5db04ea8e5b7ac0063" kindref="member">flags</ref><sp/>&amp;<sp/>~ZWP_LINUX_BUFFER_PARAMS_V1_FLAGS_Y_INVERT)</highlight></codeline>
<codeline lineno="2651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2652"><highlight class="normal"></highlight></codeline>
<codeline lineno="2653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image<sp/>=<sp/><ref refid="gl-renderer_8c_1a973b2f541e84147d29d820e7c2458d82" kindref="member">import_dmabuf</ref>(gr,<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>);</highlight></codeline>
<codeline lineno="2654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!image)</highlight></codeline>
<codeline lineno="2655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2656"><highlight class="normal"></highlight></codeline>
<codeline lineno="2657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_insert(&amp;gr-&gt;<ref refid="structgl__renderer_1ae2ab6672ea88406c24ba67d39a85c7d3" kindref="member">dmabuf_images</ref>,<sp/>&amp;image-&gt;<ref refid="structdmabuf__image_1a94589b2e4d656bf47f6857fe7a8faba7" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="2658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-dmabuf_8c_1a21027f0ac30b114a8ade4f4283f2fe52" kindref="member">linux_dmabuf_buffer_set_user_data</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>,<sp/>image,</highlight></codeline>
<codeline lineno="2659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a753ea58196ae2dafc3e366882e82b5dd" kindref="member">gl_renderer_destroy_dmabuf</ref>);</highlight></codeline>
<codeline lineno="2660"><highlight class="normal"></highlight></codeline>
<codeline lineno="2661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2662"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2663"><highlight class="normal"></highlight></codeline>
<codeline lineno="2664"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2665"><highlight class="normal"><ref refid="gl-renderer_8c_1acf0d76eeac0c74ba7cdc2f380aff6885" kindref="member">import_known_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="2666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image)</highlight></codeline>
<codeline lineno="2667"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(image-&gt;<ref refid="structdmabuf__image_1aa1241e414ee6e3a0a98929816c62f8a4" kindref="member">import_type</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a778c1b8329477c7763ed59fb4ee0d141" kindref="member">IMPORT_TYPE_DIRECT</ref>:</highlight></codeline>
<codeline lineno="2670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[0]<sp/>=<sp/><ref refid="gl-renderer_8c_1ab7539048adffcfbb62ea653abe5e483e" kindref="member">import_simple_dmabuf</ref>(gr,<sp/>&amp;image-&gt;<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>);</highlight></codeline>
<codeline lineno="2671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[0])</highlight></codeline>
<codeline lineno="2672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2675"><highlight class="normal"></highlight></codeline>
<codeline lineno="2676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a57b4a88b0eae31dbfe55efa7f111e519a20c9329ebc72fc79241fd90c952643d4" kindref="member">IMPORT_TYPE_GL_CONVERSION</ref>:</highlight></codeline>
<codeline lineno="2677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer_8c_1a0278911981019055a8b9d5391769f986" kindref="member">import_yuv_dmabuf</ref>(gr,<sp/>image))</highlight></codeline>
<codeline lineno="2678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2680"><highlight class="normal"></highlight></codeline>
<codeline lineno="2681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>import<sp/>type<sp/>for<sp/>dmabuf\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2685"><highlight class="normal"></highlight></codeline>
<codeline lineno="2686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2687"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2688"><highlight class="normal"></highlight></codeline>
<codeline lineno="2689"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2690"><highlight class="normal"><ref refid="gl-renderer_8c_1a4d050268fd3be1cc5a8343debe4303e6" kindref="member">dmabuf_is_opaque</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>)</highlight></codeline>
<codeline lineno="2691"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structpixel__format__info" kindref="compound">pixel_format_info</ref><sp/>*info;</highlight></codeline>
<codeline lineno="2693"><highlight class="normal"></highlight></codeline>
<codeline lineno="2694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info<sp/>=<sp/><ref refid="pixel-formats_8c_1a0cce9d576c08deb3593d8059f7796059" kindref="member">pixel_format_get_info</ref>(dmabuf-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1a164a1a414225914d63e4976fe70c3d9d" kindref="member">format</ref><sp/>&amp;</highlight></codeline>
<codeline lineno="2695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>~DRM_FORMAT_BIG_ENDIAN);</highlight></codeline>
<codeline lineno="2696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!info)</highlight></codeline>
<codeline lineno="2697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2698"><highlight class="normal"></highlight></codeline>
<codeline lineno="2699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="pixel-formats_8c_1a58436a5f11d63826863036333a87de59" kindref="member">pixel_format_is_opaque</ref>(info);</highlight></codeline>
<codeline lineno="2700"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2701"><highlight class="normal"></highlight></codeline>
<codeline lineno="2702"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2703"><highlight class="normal"><ref refid="gl-renderer_8c_1a8468566a577646cfe6fb16b64c0aa581" kindref="member">gl_renderer_attach_dmabuf</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>,</highlight></codeline>
<codeline lineno="2704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref>,</highlight></codeline>
<codeline lineno="2705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*dmabuf)</highlight></codeline>
<codeline lineno="2706"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="2708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="2709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image;</highlight></codeline>
<codeline lineno="2710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>target;</highlight></codeline>
<codeline lineno="2711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="2712"><highlight class="normal"></highlight></codeline>
<codeline lineno="2713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a3b0d80c232031cb4794dc6d1663dfad3" kindref="member">has_dmabuf_import</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-dmabuf_8c_1aac0dfaeedbe94a6eff566ebdc3fd8a73" kindref="member">linux_dmabuf_buffer_send_server_error</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>,</highlight></codeline>
<codeline lineno="2715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;EGL<sp/>dmabuf<sp/>import<sp/>not<sp/>supported&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2718"><highlight class="normal"></highlight></codeline>
<codeline lineno="2719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;width<sp/>=<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1aca9083138f9bf5e7c359f57f8daec03c" kindref="member">width</ref>;</highlight></codeline>
<codeline lineno="2720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height<sp/>=<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1a4aea605be2fe267863b1849f1e63f44d" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="2721"><highlight class="normal"></highlight></codeline>
<codeline lineno="2722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2723"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>GL-renderer<sp/>uses<sp/>the<sp/>OpenGL<sp/>convention<sp/>of<sp/>texture<sp/>coordinates,<sp/>where</highlight></codeline>
<codeline lineno="2724"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>the<sp/>origin<sp/>is<sp/>at<sp/>bottom-left.<sp/>Because<sp/>dmabuf<sp/>buffers<sp/>have<sp/>the<sp/>origin</highlight></codeline>
<codeline lineno="2725"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>at<sp/>top-left,<sp/>we<sp/>must<sp/>invert<sp/>the<sp/>Y_INVERT<sp/>flag<sp/>to<sp/>get<sp/>the<sp/>image<sp/>right.</highlight></codeline>
<codeline lineno="2726"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;y_inverted<sp/>=</highlight></codeline>
<codeline lineno="2728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1a4e22fa2d24152b8a952e2814fe58c76c" kindref="member">attributes</ref>.<ref refid="structdmabuf__attributes_1adb394e9536714c5db04ea8e5b7ac0063" kindref="member">flags</ref><sp/>&amp;<sp/>ZWP_LINUX_BUFFER_PARAMS_V1_FLAGS_Y_INVERT);</highlight></codeline>
<codeline lineno="2729"><highlight class="normal"></highlight></codeline>
<codeline lineno="2730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="2731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="2732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2733"><highlight class="normal"></highlight></codeline>
<codeline lineno="2734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;width;</highlight></codeline>
<codeline lineno="2735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;height;</highlight></codeline>
<codeline lineno="2736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da28519cfd07d43aced9d5c5ef11c40951" kindref="member">BUFFER_TYPE_EGL</ref>;</highlight></codeline>
<codeline lineno="2737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;y_inverted;</highlight></codeline>
<codeline lineno="2738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref><sp/>=<sp/><ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1afa2cda0071adfc3d935ed49af7e90de2" kindref="member">direct_display</ref>;</highlight></codeline>
<codeline lineno="2739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsurface" kindref="compound">surface</ref>-&gt;is_opaque<sp/>=<sp/><ref refid="gl-renderer_8c_1a4d050268fd3be1cc5a8343debe4303e6" kindref="member">dmabuf_is_opaque</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>);</highlight></codeline>
<codeline lineno="2740"><highlight class="normal"></highlight></codeline>
<codeline lineno="2741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2742"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>We<sp/>try<sp/>to<sp/>always<sp/>hold<sp/>an<sp/>imported<sp/>EGLImage<sp/>from<sp/>the<sp/>dmabuf</highlight></codeline>
<codeline lineno="2743"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>prevent<sp/>the<sp/>client<sp/>from<sp/>preventing<sp/>re-imports.<sp/>But,<sp/>we<sp/>also</highlight></codeline>
<codeline lineno="2744"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>need<sp/>to<sp/>re-import<sp/>every<sp/>time<sp/>the<sp/>contents<sp/>may<sp/>change<sp/>because</highlight></codeline>
<codeline lineno="2745"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>GL<sp/>driver&apos;s<sp/>caching<sp/>may<sp/>need<sp/>flushing.</highlight></codeline>
<codeline lineno="2746"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="2747"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Here<sp/>we<sp/>release<sp/>the<sp/>cache<sp/>reference<sp/>which<sp/>has<sp/>to<sp/>be<sp/>final.</highlight></codeline>
<codeline lineno="2748"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>-&gt;<ref refid="structlinux__dmabuf__buffer_1afa2cda0071adfc3d935ed49af7e90de2" kindref="member">direct_display</ref>)</highlight></codeline>
<codeline lineno="2750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2751"><highlight class="normal"></highlight></codeline>
<codeline lineno="2752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image<sp/>=<sp/><ref refid="linux-dmabuf_8c_1ac7fe0165b8d6bc4a87d57a777e9ec203" kindref="member">linux_dmabuf_buffer_get_user_data</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>);</highlight></codeline>
<codeline lineno="2753"><highlight class="normal"></highlight></codeline>
<codeline lineno="2754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>dmabuf_image<sp/>should<sp/>have<sp/>been<sp/>created<sp/>during<sp/>the<sp/>import<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(image<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="2756"><highlight class="normal"></highlight></codeline>
<codeline lineno="2757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref>;<sp/>++i)</highlight></codeline>
<codeline lineno="2758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="2759"><highlight class="normal"></highlight></codeline>
<codeline lineno="2760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer_8c_1acf0d76eeac0c74ba7cdc2f380aff6885" kindref="member">import_known_dmabuf</ref>(gr,<sp/>image))<sp/>{</highlight></codeline>
<codeline lineno="2761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linux-dmabuf_8c_1aac0dfaeedbe94a6eff566ebdc3fd8a73" kindref="member">linux_dmabuf_buffer_send_server_error</ref>(<ref refid="structdmabuf__image_1a9a9e6538f1dfcedde9d0d6df4b902e7e" kindref="member">dmabuf</ref>,<sp/></highlight><highlight class="stringliteral">&quot;EGL<sp/>dmabuf<sp/>import<sp/>failed&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2764"><highlight class="normal"></highlight></codeline>
<codeline lineno="2765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref><sp/>=<sp/>image-&gt;<ref refid="structdmabuf__image_1aa38982f9c296a1990d9022eae4d7882a" kindref="member">num_images</ref>;</highlight></codeline>
<codeline lineno="2766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>++i)</highlight></codeline>
<codeline lineno="2767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]<sp/>=<sp/><ref refid="gl-renderer_8c_1ae2f06a72405c4e2e30c5567ffef5430b" kindref="member">egl_image_ref</ref>(image-&gt;<ref refid="structdmabuf__image_1acf78a1e2afbbf4ff01e509a3bf5d9951" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="2768"><highlight class="normal"></highlight></codeline>
<codeline lineno="2769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target<sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a07429b2605cae48fff923b01540a9bb4" kindref="member">gl_shader_texture_variant_get_target</ref>(image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref>);</highlight></codeline>
<codeline lineno="2770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a715bd1ab3af0516ef379aea7cb8805b1" kindref="member">ensure_textures</ref>(gs,<sp/>target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>);</highlight></codeline>
<codeline lineno="2771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="2772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0<sp/>+<sp/>i);</highlight></codeline>
<codeline lineno="2773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>[i]);</highlight></codeline>
<codeline lineno="2774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1f32740854364dc4e30784c73689e8ec" kindref="member">image_target_texture_2d</ref>(target,<sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]-&gt;<ref refid="structegl__image_1a5477e32c87bc558093115a7b939041b6" kindref="member">image</ref>);</highlight></codeline>
<codeline lineno="2775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2776"><highlight class="normal"></highlight></codeline>
<codeline lineno="2777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/>image-&gt;<ref refid="structdmabuf__image_1ae9f435558e63d5973e545f7a2a99deef" kindref="member">shader_variant</ref>;</highlight></codeline>
<codeline lineno="2778"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2779"><highlight class="normal"></highlight></codeline>
<codeline lineno="2780"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2781"><highlight class="normal"><ref refid="gl-renderer_8c_1a3eed0faf6171d0306e4f45ab1f4f809d" kindref="member">gl_renderer_attach</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*es,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__buffer" kindref="compound">weston_buffer</ref><sp/>*<ref refid="structbuffer" kindref="compound">buffer</ref>)</highlight></codeline>
<codeline lineno="2782"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>es-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>;</highlight></codeline>
<codeline lineno="2784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="2785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(es);</highlight></codeline>
<codeline lineno="2786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">wl_shm_buffer<sp/>*shm_buffer;</highlight></codeline>
<codeline lineno="2787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structlinux__dmabuf__buffer" kindref="compound">linux_dmabuf_buffer</ref><sp/>*dmabuf;</highlight></codeline>
<codeline lineno="2788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>format;</highlight></codeline>
<codeline lineno="2789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="2790"><highlight class="normal"></highlight></codeline>
<codeline lineno="2791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a46c9d30efa62b7ca5f720b1dd83ebe12" kindref="member">weston_buffer_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>);</highlight></codeline>
<codeline lineno="2792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a0abe1ac1aff541e5670f35fb2db85c7d" kindref="member">weston_buffer_release_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>,</highlight></codeline>
<codeline lineno="2793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1ad07b0407bd73441852ec1336c3b92118" kindref="member">buffer_release_ref</ref>.<ref refid="structweston__buffer__release__reference_1af56e0a7bde3736fa32cce5107e620d14" kindref="member">buffer_release</ref>);</highlight></codeline>
<codeline lineno="2794"><highlight class="normal"></highlight></codeline>
<codeline lineno="2795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structbuffer" kindref="compound">buffer</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="2797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="2798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>);</highlight></codeline>
<codeline lineno="2802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" kindref="member">BUFFER_TYPE_NULL</ref>;</highlight></codeline>
<codeline lineno="2804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2809"><highlight class="normal"></highlight></codeline>
<codeline lineno="2810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shm_buffer<sp/>=<sp/>wl_shm_buffer_get(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;resource);</highlight></codeline>
<codeline lineno="2811"><highlight class="normal"></highlight></codeline>
<codeline lineno="2812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shm_buffer)</highlight></codeline>
<codeline lineno="2813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ac15d61a7b5996056050902211f4e74c6" kindref="member">gl_renderer_attach_shm</ref>(es,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>,<sp/>shm_buffer);</highlight></codeline>
<codeline lineno="2814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1abc7c3cb9666e78b3c3de6b8d7071b514" kindref="member">has_bind_display</ref><sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="2815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a67447b3d33820530bee82162cce9bf3a" kindref="member">query_buffer</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*)<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;resource,</highlight></codeline>
<codeline lineno="2816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_TEXTURE_FORMAT,<sp/>&amp;format))</highlight></codeline>
<codeline lineno="2817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a4eecccd4496854b60c88c9c728687f95" kindref="member">gl_renderer_attach_egl</ref>(es,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>,<sp/>format);</highlight></codeline>
<codeline lineno="2818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((dmabuf<sp/>=<sp/><ref refid="linux-dmabuf_8c_1aaac1c91887b3308aa22157b10ef77a3f" kindref="member">linux_dmabuf_buffer_get</ref>(<ref refid="structbuffer" kindref="compound">buffer</ref>-&gt;resource)))</highlight></codeline>
<codeline lineno="2819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a8468566a577646cfe6fb16b64c0aa581" kindref="member">gl_renderer_attach_dmabuf</ref>(es,<sp/><ref refid="structbuffer" kindref="compound">buffer</ref>,<sp/>dmabuf);</highlight></codeline>
<codeline lineno="2820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;unhandled<sp/>buffer<sp/>type!\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1abc7c3cb9666e78b3c3de6b8d7071b514" kindref="member">has_bind_display</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;eglQueryWaylandBufferWL<sp/>failed\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="2825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a46c9d30efa62b7ca5f720b1dd83ebe12" kindref="member">weston_buffer_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="2827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a0abe1ac1aff541e5670f35fb2db85c7d" kindref="member">weston_buffer_release_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="2828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" kindref="member">BUFFER_TYPE_NULL</ref>;</highlight></codeline>
<codeline lineno="2829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>es-&gt;<ref refid="structweston__surface_1a739863882d20b0be0cca2be06592d82a" kindref="member">is_opaque</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1aed6929d897784a5d5538aca4aaf7d4cd" kindref="member">weston_buffer_send_server_error</ref>(<ref refid="structbuffer" kindref="compound">buffer</ref>,</highlight></codeline>
<codeline lineno="2832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;disconnecting<sp/>due<sp/>to<sp/>unhandled<sp/>buffer<sp/>type&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2834"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2835"><highlight class="normal"></highlight></codeline>
<codeline lineno="2836"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2837"><highlight class="normal"><ref refid="gl-renderer_8c_1ab63554e4caedb0a18300ec685a7e3f10" kindref="member">gl_renderer_surface_set_color</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>,</highlight></codeline>
<codeline lineno="2838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="alpha-blending-test_8c_1a81e020c207c4f444a5d60e57c7d55fdf" kindref="member">red</ref>,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>green,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="alpha-blending-test_8c_1a9a6f44170dd627caeb06bd6a43943349" kindref="member">blue</ref>,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>alpha)</highlight></codeline>
<codeline lineno="2839"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="2841"><highlight class="normal"></highlight></codeline>
<codeline lineno="2842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[0]<sp/>=<sp/><ref refid="alpha-blending-test_8c_1a81e020c207c4f444a5d60e57c7d55fdf" kindref="member">red</ref>;</highlight></codeline>
<codeline lineno="2843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[1]<sp/>=<sp/>green;</highlight></codeline>
<codeline lineno="2844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[2]<sp/>=<sp/><ref refid="alpha-blending-test_8c_1a9a6f44170dd627caeb06bd6a43943349" kindref="member">blue</ref>;</highlight></codeline>
<codeline lineno="2845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>[3]<sp/>=<sp/>alpha;</highlight></codeline>
<codeline lineno="2846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da482261e675f08e847f2a90fff87ef135" kindref="member">BUFFER_TYPE_SOLID</ref>;</highlight></codeline>
<codeline lineno="2847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2849"><highlight class="normal"></highlight></codeline>
<codeline lineno="2850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ab844a728d81b780a6ac412b57dc00ebb" kindref="member">shader_variant</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a3b5a30644c5306606e5fda81195a8022a08ac3754c3c2d767709be2b349315339" kindref="member">SHADER_VARIANT_SOLID</ref>;</highlight></codeline>
<codeline lineno="2851"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2852"><highlight class="normal"></highlight></codeline>
<codeline lineno="2853"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2854"><highlight class="normal"><ref refid="gl-renderer_8c_1a525424c31f88ecea126e2d4cfb0d7741" kindref="member">gl_renderer_surface_get_content_size</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>,</highlight></codeline>
<codeline lineno="2855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*width,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>)</highlight></codeline>
<codeline lineno="2856"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="2858"><highlight class="normal"></highlight></codeline>
<codeline lineno="2859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref><sp/>==<sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" kindref="member">BUFFER_TYPE_NULL</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*width<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*width<sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref>;</highlight></codeline>
<codeline lineno="2864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref><sp/>=<sp/>gs-&gt;<ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>;</highlight></codeline>
<codeline lineno="2865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2866"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2867"><highlight class="normal"></highlight></codeline>
<codeline lineno="2868"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t</highlight></codeline>
<codeline lineno="2869"><highlight class="normal"><ref refid="gl-renderer_8c_1ac60620d8dd8d405aaa853182c05cd714" kindref="member">pack_color</ref>(pixman_format_code_t<sp/>format,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*c)</highlight></codeline>
<codeline lineno="2870"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>r<sp/>=<sp/>round(c[0]<sp/>*<sp/>255.0f);</highlight></codeline>
<codeline lineno="2872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>g<sp/>=<sp/>round(c[1]<sp/>*<sp/>255.0f);</highlight></codeline>
<codeline lineno="2873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>b<sp/>=<sp/>round(c[2]<sp/>*<sp/>255.0f);</highlight></codeline>
<codeline lineno="2874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>a<sp/>=<sp/>round(c[3]<sp/>*<sp/>255.0f);</highlight></codeline>
<codeline lineno="2875"><highlight class="normal"></highlight></codeline>
<codeline lineno="2876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(format)<sp/>{</highlight></codeline>
<codeline lineno="2877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>PIXMAN_a8b8g8r8:</highlight></codeline>
<codeline lineno="2878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(a<sp/>&lt;&lt;<sp/>24)<sp/>|<sp/>(b<sp/>&lt;&lt;<sp/>16)<sp/>|<sp/>(g<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>r;</highlight></codeline>
<codeline lineno="2879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="2880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(0);</highlight></codeline>
<codeline lineno="2881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2883"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2884"><highlight class="normal"></highlight></codeline>
<codeline lineno="2885"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2886"><highlight class="normal"><ref refid="gl-renderer_8c_1a64d6965a90d20b5725f85a92c80d9227" kindref="member">gl_renderer_surface_copy_content</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>,</highlight></codeline>
<codeline lineno="2887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*target,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size,</highlight></codeline>
<codeline lineno="2888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>src_x,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>src_y,</highlight></codeline>
<codeline lineno="2889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>width,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>)</highlight></codeline>
<codeline lineno="2890"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLfloat<sp/>verts[4<sp/>*<sp/>2]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="2892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.0f,<sp/>1.0f,</highlight></codeline>
<codeline lineno="2895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/>1.0f</highlight></codeline>
<codeline lineno="2896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="2897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLfloat<sp/>projmat_normal[16]<sp/>=<sp/>{<sp/></highlight><highlight class="comment">/*<sp/>transpose<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.0f,<sp/><sp/>0.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/><sp/>2.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/><sp/>0.0f,<sp/>1.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-1.0f,<sp/>-1.0f,<sp/>0.0f,<sp/>1.0f</highlight></codeline>
<codeline lineno="2902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="2903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLfloat<sp/>projmat_yinvert[16]<sp/>=<sp/>{<sp/></highlight><highlight class="comment">/*<sp/>transpose<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.0f,<sp/><sp/>0.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/>-2.0f,<sp/>0.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0f,<sp/><sp/>0.0f,<sp/>1.0f,<sp/>0.0f,</highlight></codeline>
<codeline lineno="2907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-1.0f,<sp/><sp/>1.0f,<sp/>0.0f,<sp/>1.0f</highlight></codeline>
<codeline lineno="2908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="2909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__shader__config" kindref="compound">gl_shader_config</ref><sp/>sconf<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="2910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__shader__config_1a00edad21954dc7fc7d95a035d0a1c0d5" kindref="member">view_alpha</ref><sp/>=<sp/>1.0f,</highlight></codeline>
<codeline lineno="2911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.input_tex_filter<sp/>=<sp/>GL_NEAREST,</highlight></codeline>
<codeline lineno="2912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="2913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>pixman_format_code_t<sp/>format<sp/>=<sp/>PIXMAN_a8b8g8r8;</highlight></codeline>
<codeline lineno="2914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytespp<sp/>=<sp/>4;<sp/></highlight><highlight class="comment">/*<sp/>PIXMAN_a8b8g8r8<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>GLenum<sp/>gl_format<sp/>=<sp/>GL_RGBA;<sp/></highlight><highlight class="comment">/*<sp/>PIXMAN_a8b8g8r8<sp/>little-endian<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="2917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs<sp/>=<sp/><ref refid="gl-renderer_8c_1a19332e01e97bfee74a31e89d38835758" kindref="member">get_surface_state</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="2918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cw,<sp/>ch;</highlight></codeline>
<codeline lineno="2919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/>fbo;</highlight></codeline>
<codeline lineno="2920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLuint<sp/>tex;</highlight></codeline>
<codeline lineno="2921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLenum<sp/>status;</highlight></codeline>
<codeline lineno="2922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="2923"><highlight class="normal"></highlight></codeline>
<codeline lineno="2924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a525424c31f88ecea126e2d4cfb0d7741" kindref="member">gl_renderer_surface_get_content_size</ref>(<ref refid="structsurface" kindref="compound">surface</ref>,<sp/>&amp;cw,<sp/>&amp;ch);</highlight></codeline>
<codeline lineno="2925"><highlight class="normal"></highlight></codeline>
<codeline lineno="2926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1a3df4399167e0da9a2a230e7a35fccc59" kindref="member">buffer_type</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da3236d373dc32cb94fab40ee5438a983c" kindref="member">BUFFER_TYPE_NULL</ref>:</highlight></codeline>
<codeline lineno="2928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="2929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da482261e675f08e847f2a90fff87ef135" kindref="member">BUFFER_TYPE_SOLID</ref>:</highlight></codeline>
<codeline lineno="2930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*(uint32_t<sp/>*)target<sp/>=<sp/><ref refid="gl-renderer_8c_1ac60620d8dd8d405aaa853182c05cd714" kindref="member">pack_color</ref>(format,<sp/>gs-&gt;<ref refid="structgl__surface__state_1acbded99652d74a13ef160d22343cbe37" kindref="member">color</ref>);</highlight></codeline>
<codeline lineno="2931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da1867b61ecc8948ec383bdaa04bf65f2a" kindref="member">BUFFER_TYPE_SHM</ref>:</highlight></codeline>
<codeline lineno="2933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab9a84e745915a5667f066e510a9621da" kindref="member">gl_renderer_flush_damage</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="2934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>fall<sp/>through<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a828c046795228b2d36d76c1e0993519da28519cfd07d43aced9d5c5ef11c40951" kindref="member">BUFFER_TYPE_EGL</ref>:</highlight></codeline>
<codeline lineno="2936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2938"><highlight class="normal"></highlight></codeline>
<codeline lineno="2939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ae0b5c16fdf73b565c63698710d01a378" kindref="member">gl_shader_config_set_input_textures</ref>(&amp;sconf,<sp/>gs);</highlight></codeline>
<codeline lineno="2940"><highlight class="normal"></highlight></codeline>
<codeline lineno="2941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="2942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenTextures(1,<sp/>&amp;tex);</highlight></codeline>
<codeline lineno="2943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>tex);</highlight></codeline>
<codeline lineno="2944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glTexImage2D(GL_TEXTURE_2D,<sp/>0,<sp/>GL_RGBA,<sp/>cw,<sp/>ch,</highlight></codeline>
<codeline lineno="2945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>GL_RGBA,<sp/>GL_UNSIGNED_BYTE,<sp/>NULL);</highlight></codeline>
<codeline lineno="2946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindTexture(GL_TEXTURE_2D,<sp/>0);</highlight></codeline>
<codeline lineno="2947"><highlight class="normal"></highlight></codeline>
<codeline lineno="2948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glGenFramebuffers(1,<sp/>&amp;fbo);</highlight></codeline>
<codeline lineno="2949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glBindFramebuffer(GL_FRAMEBUFFER,<sp/>fbo);</highlight></codeline>
<codeline lineno="2950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glFramebufferTexture2D(GL_FRAMEBUFFER,<sp/>GL_COLOR_ATTACHMENT0,</highlight></codeline>
<codeline lineno="2951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_TEXTURE_2D,<sp/>tex,<sp/>0);</highlight></codeline>
<codeline lineno="2952"><highlight class="normal"></highlight></codeline>
<codeline lineno="2953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status<sp/>=<sp/>glCheckFramebufferStatus(GL_FRAMEBUFFER);</highlight></codeline>
<codeline lineno="2954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(status<sp/>!=<sp/>GL_FRAMEBUFFER_COMPLETE)<sp/>{</highlight></codeline>
<codeline lineno="2955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;%s:<sp/>fbo<sp/>error:<sp/>%#x\n&quot;</highlight><highlight class="normal">,<sp/>__func__,<sp/>status);</highlight></codeline>
<codeline lineno="2956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="2957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2958"><highlight class="normal"></highlight></codeline>
<codeline lineno="2959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glViewport(0,<sp/>0,<sp/>cw,<sp/>ch);</highlight></codeline>
<codeline lineno="2960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisable(GL_BLEND);</highlight></codeline>
<codeline lineno="2961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref>)</highlight></codeline>
<codeline lineno="2962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>.<ref refid="structweston__matrix_1a525734d347a66825ef16f69d00ab82c0" kindref="member">d</ref>,<sp/>projmat_normal,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>projmat_normal);</highlight></codeline>
<codeline lineno="2963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>.<ref refid="structweston__matrix_1a525734d347a66825ef16f69d00ab82c0" kindref="member">d</ref>,<sp/>projmat_yinvert,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>projmat_yinvert);</highlight></codeline>
<codeline lineno="2965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sconf.<ref refid="structgl__shader__config_1ae3a3e566fc6c7f458b4b39c90cc1a0a5" kindref="member">projection</ref>.<ref refid="structweston__matrix_1a82a0c24ad4a2dcdead2d84fcbc59a9ad" kindref="member">type</ref><sp/>=<sp/><ref refid="matrix_8h_1a36f1c17c5d79896d6e3072add55c8c2aa2159882a3c2449030cb1d4fba1862640" kindref="member">WESTON_MATRIX_TRANSFORM_SCALE</ref><sp/>|</highlight></codeline>
<codeline lineno="2966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="matrix_8h_1a36f1c17c5d79896d6e3072add55c8c2aa827fdf83faf73bf1af8049792f35c739" kindref="member">WESTON_MATRIX_TRANSFORM_TRANSLATE</ref>;</highlight></codeline>
<codeline lineno="2967"><highlight class="normal"></highlight></codeline>
<codeline lineno="2968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="gl-renderer-internal_8h_1ab5a978c5899fb595f1023e0e0846c887" kindref="member">gl_renderer_use_program</ref>(gr,<sp/>&amp;sconf))</highlight></codeline>
<codeline lineno="2969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="2970"><highlight class="normal"></highlight></codeline>
<codeline lineno="2971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>position:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(0,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>verts);</highlight></codeline>
<codeline lineno="2973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="2974"><highlight class="normal"></highlight></codeline>
<codeline lineno="2975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>texcoord:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glVertexAttribPointer(1,<sp/>2,<sp/>GL_FLOAT,<sp/>GL_FALSE,<sp/>0,<sp/>verts);</highlight></codeline>
<codeline lineno="2977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glEnableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="2978"><highlight class="normal"></highlight></codeline>
<codeline lineno="2979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDrawArrays(GL_TRIANGLE_FAN,<sp/>0,<sp/>4);</highlight></codeline>
<codeline lineno="2980"><highlight class="normal"></highlight></codeline>
<codeline lineno="2981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(1);</highlight></codeline>
<codeline lineno="2982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDisableVertexAttribArray(0);</highlight></codeline>
<codeline lineno="2983"><highlight class="normal"></highlight></codeline>
<codeline lineno="2984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glPixelStorei(GL_PACK_ALIGNMENT,<sp/>bytespp);</highlight></codeline>
<codeline lineno="2985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glReadPixels(src_x,<sp/>src_y,<sp/>width,<sp/><ref refid="structgl__surface__state_1a21b54472373ff0f3187a3fffd39409c8" kindref="member">height</ref>,<sp/><ref refid="structgl__surface__state_1a64042c6294bd924fbb1dbf8b4ed269c2" kindref="member">gl_format</ref>,</highlight></codeline>
<codeline lineno="2986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_UNSIGNED_BYTE,<sp/>target);</highlight></codeline>
<codeline lineno="2987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2988"><highlight class="normal"></highlight></codeline>
<codeline lineno="2989"><highlight class="normal">out:</highlight></codeline>
<codeline lineno="2990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteFramebuffers(1,<sp/>&amp;fbo);</highlight></codeline>
<codeline lineno="2991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(1,<sp/>&amp;tex);</highlight></codeline>
<codeline lineno="2992"><highlight class="normal"></highlight></codeline>
<codeline lineno="2993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="2994"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2995"><highlight class="normal"></highlight></codeline>
<codeline lineno="2996"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2997"><highlight class="normal"><ref refid="gl-renderer_8c_1a4dc0bafd3ffc0f99240cb2ac8fe1255e" kindref="member">surface_state_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr)</highlight></codeline>
<codeline lineno="2998"><highlight class="normal">{</highlight></codeline>
<codeline lineno="2999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="3000"><highlight class="normal"></highlight></codeline>
<codeline lineno="3001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;gs-&gt;<ref refid="structgl__surface__state_1a44a38e6bdffaea7fb65e7ec9f42bfe84" kindref="member">surface_destroy_listener</ref>.link);</highlight></codeline>
<codeline lineno="3002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;gs-&gt;<ref refid="structgl__surface__state_1ae5dc538b00961768e27100f60a3625fe" kindref="member">renderer_destroy_listener</ref>.link);</highlight></codeline>
<codeline lineno="3003"><highlight class="normal"></highlight></codeline>
<codeline lineno="3004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a34c900dc44207a99101ce1d73886aa83" kindref="member">renderer_state</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="3005"><highlight class="normal"></highlight></codeline>
<codeline lineno="3006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glDeleteTextures(gs-&gt;<ref refid="structgl__surface__state_1a26b5e65a09fef54a1c442be3ca73daee" kindref="member">num_textures</ref>,<sp/>gs-&gt;<ref refid="structgl__surface__state_1abbe8849238d84ba13ab96da47c77b4b2" kindref="member">textures</ref>);</highlight></codeline>
<codeline lineno="3007"><highlight class="normal"></highlight></codeline>
<codeline lineno="3008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>gs-&gt;<ref refid="structgl__surface__state_1a724d1f73da7c9754f3bd12724c543d20" kindref="member">num_images</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="3009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a06ee799db1330a81b206e9c471c0b502" kindref="member">egl_image_unref</ref>(gs-&gt;<ref refid="structgl__surface__state_1ae479eed23bbc1b7c69545c546ea4615e" kindref="member">images</ref>[i]);</highlight></codeline>
<codeline lineno="3010"><highlight class="normal"></highlight></codeline>
<codeline lineno="3011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a46c9d30efa62b7ca5f720b1dd83ebe12" kindref="member">weston_buffer_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1aaeffaee80b0966023281191d673ac84a" kindref="member">buffer_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="3012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1a0abe1ac1aff541e5670f35fb2db85c7d" kindref="member">weston_buffer_release_reference</ref>(&amp;gs-&gt;<ref refid="structgl__surface__state_1acfa1630aa66a592129cbbd88e4f720a0" kindref="member">buffer_release_ref</ref>,<sp/>NULL);</highlight></codeline>
<codeline lineno="3013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>);</highlight></codeline>
<codeline lineno="3014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(gs);</highlight></codeline>
<codeline lineno="3015"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3016"><highlight class="normal"></highlight></codeline>
<codeline lineno="3017"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3018"><highlight class="normal"><ref refid="gl-renderer_8c_1aa110a438acee8cea5b329204ad176515" kindref="member">surface_state_handle_surface_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>wl_listener<sp/>*listener,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3019"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs;</highlight></codeline>
<codeline lineno="3021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr;</highlight></codeline>
<codeline lineno="3022"><highlight class="normal"></highlight></codeline>
<codeline lineno="3023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs<sp/>=<sp/>container_of(listener,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref>,</highlight></codeline>
<codeline lineno="3024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>surface_destroy_listener);</highlight></codeline>
<codeline lineno="3025"><highlight class="normal"></highlight></codeline>
<codeline lineno="3026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref>-&gt;<ref refid="structweston__surface_1a41c8e02bbd08f7a51960586aff9f4eac" kindref="member">compositor</ref>);</highlight></codeline>
<codeline lineno="3027"><highlight class="normal"></highlight></codeline>
<codeline lineno="3028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a4dc0bafd3ffc0f99240cb2ac8fe1255e" kindref="member">surface_state_destroy</ref>(gs,<sp/>gr);</highlight></codeline>
<codeline lineno="3029"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3030"><highlight class="normal"></highlight></codeline>
<codeline lineno="3031"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3032"><highlight class="normal"><ref refid="gl-renderer_8c_1a821e578eb171c4c99d515ef377cadbf3" kindref="member">surface_state_handle_renderer_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>wl_listener<sp/>*listener,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3033"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs;</highlight></codeline>
<codeline lineno="3035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr;</highlight></codeline>
<codeline lineno="3036"><highlight class="normal"></highlight></codeline>
<codeline lineno="3037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="3038"><highlight class="normal"></highlight></codeline>
<codeline lineno="3039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs<sp/>=<sp/>container_of(listener,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref>,</highlight></codeline>
<codeline lineno="3040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>renderer_destroy_listener);</highlight></codeline>
<codeline lineno="3041"><highlight class="normal"></highlight></codeline>
<codeline lineno="3042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a4dc0bafd3ffc0f99240cb2ac8fe1255e" kindref="member">surface_state_destroy</ref>(gs,<sp/>gr);</highlight></codeline>
<codeline lineno="3043"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3044"><highlight class="normal"></highlight></codeline>
<codeline lineno="3045"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3046"><highlight class="normal"><ref refid="gl-renderer_8c_1ab64e604cc7dab39204e8bc963a8e2317" kindref="member">gl_renderer_create_surface</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__surface" kindref="compound">weston_surface</ref><sp/>*<ref refid="structsurface" kindref="compound">surface</ref>)</highlight></codeline>
<codeline lineno="3047"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__surface__state" kindref="compound">gl_surface_state</ref><sp/>*gs;</highlight></codeline>
<codeline lineno="3049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="3050"><highlight class="normal"></highlight></codeline>
<codeline lineno="3051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*gs);</highlight></codeline>
<codeline lineno="3052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs<sp/>==<sp/>NULL)</highlight></codeline>
<codeline lineno="3053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3054"><highlight class="normal"></highlight></codeline>
<codeline lineno="3055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>A<sp/>buffer<sp/>is<sp/>never<sp/>attached<sp/>to<sp/>solid<sp/>color<sp/>surfaces,<sp/>yet</highlight></codeline>
<codeline lineno="3056"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>they<sp/>still<sp/>go<sp/>through<sp/>texcoord<sp/>computations.<sp/>Do<sp/>not<sp/>divide</highlight></codeline>
<codeline lineno="3057"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>by<sp/>zero<sp/>there.</highlight></codeline>
<codeline lineno="3058"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1adf4f1523ee9a13199fbfbf2f21b7553c" kindref="member">pitch</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="3060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a8fd8b52321bb4080fee0eb390e4c7394" kindref="member">y_inverted</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="3061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1af88729ac43e49714e883e2c83564953d" kindref="member">direct_display</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="3062"><highlight class="normal"></highlight></codeline>
<codeline lineno="3063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a9a8e7c34a7bb049b99595b8301a1fdf2" kindref="member">surface</ref><sp/>=<sp/><ref refid="structsurface" kindref="compound">surface</ref>;</highlight></codeline>
<codeline lineno="3064"><highlight class="normal"></highlight></codeline>
<codeline lineno="3065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;gs-&gt;<ref refid="structgl__surface__state_1a924805a62636c057fd0e49be62f4c359" kindref="member">texture_damage</ref>);</highlight></codeline>
<codeline lineno="3066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsurface" kindref="compound">surface</ref>-&gt;renderer_state<sp/>=<sp/>gs;</highlight></codeline>
<codeline lineno="3067"><highlight class="normal"></highlight></codeline>
<codeline lineno="3068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1a44a38e6bdffaea7fb65e7ec9f42bfe84" kindref="member">surface_destroy_listener</ref>.notify<sp/>=</highlight></codeline>
<codeline lineno="3069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1aa110a438acee8cea5b329204ad176515" kindref="member">surface_state_handle_surface_destroy</ref>;</highlight></codeline>
<codeline lineno="3070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_add(&amp;<ref refid="structsurface" kindref="compound">surface</ref>-&gt;destroy_signal,</highlight></codeline>
<codeline lineno="3071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;gs-&gt;<ref refid="structgl__surface__state_1a44a38e6bdffaea7fb65e7ec9f42bfe84" kindref="member">surface_destroy_listener</ref>);</highlight></codeline>
<codeline lineno="3072"><highlight class="normal"></highlight></codeline>
<codeline lineno="3073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gs-&gt;<ref refid="structgl__surface__state_1ae5dc538b00961768e27100f60a3625fe" kindref="member">renderer_destroy_listener</ref>.notify<sp/>=</highlight></codeline>
<codeline lineno="3074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a821e578eb171c4c99d515ef377cadbf3" kindref="member">surface_state_handle_renderer_destroy</ref>;</highlight></codeline>
<codeline lineno="3075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_add(&amp;gr-&gt;<ref refid="structgl__renderer_1ae237cc3a53f93ac46fefb37e3e3589a7" kindref="member">destroy_signal</ref>,</highlight></codeline>
<codeline lineno="3076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;gs-&gt;<ref refid="structgl__surface__state_1ae5dc538b00961768e27100f60a3625fe" kindref="member">renderer_destroy_listener</ref>);</highlight></codeline>
<codeline lineno="3077"><highlight class="normal"></highlight></codeline>
<codeline lineno="3078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structsurface" kindref="compound">surface</ref>-&gt;buffer_ref.<ref refid="structsurface_1a6380eb64761a852c50514a0ad1b8a37c" kindref="member">buffer</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a3eed0faf6171d0306e4f45ab1f4f809d" kindref="member">gl_renderer_attach</ref>(<ref refid="structsurface" kindref="compound">surface</ref>,<sp/><ref refid="structsurface" kindref="compound">surface</ref>-&gt;buffer_ref.<ref refid="structsurface_1a6380eb64761a852c50514a0ad1b8a37c" kindref="member">buffer</ref>);</highlight></codeline>
<codeline lineno="3080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab9a84e745915a5667f066e510a9621da" kindref="member">gl_renderer_flush_damage</ref>(<ref refid="structsurface" kindref="compound">surface</ref>);</highlight></codeline>
<codeline lineno="3081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3082"><highlight class="normal"></highlight></codeline>
<codeline lineno="3083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="3084"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3085"><highlight class="normal"></highlight></codeline>
<codeline lineno="3086"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3087"><highlight class="normal"><ref refid="gl-renderer_8c_1acb1879516a5eb18d6a30d1bf77d836fc" kindref="member">gl_renderer_log_extensions</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extensions)</highlight></codeline>
<codeline lineno="3088"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3089"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/>*end;</highlight></codeline>
<codeline lineno="3090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l;</highlight></codeline>
<codeline lineno="3091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>len;</highlight></codeline>
<codeline lineno="3092"><highlight class="normal"></highlight></codeline>
<codeline lineno="3093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l<sp/>=<sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;%s:&quot;</highlight><highlight class="normal">,<sp/>name);</highlight></codeline>
<codeline lineno="3094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>extensions;</highlight></codeline>
<codeline lineno="3095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="3096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>=<sp/>strchrnul(p,<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>len<sp/>=<sp/>end<sp/>-<sp/>p;</highlight></codeline>
<codeline lineno="3098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(l<sp/>+<sp/>len<sp/>&gt;<sp/>78)</highlight></codeline>
<codeline lineno="3099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l<sp/>=<sp/><ref refid="group__wlog_1gaa0016cb4379eb39a57ac3be92f19ffa9" kindref="member">weston_log_continue</ref>(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a4dcb9f8540ab54e157a5237c5354a203" kindref="member">STAMP_SPACE</ref><sp/></highlight><highlight class="stringliteral">&quot;%.*s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>len,<sp/>p);</highlight></codeline>
<codeline lineno="3101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l<sp/>+=<sp/><ref refid="group__wlog_1gaa0016cb4379eb39a57ac3be92f19ffa9" kindref="member">weston_log_continue</ref>(</highlight><highlight class="stringliteral">&quot;<sp/>%.*s&quot;</highlight><highlight class="normal">,<sp/>len,<sp/>p);</highlight></codeline>
<codeline lineno="3103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(p<sp/>=<sp/>end;<sp/>isspace(*p);<sp/>p++)</highlight></codeline>
<codeline lineno="3104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>;</highlight></codeline>
<codeline lineno="3105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1gaa0016cb4379eb39a57ac3be92f19ffa9" kindref="member">weston_log_continue</ref>(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3107"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3108"><highlight class="normal"></highlight></codeline>
<codeline lineno="3109"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3110"><highlight class="normal"><ref refid="gl-renderer_8c_1ab0422d657ecad7e39c475667db67a085" kindref="member">log_egl_info</ref>(<ref refid="gl-renderer_8h_1a87d55554aa13accdcb0e10eab910c72e" kindref="member">EGLDisplay</ref><sp/>egldpy)</highlight></codeline>
<codeline lineno="3111"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*str;</highlight></codeline>
<codeline lineno="3113"><highlight class="normal"></highlight></codeline>
<codeline lineno="3114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>eglQueryString(egldpy,<sp/>EGL_VERSION);</highlight></codeline>
<codeline lineno="3115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;EGL<sp/>version:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3116"><highlight class="normal"></highlight></codeline>
<codeline lineno="3117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>eglQueryString(egldpy,<sp/>EGL_VENDOR);</highlight></codeline>
<codeline lineno="3118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;EGL<sp/>vendor:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3119"><highlight class="normal"></highlight></codeline>
<codeline lineno="3120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>eglQueryString(egldpy,<sp/>EGL_CLIENT_APIS);</highlight></codeline>
<codeline lineno="3121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;EGL<sp/>client<sp/>APIs:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3122"><highlight class="normal"></highlight></codeline>
<codeline lineno="3123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>eglQueryString(egldpy,<sp/>EGL_EXTENSIONS);</highlight></codeline>
<codeline lineno="3124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1acb1879516a5eb18d6a30d1bf77d836fc" kindref="member">gl_renderer_log_extensions</ref>(</highlight><highlight class="stringliteral">&quot;EGL<sp/>extensions&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3125"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3126"><highlight class="normal"></highlight></codeline>
<codeline lineno="3127"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3128"><highlight class="normal"><ref refid="gl-renderer_8c_1a6de923e3da984b708ab8e38b70477225" kindref="member">log_gl_info</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3129"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*str;</highlight></codeline>
<codeline lineno="3131"><highlight class="normal"></highlight></codeline>
<codeline lineno="3132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)glGetString(GL_VERSION);</highlight></codeline>
<codeline lineno="3133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL<sp/>version:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3134"><highlight class="normal"></highlight></codeline>
<codeline lineno="3135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)glGetString(GL_SHADING_LANGUAGE_VERSION);</highlight></codeline>
<codeline lineno="3136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GLSL<sp/>version:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3137"><highlight class="normal"></highlight></codeline>
<codeline lineno="3138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)glGetString(GL_VENDOR);</highlight></codeline>
<codeline lineno="3139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL<sp/>vendor:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3140"><highlight class="normal"></highlight></codeline>
<codeline lineno="3141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)glGetString(GL_RENDERER);</highlight></codeline>
<codeline lineno="3142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL<sp/>renderer:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3143"><highlight class="normal"></highlight></codeline>
<codeline lineno="3144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>str<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)glGetString(GL_EXTENSIONS);</highlight></codeline>
<codeline lineno="3145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1acb1879516a5eb18d6a30d1bf77d836fc" kindref="member">gl_renderer_log_extensions</ref>(</highlight><highlight class="stringliteral">&quot;GL<sp/>extensions&quot;</highlight><highlight class="normal">,<sp/>str<sp/>?<sp/>str<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3146"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3147"><highlight class="normal"></highlight></codeline>
<codeline lineno="3148"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3149"><highlight class="normal"><ref refid="gl-renderer_8c_1aae880f0fafdc938725ae869db58c554a" kindref="member">gl_renderer_output_set_border</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="3150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a8e5f6eb1b1b7b25d13d58ed255c41403" kindref="member">gl_renderer_border_side</ref><sp/>side,</highlight></codeline>
<codeline lineno="3151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>width,<sp/>int32_t<sp/>height,</highlight></codeline>
<codeline lineno="3152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>tex_width,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3153"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="3155"><highlight class="normal"></highlight></codeline>
<codeline lineno="3156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>!=<sp/>width<sp/>||</highlight></codeline>
<codeline lineno="3157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref><sp/>!=<sp/>height)</highlight></codeline>
<codeline lineno="3158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>In<sp/>this<sp/>case,<sp/>we<sp/>have<sp/>to<sp/>blow<sp/>everything<sp/>and<sp/>do<sp/>a<sp/>full</highlight></codeline>
<codeline lineno="3159"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>repaint.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref><sp/>|=<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5a955e714fe630ca6d864293605a1d80da" kindref="member">BORDER_SIZE_CHANGED</ref><sp/>|<sp/><ref refid="gl-renderer_8c_1ab759d2df19073820ea76ac77c64124c5afe73d5275ac520114d310400d092b9bb" kindref="member">BORDER_ALL_DIRTY</ref>;</highlight></codeline>
<codeline lineno="3161"><highlight class="normal"></highlight></codeline>
<codeline lineno="3162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(data<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="3163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>width<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="3164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>height<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="3165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3166"><highlight class="normal"></highlight></codeline>
<codeline lineno="3167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1acc3da08ec2527f26bf96a119e0132d9c" kindref="member">width</ref><sp/>=<sp/>width;</highlight></codeline>
<codeline lineno="3168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1a72e9127ad0f05d1c292dae2643273b0e" kindref="member">height</ref><sp/>=<sp/>height;</highlight></codeline>
<codeline lineno="3169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1a7a64d69b74da000da48b95ac7425edb3" kindref="member">tex_width</ref><sp/>=<sp/>tex_width;</highlight></codeline>
<codeline lineno="3170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1aec57e73b2ef61d4af4dbecab82740247" kindref="member">borders</ref>[side].<ref refid="structgl__border__image_1a222717b14c1e57156e1a67666d9c9c4e" kindref="member">data</ref><sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="3171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ad078ccf2d36ef2dadbb74c8b9096ca37" kindref="member">border_status</ref><sp/>|=<sp/>1<sp/>&lt;&lt;<sp/>side;</highlight></codeline>
<codeline lineno="3172"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3173"><highlight class="normal"></highlight></codeline>
<codeline lineno="3174"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3175"><highlight class="normal"><ref refid="gl-renderer_8c_1a6c4d504b0e8768523a1e604ca3d4ce5e" kindref="member">gl_renderer_setup</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec,<sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>);</highlight></codeline>
<codeline lineno="3176"><highlight class="normal"></highlight></codeline>
<codeline lineno="3177"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref></highlight></codeline>
<codeline lineno="3178"><highlight class="normal"><ref refid="gl-renderer_8c_1a4c6070ff1fb5b662ec5258d922446710" kindref="member">gl_renderer_create_window_surface</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr,</highlight></codeline>
<codeline lineno="3179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a4007ec919445bd39e1cdbf77c07fc090" kindref="member">EGLNativeWindowType</ref><sp/>window_for_legacy,</highlight></codeline>
<codeline lineno="3180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*window_for_platform,</highlight></codeline>
<codeline lineno="3181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>*drm_formats,</highlight></codeline>
<codeline lineno="3182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>drm_formats_count)</highlight></codeline>
<codeline lineno="3183"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>=<sp/>EGL_NO_SURFACE;</highlight></codeline>
<codeline lineno="3185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a691766e6d867e15207ec0a6d6e46253c" kindref="member">EGLConfig</ref><sp/>egl_config;</highlight></codeline>
<codeline lineno="3186"><highlight class="normal"></highlight></codeline>
<codeline lineno="3187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_config<sp/>=<sp/><ref refid="egl-glue_8c_1ae5511db4c1a81d3592bd2495729d87db" kindref="member">gl_renderer_get_egl_config</ref>(gr,<sp/><ref refid="gl-renderer_8h_1a0afa78b0eede7a459e7df188ccd7a371" kindref="member">EGL_WINDOW_BIT</ref>,</highlight></codeline>
<codeline lineno="3188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drm_formats,<sp/>drm_formats_count);</highlight></codeline>
<codeline lineno="3189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(egl_config<sp/>==<sp/>EGL_NO_CONFIG_KHR)</highlight></codeline>
<codeline lineno="3190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>EGL_NO_SURFACE;</highlight></codeline>
<codeline lineno="3191"><highlight class="normal"></highlight></codeline>
<codeline lineno="3192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a0b413a1ec068c5a31bf74bdc205b3a24" kindref="member">log_egl_config_info</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>egl_config);</highlight></codeline>
<codeline lineno="3193"><highlight class="normal"></highlight></codeline>
<codeline lineno="3194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a9d7c51b6ff6e1935a0ee6bd080340275" kindref="member">create_platform_window</ref>)</highlight></codeline>
<codeline lineno="3195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a9d7c51b6ff6e1935a0ee6bd080340275" kindref="member">create_platform_window</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_config,</highlight></codeline>
<codeline lineno="3197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window_for_platform,</highlight></codeline>
<codeline lineno="3198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL);</highlight></codeline>
<codeline lineno="3199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>=<sp/>eglCreateWindowSurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_config,</highlight></codeline>
<codeline lineno="3202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window_for_legacy,<sp/>NULL);</highlight></codeline>
<codeline lineno="3203"><highlight class="normal"></highlight></codeline>
<codeline lineno="3204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>;</highlight></codeline>
<codeline lineno="3205"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3206"><highlight class="normal"></highlight></codeline>
<codeline lineno="3207"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3208"><highlight class="normal"><ref refid="gl-renderer_8c_1ac386148038fcc182210857e50f8f0a63" kindref="member">gl_renderer_output_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="3209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/><ref refid="structsurface" kindref="compound">surface</ref>)</highlight></codeline>
<codeline lineno="3210"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go;</highlight></codeline>
<codeline lineno="3212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="3213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__testsuite__quirks" kindref="compound">weston_testsuite_quirks</ref><sp/>*quirks;</highlight></codeline>
<codeline lineno="3214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GLint<sp/>internal_format;</highlight></codeline>
<codeline lineno="3215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="3216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="3217"><highlight class="normal"></highlight></codeline>
<codeline lineno="3218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quirks<sp/>=<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor-&gt;test_data.test_quirks;</highlight></codeline>
<codeline lineno="3219"><highlight class="normal"></highlight></codeline>
<codeline lineno="3220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*go);</highlight></codeline>
<codeline lineno="3221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go<sp/>==<sp/>NULL)</highlight></codeline>
<codeline lineno="3222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3223"><highlight class="normal"></highlight></codeline>
<codeline lineno="3224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>=<sp/><ref refid="structsurface" kindref="compound">surface</ref>;</highlight></codeline>
<codeline lineno="3225"><highlight class="normal"></highlight></codeline>
<codeline lineno="3226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="gl-renderer_8c_1a0d2bb58565d26985ed4a54353c307af2" kindref="member">BUFFER_DAMAGE_COUNT</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="3227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;go-&gt;<ref refid="structgl__output__state_1acc706d22ee8bec65f987885e1126ef49" kindref="member">buffer_damage</ref>[i]);</highlight></codeline>
<codeline lineno="3228"><highlight class="normal"></highlight></codeline>
<codeline lineno="3229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;go-&gt;<ref refid="structgl__output__state_1a021618cc7845f82c2af9b7efc8ac6e7b" kindref="member">timeline_render_point_list</ref>);</highlight></codeline>
<codeline lineno="3230"><highlight class="normal"></highlight></codeline>
<codeline lineno="3231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref><sp/>=<sp/>EGL_NO_SYNC_KHR;</highlight></codeline>
<codeline lineno="3232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref><sp/>=<sp/>EGL_NO_SYNC_KHR;</highlight></codeline>
<codeline lineno="3233"><highlight class="normal"></highlight></codeline>
<codeline lineno="3234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;use_renderer_shadow_buffer)<sp/>{</highlight></codeline>
<codeline lineno="3235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref>);</highlight></codeline>
<codeline lineno="3236"><highlight class="normal"></highlight></codeline>
<codeline lineno="3237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref><sp/>==<sp/>GL_HALF_FLOAT_OES)</highlight></codeline>
<codeline lineno="3238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>internal_format<sp/>=<sp/>GL_RGBA;</highlight></codeline>
<codeline lineno="3239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>internal_format<sp/>=<sp/>GL_RGBA16F;</highlight></codeline>
<codeline lineno="3241"><highlight class="normal"></highlight></codeline>
<codeline lineno="3242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="gl-renderer_8c_1aeaf10b41e911de6a80a1885227a0c2b6" kindref="member">gl_fbo_texture_init</ref>(&amp;go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>,</highlight></codeline>
<codeline lineno="3243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="3244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="3245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>internal_format,</highlight></codeline>
<codeline lineno="3246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GL_RGBA,</highlight></codeline>
<codeline lineno="3247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref>);</highlight></codeline>
<codeline lineno="3248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret)<sp/>{</highlight></codeline>
<codeline lineno="3249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Output<sp/>%s<sp/>uses<sp/>16F<sp/>shadow.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;name);</highlight></codeline>
<codeline lineno="3251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="3252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Output<sp/>%s<sp/>failed<sp/>to<sp/>create<sp/>16F<sp/>shadow.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;name);</highlight></codeline>
<codeline lineno="3254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(go);</highlight></codeline>
<codeline lineno="3255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(quirks-&gt;<ref refid="structweston__testsuite__quirks_1abb3769af372946baa999893d45bba17f" kindref="member">gl_force_full_redraw_of_shadow_fb</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;ERROR:<sp/>gl_force_full_redraw_of_shadow_fb<sp/>quirk<sp/>used<sp/>but<sp/>shadow<sp/>fb<sp/>was<sp/>not<sp/>enabled.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>abort();</highlight></codeline>
<codeline lineno="3260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3261"><highlight class="normal"></highlight></codeline>
<codeline lineno="3262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;renderer_state<sp/>=<sp/>go;</highlight></codeline>
<codeline lineno="3263"><highlight class="normal"></highlight></codeline>
<codeline lineno="3264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="3265"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3266"><highlight class="normal"></highlight></codeline>
<codeline lineno="3267"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3268"><highlight class="normal"><ref refid="gl-renderer_8c_1aec7c581b0b5456ce0c465781cc7bbd18" kindref="member">gl_renderer_output_window_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="3269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer__output__options" kindref="compound">gl_renderer_output_options</ref><sp/>*options)</highlight></codeline>
<codeline lineno="3270"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor;</highlight></codeline>
<codeline lineno="3272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="3273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/>egl_surface<sp/>=<sp/>EGL_NO_SURFACE;</highlight></codeline>
<codeline lineno="3274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="3275"><highlight class="normal"></highlight></codeline>
<codeline lineno="3276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_surface<sp/>=<sp/><ref refid="gl-renderer_8c_1a4c6070ff1fb5b662ec5258d922446710" kindref="member">gl_renderer_create_window_surface</ref>(gr,</highlight></codeline>
<codeline lineno="3277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__output__options_1a82e504499e5952cfb2f0308dcfed3fee" kindref="member">window_for_legacy</ref>,</highlight></codeline>
<codeline lineno="3278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__output__options_1a4a41f1b90ab23ec044d3ee9f5dc18168" kindref="member">window_for_platform</ref>,</highlight></codeline>
<codeline lineno="3279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__output__options_1aef1d377ceb344ade2ebcedf02dbf6d53" kindref="member">drm_formats</ref>,</highlight></codeline>
<codeline lineno="3280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__output__options_1ae575c80769bbd43947478c845e36bce3" kindref="member">drm_formats_count</ref>);</highlight></codeline>
<codeline lineno="3281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(egl_surface<sp/>==<sp/>EGL_NO_SURFACE)<sp/>{</highlight></codeline>
<codeline lineno="3282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>create<sp/>egl<sp/>surface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3285"><highlight class="normal"></highlight></codeline>
<codeline lineno="3286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="gl-renderer_8c_1ac386148038fcc182210857e50f8f0a63" kindref="member">gl_renderer_output_create</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>egl_surface);</highlight></codeline>
<codeline lineno="3287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="3288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>weston_platform_destroy_egl_surface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>egl_surface);</highlight></codeline>
<codeline lineno="3289"><highlight class="normal"></highlight></codeline>
<codeline lineno="3290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="3291"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3292"><highlight class="normal"></highlight></codeline>
<codeline lineno="3293"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3294"><highlight class="normal"><ref refid="gl-renderer_8c_1afbd97b5e78fed70df49d4598d28490ef" kindref="member">gl_renderer_output_pbuffer_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="3295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer__pbuffer__options" kindref="compound">gl_renderer_pbuffer_options</ref><sp/>*options)</highlight></codeline>
<codeline lineno="3296"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="3298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go;</highlight></codeline>
<codeline lineno="3299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a691766e6d867e15207ec0a6d6e46253c" kindref="member">EGLConfig</ref><sp/>pbuffer_config;</highlight></codeline>
<codeline lineno="3300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>;</highlight></codeline>
<codeline lineno="3301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>value<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="3302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="3303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>pbuffer_attribs[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="3304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_WIDTH,<sp/>options-&gt;<ref refid="structgl__renderer__pbuffer__options_1a5dc59cbda4b72ef570bd21a94b971f93" kindref="member">width</ref>,</highlight></codeline>
<codeline lineno="3305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_HEIGHT,<sp/>options-&gt;<ref refid="structgl__renderer__pbuffer__options_1ad14341136c3660b7188572c4fb0fdc79" kindref="member">height</ref>,</highlight></codeline>
<codeline lineno="3306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NONE</highlight></codeline>
<codeline lineno="3307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="3308"><highlight class="normal"></highlight></codeline>
<codeline lineno="3309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_config<sp/>=<sp/><ref refid="egl-glue_8c_1ae5511db4c1a81d3592bd2495729d87db" kindref="member">gl_renderer_get_egl_config</ref>(gr,<sp/><ref refid="gl-renderer_8h_1ace4c8dbcd8e4e41ea1fe7b4b6c4c280e" kindref="member">EGL_PBUFFER_BIT</ref>,</highlight></codeline>
<codeline lineno="3310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__pbuffer__options_1a0062c566a30acd685a0641df8c781369" kindref="member">drm_formats</ref>,</highlight></codeline>
<codeline lineno="3311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__pbuffer__options_1a4590629e5a9e65477710f5dd8a684d92" kindref="member">drm_formats_count</ref>);</highlight></codeline>
<codeline lineno="3312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pbuffer_config<sp/>==<sp/>EGL_NO_CONFIG_KHR)<sp/>{</highlight></codeline>
<codeline lineno="3313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>choose<sp/>EGL<sp/>config<sp/>for<sp/>PbufferSurface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3316"><highlight class="normal"></highlight></codeline>
<codeline lineno="3317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a0b413a1ec068c5a31bf74bdc205b3a24" kindref="member">log_egl_config_info</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>pbuffer_config);</highlight></codeline>
<codeline lineno="3318"><highlight class="normal"></highlight></codeline>
<codeline lineno="3319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>=<sp/>eglCreatePbufferSurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>pbuffer_config,</highlight></codeline>
<codeline lineno="3320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_attribs);</highlight></codeline>
<codeline lineno="3321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref><sp/>==<sp/>EGL_NO_SURFACE)<sp/>{</highlight></codeline>
<codeline lineno="3322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>create<sp/>egl<sp/>surface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="3324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3326"><highlight class="normal"></highlight></codeline>
<codeline lineno="3327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglSurfaceAttrib(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="3328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_SWAP_BEHAVIOR,<sp/>EGL_BUFFER_PRESERVED);</highlight></codeline>
<codeline lineno="3329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!eglQuerySurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>,</highlight></codeline>
<codeline lineno="3330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_SWAP_BEHAVIOR,<sp/>&amp;value)<sp/>||</highlight></codeline>
<codeline lineno="3331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>value<sp/>!=<sp/>EGL_BUFFER_PRESERVED)<sp/>{</highlight></codeline>
<codeline lineno="3332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Error:<sp/>pbuffer<sp/>surface<sp/>does<sp/>not<sp/>support<sp/>EGL_BUFFER_PRESERVED,<sp/>got<sp/>0x%x.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/>Continuing<sp/>anyway.\n&quot;</highlight><highlight class="normal">,<sp/>value);</highlight></codeline>
<codeline lineno="3334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3335"><highlight class="normal"></highlight></codeline>
<codeline lineno="3336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="gl-renderer_8c_1ac386148038fcc182210857e50f8f0a63" kindref="member">gl_renderer_output_create</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>);</highlight></codeline>
<codeline lineno="3337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="3338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglDestroySurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/><ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>);</highlight></codeline>
<codeline lineno="3339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="3340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="3341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>go-&gt;<ref refid="structgl__output__state_1af8fd29926f661027db2800b4b50d28a9" kindref="member">swap_behavior_is_preserved</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="3342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3343"><highlight class="normal"></highlight></codeline>
<codeline lineno="3344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="3345"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3346"><highlight class="normal"></highlight></codeline>
<codeline lineno="3347"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3348"><highlight class="normal"><ref refid="gl-renderer_8c_1ad9ff8094d61d9064badbff54ad29eedb" kindref="member">gl_renderer_output_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="3349"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="3351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="3352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structtimeline__render__point" kindref="compound">timeline_render_point</ref><sp/>*trp,<sp/>*tmp;</highlight></codeline>
<codeline lineno="3353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="3354"><highlight class="normal"></highlight></codeline>
<codeline lineno="3355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)</highlight></codeline>
<codeline lineno="3356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;go-&gt;<ref refid="structgl__output__state_1acc706d22ee8bec65f987885e1126ef49" kindref="member">buffer_damage</ref>[i]);</highlight></codeline>
<codeline lineno="3357"><highlight class="normal"></highlight></codeline>
<codeline lineno="3358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a882e8d873d5d851c1b3d1b6f306cbcc4" kindref="member">shadow_exists</ref>(go))</highlight></codeline>
<codeline lineno="3359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a2fc2b9f773abe95904333149ad2c931e" kindref="member">gl_fbo_texture_fini</ref>(&amp;go-&gt;<ref refid="structgl__output__state_1a7fea4d100943e2244d87f67817cfa3c3" kindref="member">shadow</ref>);</highlight></codeline>
<codeline lineno="3360"><highlight class="normal"></highlight></codeline>
<codeline lineno="3361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglMakeCurrent(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_SURFACE,<sp/>EGL_NO_SURFACE,</highlight></codeline>
<codeline lineno="3363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_CONTEXT);</highlight></codeline>
<codeline lineno="3364"><highlight class="normal"></highlight></codeline>
<codeline lineno="3365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>weston_platform_destroy_egl_surface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1ae861eb32faad70d315e4670133c3bdc9" kindref="member">egl_surface</ref>);</highlight></codeline>
<codeline lineno="3366"><highlight class="normal"></highlight></codeline>
<codeline lineno="3367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!wl_list_empty(&amp;go-&gt;<ref refid="structgl__output__state_1a021618cc7845f82c2af9b7efc8ac6e7b" kindref="member">timeline_render_point_list</ref>))</highlight></codeline>
<codeline lineno="3368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;warning:<sp/>discarding<sp/>pending<sp/>timeline<sp/>render&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;objects<sp/>at<sp/>output<sp/>destruction&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3370"><highlight class="normal"></highlight></codeline>
<codeline lineno="3371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(trp,<sp/>tmp,<sp/>&amp;go-&gt;<ref refid="structgl__output__state_1a021618cc7845f82c2af9b7efc8ac6e7b" kindref="member">timeline_render_point_list</ref>,<sp/><ref refid="structtimeline__render__point_1a285b8f98ba42fe564b3ed092725b1434" kindref="member">link</ref>)</highlight></codeline>
<codeline lineno="3372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a520b26cd0da6352bb678758ea5545c67" kindref="member">timeline_render_point_destroy</ref>(trp);</highlight></codeline>
<codeline lineno="3373"><highlight class="normal"></highlight></codeline>
<codeline lineno="3374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref><sp/>!=<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="3375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a647a24d7c43b5e1ba3fa16268858fa6d" kindref="member">destroy_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1acb5d0c255cbbd0af69c5e2884d4e9247" kindref="member">begin_render_sync</ref>);</highlight></codeline>
<codeline lineno="3376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref><sp/>!=<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="3377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a647a24d7c43b5e1ba3fa16268858fa6d" kindref="member">destroy_sync</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref>);</highlight></codeline>
<codeline lineno="3378"><highlight class="normal"></highlight></codeline>
<codeline lineno="3379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(go);</highlight></codeline>
<codeline lineno="3380"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3381"><highlight class="normal"></highlight></codeline>
<codeline lineno="3382"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3383"><highlight class="normal"><ref refid="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" kindref="member">gl_renderer_create_fence_fd</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>)</highlight></codeline>
<codeline lineno="3384"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__output__state" kindref="compound">gl_output_state</ref><sp/>*go<sp/>=<sp/><ref refid="gl-renderer_8c_1a7553e34976f0905f84d5c76169cb85d4" kindref="member">get_output_state</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="3386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor);</highlight></codeline>
<codeline lineno="3387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd;</highlight></codeline>
<codeline lineno="3388"><highlight class="normal"></highlight></codeline>
<codeline lineno="3389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref><sp/>==<sp/>EGL_NO_SYNC_KHR)</highlight></codeline>
<codeline lineno="3390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3391"><highlight class="normal"></highlight></codeline>
<codeline lineno="3392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fd<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a32d839fb862a9fb6c723d8d03297bf0e" kindref="member">dup_native_fence_fd</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>go-&gt;<ref refid="structgl__output__state_1a0d032fdd5ea8d924978ecfae4be5687e" kindref="member">end_render_sync</ref>);</highlight></codeline>
<codeline lineno="3393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fd<sp/>==<sp/>EGL_NO_NATIVE_FENCE_FD_ANDROID)</highlight></codeline>
<codeline lineno="3394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3395"><highlight class="normal"></highlight></codeline>
<codeline lineno="3396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fd;</highlight></codeline>
<codeline lineno="3397"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3398"><highlight class="normal"></highlight></codeline>
<codeline lineno="3399"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3400"><highlight class="normal"><ref refid="gl-renderer_8c_1af62a76e37d4c9106c6ef65a389b422ef" kindref="member">gl_renderer_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec)</highlight></codeline>
<codeline lineno="3401"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="3403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__image" kindref="compound">dmabuf_image</ref><sp/>*image,<sp/>*next;</highlight></codeline>
<codeline lineno="3404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdmabuf__format" kindref="compound">dmabuf_format</ref><sp/>*<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>,<sp/>*next_format;</highlight></codeline>
<codeline lineno="3405"><highlight class="normal"></highlight></codeline>
<codeline lineno="3406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_emit(&amp;gr-&gt;<ref refid="structgl__renderer_1ae237cc3a53f93ac46fefb37e3e3589a7" kindref="member">destroy_signal</ref>,<sp/>gr);</highlight></codeline>
<codeline lineno="3407"><highlight class="normal"></highlight></codeline>
<codeline lineno="3408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1abc7c3cb9666e78b3c3de6b8d7071b514" kindref="member">has_bind_display</ref>)</highlight></codeline>
<codeline lineno="3409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a48ca68a22398c47d51cb41809a7bea3d" kindref="member">unbind_display</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>);</highlight></codeline>
<codeline lineno="3410"><highlight class="normal"></highlight></codeline>
<codeline lineno="3411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1a94000234ec71d21ad1cb35645a02a24a" kindref="member">gl_renderer_shader_list_destroy</ref>(gr);</highlight></codeline>
<codeline lineno="3412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a7bd95f699444ea14e713dba46a17c7e9" kindref="member">fallback_shader</ref>)</highlight></codeline>
<codeline lineno="3413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer-internal_8h_1abbd654c0f2592d5518d3389955edcc18" kindref="member">gl_shader_destroy</ref>(gr,<sp/>gr-&gt;<ref refid="structgl__renderer_1a7bd95f699444ea14e713dba46a17c7e9" kindref="member">fallback_shader</ref>);</highlight></codeline>
<codeline lineno="3414"><highlight class="normal"></highlight></codeline>
<codeline lineno="3415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Work<sp/>around<sp/>crash<sp/>in<sp/>egl_dri2.c&apos;s<sp/>dri2_make_current()<sp/>-<sp/>when<sp/>does<sp/>this<sp/>apply?<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglMakeCurrent(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_SURFACE,<sp/>EGL_NO_SURFACE,</highlight></codeline>
<codeline lineno="3418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_CONTEXT);</highlight></codeline>
<codeline lineno="3419"><highlight class="normal"></highlight></codeline>
<codeline lineno="3420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(image,<sp/>next,<sp/>&amp;gr-&gt;<ref refid="structgl__renderer_1ae2ab6672ea88406c24ba67d39a85c7d3" kindref="member">dmabuf_images</ref>,<sp/><ref refid="structdmabuf__format_1a64b4aea734a37f158aa49116dec40c51" kindref="member">link</ref>)</highlight></codeline>
<codeline lineno="3421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a9aa2823f0af7287f156ba09272a7fecc" kindref="member">dmabuf_image_destroy</ref>(image);</highlight></codeline>
<codeline lineno="3422"><highlight class="normal"></highlight></codeline>
<codeline lineno="3423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>,<sp/>next_format,<sp/>&amp;gr-&gt;<ref refid="structgl__renderer_1a8a61c9d9da383117bd578c325b81db91" kindref="member">dmabuf_formats</ref>,<sp/><ref refid="structdmabuf__format_1a64b4aea734a37f158aa49116dec40c51" kindref="member">link</ref>)</highlight></codeline>
<codeline lineno="3424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a53e62eb0e0d93a1c8d8aa355f4f729de" kindref="member">dmabuf_format_destroy</ref>(<ref refid="structdmabuf__format_1a45e2291242764288376990de7982cb49" kindref="member">format</ref>);</highlight></codeline>
<codeline lineno="3425"><highlight class="normal"></highlight></codeline>
<codeline lineno="3426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref><sp/>!=<sp/>EGL_NO_SURFACE)</highlight></codeline>
<codeline lineno="3427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>weston_platform_destroy_egl_surface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref>);</highlight></codeline>
<codeline lineno="3429"><highlight class="normal"></highlight></codeline>
<codeline lineno="3430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglTerminate(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>);</highlight></codeline>
<codeline lineno="3431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglReleaseThread();</highlight></codeline>
<codeline lineno="3432"><highlight class="normal"></highlight></codeline>
<codeline lineno="3433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;gr-&gt;<ref refid="structgl__renderer_1ad238bebdd3aa0dea7602024e02f7dbad" kindref="member">output_destroy_listener</ref>.link);</highlight></codeline>
<codeline lineno="3434"><highlight class="normal"></highlight></codeline>
<codeline lineno="3435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_array_release(&amp;gr-&gt;<ref refid="structgl__renderer_1adac0baf7ccf72aec5f5f8af6e578851d" kindref="member">vertices</ref>);</highlight></codeline>
<codeline lineno="3436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_array_release(&amp;gr-&gt;<ref refid="structgl__renderer_1a7e90652824e97ffddb9a922c43219fdf" kindref="member">vtxcnt</ref>);</highlight></codeline>
<codeline lineno="3437"><highlight class="normal"></highlight></codeline>
<codeline lineno="3438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a19a35e83389dac2b135df4f7d6851f71" kindref="member">fragment_binding</ref>)</highlight></codeline>
<codeline lineno="3439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bindings_8c_1ac05f4cdd96d5aa388f5104d88f24f7a8" kindref="member">weston_binding_destroy</ref>(gr-&gt;<ref refid="structgl__renderer_1a19a35e83389dac2b135df4f7d6851f71" kindref="member">fragment_binding</ref>);</highlight></codeline>
<codeline lineno="3440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a1c5d444052ce2cc91f4393015e446000" kindref="member">fan_binding</ref>)</highlight></codeline>
<codeline lineno="3441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bindings_8c_1ac05f4cdd96d5aa388f5104d88f24f7a8" kindref="member">weston_binding_destroy</ref>(gr-&gt;<ref refid="structgl__renderer_1a1c5d444052ce2cc91f4393015e446000" kindref="member">fan_binding</ref>);</highlight></codeline>
<codeline lineno="3442"><highlight class="normal"></highlight></codeline>
<codeline lineno="3443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structweston__log__scope_1a32ad399b7e203a9ad0a5a11cdd0711ce" kindref="member">weston_log_scope_destroy</ref>(gr-&gt;<ref refid="structgl__renderer_1a25b6ad5ba07b7cb01a6aa7bda56a2b3b" kindref="member">shader_scope</ref>);</highlight></codeline>
<codeline lineno="3444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(gr);</highlight></codeline>
<codeline lineno="3445"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3446"><highlight class="normal"></highlight></codeline>
<codeline lineno="3447"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3448"><highlight class="normal"><ref refid="gl-renderer_8c_1a1ecf85e437a88a60b1a36825ce407b1c" kindref="member">output_handle_destroy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>wl_listener<sp/>*listener,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3449"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr;</highlight></codeline>
<codeline lineno="3451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="3452"><highlight class="normal"></highlight></codeline>
<codeline lineno="3453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr<sp/>=<sp/>container_of(listener,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref>,</highlight></codeline>
<codeline lineno="3454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_destroy_listener);</highlight></codeline>
<codeline lineno="3455"><highlight class="normal"></highlight></codeline>
<codeline lineno="3456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wl_list_empty(&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;compositor-&gt;output_list))</highlight></codeline>
<codeline lineno="3457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglMakeCurrent(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref>,</highlight></codeline>
<codeline lineno="3458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref>,<sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref>);</highlight></codeline>
<codeline lineno="3459"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3460"><highlight class="normal"></highlight></codeline>
<codeline lineno="3461"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3462"><highlight class="normal"><ref refid="gl-renderer_8c_1aa49e459d45b4a61c1d07d1efbd4f7213" kindref="member">gl_renderer_create_pbuffer_surface</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr)<sp/>{</highlight></codeline>
<codeline lineno="3463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a691766e6d867e15207ec0a6d6e46253c" kindref="member">EGLConfig</ref><sp/>pbuffer_config;</highlight></codeline>
<codeline lineno="3464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>pbuffer_attribs[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="3465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_WIDTH,<sp/>10,</highlight></codeline>
<codeline lineno="3466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_HEIGHT,<sp/>10,</highlight></codeline>
<codeline lineno="3467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NONE</highlight></codeline>
<codeline lineno="3468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="3469"><highlight class="normal"></highlight></codeline>
<codeline lineno="3470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_config<sp/>=<sp/>gr-&gt;<ref refid="structgl__renderer_1a8c2e208b8924439784d376e3c9ba4c78" kindref="member">egl_config</ref>;</highlight></codeline>
<codeline lineno="3471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pbuffer_config<sp/>==<sp/>EGL_NO_CONFIG_KHR)<sp/>{</highlight></codeline>
<codeline lineno="3472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_config<sp/>=</highlight></codeline>
<codeline lineno="3473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1ae5511db4c1a81d3592bd2495729d87db" kindref="member">gl_renderer_get_egl_config</ref>(gr,<sp/><ref refid="gl-renderer_8h_1ace4c8dbcd8e4e41ea1fe7b4b6c4c280e" kindref="member">EGL_PBUFFER_BIT</ref>,</highlight></codeline>
<codeline lineno="3474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL,<sp/>0);</highlight></codeline>
<codeline lineno="3475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pbuffer_config<sp/>==<sp/>EGL_NO_CONFIG_KHR)<sp/>{</highlight></codeline>
<codeline lineno="3477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>choose<sp/>EGL<sp/>config<sp/>for<sp/>PbufferSurface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3480"><highlight class="normal"></highlight></codeline>
<codeline lineno="3481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref><sp/>=<sp/>eglCreatePbufferSurface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_config,</highlight></codeline>
<codeline lineno="3483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pbuffer_attribs);</highlight></codeline>
<codeline lineno="3484"><highlight class="normal"></highlight></codeline>
<codeline lineno="3485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref><sp/>==<sp/>EGL_NO_SURFACE)<sp/>{</highlight></codeline>
<codeline lineno="3486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>create<sp/>PbufferSurface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3489"><highlight class="normal"></highlight></codeline>
<codeline lineno="3490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="3491"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3492"><highlight class="normal"></highlight></codeline>
<codeline lineno="3493"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3494"><highlight class="normal"><ref refid="gl-renderer_8c_1aa24f0204f154a5eabb1fcca2652e77b6" kindref="member">gl_renderer_display_create</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec,</highlight></codeline>
<codeline lineno="3495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structgl__renderer__display__options" kindref="compound">gl_renderer_display_options</ref><sp/>*options)</highlight></codeline>
<codeline lineno="3496"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr;</highlight></codeline>
<codeline lineno="3498"><highlight class="normal"></highlight></codeline>
<codeline lineno="3499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr<sp/>=<sp/><ref refid="zalloc_8h_1a260ac290b02627b12230b313c8fa92b3" kindref="member">zalloc</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>*gr);</highlight></codeline>
<codeline lineno="3500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr<sp/>==<sp/>NULL)</highlight></codeline>
<codeline lineno="3501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3502"><highlight class="normal"></highlight></codeline>
<codeline lineno="3503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref><sp/>=<sp/>ec;</highlight></codeline>
<codeline lineno="3504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;gr-&gt;<ref refid="structgl__renderer_1a52539b172c96178779b6cba4061ef83d" kindref="member">shader_list</ref>);</highlight></codeline>
<codeline lineno="3505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1abb719fa4fbd1d18122e43d5db16c9b93" kindref="member">platform</ref><sp/>=<sp/>options-&gt;<ref refid="structgl__renderer__display__options_1af7b55369e1f51f0a3f67a16c0301f6d5" kindref="member">egl_platform</ref>;</highlight></codeline>
<codeline lineno="3506"><highlight class="normal"></highlight></codeline>
<codeline lineno="3507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a25b6ad5ba07b7cb01a6aa7bda56a2b3b" kindref="member">shader_scope</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a0e92bc7b7c116c4d569208e27c672805" kindref="member">gl_shader_scope_create</ref>(gr);</highlight></codeline>
<codeline lineno="3508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a25b6ad5ba07b7cb01a6aa7bda56a2b3b" kindref="member">shader_scope</ref>)</highlight></codeline>
<codeline lineno="3509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail;</highlight></codeline>
<codeline lineno="3510"><highlight class="normal"></highlight></codeline>
<codeline lineno="3511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="egl-glue_8c_1a33e7b0df8f1ef7c78deb5bc0320f8741" kindref="member">gl_renderer_setup_egl_client_extensions</ref>(gr)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="3512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail;</highlight></codeline>
<codeline lineno="3513"><highlight class="normal"></highlight></codeline>
<codeline lineno="3514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a3efd939e39ab8b4347efb4152e8a5a56" kindref="member">read_pixels</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a27c525c114d7039365db4b428b64cb59" kindref="member">gl_renderer_read_pixels</ref>;</highlight></codeline>
<codeline lineno="3515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a3d20edac64ed4e94abf90c3c83479f2e" kindref="member">repaint_output</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a34db4fc09924159f0101aafee06c64ca" kindref="member">gl_renderer_repaint_output</ref>;</highlight></codeline>
<codeline lineno="3516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1ad8200fad4388d10fe23aedfb1ac12acc" kindref="member">flush_damage</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ab9a84e745915a5667f066e510a9621da" kindref="member">gl_renderer_flush_damage</ref>;</highlight></codeline>
<codeline lineno="3517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a7ecf9b1c4c4deff1880e666fce7be112" kindref="member">attach</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a3eed0faf6171d0306e4f45ab1f4f809d" kindref="member">gl_renderer_attach</ref>;</highlight></codeline>
<codeline lineno="3518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a43e96c783c72c2da5d11fb40a18fc6d9" kindref="member">surface_set_color</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ab63554e4caedb0a18300ec685a7e3f10" kindref="member">gl_renderer_surface_set_color</ref>;</highlight></codeline>
<codeline lineno="3519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1ae0cf2b9ed74efb4f619b4b5e2b84d9fd" kindref="member">destroy</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1af62a76e37d4c9106c6ef65a389b422ef" kindref="member">gl_renderer_destroy</ref>;</highlight></codeline>
<codeline lineno="3520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a5354db09e69ed5743a59f7ed80fd6bc0" kindref="member">surface_get_content_size</ref><sp/>=</highlight></codeline>
<codeline lineno="3521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a525424c31f88ecea126e2d4cfb0d7741" kindref="member">gl_renderer_surface_get_content_size</ref>;</highlight></codeline>
<codeline lineno="3522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1afcc57b0d929767f57e20b9e5d68f9dee" kindref="member">surface_copy_content</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a64d6965a90d20b5725f85a92c80d9227" kindref="member">gl_renderer_surface_copy_content</ref>;</highlight></codeline>
<codeline lineno="3523"><highlight class="normal"></highlight></codeline>
<codeline lineno="3524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="egl-glue_8c_1a4d813bed8f56cc160bcb91117b055d76" kindref="member">gl_renderer_setup_egl_display</ref>(gr,<sp/>options-&gt;<ref refid="structgl__renderer__display__options_1a6a693604b69d3984cce8a6139d50dcb1" kindref="member">egl_native_display</ref>)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="3525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail;</highlight></codeline>
<codeline lineno="3526"><highlight class="normal"></highlight></codeline>
<codeline lineno="3527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ab0422d657ecad7e39c475667db67a085" kindref="member">log_egl_info</ref>(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>);</highlight></codeline>
<codeline lineno="3528"><highlight class="normal"></highlight></codeline>
<codeline lineno="3529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1adfa35d8b6ef4bac08ccecbbd37acb81d" kindref="member">renderer</ref><sp/>=<sp/>&amp;gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="3530"><highlight class="normal"></highlight></codeline>
<codeline lineno="3531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="egl-glue_8c_1a417380db73cd0f35af5925c8696728af" kindref="member">gl_renderer_setup_egl_extensions</ref>(ec)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="3532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail_with_error;</highlight></codeline>
<codeline lineno="3533"><highlight class="normal"></highlight></codeline>
<codeline lineno="3534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a950ceb1910c71cb4a22b6adbfe33d1ba" kindref="member">has_configless_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>egl_surface_type<sp/>=<sp/>options-&gt;<ref refid="structgl__renderer__display__options_1a18b0a47d9c26c392ebff6f2e755a6812" kindref="member">egl_surface_type</ref>;</highlight></codeline>
<codeline lineno="3536"><highlight class="normal"></highlight></codeline>
<codeline lineno="3537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a40cc8abffa0ad500044b1c86d6111601" kindref="member">has_surfaceless_context</ref>)</highlight></codeline>
<codeline lineno="3538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_surface_type<sp/>|=<sp/><ref refid="gl-renderer_8h_1ace4c8dbcd8e4e41ea1fe7b4b6c4c280e" kindref="member">EGL_PBUFFER_BIT</ref>;</highlight></codeline>
<codeline lineno="3539"><highlight class="normal"></highlight></codeline>
<codeline lineno="3540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a8c2e208b8924439784d376e3c9ba4c78" kindref="member">egl_config</ref><sp/>=</highlight></codeline>
<codeline lineno="3541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1ae5511db4c1a81d3592bd2495729d87db" kindref="member">gl_renderer_get_egl_config</ref>(gr,</highlight></codeline>
<codeline lineno="3542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_surface_type,</highlight></codeline>
<codeline lineno="3543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__display__options_1a3c7f40c55bfef4ba47c355334fb226d4" kindref="member">drm_formats</ref>,</highlight></codeline>
<codeline lineno="3544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options-&gt;<ref refid="structgl__renderer__display__options_1a1a8c93300796002b03508506b7139afc" kindref="member">drm_formats_count</ref>);</highlight></codeline>
<codeline lineno="3545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a8c2e208b8924439784d376e3c9ba4c78" kindref="member">egl_config</ref><sp/>==<sp/>EGL_NO_CONFIG_KHR)<sp/>{</highlight></codeline>
<codeline lineno="3546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>choose<sp/>EGL<sp/>config\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail_terminate;</highlight></codeline>
<codeline lineno="3548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3550"><highlight class="normal"></highlight></codeline>
<codeline lineno="3551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a5be5c87f03fcdbc3aa7c456ebb96e4aa" kindref="member">capabilities</ref><sp/>|=<sp/><ref refid="libweston_8h_1a4d5e112f3ecc541323c729709ea9ee2dacfc07a33167b2f9438c61a8aa70bc11a" kindref="member">WESTON_CAP_ROTATION_ANY</ref>;</highlight></codeline>
<codeline lineno="3552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a5be5c87f03fcdbc3aa7c456ebb96e4aa" kindref="member">capabilities</ref><sp/>|=<sp/><ref refid="libweston_8h_1a4d5e112f3ecc541323c729709ea9ee2da8c6fa756c17911d39750f20b0270302f" kindref="member">WESTON_CAP_CAPTURE_YFLIP</ref>;</highlight></codeline>
<codeline lineno="3553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a5be5c87f03fcdbc3aa7c456ebb96e4aa" kindref="member">capabilities</ref><sp/>|=<sp/><ref refid="libweston_8h_1a4d5e112f3ecc541323c729709ea9ee2da9d3b76d6c75b519426aa5a4b8571b500" kindref="member">WESTON_CAP_VIEW_CLIP_MASK</ref>;</highlight></codeline>
<codeline lineno="3554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a565fad372070dd5710626b6a7c1fea5c" kindref="member">has_native_fence_sync</ref><sp/>&amp;&amp;<sp/>gr-&gt;<ref refid="structgl__renderer_1a76861d99667a14188420258b48f8f1f1" kindref="member">has_wait_sync</ref>)</highlight></codeline>
<codeline lineno="3555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a5be5c87f03fcdbc3aa7c456ebb96e4aa" kindref="member">capabilities</ref><sp/>|=<sp/><ref refid="libweston_8h_1a4d5e112f3ecc541323c729709ea9ee2dac0105501579ea73b78960706632814a9" kindref="member">WESTON_CAP_EXPLICIT_SYNC</ref>;</highlight></codeline>
<codeline lineno="3556"><highlight class="normal"></highlight></codeline>
<codeline lineno="3557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;gr-&gt;<ref refid="structgl__renderer_1ae2ab6672ea88406c24ba67d39a85c7d3" kindref="member">dmabuf_images</ref>);</highlight></codeline>
<codeline lineno="3558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a3b0d80c232031cb4794dc6d1663dfad3" kindref="member">has_dmabuf_import</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a5999bb29493d522ddcff40318e677e2d" kindref="member">import_dmabuf</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1a372d17adc0006b25c14b1b4cef44ea35" kindref="member">gl_renderer_import_dmabuf</ref>;</highlight></codeline>
<codeline lineno="3560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a45313a51035c0cda9938cc53bc843dbe" kindref="member">query_dmabuf_formats</ref><sp/>=</highlight></codeline>
<codeline lineno="3561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a97ae83f934c4ca1f9ed56bc303da1fd2" kindref="member">gl_renderer_query_dmabuf_formats</ref>;</highlight></codeline>
<codeline lineno="3562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac378dee768bb889023f289e8c90ad69d" kindref="member">base</ref>.<ref refid="structweston__renderer_1a2df7097f45e9c4b14ec943033e974383" kindref="member">query_dmabuf_modifiers</ref><sp/>=</highlight></codeline>
<codeline lineno="3563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a4ea2f687149f0196c66bb147c16e350f" kindref="member">gl_renderer_query_dmabuf_modifiers</ref>;</highlight></codeline>
<codeline lineno="3564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;gr-&gt;<ref refid="structgl__renderer_1a8a61c9d9da383117bd578c325b81db91" kindref="member">dmabuf_formats</ref>);</highlight></codeline>
<codeline lineno="3566"><highlight class="normal"></highlight></codeline>
<codeline lineno="3567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a40cc8abffa0ad500044b1c86d6111601" kindref="member">has_surfaceless_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;EGL_KHR_surfaceless_context<sp/>available\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref><sp/>=<sp/>EGL_NO_SURFACE;</highlight></codeline>
<codeline lineno="3570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="3571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;EGL_KHR_surfaceless_context<sp/>unavailable.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Trying<sp/>PbufferSurface\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3573"><highlight class="normal"></highlight></codeline>
<codeline lineno="3574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1aa49e459d45b4a61c1d07d1efbd4f7213" kindref="member">gl_renderer_create_pbuffer_surface</ref>(gr)<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="3575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail_with_error;</highlight></codeline>
<codeline lineno="3576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3577"><highlight class="normal"></highlight></codeline>
<codeline lineno="3578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_display_add_shm_format(ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>,<sp/>WL_SHM_FORMAT_RGB565);</highlight></codeline>
<codeline lineno="3579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_display_add_shm_format(ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>,<sp/>WL_SHM_FORMAT_YUV420);</highlight></codeline>
<codeline lineno="3580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_display_add_shm_format(ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>,<sp/>WL_SHM_FORMAT_NV12);</highlight></codeline>
<codeline lineno="3581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_display_add_shm_format(ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>,<sp/>WL_SHM_FORMAT_YUYV);</highlight></codeline>
<codeline lineno="3582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_display_add_shm_format(ec-&gt;<ref refid="structweston__compositor_1a2ad81ce6f58ba42026cd6d86d5f88c8b" kindref="member">wl_display</ref>,<sp/>WL_SHM_FORMAT_XYUV8888);</highlight></codeline>
<codeline lineno="3583"><highlight class="normal"></highlight></codeline>
<codeline lineno="3584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_init(&amp;gr-&gt;<ref refid="structgl__renderer_1ae237cc3a53f93ac46fefb37e3e3589a7" kindref="member">destroy_signal</ref>);</highlight></codeline>
<codeline lineno="3585"><highlight class="normal"></highlight></codeline>
<codeline lineno="3586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gl-renderer_8c_1a6c4d504b0e8768523a1e604ca3d4ce5e" kindref="member">gl_renderer_setup</ref>(ec,<sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="3587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref><sp/>!=<sp/>EGL_NO_SURFACE)</highlight></codeline>
<codeline lineno="3588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>weston_platform_destroy_egl_surface(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ac6e67a3e0e48848dc5e8296bdbfd856d" kindref="member">dummy_surface</ref>);</highlight></codeline>
<codeline lineno="3590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fail_with_error;</highlight></codeline>
<codeline lineno="3591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3592"><highlight class="normal"></highlight></codeline>
<codeline lineno="3593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="3594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a5be5c87f03fcdbc3aa7c456ebb96e4aa" kindref="member">capabilities</ref><sp/>|=<sp/><ref refid="libweston_8h_1a4d5e112f3ecc541323c729709ea9ee2da1b1e29ae46171ce404f460103204ce98" kindref="member">WESTON_CAP_COLOR_OPS</ref>;</highlight></codeline>
<codeline lineno="3595"><highlight class="normal"></highlight></codeline>
<codeline lineno="3596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="3597"><highlight class="normal"></highlight></codeline>
<codeline lineno="3598"><highlight class="normal">fail_with_error:</highlight></codeline>
<codeline lineno="3599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="3600"><highlight class="normal">fail_terminate:</highlight></codeline>
<codeline lineno="3601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglTerminate(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>);</highlight></codeline>
<codeline lineno="3602"><highlight class="normal">fail:</highlight></codeline>
<codeline lineno="3603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structweston__log__scope_1a32ad399b7e203a9ad0a5a11cdd0711ce" kindref="member">weston_log_scope_destroy</ref>(gr-&gt;<ref refid="structgl__renderer_1a25b6ad5ba07b7cb01a6aa7bda56a2b3b" kindref="member">shader_scope</ref>);</highlight></codeline>
<codeline lineno="3604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(gr);</highlight></codeline>
<codeline lineno="3605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1adfa35d8b6ef4bac08ccecbbd37acb81d" kindref="member">renderer</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="3606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3607"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3608"><highlight class="normal"></highlight></codeline>
<codeline lineno="3609"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3610"><highlight class="normal"><ref refid="gl-renderer_8c_1a012bbe33b1a7b945671bbe164c5589e3" kindref="member">fragment_debug_binding</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__keyboard" kindref="compound">weston_keyboard</ref><sp/>*<ref refid="structkeyboard" kindref="compound">keyboard</ref>,</highlight></codeline>
<codeline lineno="3611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>timespec<sp/>*time,</highlight></codeline>
<codeline lineno="3612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>key,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3613"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="3615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="3616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>;</highlight></codeline>
<codeline lineno="3617"><highlight class="normal"></highlight></codeline>
<codeline lineno="3618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1aa4a0bc78bd4d1c8568c0cb561ecc1e13" kindref="member">fragment_shader_debug</ref><sp/>=<sp/>!gr-&gt;<ref refid="structgl__renderer_1aa4a0bc78bd4d1c8568c0cb561ecc1e13" kindref="member">fragment_shader_debug</ref>;</highlight></codeline>
<codeline lineno="3619"><highlight class="normal"></highlight></codeline>
<codeline lineno="3620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>&amp;ec-&gt;<ref refid="structweston__compositor_1a581453fe2554be5647e5ecae8f9b99ba" kindref="member">output_list</ref>,<sp/><ref refid="structweston__output_1ac8d0528e465546f7c9074c8319215986" kindref="member">link</ref>)</highlight></codeline>
<codeline lineno="3621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__output_1gab45be972c9a7bf6c86c6ca8db03034f2" kindref="member">weston_output_damage</ref>(<ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="3622"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3623"><highlight class="normal"></highlight></codeline>
<codeline lineno="3624"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3625"><highlight class="normal"><ref refid="gl-renderer_8c_1ac655204cf05c02ce3055efae15cefa70" kindref="member">fan_debug_repaint_binding</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__keyboard" kindref="compound">weston_keyboard</ref><sp/>*<ref refid="structkeyboard" kindref="compound">keyboard</ref>,</highlight></codeline>
<codeline lineno="3626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>timespec<sp/>*time,</highlight></codeline>
<codeline lineno="3627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>key,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="3628"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*compositor<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="3630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref>);</highlight></codeline>
<codeline lineno="3631"><highlight class="normal"></highlight></codeline>
<codeline lineno="3632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref><sp/>=<sp/>!gr-&gt;<ref refid="structgl__renderer_1a1a517029f6ac148694f2af12f3c27ccb" kindref="member">fan_debug</ref>;</highlight></codeline>
<codeline lineno="3633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__compositor_1ga674d4dd1642c36ca73a7ddc246a4b411" kindref="member">weston_compositor_damage_all</ref>(<ref refid="structgl__renderer_1a5977b06a8c8532933e1a8de908cf05b0" kindref="member">compositor</ref>);</highlight></codeline>
<codeline lineno="3634"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3635"><highlight class="normal"></highlight></codeline>
<codeline lineno="3636"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t</highlight></codeline>
<codeline lineno="3637"><highlight class="normal"><ref refid="gl-renderer_8c_1ac83b8846440f9c04f8e527ffa2c0fa93" kindref="member">get_gl_version</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3638"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*version;</highlight></codeline>
<codeline lineno="3640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>major,<sp/>minor;</highlight></codeline>
<codeline lineno="3641"><highlight class="normal"></highlight></codeline>
<codeline lineno="3642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)<sp/>glGetString(GL_VERSION);</highlight></codeline>
<codeline lineno="3643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(version<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="3644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(sscanf(version,<sp/></highlight><highlight class="stringliteral">&quot;%d.%d&quot;</highlight><highlight class="normal">,<sp/>&amp;major,<sp/>&amp;minor)<sp/>==<sp/>2<sp/>||</highlight></codeline>
<codeline lineno="3645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sscanf(version,<sp/></highlight><highlight class="stringliteral">&quot;OpenGL<sp/>ES<sp/>%d.%d&quot;</highlight><highlight class="normal">,<sp/>&amp;major,<sp/>&amp;minor)<sp/>==<sp/>2)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="3646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>major<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>minor<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="3647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(major,<sp/>minor);</highlight></codeline>
<codeline lineno="3648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3649"><highlight class="normal"></highlight></codeline>
<codeline lineno="3650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;warning:<sp/>failed<sp/>to<sp/>detect<sp/>GLES<sp/>version,<sp/>defaulting<sp/>to<sp/>2.0.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(2,<sp/>0);</highlight></codeline>
<codeline lineno="3652"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3653"><highlight class="normal"></highlight></codeline>
<codeline lineno="3654"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3655"><highlight class="normal"><ref refid="gl-renderer_8c_1a6c4d504b0e8768523a1e604ca3d4ce5e" kindref="member">gl_renderer_setup</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__compositor" kindref="compound">weston_compositor</ref><sp/>*ec,<sp/><ref refid="gl-renderer_8h_1a1bd45435703af31ea10bc2f2229f337b" kindref="member">EGLSurface</ref><sp/>egl_surface)</highlight></codeline>
<codeline lineno="3656"><highlight class="normal">{</highlight></codeline>
<codeline lineno="3657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer" kindref="compound">gl_renderer</ref><sp/>*gr<sp/>=<sp/><ref refid="pixman-renderer_8c_1a1792b3bc4ed547807311306aea0db524" kindref="member">get_renderer</ref>(ec);</highlight></codeline>
<codeline lineno="3658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extensions;</highlight></codeline>
<codeline lineno="3659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGLBoolean<sp/>ret;</highlight></codeline>
<codeline lineno="3660"><highlight class="normal"></highlight></codeline>
<codeline lineno="3661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>context_attribs[16]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="3662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_CONTEXT_CLIENT_VERSION,<sp/>0,</highlight></codeline>
<codeline lineno="3663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="3664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nattr<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="3665"><highlight class="normal"></highlight></codeline>
<codeline lineno="3666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!eglBindAPI(EGL_OPENGL_ES_API))<sp/>{</highlight></codeline>
<codeline lineno="3667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>bind<sp/>EGL_OPENGL_ES_API\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="3669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3671"><highlight class="normal"></highlight></codeline>
<codeline lineno="3672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="3673"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Being<sp/>the<sp/>compositor<sp/>we<sp/>require<sp/>minimum<sp/>output<sp/>latency,</highlight></codeline>
<codeline lineno="3674"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>so<sp/>request<sp/>a<sp/>high<sp/>priority<sp/>context<sp/>for<sp/>ourselves<sp/>-<sp/>that<sp/>should</highlight></codeline>
<codeline lineno="3675"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>reschedule<sp/>all<sp/>of<sp/>our<sp/>rendering<sp/>and<sp/>its<sp/>dependencies<sp/>to<sp/>be<sp/>completed</highlight></codeline>
<codeline lineno="3676"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>first.<sp/>If<sp/>the<sp/>driver<sp/>doesn&apos;t<sp/>permit<sp/>us<sp/>to<sp/>create<sp/>a<sp/>high<sp/>priority</highlight></codeline>
<codeline lineno="3677"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>context,<sp/>it<sp/>will<sp/>fallback<sp/>to<sp/>the<sp/>default<sp/>priority<sp/>(MEDIUM).</highlight></codeline>
<codeline lineno="3678"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a6c5ea920e1dca4a88d07314980d01155" kindref="member">has_context_priority</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs[nattr++]<sp/>=<sp/>EGL_CONTEXT_PRIORITY_LEVEL_IMG;</highlight></codeline>
<codeline lineno="3681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs[nattr++]<sp/>=<sp/>EGL_CONTEXT_PRIORITY_HIGH_IMG;</highlight></codeline>
<codeline lineno="3682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3683"><highlight class="normal"></highlight></codeline>
<codeline lineno="3684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(nattr<sp/>&lt;<sp/>ARRAY_LENGTH(context_attribs));</highlight></codeline>
<codeline lineno="3685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs[nattr]<sp/>=<sp/>EGL_NONE;</highlight></codeline>
<codeline lineno="3686"><highlight class="normal"></highlight></codeline>
<codeline lineno="3687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>try<sp/>to<sp/>create<sp/>an<sp/>OpenGLES<sp/>3<sp/>context<sp/>first<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs[1]<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="3689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref><sp/>=<sp/>eglCreateContext(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>gr-&gt;<ref refid="structgl__renderer_1a8c2e208b8924439784d376e3c9ba4c78" kindref="member">egl_config</ref>,</highlight></codeline>
<codeline lineno="3690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_CONTEXT,<sp/>context_attribs);</highlight></codeline>
<codeline lineno="3691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref><sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="3692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>and<sp/>then<sp/>fallback<sp/>to<sp/>OpenGLES<sp/>2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs[1]<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="3694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref><sp/>=<sp/>eglCreateContext(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,</highlight></codeline>
<codeline lineno="3695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a8c2e208b8924439784d376e3c9ba4c78" kindref="member">egl_config</ref>,</highlight></codeline>
<codeline lineno="3696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_NO_CONTEXT,</highlight></codeline>
<codeline lineno="3697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>context_attribs);</highlight></codeline>
<codeline lineno="3698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref><sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="3699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>create<sp/>context\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="3701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3704"><highlight class="normal"></highlight></codeline>
<codeline lineno="3705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a6c5ea920e1dca4a88d07314980d01155" kindref="member">has_context_priority</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8h_1a97030274d045a36c550fc0d66d26f175" kindref="member">EGLint</ref><sp/>value<sp/>=<sp/>EGL_CONTEXT_PRIORITY_MEDIUM_IMG;</highlight></codeline>
<codeline lineno="3707"><highlight class="normal"></highlight></codeline>
<codeline lineno="3708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eglQueryContext(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref>,</highlight></codeline>
<codeline lineno="3709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EGL_CONTEXT_PRIORITY_LEVEL_IMG,<sp/>&amp;value);</highlight></codeline>
<codeline lineno="3710"><highlight class="normal"></highlight></codeline>
<codeline lineno="3711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(value<sp/>!=<sp/>EGL_CONTEXT_PRIORITY_HIGH_IMG)<sp/>{</highlight></codeline>
<codeline lineno="3712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>obtain<sp/>a<sp/>high<sp/>priority<sp/>context.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Not<sp/>an<sp/>error,<sp/>continue<sp/>on<sp/>as<sp/>normal<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3716"><highlight class="normal"></highlight></codeline>
<codeline lineno="3717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>eglMakeCurrent(gr-&gt;<ref refid="structgl__renderer_1a1f947120866d14d1a6162b22d074143f" kindref="member">egl_display</ref>,<sp/>egl_surface,</highlight></codeline>
<codeline lineno="3718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>egl_surface,<sp/>gr-&gt;<ref refid="structgl__renderer_1a49844e2bfbc88be8c84276d2e0b8a676" kindref="member">egl_context</ref>);</highlight></codeline>
<codeline lineno="3719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>EGL_FALSE)<sp/>{</highlight></codeline>
<codeline lineno="3720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>make<sp/>EGL<sp/>context<sp/>current.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="egl-glue_8c_1a8287ddea4cec5bbe06280f48c83ca0c2" kindref="member">gl_renderer_print_egl_error_state</ref>();</highlight></codeline>
<codeline lineno="3722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3724"><highlight class="normal"></highlight></codeline>
<codeline lineno="3725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1ac83b8846440f9c04f8e527ffa2c0fa93" kindref="member">get_gl_version</ref>();</highlight></codeline>
<codeline lineno="3726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a6de923e3da984b708ab8e38b70477225" kindref="member">log_gl_info</ref>();</highlight></codeline>
<codeline lineno="3727"><highlight class="normal"></highlight></codeline>
<codeline lineno="3728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1f32740854364dc4e30784c73689e8ec" kindref="member">image_target_texture_2d</ref><sp/>=</highlight></codeline>
<codeline lineno="3729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*)<sp/>eglGetProcAddress(</highlight><highlight class="stringliteral">&quot;glEGLImageTargetTexture2DOES&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3730"><highlight class="normal"></highlight></codeline>
<codeline lineno="3731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>extensions<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)<sp/>glGetString(GL_EXTENSIONS);</highlight></codeline>
<codeline lineno="3732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!extensions)<sp/>{</highlight></codeline>
<codeline lineno="3733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Retrieving<sp/>GL<sp/>extension<sp/>string<sp/>failed.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3736"><highlight class="normal"></highlight></codeline>
<codeline lineno="3737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_EXT_texture_format_BGRA8888&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="3738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL_EXT_texture_format_BGRA8888<sp/>not<sp/>available\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3741"><highlight class="normal"></highlight></codeline>
<codeline lineno="3742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_EXT_read_format_bgra&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="3743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a974cb74b7d8dd5117a8e98d363d341c3" kindref="member">read_format</ref><sp/>=<sp/>PIXMAN_a8r8g8b8;</highlight></codeline>
<codeline lineno="3744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a974cb74b7d8dd5117a8e98d363d341c3" kindref="member">read_format</ref><sp/>=<sp/>PIXMAN_a8b8g8r8;</highlight></codeline>
<codeline lineno="3746"><highlight class="normal"></highlight></codeline>
<codeline lineno="3747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref><sp/>&lt;<sp/><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(3,<sp/>0)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="3748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_EXT_unpack_subimage&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="3749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL_EXT_unpack_subimage<sp/>not<sp/>available.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3752"><highlight class="normal"></highlight></codeline>
<codeline lineno="3753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref><sp/>&gt;=<sp/><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(3,<sp/>0)<sp/>||</highlight></codeline>
<codeline lineno="3754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_EXT_texture_rg&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="3755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ab7dea4c1aeae5e868a156df8480facf6" kindref="member">has_gl_texture_rg</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="3756"><highlight class="normal"></highlight></codeline>
<codeline lineno="3757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_OES_EGL_image_external&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="3758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a806ded7ab986e210361c1c00f18c2e9f" kindref="member">has_egl_image_external</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="3759"><highlight class="normal"></highlight></codeline>
<codeline lineno="3760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_EXT_color_buffer_half_float&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="3761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref><sp/>&gt;=<sp/><ref refid="gl-renderer_8c_1a873702a8c842a16bacda706188dff6e3" kindref="member">gr_gl_version</ref>(3,<sp/>0))</highlight></codeline>
<codeline lineno="3762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref><sp/>=<sp/>GL_HALF_FLOAT;</highlight></codeline>
<codeline lineno="3763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(weston_check_egl_extension(extensions,<sp/></highlight><highlight class="stringliteral">&quot;GL_OES_texture_half_float&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="3764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a3b9ac6c2ecfa1e56308aa90531626f2e" kindref="member">gl_half_float_type</ref><sp/>=<sp/>GL_HALF_FLOAT_OES;</highlight></codeline>
<codeline lineno="3765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3766"><highlight class="normal"></highlight></codeline>
<codeline lineno="3767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glActiveTexture(GL_TEXTURE0);</highlight></codeline>
<codeline lineno="3768"><highlight class="normal"></highlight></codeline>
<codeline lineno="3769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a7bd95f699444ea14e713dba46a17c7e9" kindref="member">fallback_shader</ref><sp/>=<sp/><ref refid="gl-renderer-internal_8h_1a9838cc6ca8dacc9a830f36e5396572c8" kindref="member">gl_renderer_create_fallback_shader</ref>(gr);</highlight></codeline>
<codeline lineno="3770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!gr-&gt;<ref refid="structgl__renderer_1a7bd95f699444ea14e713dba46a17c7e9" kindref="member">fallback_shader</ref>)<sp/>{</highlight></codeline>
<codeline lineno="3771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Error:<sp/>compiling<sp/>fallback<sp/>shader<sp/>failed.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="3773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="3774"><highlight class="normal"></highlight></codeline>
<codeline lineno="3775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a19a35e83389dac2b135df4f7d6851f71" kindref="member">fragment_binding</ref><sp/>=</highlight></codeline>
<codeline lineno="3776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bindings_8c_1a6f638fc0804cf27ddd04859ed4fbf9c3" kindref="member">weston_compositor_add_debug_binding</ref>(ec,<sp/>KEY_S,</highlight></codeline>
<codeline lineno="3777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a012bbe33b1a7b945671bbe164c5589e3" kindref="member">fragment_debug_binding</ref>,</highlight></codeline>
<codeline lineno="3778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec);</highlight></codeline>
<codeline lineno="3779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1a1c5d444052ce2cc91f4393015e446000" kindref="member">fan_binding</ref><sp/>=</highlight></codeline>
<codeline lineno="3780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bindings_8c_1a6f638fc0804cf27ddd04859ed4fbf9c3" kindref="member">weston_compositor_add_debug_binding</ref>(ec,<sp/>KEY_F,</highlight></codeline>
<codeline lineno="3781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1ac655204cf05c02ce3055efae15cefa70" kindref="member">fan_debug_repaint_binding</ref>,</highlight></codeline>
<codeline lineno="3782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec);</highlight></codeline>
<codeline lineno="3783"><highlight class="normal"></highlight></codeline>
<codeline lineno="3784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1ad238bebdd3aa0dea7602024e02f7dbad" kindref="member">output_destroy_listener</ref>.notify<sp/>=<sp/><ref refid="gl-renderer_8c_1a1ecf85e437a88a60b1a36825ce407b1c" kindref="member">output_handle_destroy</ref>;</highlight></codeline>
<codeline lineno="3785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_signal_add(&amp;ec-&gt;<ref refid="structweston__compositor_1ab1912e258bec64ce232b91caa3e54363" kindref="member">output_destroyed_signal</ref>,</highlight></codeline>
<codeline lineno="3786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;gr-&gt;<ref refid="structgl__renderer_1ad238bebdd3aa0dea7602024e02f7dbad" kindref="member">output_destroy_listener</ref>);</highlight></codeline>
<codeline lineno="3787"><highlight class="normal"></highlight></codeline>
<codeline lineno="3788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;GL<sp/>ES<sp/>%d.%d<sp/>-<sp/>renderer<sp/>features:\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1a690ae1156bf3548155179290fb0ef86f" kindref="member">gr_gl_version_major</ref>(gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref>),</highlight></codeline>
<codeline lineno="3790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gl-renderer_8c_1aafdd7e372594d386d8ac23f506b0ead1" kindref="member">gr_gl_version_minor</ref>(gr-&gt;<ref refid="structgl__renderer_1a77612987a24c5d5efa75c5136bf37e63" kindref="member">gl_version</ref>));</highlight></codeline>
<codeline lineno="3791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1gaa0016cb4379eb39a57ac3be92f19ffa9" kindref="member">weston_log_continue</ref>(<ref refid="libweston_8h_1a4dcb9f8540ab54e157a5237c5354a203" kindref="member">STAMP_SPACE</ref><sp/></highlight><highlight class="stringliteral">&quot;read-back<sp/>format:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ec-&gt;<ref refid="structweston__compositor_1a974cb74b7d8dd5117a8e98d363d341c3" kindref="member">read_format</ref><sp/>==<sp/>PIXMAN_a8r8g8b8<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;BGRA&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;RGBA&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1gaa0016cb4379eb39a57ac3be92f19ffa9" kindref="member">weston_log_continue</ref>(<ref refid="libweston_8h_1a4dcb9f8540ab54e157a5237c5354a203" kindref="member">STAMP_SPACE</ref><sp/></highlight><highlight class="stringliteral">&quot;EGL<sp/>Wayland<sp/>extension:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="3794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gr-&gt;<ref refid="structgl__renderer_1abc7c3cb9666e78b3c3de6b8d7071b514" kindref="member">has_bind_display</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;yes&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;no&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3795"><highlight class="normal"></highlight></codeline>
<codeline lineno="3796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="3797"><highlight class="normal">}</highlight></codeline>
<codeline lineno="3798"><highlight class="normal"></highlight></codeline>
<codeline lineno="3799"><highlight class="normal">WL_EXPORT<sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgl__renderer__interface" kindref="compound">gl_renderer_interface</ref><sp/><ref refid="structgl__renderer__interface" kindref="compound">gl_renderer_interface</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="3800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structgl__renderer__interface_1ae0141c11b0fe5d0749016b7904513230" kindref="member">display_create</ref><sp/>=<sp/><ref refid="gl-renderer_8c_1aa24f0204f154a5eabb1fcca2652e77b6" kindref="member">gl_renderer_display_create</ref>,</highlight></codeline>
<codeline lineno="3801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_window_create<sp/>=<sp/><ref refid="gl-renderer_8c_1aec7c581b0b5456ce0c465781cc7bbd18" kindref="member">gl_renderer_output_window_create</ref>,</highlight></codeline>
<codeline lineno="3802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_pbuffer_create<sp/>=<sp/><ref refid="gl-renderer_8c_1afbd97b5e78fed70df49d4598d28490ef" kindref="member">gl_renderer_output_pbuffer_create</ref>,</highlight></codeline>
<codeline lineno="3803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_destroy<sp/>=<sp/><ref refid="gl-renderer_8c_1ad9ff8094d61d9064badbff54ad29eedb" kindref="member">gl_renderer_output_destroy</ref>,</highlight></codeline>
<codeline lineno="3804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.output_set_border<sp/>=<sp/><ref refid="gl-renderer_8c_1aae880f0fafdc938725ae869db58c554a" kindref="member">gl_renderer_output_set_border</ref>,</highlight></codeline>
<codeline lineno="3805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.create_fence_fd<sp/>=<sp/><ref refid="gl-renderer_8c_1a7461308829b30241ae49a3d796e1c2fc" kindref="member">gl_renderer_create_fence_fd</ref>,</highlight></codeline>
<codeline lineno="3806"><highlight class="normal">};</highlight></codeline>
    </programlisting>
    <location file="/home/lzm/Wayland/weston/libweston/renderer-gl/gl-renderer.c"/>
  </compounddef>
</doxygen>
