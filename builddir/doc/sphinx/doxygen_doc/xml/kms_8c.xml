<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="kms_8c" kind="file" language="C++">
    <compoundname>kms.c</compoundname>
    <includes local="yes">config.h</includes>
    <includes local="no">stdint.h</includes>
    <includes local="no">xf86drm.h</includes>
    <includes local="no">xf86drmMode.h</includes>
    <includes refid="libweston_8h" local="no">libweston/libweston.h</includes>
    <includes refid="backend-drm_8h" local="no">libweston/backend-drm.h</includes>
    <includes local="yes">shared/helpers.h</includes>
    <includes local="yes">shared/weston-drm-fourcc.h</includes>
    <includes refid="drm-internal_8h" local="yes">drm-internal.h</includes>
    <includes refid="pixel-formats_8h" local="yes">pixel-formats.h</includes>
    <includes local="yes">presentation-time-server-protocol.h</includes>
    <incdepgraph>
      <node id="4">
        <label>xf86drm.h</label>
      </node>
      <node id="7">
        <label>stdbool.h</label>
      </node>
      <node id="32">
        <label>stdarg.h</label>
      </node>
      <node id="6">
        <label>libweston/libweston.h</label>
        <link refid="libweston_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>linux/input.h</label>
      </node>
      <node id="37">
        <label>pixel-formats.h</label>
        <link refid="pixel-formats_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>assert.h</label>
      </node>
      <node id="3">
        <label>stdint.h</label>
      </node>
      <node id="29">
        <label>sys/mman.h</label>
      </node>
      <node id="14">
        <label>stdlib.h</label>
      </node>
      <node id="31">
        <label>libweston/weston-log.h</label>
        <link refid="weston-log_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>wayland-server.h</label>
      </node>
      <node id="10">
        <label>xkbcommon/xkbcommon.h</label>
      </node>
      <node id="21">
        <label>errno.h</label>
      </node>
      <node id="24">
        <label>fcntl.h</label>
      </node>
      <node id="20">
        <label>drm-internal.h</label>
        <link refid="drm-internal_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>xf86drmMode.h</label>
      </node>
      <node id="18">
        <label>shared/helpers.h</label>
      </node>
      <node id="17">
        <label>stddef.h</label>
      </node>
      <node id="23">
        <label>string.h</label>
      </node>
      <node id="15">
        <label>libweston/backend-drm.h</label>
        <link refid="backend-drm_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>unistd.h</label>
      </node>
      <node id="19">
        <label>shared/weston-drm-fourcc.h</label>
      </node>
      <node id="16">
        <label>libweston/plugin-registry.h</label>
        <link refid="plugin-registry_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>libweston/zalloc.h</label>
        <link refid="zalloc_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>/home/lzm/Wayland/weston/libweston/backend-drm/kms.c</label>
        <link refid="kms_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
      </node>
      <node id="30">
        <label>libudev.h</label>
      </node>
      <node id="8">
        <label>time.h</label>
      </node>
      <node id="12">
        <label>libweston/matrix.h</label>
        <link refid="matrix_8h"/>
      </node>
      <node id="9">
        <label>pixman.h</label>
      </node>
      <node id="22">
        <label>ctype.h</label>
      </node>
      <node id="39">
        <label>presentation-time-server-protocol.h</label>
      </node>
      <node id="27">
        <label>linux/vt.h</label>
      </node>
      <node id="34">
        <label>libinput-seat.h</label>
        <link refid="libinput-seat_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>libweston-internal.h</label>
        <link refid="libweston-internal_8h"/>
      </node>
      <node id="2">
        <label>config.h</label>
      </node>
      <node id="35">
        <label>backend.h</label>
        <link refid="backend_8h"/>
      </node>
      <node id="33">
        <label>stdio.h</label>
      </node>
      <node id="38">
        <label>inttypes.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="enum">
      <memberdef kind="enum" id="kms_8c_1a3d188a71238375d39ecfe53a041749ed" prot="public" static="no" strong="no">
        <type></type>
        <name>drm_state_apply_mode</name>
        <enumvalue id="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" prot="public">
          <name>DRM_STATE_APPLY_SYNC</name>
          <briefdescription>
<para>state fully processed </para>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" prot="public">
          <name>DRM_STATE_APPLY_ASYNC</name>
          <briefdescription>
<para>state pending event delivery </para>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="kms_8c_1a3d188a71238375d39ecfe53a041749eda99a96cf36762e16e89f055a9babe51a0" prot="public">
          <name>DRM_STATE_TEST_ONLY</name>
          <briefdescription>
<para>test if the state can be applied </para>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
<para>Mode for drm_pending_state_apply and co. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="157" column="26" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="157" bodyend="161"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="kms_8c_1a9a0a3992ee7fbc70bf95039ec518811f" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref></type>
        <definition>struct drm_property_enum_info plane_type_enums[]</definition>
        <argsstring>[]</argsstring>
        <name>plane_type_enums</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa4a2d2b2fe30446398be9ea7ad4bccb9a" kindref="member">WDRM_PLANE_TYPE_PRIMARY</ref>] = {
		.name = &quot;Primary&quot;,
	},
	[WDRM_PLANE_TYPE_OVERLAY] = {
		.name = &quot;Overlay&quot;,
	},
	[WDRM_PLANE_TYPE_CURSOR] = {
		.name = &quot;Cursor&quot;,
	},
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="45" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1afece1e55c7d754994d0c318f6d6498d4" prot="public" static="no" mutable="no">
        <type>const struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref></type>
        <definition>const struct drm_property_info plane_props[]</definition>
        <argsstring>[]</argsstring>
        <name>plane_props</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596baa5105c0b33c6a2dc34f5b841b2fa05c4" kindref="member">WDRM_PLANE_TYPE</ref>] = {
		.name = &quot;type&quot;,
		.enum_values = <ref refid="kms_8c_1a9a0a3992ee7fbc70bf95039ec518811f" kindref="member">plane_type_enums</ref>,
		.num_enum_values = <ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa67cd543c2329ddfd5bb348261e4791d9" kindref="member">WDRM_PLANE_TYPE__COUNT</ref>,
	},
	[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596baa6a42b2c7c3f776db5e3a9bb61134862" kindref="member">WDRM_PLANE_SRC_X</ref>] = { .name = &quot;SRC_X&quot;, },
	[WDRM_PLANE_SRC_Y] = { .name = &quot;SRC_Y&quot;, },
	[WDRM_PLANE_SRC_W] = { .name = &quot;SRC_W&quot;, },
	[WDRM_PLANE_SRC_H] = { .name = &quot;SRC_H&quot;, },
	[WDRM_PLANE_CRTC_X] = { .name = &quot;CRTC_X&quot;, },
	[WDRM_PLANE_CRTC_Y] = { .name = &quot;CRTC_Y&quot;, },
	[WDRM_PLANE_CRTC_W] = { .name = &quot;CRTC_W&quot;, },
	[WDRM_PLANE_CRTC_H] = { .name = &quot;CRTC_H&quot;, },
	[WDRM_PLANE_FB_ID] = { .name = &quot;FB_ID&quot;, },
	[WDRM_PLANE_CRTC_ID] = { .name = &quot;CRTC_ID&quot;, },
	[WDRM_PLANE_IN_FORMATS] = { .name = &quot;IN_FORMATS&quot; },
	[WDRM_PLANE_IN_FENCE_FD] = { .name = &quot;IN_FENCE_FD&quot; },
	[WDRM_PLANE_FB_DAMAGE_CLIPS] = { .name = &quot;FB_DAMAGE_CLIPS&quot; },
	[WDRM_PLANE_ZPOS] = { .name = &quot;zpos&quot; },
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="57" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1a4196bce485e1c70d095c7e8621d3fc4d" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref></type>
        <definition>struct drm_property_enum_info dpms_state_enums[]</definition>
        <argsstring>[]</argsstring>
        <name>dpms_state_enums</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a2dd7311fcdba8c50e0c848526d366457" kindref="member">WDRM_DPMS_STATE_OFF</ref>] = {
		.name = &quot;Off&quot;,
	},
	[WDRM_DPMS_STATE_ON] = {
		.name = &quot;On&quot;,
	},
	[WDRM_DPMS_STATE_STANDBY] = {
		.name = &quot;Standby&quot;,
	},
	[WDRM_DPMS_STATE_SUSPEND] = {
		.name = &quot;Suspend&quot;,
	},
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="79" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1a92216de14c4ddbf8319b2325975711dd" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref></type>
        <definition>struct drm_property_enum_info content_protection_enums[]</definition>
        <argsstring>[]</argsstring>
        <name>content_protection_enums</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62ae146e054e9a83f3343c3870d6acf791d" kindref="member">WDRM_CONTENT_PROTECTION_UNDESIRED</ref>] = {
		.name = &quot;Undesired&quot;,
	},
	[WDRM_CONTENT_PROTECTION_DESIRED] = {
		.name = &quot;Desired&quot;,
	},
	[WDRM_CONTENT_PROTECTION_ENABLED] = {
		.name = &quot;Enabled&quot;,
	},
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="94" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1ada809cd1bd04d3e534cfb1555770d5fb" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref></type>
        <definition>struct drm_property_enum_info hdcp_content_type_enums[]</definition>
        <argsstring>[]</argsstring>
        <name>hdcp_content_type_enums</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a3e4ef5bde37b358fcfa6b57a83ef22c0" kindref="member">WDRM_HDCP_CONTENT_TYPE0</ref>] = {
		.name = &quot;HDCP Type0&quot;,
	},
	[WDRM_HDCP_CONTENT_TYPE1] = {
		.name = &quot;HDCP Type1&quot;,
	},
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="106" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1a8ac5a7393a85482b76ccaa60a1d3b8ad" prot="public" static="no" mutable="no">
        <type>struct <ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref></type>
        <definition>struct drm_property_enum_info panel_orientation_enums[]</definition>
        <argsstring>[]</argsstring>
        <name>panel_orientation_enums</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a42564f64da883c866cf0975335c4b72f" kindref="member">WDRM_PANEL_ORIENTATION_NORMAL</ref>] = { .name = &quot;Normal&quot;, },
	[WDRM_PANEL_ORIENTATION_UPSIDE_DOWN] = { .name = &quot;Upside Down&quot;, },
	[WDRM_PANEL_ORIENTATION_LEFT_SIDE_UP] = { .name = &quot;Left Side Up&quot;, },
	[WDRM_PANEL_ORIENTATION_RIGHT_SIDE_UP] = { .name = &quot;Right Side Up&quot;, },
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="115" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1af6243e82855858b6e4ee9b4fe6551c55" prot="public" static="no" mutable="no">
        <type>const struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref></type>
        <definition>const struct drm_property_info connector_props[]</definition>
        <argsstring>[]</argsstring>
        <name>connector_props</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a519892ddd836449f362f05c4a24db57e" kindref="member">WDRM_CONNECTOR_EDID</ref>] = { .name = &quot;EDID&quot; },
	[WDRM_CONNECTOR_DPMS] = {
		.name = &quot;DPMS&quot;,
		.enum_values = <ref refid="kms_8c_1a4196bce485e1c70d095c7e8621d3fc4d" kindref="member">dpms_state_enums</ref>,
		.num_enum_values = <ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a43cf9f3cbb9371734352b37bb438122b" kindref="member">WDRM_DPMS_STATE__COUNT</ref>,
	},
	[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a56a25fb6bda4f871114c5c6a078dde47" kindref="member">WDRM_CONNECTOR_CRTC_ID</ref>] = { .name = &quot;CRTC_ID&quot;, },
	[WDRM_CONNECTOR_NON_DESKTOP] = { .name = &quot;non-desktop&quot;, },
	[WDRM_CONNECTOR_CONTENT_PROTECTION] = {
		.name = &quot;Content Protection&quot;,
		.enum_values = <ref refid="kms_8c_1a92216de14c4ddbf8319b2325975711dd" kindref="member">content_protection_enums</ref>,
		.num_enum_values = <ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62a7b1dfe7c38f652379ef2f3b7436f1e1b" kindref="member">WDRM_CONTENT_PROTECTION__COUNT</ref>,
	},
	[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>] = {
		.name = &quot;HDCP Content Type&quot;,
		.enum_values = <ref refid="kms_8c_1ada809cd1bd04d3e534cfb1555770d5fb" kindref="member">hdcp_content_type_enums</ref>,
		.num_enum_values = <ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a2c4a92c1cfa764efc6d791109bde5ec3" kindref="member">WDRM_HDCP_CONTENT_TYPE__COUNT</ref>,
	},
	[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a95481a04c83680495ecea913e7b6089a" kindref="member">WDRM_CONNECTOR_PANEL_ORIENTATION</ref>] = {
		.name = &quot;panel orientation&quot;,
		.enum_values = <ref refid="kms_8c_1a8ac5a7393a85482b76ccaa60a1d3b8ad" kindref="member">panel_orientation_enums</ref>,
		.num_enum_values = <ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a824fe5754f312f0c2370d7b598ea034c" kindref="member">WDRM_PANEL_ORIENTATION__COUNT</ref>,
	},
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="122" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="kms_8c_1abb551725d8d78ed1e34a44ccb7bb7616" prot="public" static="no" mutable="no">
        <type>const struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref></type>
        <definition>const struct drm_property_info crtc_props[]</definition>
        <argsstring>[]</argsstring>
        <name>crtc_props</name>
        <initializer>= {
	[<ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7aaa3791b4f16e891397dee4d059009768" kindref="member">WDRM_CRTC_MODE_ID</ref>] = { .name = &quot;MODE_ID&quot;, },
	[WDRM_CRTC_ACTIVE] = { .name = &quot;ACTIVE&quot;, },
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1" column="0" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="148" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="kms_8c_1a10a6cc59b12c55f8350d2dab4f1edb69" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint64_t</type>
        <definition>uint64_t drm_property_get_value</definition>
        <argsstring>(struct drm_property_info *info, const drmModeObjectProperties *props, uint64_t def)</argsstring>
        <name>drm_property_get_value</name>
        <param>
          <type>struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> *</type>
          <declname>info</declname>
        </param>
        <param>
          <type>const drmModeObjectProperties *</type>
          <declname>props</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>def</declname>
        </param>
        <briefdescription>
<para>Get the current value of a KMS property. </para>
        </briefdescription>
        <detaileddescription>
<para>Given a drmModeObjectGetProperties return, as well as the <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> for the target property, return the current value of that property, with an optional default. If the property is a KMS enum type, the return value will be translated into the appropriate internal enum.</para>
<para>If the property is not present, the default value will be returned.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>info</parametername>
</parameternamelist>
<parameterdescription>
<para>Internal structure for property to look up </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>props</parametername>
</parameternamelist>
<parameterdescription>
<para>Raw KMS properties for the target object </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>def</parametername>
</parameternamelist>
<parameterdescription>
<para>Value to return if property is not found </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="178" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="178" bodyend="212"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a2ada0c9369647715fb9a1498f87a5b7e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint64_t *</type>
        <definition>uint64_t* drm_property_get_range_values</definition>
        <argsstring>(struct drm_property_info *info, const drmModeObjectProperties *props)</argsstring>
        <name>drm_property_get_range_values</name>
        <param>
          <type>struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> *</type>
          <declname>info</declname>
        </param>
        <param>
          <type>const drmModeObjectProperties *</type>
          <declname>props</declname>
        </param>
        <briefdescription>
<para>Get the current range values of a KMS property. </para>
        </briefdescription>
        <detaileddescription>
<para>Given a drmModeObjectGetProperties return, as well as the <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> for the target property, return the current range values of that property,</para>
<para>If the property is not present, or there&apos;s no it is not a prop range then NULL will be returned.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>info</parametername>
</parameternamelist>
<parameterdescription>
<para>Internal structure for property to look up </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>props</parametername>
</parameternamelist>
<parameterdescription>
<para>Raw KMS properties for the target object </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="227" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="227" bodyend="248"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a062f3a9fec634be7094540e94021ce18" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void drm_property_info_populate</definition>
        <argsstring>(struct drm_backend *b, const struct drm_property_info *src, struct drm_property_info *info, unsigned int num_infos, drmModeObjectProperties *props)</argsstring>
        <name>drm_property_info_populate</name>
        <param>
          <type>struct <ref refid="structdrm__backend" kindref="compound">drm_backend</ref> *</type>
          <declname>b</declname>
        </param>
        <param>
          <type>const struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> *</type>
          <declname>src</declname>
        </param>
        <param>
          <type>struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> *</type>
          <declname>info</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>num_infos</declname>
        </param>
        <param>
          <type>drmModeObjectProperties *</type>
          <declname>props</declname>
        </param>
        <briefdescription>
<para>Cache DRM property values. </para>
        </briefdescription>
        <detaileddescription>
<para>Update a per-object array of <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> structures, given the DRM properties of the object.</para>
<para>Call this every time an object newly appears (note that only connectors can be hotplugged), the first time it is seen, or when its status changes in a way which invalidates the potential property values (currently, the only case for this is connector hotplug).</para>
<para>This updates the property IDs and enum values within the <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> array.</para>
<para>DRM property enum values are dynamic at runtime; the user must query the property to find out the desired runtime value for a requested string name. Using the &apos;type&apos; field on planes as an example, there is no single hardcoded constant for primary plane types; instead, the property must be queried at runtime to find the value associated with the string &quot;Primary&quot;.</para>
<para>This helper queries and caches the enum values, to allow us to use a set of compile-time-constant enums portably across various implementations. The values given in enum_names are searched for, and stored in the same-indexed field of the map array.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>DRM backend object </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>src</parametername>
</parameternamelist>
<parameterdescription>
<para>DRM property info array to source from </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>info</parametername>
</parameternamelist>
<parameterdescription>
<para>DRM property info array to copy into </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>num_infos</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of entries in the source array </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>props</parametername>
</parameternamelist>
<parameterdescription>
<para>DRM object properties for the object </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="282" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="282" bodyend="391"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1acb923f9ec3b8e49c4a3e6bba2a7ae398" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void drm_property_info_free</definition>
        <argsstring>(struct drm_property_info *info, int num_props)</argsstring>
        <name>drm_property_info_free</name>
        <param>
          <type>struct <ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref> *</type>
          <declname>info</declname>
        </param>
        <param>
          <type>int</type>
          <declname>num_props</declname>
        </param>
        <briefdescription>
<para>Free DRM property information. </para>
        </briefdescription>
        <detaileddescription>
<para>Frees all memory associated with a DRM property info array and zeroes it out, leaving it usable for a further drm_property_info_update() or <ref refid="kms_8c_1acb923f9ec3b8e49c4a3e6bba2a7ae398" kindref="member">drm_property_info_free()</ref>.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>info</parametername>
</parameternamelist>
<parameterdescription>
<para>DRM property info array </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>num_props</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of entries in array to free </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="404" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="404" bodyend="412"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a3a64a4b29a1c2f3b0e05e7d53c847a5a" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>uint32_t *</type>
        <definition>static uint32_t* formats_ptr</definition>
        <argsstring>(struct drm_format_modifier_blob *blob)</argsstring>
        <name>formats_ptr</name>
        <param>
          <type>struct drm_format_modifier_blob *</type>
          <declname>blob</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="415" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="415" bodyend="418"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1ad4e431e7587eefefa3ef0ca1425ecfe9" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>struct drm_format_modifier *</type>
        <definition>static struct drm_format_modifier* modifiers_ptr</definition>
        <argsstring>(struct drm_format_modifier_blob *blob)</argsstring>
        <name>modifiers_ptr</name>
        <param>
          <type>struct drm_format_modifier_blob *</type>
          <declname>blob</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="421" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="421" bodyend="425"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a5411bfbbabbc04a852c2310f4b2fa603" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int drm_plane_populate_formats</definition>
        <argsstring>(struct drm_plane *plane, const drmModePlane *kplane, const drmModeObjectProperties *props, const bool use_modifiers)</argsstring>
        <name>drm_plane_populate_formats</name>
        <param>
          <type>struct <ref refid="structdrm__plane" kindref="compound">drm_plane</ref> *</type>
          <declname>plane</declname>
        </param>
        <param>
          <type>const drmModePlane *</type>
          <declname>kplane</declname>
        </param>
        <param>
          <type>const drmModeObjectProperties *</type>
          <declname>props</declname>
        </param>
        <param>
          <type>const bool</type>
          <declname>use_modifiers</declname>
        </param>
        <briefdescription>
<para>Populates the plane&apos;s formats array, using either the IN_FORMATS blob property (if available), or the plane&apos;s format list if not. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="432" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="432" bodyend="516"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a374934d699770680d5bf3a8f7292e38f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void drm_output_set_gamma</definition>
        <argsstring>(struct weston_output *output_base, uint16_t size, uint16_t *r, uint16_t *g, uint16_t *b)</argsstring>
        <name>drm_output_set_gamma</name>
        <param>
          <type>struct <ref refid="structweston__output" kindref="compound">weston_output</ref> *</type>
          <declname>output_base</declname>
        </param>
        <param>
          <type>uint16_t</type>
          <declname>size</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>g</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="519" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="519" bodyend="536"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void drm_output_assign_state</definition>
        <argsstring>(struct drm_output_state *state, enum drm_state_apply_mode mode)</argsstring>
        <name>drm_output_assign_state</name>
        <param>
          <type>struct <ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref> *</type>
          <declname>state</declname>
        </param>
        <param>
          <type>enum <ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749ed" kindref="member">drm_state_apply_mode</ref></type>
          <declname>mode</declname>
        </param>
        <briefdescription>
<para>Mark an output state as current on the output, i.e. </para>
        </briefdescription>
        <detaileddescription>
<para>it has been submitted to the kernel. The mode argument determines whether this update will be applied synchronously (e.g. when calling drmModeSetCrtc), or asynchronously (in which case we wait for events to complete). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="545" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="545" bodyend="601"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a2903870dc99824411df261b8a0c2bf4c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void drm_output_set_cursor</definition>
        <argsstring>(struct drm_output_state *output_state)</argsstring>
        <name>drm_output_set_cursor</name>
        <param>
          <type>struct <ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref> *</type>
          <declname>output_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="604" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="604" bodyend="654"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a9ddf2bec776193329dcaa6cb4f91921b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int drm_output_apply_state_legacy</definition>
        <argsstring>(struct drm_output_state *state)</argsstring>
        <name>drm_output_apply_state_legacy</name>
        <param>
          <type>struct <ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref> *</type>
          <declname>state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="657" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="657" bodyend="794"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a90b7adedfd3040c8440230840963b20e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int crtc_add_prop</definition>
        <argsstring>(drmModeAtomicReq *req, struct drm_crtc *crtc, enum wdrm_crtc_property prop, uint64_t val)</argsstring>
        <name>crtc_add_prop</name>
        <param>
          <type>drmModeAtomicReq *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>struct <ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref> *</type>
          <declname>crtc</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7" kindref="member">wdrm_crtc_property</ref></type>
          <declname>prop</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="797" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="797" bodyend="813"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int connector_add_prop</definition>
        <argsstring>(drmModeAtomicReq *req, struct drm_connector *connector, enum wdrm_connector_property prop, uint64_t val)</argsstring>
        <name>connector_add_prop</name>
        <param>
          <type>drmModeAtomicReq *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>struct <ref refid="structdrm__connector" kindref="compound">drm_connector</ref> *</type>
          <declname>connector</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47" kindref="member">wdrm_connector_property</ref></type>
          <declname>prop</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="816" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="816" bodyend="832"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int plane_add_prop</definition>
        <argsstring>(drmModeAtomicReq *req, struct drm_plane *plane, enum wdrm_plane_property prop, uint64_t val)</argsstring>
        <name>plane_add_prop</name>
        <param>
          <type>drmModeAtomicReq *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>struct <ref refid="structdrm__plane" kindref="compound">drm_plane</ref> *</type>
          <declname>plane</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596b" kindref="member">wdrm_plane_property</ref></type>
          <declname>prop</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="835" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="835" bodyend="851"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1ac445c5919f6647e420114c47fcb95298" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool drm_connector_has_prop</definition>
        <argsstring>(struct drm_connector *connector, enum wdrm_connector_property prop)</argsstring>
        <name>drm_connector_has_prop</name>
        <param>
          <type>struct <ref refid="structdrm__connector" kindref="compound">drm_connector</ref> *</type>
          <declname>connector</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47" kindref="member">wdrm_connector_property</ref></type>
          <declname>prop</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="854" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="854" bodyend="861"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a565e0e4ee6dce29229c39151a9f90964" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void get_drm_protection_from_weston</definition>
        <argsstring>(enum weston_hdcp_protection weston_protection, enum wdrm_content_protection_state *drm_protection, enum wdrm_hdcp_content_type *drm_cp_type)</argsstring>
        <name>get_drm_protection_from_weston</name>
        <param>
          <type>enum <ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671" kindref="member">weston_hdcp_protection</ref></type>
          <declname>weston_protection</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62" kindref="member">wdrm_content_protection_state</ref> *</type>
          <declname>drm_protection</declname>
        </param>
        <param>
          <type>enum <ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843" kindref="member">wdrm_hdcp_content_type</ref> *</type>
          <declname>drm_cp_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="869" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="869" bodyend="890"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a6977d8bed59f8c8bba8100c4d75c6768" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void drm_connector_set_hdcp_property</definition>
        <argsstring>(struct drm_connector *connector, enum weston_hdcp_protection protection, drmModeAtomicReq *req)</argsstring>
        <name>drm_connector_set_hdcp_property</name>
        <param>
          <type>struct <ref refid="structdrm__connector" kindref="compound">drm_connector</ref> *</type>
          <declname>connector</declname>
        </param>
        <param>
          <type>enum <ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671" kindref="member">weston_hdcp_protection</ref></type>
          <declname>protection</declname>
        </param>
        <param>
          <type>drmModeAtomicReq *</type>
          <declname>req</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="893" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="893" bodyend="933"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a7b8161b2d45990d6052ecbdb582380b2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int drm_output_apply_state_atomic</definition>
        <argsstring>(struct drm_output_state *state, drmModeAtomicReq *req, uint32_t *flags)</argsstring>
        <name>drm_output_apply_state_atomic</name>
        <param>
          <type>struct <ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref> *</type>
          <declname>state</declname>
        </param>
        <param>
          <type>drmModeAtomicReq *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>flags</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="936" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="936" bodyend="1048"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1acd386ec3f4686fa6e8fc47f767ce7c5e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int drm_pending_state_apply_atomic</definition>
        <argsstring>(struct drm_pending_state *pending_state, enum drm_state_apply_mode mode)</argsstring>
        <name>drm_pending_state_apply_atomic</name>
        <param>
          <type>struct <ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref> *</type>
          <declname>pending_state</declname>
        </param>
        <param>
          <type>enum <ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749ed" kindref="member">drm_state_apply_mode</ref></type>
          <declname>mode</declname>
        </param>
        <briefdescription>
<para>Helper function used only by drm_pending_state_apply, with the same guarantees and constraints as that function. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1055" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1055" bodyend="1204"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1aa1fc0f2bef56ac2d3cb5e7bfb0e3685f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int drm_pending_state_test</definition>
        <argsstring>(struct drm_pending_state *pending_state)</argsstring>
        <name>drm_pending_state_test</name>
        <param>
          <type>struct <ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref> *</type>
          <declname>pending_state</declname>
        </param>
        <briefdescription>
<para>Tests a pending state, to see if the kernel will accept the update as constructed. </para>
        </briefdescription>
        <detaileddescription>
<para>Using atomic modesetting, the kernel performs the same checks as it would on a real commit, returning success or failure without actually modifying the running state. It does not return -EBUSY if there are pending updates in flight, so states may be tested at any point, however this means a state which passed testing may fail on a real commit if the timing is not respected (e.g. committing before the previous commit has completed).</para>
<para>Without atomic modesetting, we have no way to check, so we optimistically claim it will work.</para>
<para>Unlike <ref refid="kms_8c_1a21c4ef1aa7126bfd913e3a5b80c9fe21" kindref="member">drm_pending_state_apply()</ref> and <ref refid="kms_8c_1adc1b74a20dc9a68f57660b68ba2b3300" kindref="member">drm_pending_state_apply_sync()</ref>, this function does <emphasis>not</emphasis> take ownership of pending_state, nor does it clear state_invalid. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1225" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1225" bodyend="1236"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a21c4ef1aa7126bfd913e3a5b80c9fe21" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int drm_pending_state_apply</definition>
        <argsstring>(struct drm_pending_state *pending_state)</argsstring>
        <name>drm_pending_state_apply</name>
        <param>
          <type>struct <ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref> *</type>
          <declname>pending_state</declname>
        </param>
        <briefdescription>
<para>Applies all of a pending_state asynchronously: the primary entry point for applying KMS state to a device. </para>
        </briefdescription>
        <detaileddescription>
<para>Updates the state for all outputs in the pending_state, as well as disabling any unclaimed outputs.</para>
<para>Unconditionally takes ownership of pending_state, and clears state_invalid. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1246" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1246" bodyend="1295"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1adc1b74a20dc9a68f57660b68ba2b3300" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int drm_pending_state_apply_sync</definition>
        <argsstring>(struct drm_pending_state *pending_state)</argsstring>
        <name>drm_pending_state_apply_sync</name>
        <param>
          <type>struct <ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref> *</type>
          <declname>pending_state</declname>
        </param>
        <briefdescription>
<para>The synchronous version of drm_pending_state_apply. </para>
        </briefdescription>
        <detaileddescription>
<para>May only be used to disable outputs. Does so synchronously: the request is guaranteed to have completed on return, and the output will not be touched afterwards.</para>
<para>Unconditionally takes ownership of pending_state, and clears state_invalid. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1305" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1305" bodyend="1348"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1ab4896bad0a1e02c27d51a42b34650934" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void drm_output_update_msc</definition>
        <argsstring>(struct drm_output *output, unsigned int seq)</argsstring>
        <name>drm_output_update_msc</name>
        <param>
          <type>struct <ref refid="structdrm__output" kindref="compound">drm_output</ref> *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>seq</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1351" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1351" bodyend="1359"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a397fe6e6e3813de773ef8f670667e03d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void page_flip_handler</definition>
        <argsstring>(int fd, unsigned int frame, unsigned int sec, unsigned int usec, void *data)</argsstring>
        <name>page_flip_handler</name>
        <param>
          <type>int</type>
          <declname>fd</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>frame</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>sec</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>usec</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1362" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1362" bodyend="1378"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a60933b9ef2d5b393216ab5c7e34b2508" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void atomic_flip_handler</definition>
        <argsstring>(int fd, unsigned int frame, unsigned int sec, unsigned int usec, unsigned int crtc_id, void *data)</argsstring>
        <name>atomic_flip_handler</name>
        <param>
          <type>int</type>
          <declname>fd</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>frame</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>sec</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>usec</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>crtc_id</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1381" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1381" bodyend="1411"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1a89cf346c4ddb1a71f83323b1e0223825" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int on_drm_input</definition>
        <argsstring>(int fd, uint32_t mask, void *data)</argsstring>
        <name>on_drm_input</name>
        <param>
          <type>int</type>
          <declname>fd</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>mask</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1414" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1414" bodyend="1428"/>
      </memberdef>
      <memberdef kind="function" id="kms_8c_1acc628968d33cfc207b6b55a23722238c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int init_kms_caps</definition>
        <argsstring>(struct drm_backend *b)</argsstring>
        <name>init_kms_caps</name>
        <param>
          <type>struct <ref refid="structdrm__backend" kindref="compound">drm_backend</ref> *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" line="1431" column="1" bodyfile="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c" bodystart="1431" bodyend="1505"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>©<sp/>2008-2011<sp/>Kristian<sp/>Høgsberg</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>©<sp/>2011<sp/>Intel<sp/>Corporation</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>©<sp/>2017,<sp/>2018<sp/>Collabora,<sp/>Ltd.</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>©<sp/>2017,<sp/>2018<sp/>General<sp/>Electric<sp/>Company</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>(c)<sp/>2018<sp/>DisplayLink<sp/>(UK)<sp/>Ltd.</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>Permission<sp/>is<sp/>hereby<sp/>granted,<sp/>free<sp/>of<sp/>charge,<sp/>to<sp/>any<sp/>person<sp/>obtaining</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/>a<sp/>copy<sp/>of<sp/>this<sp/>software<sp/>and<sp/>associated<sp/>documentation<sp/>files<sp/>(the</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/>&quot;Software&quot;),<sp/>to<sp/>deal<sp/>in<sp/>the<sp/>Software<sp/>without<sp/>restriction,<sp/>including</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/>without<sp/>limitation<sp/>the<sp/>rights<sp/>to<sp/>use,<sp/>copy,<sp/>modify,<sp/>merge,<sp/>publish,</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>distribute,<sp/>sublicense,<sp/>and/or<sp/>sell<sp/>copies<sp/>of<sp/>the<sp/>Software,<sp/>and<sp/>to</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>permit<sp/>persons<sp/>to<sp/>whom<sp/>the<sp/>Software<sp/>is<sp/>furnished<sp/>to<sp/>do<sp/>so,<sp/>subject<sp/>to</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>the<sp/>following<sp/>conditions:</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>The<sp/>above<sp/>copyright<sp/>notice<sp/>and<sp/>this<sp/>permission<sp/>notice<sp/>(including<sp/>the</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>next<sp/>paragraph)<sp/>shall<sp/>be<sp/>included<sp/>in<sp/>all<sp/>copies<sp/>or<sp/>substantial</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/>portions<sp/>of<sp/>the<sp/>Software.</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*<sp/>THE<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>&quot;AS<sp/>IS&quot;,<sp/>WITHOUT<sp/>WARRANTY<sp/>OF<sp/>ANY<sp/>KIND,</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*<sp/>EXPRESS<sp/>OR<sp/>IMPLIED,<sp/>INCLUDING<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO<sp/>THE<sp/>WARRANTIES<sp/>OF</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*<sp/>MERCHANTABILITY,<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>AND</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/>NONINFRINGEMENT.<sp/><sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>AUTHORS<sp/>OR<sp/>COPYRIGHT<sp/>HOLDERS</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/>*<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>CLAIM,<sp/>DAMAGES<sp/>OR<sp/>OTHER<sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>AN</highlight></codeline>
<codeline lineno="25"><highlight class="comment"><sp/>*<sp/>ACTION<sp/>OF<sp/>CONTRACT,<sp/>TORT<sp/>OR<sp/>OTHERWISE,<sp/>ARISING<sp/>FROM,<sp/>OUT<sp/>OF<sp/>OR<sp/>IN</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/>*<sp/>CONNECTION<sp/>WITH<sp/>THE<sp/>SOFTWARE<sp/>OR<sp/>THE<sp/>USE<sp/>OR<sp/>OTHER<sp/>DEALINGS<sp/>IN<sp/>THE</highlight></codeline>
<codeline lineno="27"><highlight class="comment"><sp/>*<sp/>SOFTWARE.</highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;config.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdint.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;xf86drm.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;xf86drmMode.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="libweston_8h" kindref="compound">libweston/libweston.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="backend-drm_8h" kindref="compound">libweston/backend-drm.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/helpers.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;shared/weston-drm-fourcc.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="drm-internal_8h" kindref="compound">drm-internal.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="pixel-formats_8h" kindref="compound">pixel-formats.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;presentation-time-server-protocol.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/><ref refid="kms_8c_1a9a0a3992ee7fbc70bf95039ec518811f" kindref="member">plane_type_enums</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa4a2d2b2fe30446398be9ea7ad4bccb9a" kindref="member">WDRM_PLANE_TYPE_PRIMARY</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Primary&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa8a23148c30aa54f031663953b3348529" kindref="member">WDRM_PLANE_TYPE_OVERLAY</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Overlay&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daab2c664f88c2866f6c11ec3bf738817b1" kindref="member">WDRM_PLANE_TYPE_CURSOR</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Cursor&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="55"><highlight class="normal">};</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/><ref refid="kms_8c_1afece1e55c7d754994d0c318f6d6498d4" kindref="member">plane_props</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596baa5105c0b33c6a2dc34f5b841b2fa05c4" kindref="member">WDRM_PLANE_TYPE</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.enum_values<sp/>=<sp/><ref refid="kms_8c_1a9a0a3992ee7fbc70bf95039ec518811f" kindref="member">plane_type_enums</ref>,</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.num_enum_values<sp/>=<sp/><ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa67cd543c2329ddfd5bb348261e4791d9" kindref="member">WDRM_PLANE_TYPE__COUNT</ref>,</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596baa6a42b2c7c3f776db5e3a9bb61134862" kindref="member">WDRM_PLANE_SRC_X</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SRC_X&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba95709d13f77f9376e83485e1944f4836" kindref="member">WDRM_PLANE_SRC_Y</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SRC_Y&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba70c980a8835fd61c6c1e4e328f0939a2" kindref="member">WDRM_PLANE_SRC_W</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SRC_W&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596babd5e918516ce184928449f3f04f59bf8" kindref="member">WDRM_PLANE_SRC_H</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SRC_H&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bac58c01db3494d3fb109515e76993cced" kindref="member">WDRM_PLANE_CRTC_X</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_X&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba8809b4aafd5cec0a81c0ad09f4f8d601" kindref="member">WDRM_PLANE_CRTC_Y</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_Y&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba5c8ca3e4e2dcc4ed31829d2bbf3263d4" kindref="member">WDRM_PLANE_CRTC_W</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_W&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bab66991ba381f5104f3f848ef98207c52" kindref="member">WDRM_PLANE_CRTC_H</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_H&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bad2b8062a854792b323e3ff53dfd0a1c3" kindref="member">WDRM_PLANE_FB_ID</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;FB_ID&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba704a0668e807b595f7e9fda8726759a7" kindref="member">WDRM_PLANE_CRTC_ID</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_ID&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596babf5d83cc146a80521444fb7d71c130e7" kindref="member">WDRM_PLANE_IN_FORMATS</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;IN_FORMATS&quot;</highlight><highlight class="normal"><sp/>},</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba91e2dd71de34a7dce93afb47d431a2e2" kindref="member">WDRM_PLANE_IN_FENCE_FD</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;IN_FENCE_FD&quot;</highlight><highlight class="normal"><sp/>},</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba71e3e231b7d8361addebf93ec0850cb2" kindref="member">WDRM_PLANE_FB_DAMAGE_CLIPS</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;FB_DAMAGE_CLIPS&quot;</highlight><highlight class="normal"><sp/>},</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba34b67be34600e4edba988b6a9d5e01bc" kindref="member">WDRM_PLANE_ZPOS</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;zpos&quot;</highlight><highlight class="normal"><sp/>},</highlight></codeline>
<codeline lineno="77"><highlight class="normal">};</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/><ref refid="kms_8c_1a4196bce485e1c70d095c7e8621d3fc4d" kindref="member">dpms_state_enums</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a2dd7311fcdba8c50e0c848526d366457" kindref="member">WDRM_DPMS_STATE_OFF</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Off&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a4b823cd8cb6f31977df876e0f5b03858" kindref="member">WDRM_DPMS_STATE_ON</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;On&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a94ae60adfc04d5729ae078c0e59ff661" kindref="member">WDRM_DPMS_STATE_STANDBY</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Standby&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7aad51f1f81fa13400feac645bd7df1064" kindref="member">WDRM_DPMS_STATE_SUSPEND</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Suspend&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="92"><highlight class="normal">};</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/><ref refid="kms_8c_1a92216de14c4ddbf8319b2325975711dd" kindref="member">content_protection_enums</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62ae146e054e9a83f3343c3870d6acf791d" kindref="member">WDRM_CONTENT_PROTECTION_UNDESIRED</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undesired&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62a1400d4665d7b85d09fa5aee9c906378c" kindref="member">WDRM_CONTENT_PROTECTION_DESIRED</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Desired&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62aa4df39bdaa07bfd545331d8e0cbccd84" kindref="member">WDRM_CONTENT_PROTECTION_ENABLED</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Enabled&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="104"><highlight class="normal">};</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/><ref refid="kms_8c_1ada809cd1bd04d3e534cfb1555770d5fb" kindref="member">hdcp_content_type_enums</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a3e4ef5bde37b358fcfa6b57a83ef22c0" kindref="member">WDRM_HDCP_CONTENT_TYPE0</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;HDCP<sp/>Type0&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a5b24089b472a15f0f1e4cc575e645d27" kindref="member">WDRM_HDCP_CONTENT_TYPE1</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;HDCP<sp/>Type1&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="113"><highlight class="normal">};</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/><ref refid="kms_8c_1a8ac5a7393a85482b76ccaa60a1d3b8ad" kindref="member">panel_orientation_enums</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a42564f64da883c866cf0975335c4b72f" kindref="member">WDRM_PANEL_ORIENTATION_NORMAL</ref>]<sp/>=<sp/>{<sp/>.<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Normal&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a8a85c0b2e0084d8469534d07836e2b8e" kindref="member">WDRM_PANEL_ORIENTATION_UPSIDE_DOWN</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Upside<sp/>Down&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a764e1c2d64bd322521aca4d1725cd888" kindref="member">WDRM_PANEL_ORIENTATION_LEFT_SIDE_UP</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Left<sp/>Side<sp/>Up&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a8d1a0c1c7c0734e8ef42fa3579b9a6ce" kindref="member">WDRM_PANEL_ORIENTATION_RIGHT_SIDE_UP</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Right<sp/>Side<sp/>Up&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="120"><highlight class="normal">};</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/><ref refid="kms_8c_1af6243e82855858b6e4ee9b4fe6551c55" kindref="member">connector_props</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a519892ddd836449f362f05c4a24db57e" kindref="member">WDRM_CONNECTOR_EDID</ref>]<sp/>=<sp/>{<sp/>.<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;EDID&quot;</highlight><highlight class="normal"><sp/>},</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47adf7f47243756ed3dc633bc4c7b9e83a9" kindref="member">WDRM_CONNECTOR_DPMS</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DPMS&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.enum_values<sp/>=<sp/><ref refid="kms_8c_1a4196bce485e1c70d095c7e8621d3fc4d" kindref="member">dpms_state_enums</ref>,</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.num_enum_values<sp/>=<sp/><ref refid="drm-internal_8h_1a8adb4289439ac793a2a10e61bb1388a7a43cf9f3cbb9371734352b37bb438122b" kindref="member">WDRM_DPMS_STATE__COUNT</ref>,</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a56a25fb6bda4f871114c5c6a078dde47" kindref="member">WDRM_CONNECTOR_CRTC_ID</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CRTC_ID&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a82e427d6d25400d7de115639cdef2810" kindref="member">WDRM_CONNECTOR_NON_DESKTOP</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;non-desktop&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47acb6b8ba5f75b3f5a37a6aecdb90b96a1" kindref="member">WDRM_CONNECTOR_CONTENT_PROTECTION</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Content<sp/>Protection&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.enum_values<sp/>=<sp/><ref refid="kms_8c_1a92216de14c4ddbf8319b2325975711dd" kindref="member">content_protection_enums</ref>,</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.num_enum_values<sp/>=<sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62a7b1dfe7c38f652379ef2f3b7436f1e1b" kindref="member">WDRM_CONTENT_PROTECTION__COUNT</ref>,</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;HDCP<sp/>Content<sp/>Type&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.enum_values<sp/>=<sp/><ref refid="kms_8c_1ada809cd1bd04d3e534cfb1555770d5fb" kindref="member">hdcp_content_type_enums</ref>,</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.num_enum_values<sp/>=<sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a2c4a92c1cfa764efc6d791109bde5ec3" kindref="member">WDRM_HDCP_CONTENT_TYPE__COUNT</ref>,</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a95481a04c83680495ecea913e7b6089a" kindref="member">WDRM_CONNECTOR_PANEL_ORIENTATION</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;panel<sp/>orientation&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.enum_values<sp/>=<sp/><ref refid="kms_8c_1a8ac5a7393a85482b76ccaa60a1d3b8ad" kindref="member">panel_orientation_enums</ref>,</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.num_enum_values<sp/>=<sp/><ref refid="drm-internal_8h_1a7ef68e81e6386ebab2e4668e11012af9a824fe5754f312f0c2370d7b598ea034c" kindref="member">WDRM_PANEL_ORIENTATION__COUNT</ref>,</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="146"><highlight class="normal">};</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/><ref refid="kms_8c_1abb551725d8d78ed1e34a44ccb7bb7616" kindref="member">crtc_props</ref>[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7aaa3791b4f16e891397dee4d059009768" kindref="member">WDRM_CRTC_MODE_ID</ref>]<sp/>=<sp/>{<sp/>.<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;MODE_ID&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7a18532bea4b0b2f07db220e7102648d41" kindref="member">WDRM_CRTC_ACTIVE</ref>]<sp/>=<sp/>{<sp/>.name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;ACTIVE&quot;</highlight><highlight class="normal">,<sp/>},</highlight></codeline>
<codeline lineno="151"><highlight class="normal">};</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749ed" kindref="member">drm_state_apply_mode</ref><sp/>{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" kindref="member">DRM_STATE_APPLY_SYNC</ref>,<sp/></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>,<sp/></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda99a96cf36762e16e89f055a9babe51a0" kindref="member">DRM_STATE_TEST_ONLY</ref>,<sp/></highlight></codeline>
<codeline lineno="161"><highlight class="normal">};</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal">uint64_t</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><ref refid="kms_8c_1a10a6cc59b12c55f8350d2dab4f1edb69" kindref="member">drm_property_get_value</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info,</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>drmModeObjectProperties<sp/>*props,</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>def)</highlight></codeline>
<codeline lineno="181"><highlight class="normal">{</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>def;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>props-&gt;count_props;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(props-&gt;props[i]<sp/>!=<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Simple<sp/>(non-enum)<sp/>types<sp/>can<sp/>return<sp/>the<sp/>value<sp/>directly<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>props-&gt;prop_values[i];</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Map<sp/>from<sp/>raw<sp/>value<sp/>to<sp/>enum<sp/>value<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>info-&gt;<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!info-&gt;<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[j].<ref refid="structdrm__property__enum__info_1a63f5dffaeb44fcc5e8adc1eb30794e37" kindref="member">valid</ref>)</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[j].<ref refid="structdrm__property__enum__info_1a75456ebd33382718c1b41aa40ffaf21a" kindref="member">value</ref><sp/>!=<sp/>props-&gt;prop_values[i])</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>don&apos;t<sp/>have<sp/>a<sp/>mapping<sp/>for<sp/>this<sp/>enum;<sp/>return<sp/>default.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>def;</highlight></codeline>
<codeline lineno="212"><highlight class="normal">}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal">uint64_t<sp/>*</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><ref refid="kms_8c_1a2ada0c9369647715fb9a1498f87a5b7e" kindref="member">drm_property_get_range_values</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info,</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>drmModeObjectProperties<sp/>*props)</highlight></codeline>
<codeline lineno="229"><highlight class="normal">{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>props-&gt;count_props;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(props-&gt;props[i]<sp/>!=<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(info-&gt;<ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref><sp/>&amp;<sp/>DRM_MODE_PROP_RANGE)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!(info-&gt;<ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref><sp/>&amp;<sp/>DRM_MODE_PROP_SIGNED_RANGE))</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>info-&gt;<ref refid="structdrm__property__info_1a6b62061cac19970544dc739e9f2591fa" kindref="member">range_values</ref>;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="248"><highlight class="normal">}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><ref refid="kms_8c_1a062f3a9fec634be7094540e94021ce18" kindref="member">drm_property_info_populate</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b,</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*src,</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info,</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_infos,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeObjectProperties<sp/>*props)</highlight></codeline>
<codeline lineno="287"><highlight class="normal">{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModePropertyRes<sp/>*prop;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i,<sp/>j;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_infos;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref><sp/>=<sp/>src[i].<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>=<sp/>src[i].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref>;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(src[i].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref><sp/>=</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>malloc(src[i].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>*</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>));</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>info[i].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[j].<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref><sp/>=<sp/>src[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[j].<ref refid="structdrm__property__enum__info_1a6db057aebb52c40ae82d5ab89c3a7709" kindref="member">name</ref>;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[j].<ref refid="structdrm__property__enum__info_1a63f5dffaeb44fcc5e8adc1eb30794e37" kindref="member">valid</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>props-&gt;count_props;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prop<sp/>=<sp/>drmModeGetProperty(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>props-&gt;props[i]);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!prop)</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>num_infos;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(prop-&gt;name,<sp/>info[j].name))</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>don&apos;t<sp/>know/care<sp/>about<sp/>this<sp/>property.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(j<sp/>==<sp/>num_infos)<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM<sp/>debug:<sp/>unrecognized<sp/>property<sp/>%u<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prop-&gt;prop_id,<sp/>prop-&gt;name);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeProperty(prop);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info[j].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>==<sp/>0<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(prop-&gt;flags<sp/>&amp;<sp/>DRM_MODE_PROP_ENUM))<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>expected<sp/>property<sp/>%s<sp/>to<sp/>not<sp/>be<sp/>an&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/>enum,<sp/>but<sp/>it<sp/>is;<sp/>ignoring\n&quot;</highlight><highlight class="normal">,<sp/>prop-&gt;name);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeProperty(prop);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>=<sp/>props-&gt;props[i];</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref><sp/>=<sp/>prop-&gt;flags;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prop-&gt;flags<sp/>&amp;<sp/>DRM_MODE_PROP_RANGE<sp/>||</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prop-&gt;flags<sp/>&amp;<sp/>DRM_MODE_PROP_SIGNED_RANGE)<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1a30dbc711a95850098970d85e0d851420" kindref="member">num_range_values</ref><sp/>=<sp/>prop-&gt;count_values;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>prop-&gt;count_values;<sp/>i++)</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1a6b62061cac19970544dc739e9f2591fa" kindref="member">range_values</ref>[i]<sp/>=<sp/>prop-&gt;values[i];</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info[j].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeProperty(prop);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(prop-&gt;flags<sp/>&amp;<sp/>DRM_MODE_PROP_ENUM))<sp/>{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>expected<sp/>property<sp/>%s<sp/>to<sp/>be<sp/>an<sp/>enum,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/>but<sp/>it<sp/>is<sp/>not;<sp/>ignoring\n&quot;</highlight><highlight class="normal">,<sp/>prop-&gt;name);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeProperty(prop);</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>info[j].<ref refid="structdrm__property__info_1af865d18107586fc75d6bf893f0a1e219" kindref="member">num_enum_values</ref>;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(l<sp/>=<sp/>0;<sp/>l<sp/>&lt;<sp/>prop-&gt;count_enums;<sp/>l++)<sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(prop-&gt;enums[l].name,</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].enum_values[k].name))</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(l<sp/>==<sp/>prop-&gt;count_enums)</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[k].<ref refid="structdrm__property__enum__info_1a63f5dffaeb44fcc5e8adc1eb30794e37" kindref="member">valid</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[j].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>[k].<ref refid="structdrm__property__enum__info_1a75456ebd33382718c1b41aa40ffaf21a" kindref="member">value</ref><sp/>=<sp/>prop-&gt;enums[l].value;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeProperty(prop);</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_infos;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info[i].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM<sp/>warning:<sp/>property<sp/>&apos;%s&apos;<sp/>missing\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info[i].<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal">}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><ref refid="kms_8c_1acb923f9ec3b8e49c4a3e6bba2a7ae398" kindref="member">drm_property_info_free</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_props)</highlight></codeline>
<codeline lineno="405"><highlight class="normal">{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_props;<sp/>i++)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(info[i].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(info,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*info)<sp/>*<sp/>num_props);</highlight></codeline>
<codeline lineno="412"><highlight class="normal">}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/>uint32_t<sp/>*</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><ref refid="kms_8c_1a3a64a4b29a1c2f3b0e05e7d53c847a5a" kindref="member">formats_ptr</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>drm_format_modifier_blob<sp/>*blob)</highlight></codeline>
<codeline lineno="416"><highlight class="normal">{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(uint32_t<sp/>*)(((</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)blob)<sp/>+<sp/>blob-&gt;formats_offset);</highlight></codeline>
<codeline lineno="418"><highlight class="normal">}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">drm_format_modifier<sp/>*</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><ref refid="kms_8c_1ad4e431e7587eefefa3ef0ca1425ecfe9" kindref="member">modifiers_ptr</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>drm_format_modifier_blob<sp/>*blob)</highlight></codeline>
<codeline lineno="422"><highlight class="normal">{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>drm_format_modifier<sp/>*)</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(((</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)blob)<sp/>+<sp/>blob-&gt;modifiers_offset);</highlight></codeline>
<codeline lineno="425"><highlight class="normal">}</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><ref refid="kms_8c_1a5411bfbbabbc04a852c2310f4b2fa603" kindref="member">drm_plane_populate_formats</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>drmModePlane<sp/>*kplane,</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>drmModeObjectProperties<sp/>*props,</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>use_modifiers)</highlight></codeline>
<codeline lineno="435"><highlight class="normal">{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModePropertyBlobRes<sp/>*blob;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">drm_format_modifier_blob<sp/>*fmt_mod_blob;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">drm_format_modifier<sp/>*blob_modifiers;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>*blob_formats;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>blob_id;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!use_modifiers)</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fallback;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob_id<sp/>=<sp/><ref refid="kms_8c_1a10a6cc59b12c55f8350d2dab4f1edb69" kindref="member">drm_property_get_value</ref>(&amp;plane-&gt;<ref refid="structdrm__plane_1abc0a66704df3babfe798c7297ce9dcc3" kindref="member">props</ref>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596babf5d83cc146a80521444fb7d71c130e7" kindref="member">WDRM_PLANE_IN_FORMATS</ref>],</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>props,</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0);</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(blob_id<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fallback;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob<sp/>=<sp/>drmModeGetPropertyBlob(plane-&gt;<ref refid="structdrm__plane_1a2edab895883082a3f29c5cc1b1cf341b" kindref="member">backend</ref>-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>blob_id);</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!blob)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>fallback;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fmt_mod_blob<sp/>=<sp/>blob-&gt;data;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob_formats<sp/>=<sp/><ref refid="kms_8c_1a3a64a4b29a1c2f3b0e05e7d53c847a5a" kindref="member">formats_ptr</ref>(fmt_mod_blob);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob_modifiers<sp/>=<sp/><ref refid="kms_8c_1ad4e431e7587eefefa3ef0ca1425ecfe9" kindref="member">modifiers_ptr</ref>(fmt_mod_blob);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane-&gt;<ref refid="structdrm__plane_1a86313f26511ca3f8f110a5b7af9ac78a" kindref="member">count_formats</ref><sp/>!=<sp/>fmt_mod_blob-&gt;count_formats)<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM<sp/>backend:<sp/>format<sp/>count<sp/>differs<sp/>between<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;plane<sp/>(%d)<sp/>and<sp/>IN_FORMATS<sp/>(%d)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a86313f26511ca3f8f110a5b7af9ac78a" kindref="member">count_formats</ref>,</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fmt_mod_blob-&gt;count_formats);</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;This<sp/>represents<sp/>a<sp/>kernel<sp/>bug;<sp/>Weston<sp/>is<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>continue.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>abort();</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>fmt_mod_blob-&gt;count_formats;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>count_modifiers<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>*modifiers<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>fmt_mod_blob-&gt;count_modifiers;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">drm_format_modifier<sp/>*mod<sp/>=<sp/>&amp;blob_modifiers[j];</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((i<sp/>&lt;<sp/>mod-&gt;offset)<sp/>||<sp/>(i<sp/>&gt;<sp/>mod-&gt;offset<sp/>+<sp/>63))</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(mod-&gt;formats<sp/>&amp;<sp/>(1<sp/>&lt;&lt;<sp/>(i<sp/>-<sp/>mod-&gt;offset))))</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>modifiers<sp/>=<sp/>realloc(modifiers,</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(count_modifiers<sp/>+<sp/>1)<sp/>*</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(modifiers[0]));</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(modifiers);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>modifiers[count_modifiers++]<sp/>=<sp/>mod-&gt;modifier;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count_modifiers<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>modifiers<sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*modifiers));</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*modifiers<sp/>=<sp/>DRM_FORMAT_MOD_LINEAR;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>count_modifiers<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1a3c95d78a9bc48b279b2ff8635f17e87d" kindref="member">format</ref><sp/>=<sp/>blob_formats[i];</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1adc19000ed02010eacdb2df1837fe65c0" kindref="member">modifiers</ref><sp/>=<sp/>modifiers;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1ae6bfcc58b333a60ee40b43cb7fa379cf" kindref="member">count_modifiers</ref><sp/>=<sp/>count_modifiers;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreePropertyBlob(blob);</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal">fallback:</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>No<sp/>IN_FORMATS<sp/>blob<sp/>available,<sp/>so<sp/>just<sp/>use<sp/>the<sp/>old.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(plane-&gt;<ref refid="structdrm__plane_1a86313f26511ca3f8f110a5b7af9ac78a" kindref="member">count_formats</ref><sp/>==<sp/>kplane-&gt;count_formats);</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>kplane-&gt;count_formats;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1a3c95d78a9bc48b279b2ff8635f17e87d" kindref="member">format</ref><sp/>=<sp/>kplane-&gt;formats[i];</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1adc19000ed02010eacdb2df1837fe65c0" kindref="member">modifiers</ref><sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint64_t));</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1adc19000ed02010eacdb2df1837fe65c0" kindref="member">modifiers</ref>[0]<sp/>=<sp/>DRM_FORMAT_MOD_LINEAR;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1a5adbfe14e7d3f1824dc383d8df2876cc" kindref="member">formats</ref>[i].<ref refid="structdrm__plane_1ae6bfcc58b333a60ee40b43cb7fa379cf" kindref="member">count_modifiers</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><ref refid="kms_8c_1a374934d699770680d5bf3a8f7292e38f" kindref="member">drm_output_set_gamma</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structweston__output" kindref="compound">weston_output</ref><sp/>*output_base,</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>size,<sp/>uint16_t<sp/>*r,<sp/>uint16_t<sp/>*g,<sp/>uint16_t<sp/>*b)</highlight></codeline>
<codeline lineno="521"><highlight class="normal">{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/><ref refid="drm-internal_8h_1ad641cb71d4629aa9b1c3ed7cc5626fe2" kindref="member">to_drm_output</ref>(output_base);</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*backend<sp/>=</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>check<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(output_base-&gt;<ref refid="structweston__output_1ad772cabc2f4931aef823815cb7fd69bf" kindref="member">gamma_size</ref><sp/>!=<sp/>size)</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>drmModeCrtcSetGamma(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;crtc-&gt;crtc_id,</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>size,<sp/>r,<sp/>g,<sp/>b);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc)</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;set<sp/>gamma<sp/>failed:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="536"><highlight class="normal">}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><ref refid="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" kindref="member">drm_output_assign_state</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*state,</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749ed" kindref="member">drm_state_apply_mode</ref><sp/>mode)</highlight></codeline>
<codeline lineno="547"><highlight class="normal">{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane__state" kindref="compound">drm_plane_state</ref><sp/>*plane_state;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__head" kindref="compound">drm_head</ref><sp/>*head;</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(!<ref refid="structoutput" kindref="compound">output</ref>-&gt;state_last);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>==<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>)</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;state_last<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;state_cur;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1aadf95e25ad6a650a2e0503844ac2b58c" kindref="member">drm_output_state_free</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;state_cur);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_remove(&amp;state-&gt;<ref refid="structdrm__output__state_1a4fd38e634854f64d47486ab839bd60a6" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_init(&amp;state-&gt;<ref refid="structdrm__output__state_1a4fd38e634854f64d47486ab839bd60a6" kindref="member">link</ref>);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structdrm__output__state_1aff9ca824fc317253fd8a3b3f0e999303" kindref="member">pending_state</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;state_cur<sp/>=<sp/>state;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref><sp/>&amp;&amp;<sp/>mode<sp/>==<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>)<sp/>{</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t[CRTC:%u]<sp/>setting<sp/>pending<sp/>flip\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;crtc-&gt;crtc_id);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;atomic_complete_pending<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref><sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structdrm__output__state_1a158f0d5e549532c6ba80f028de1d5d51" kindref="member">protection</ref><sp/>==<sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671ad11b3fce4f7baccb7a07a1107b23f92e" kindref="member">WESTON_HDCP_DISABLE</ref>)</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.head_list,<sp/><ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.<ref refid="structweston__head_1a21f63bcc97ea0592e94f94c6881a0ed3" kindref="member">output_link</ref>)</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compositor_8c_1ad857cfe1c11b72be724989f35dbb2d5a" kindref="member">weston_head_set_content_protection_status</ref>(&amp;head-&gt;<ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>,</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671ad11b3fce4f7baccb7a07a1107b23f92e" kindref="member">WESTON_HDCP_DISABLE</ref>);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Replace<sp/>state_cur<sp/>on<sp/>each<sp/>affected<sp/>plane<sp/>with<sp/>the<sp/>new<sp/>state,<sp/>being</highlight></codeline>
<codeline lineno="579"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>careful<sp/>to<sp/>dispose<sp/>of<sp/>orphaned<sp/>(but<sp/>only<sp/>orphaned)<sp/>previous<sp/>state.</highlight></codeline>
<codeline lineno="580"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>If<sp/>the<sp/>previous<sp/>state<sp/>is<sp/>not<sp/>orphaned<sp/>(still<sp/>has<sp/>an<sp/>output_state</highlight></codeline>
<codeline lineno="581"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>attached),<sp/>it<sp/>will<sp/>be<sp/>disposed<sp/>of<sp/>by<sp/>freeing<sp/>the<sp/>output_state.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(plane_state,<sp/>&amp;state-&gt;plane_list,<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane<sp/>=<sp/>plane_state-&gt;plane;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref><sp/>&amp;&amp;<sp/>!plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a9dce0cbff4f30e5feda2878aac526a05" kindref="member">output_state</ref>)</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a3d47a20b3993b15d4b6dde3ea45199ea" kindref="member">drm_plane_state_free</ref>(plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref><sp/>=<sp/>plane_state;</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>!=<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>)<sp/>{</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ac4db4bcf52ffdc93f8b92ca6f8b34bb2" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>)</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(plane-&gt;<ref refid="structdrm__plane_1a9ad049d16b475a2fcc9bc59d8890288a" kindref="member">type</ref><sp/>!=<sp/><ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa8a23148c30aa54f031663953b3348529" kindref="member">WDRM_PLANE_TYPE_OVERLAY</ref>);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane-&gt;<ref refid="structdrm__plane_1a9ad049d16b475a2fcc9bc59d8890288a" kindref="member">type</ref><sp/>==<sp/><ref refid="drm-internal_8h_1a9f4701eaab7725457757d2be11ae74daa4a2d2b2fe30446398be9ea7ad4bccb9a" kindref="member">WDRM_PLANE_TYPE_PRIMARY</ref>)</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;page_flip_pending<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="601"><highlight class="normal">}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><ref refid="kms_8c_1a2903870dc99824411df261b8a0c2bf4c" kindref="member">drm_output_set_cursor</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*output_state)</highlight></codeline>
<codeline lineno="605"><highlight class="normal">{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>output_state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;crtc;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_plane;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane__state" kindref="compound">drm_plane_state</ref><sp/>*state;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>handle;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>)</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state<sp/>=<sp/><ref refid="drm-internal_8h_1a6b45744aec60bfe85d88dc358d1db3b2" kindref="member">drm_output_state_get_existing_plane</ref>(<ref refid="structdrm__plane__state_1a9dce0cbff4f30e5feda2878aac526a05" kindref="member">output_state</ref>,<sp/><ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!state)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>)<sp/>{</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a6db0329fb1df9ed790e2f950940d2855" kindref="member">base</ref>.<ref refid="structweston__plane_1a8e80302ccee9b0195d9227a04c58ef05" kindref="member">damage</ref>);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a6db0329fb1df9ed790e2f950940d2855" kindref="member">base</ref>.<ref refid="structweston__plane_1a8e80302ccee9b0195d9227a04c58ef05" kindref="member">damage</ref>);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeSetCursor(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>0,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>==<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;gbm_cursor_fb[<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_cursor]);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(!<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a0e320411fef6c2f00b12e2cb6687801b" kindref="member">output</ref><sp/>||<sp/><ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a0e320411fef6c2f00b12e2cb6687801b" kindref="member">output</ref><sp/>==<sp/><ref refid="structoutput" kindref="compound">output</ref>);</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>handle<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;gbm_cursor_handle[<ref refid="structoutput" kindref="compound">output</ref>-&gt;current_cursor];</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>!=<sp/>state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>)<sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(drmModeSetCursor(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>handle,</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a6604f296567ccd200064cbbb57aed7c2" kindref="member">cursor_width</ref>,<sp/>b-&gt;<ref refid="structdrm__backend_1a680e6639d09d220f29c4790fff478dc7" kindref="member">cursor_height</ref>))<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>set<sp/>cursor:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strerror(errno));</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_fini(&amp;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a6db0329fb1df9ed790e2f950940d2855" kindref="member">base</ref>.<ref refid="structweston__plane_1a8e80302ccee9b0195d9227a04c58ef05" kindref="member">damage</ref>);</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pixman_region32_init(&amp;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a6db0329fb1df9ed790e2f950940d2855" kindref="member">base</ref>.<ref refid="structweston__plane_1a8e80302ccee9b0195d9227a04c58ef05" kindref="member">damage</ref>);</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(drmModeMoveCursor(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structdrm__plane__state_1a70d1e4ec3e8ee540644dcd74f85648f7" kindref="member">dest_x</ref>,<sp/>state-&gt;<ref refid="structdrm__plane__state_1ad117aa4401e9930993e585eb3fcdd851" kindref="member">dest_y</ref>))<sp/>{</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>move<sp/>cursor:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal">err:</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a51d71b33e0a2454ca4685520974f27e6" kindref="member">cursors_are_broken</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeSetCursor(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>0,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="654"><highlight class="normal">}</highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><ref refid="kms_8c_1a9ddf2bec776193329dcaa6cb4f91921b" kindref="member">drm_output_apply_state_legacy</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*state)</highlight></codeline>
<codeline lineno="658"><highlight class="normal">{</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*backend<sp/>=<sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*scanout_plane<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;scanout_plane;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;crtc;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*dpms_prop;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane__state" kindref="compound">drm_plane_state</ref><sp/>*scanout_state;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__mode" kindref="compound">drm_mode</ref><sp/>*mode;</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__head" kindref="compound">drm_head</ref><sp/>*head;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structpixel__format__info" kindref="compound">pixel_format_info</ref><sp/>*pinfo<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>connectors[<ref refid="drm-internal_8h_1a57d17743146757f871d37931ed139584" kindref="member">MAX_CLONED_CONNECTORS</ref>];</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_conn<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">timespec<sp/>now;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.head_list,<sp/>base.output_link)<sp/>{</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(n_conn<sp/>&lt;<sp/><ref refid="drm-internal_8h_1a57d17743146757f871d37931ed139584" kindref="member">MAX_CLONED_CONNECTORS</ref>);</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>connectors[n_conn++]<sp/>=<sp/>head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>.<ref refid="structdrm__connector_1a9a19b388f082e36a49aaa9cf33a663bf" kindref="member">connector_id</ref>;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>disable_planes<sp/>is<sp/>set<sp/>then<sp/>assign_planes()<sp/>wasn&apos;t</highlight></codeline>
<codeline lineno="679"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>called<sp/>for<sp/>this<sp/>render,<sp/>so<sp/>we<sp/>could<sp/>still<sp/>have<sp/>a<sp/>stale</highlight></codeline>
<codeline lineno="680"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>cursor<sp/>plane<sp/>set<sp/>up.</highlight></codeline>
<codeline lineno="681"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.disable_planes)<sp/>{</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_view<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_plane)<sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_plane-&gt;base.<ref refid="structoutput_1acaa160777547223ba734d78e4690c24b" kindref="member">x</ref><sp/>=<sp/>INT32_MIN;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_plane-&gt;base.<ref refid="structoutput_1ac2c2a13096bd351fda95e72cb6f5a254" kindref="member">y</ref><sp/>=<sp/>INT32_MIN;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>!=<sp/><ref refid="libweston_8h_1a745785f1c5cf40791e2b4c3ef11043c3ad1b8db0fe08ab29dbaa695396cb1c637" kindref="member">WESTON_DPMS_ON</ref>)<sp/>{</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_plane)<sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeSetCursor(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret)</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;drmModeSetCursor<sp/>failed<sp/>disable:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strerror(errno));</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeSetCrtc(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>0,<sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL,<sp/>0,<sp/>NULL);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret)</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;drmModeSetCrtc<sp/>failed<sp/>disabling:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strerror(errno));</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" kindref="member">drm_output_assign_state</ref>(state,<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" kindref="member">DRM_STATE_APPLY_SYNC</ref>);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__compositor_1ga464e69b90dabde1e2f4797181f3dc65a" kindref="member">weston_compositor_read_presentation_clock</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor,<sp/>&amp;now);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1afb55f629c85e3c178506af86c21a7a75" kindref="member">drm_output_update_complete</ref>(<ref refid="structoutput" kindref="compound">output</ref>,</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WP_PRESENTATION_FEEDBACK_KIND_HW_COMPLETION,</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>now.tv_sec,<sp/>now.tv_nsec<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scanout_state<sp/>=</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a6b45744aec60bfe85d88dc358d1db3b2" kindref="member">drm_output_state_get_existing_plane</ref>(state,<sp/>scanout_plane);</highlight></codeline>
<codeline lineno="716"><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>legacy<sp/>SetCrtc<sp/>API<sp/>doesn&apos;t<sp/>allow<sp/>us<sp/>to<sp/>do<sp/>scaling,<sp/>and<sp/>the</highlight></codeline>
<codeline lineno="718"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>legacy<sp/>PageFlip<sp/>API<sp/>doesn&apos;t<sp/>allow<sp/>us<sp/>to<sp/>do<sp/>clipping<sp/>either.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a101fb7ab1d3deb9ac3ec67182a521207" kindref="member">src_x</ref><sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1af3c8448482dfae7b02c8a44458541d40" kindref="member">src_y</ref><sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a9f09e8a40ad4351174df8085eca14692" kindref="member">src_w</ref><sp/>==</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)<sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.current_mode-&gt;<ref refid="structoutput_1a8d0ce045e764bc53e9cb70b1c5830acb" kindref="member">width</ref><sp/>&lt;&lt;<sp/>16));</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a18040b750d8d6969dcdc3baf257c648b" kindref="member">src_h</ref><sp/>==</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)<sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.current_mode-&gt;<ref refid="structoutput_1ab82f03b52728ed0bdc7471851c0411ef" kindref="member">height</ref><sp/>&lt;&lt;<sp/>16));</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a70d1e4ec3e8ee540644dcd74f85648f7" kindref="member">dest_x</ref><sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1ad117aa4401e9930993e585eb3fcdd851" kindref="member">dest_y</ref><sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1ab8cbfbec3b3795a28308f80945dcb647" kindref="member">dest_w</ref><sp/>==<sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a9f09e8a40ad4351174df8085eca14692" kindref="member">src_w</ref><sp/>&gt;&gt;<sp/>16);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a95cf58632d3b98a9d82736991e4f61f6" kindref="member">dest_h</ref><sp/>==<sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a18040b750d8d6969dcdc3baf257c648b" kindref="member">src_h</ref><sp/>&gt;&gt;<sp/>16);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>legacy<sp/>SetCrtc<sp/>API<sp/>doesn&apos;t<sp/>support<sp/>fences<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(scanout_state-&gt;<ref refid="structdrm__plane__state_1a7c56c95a62c11f834c99efbcb07027fb" kindref="member">in_fence_fd</ref><sp/>==<sp/>-1);</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mode<sp/>=<sp/><ref refid="drm-internal_8h_1a48fd1efb29c2efbf397cf59c4b587746" kindref="member">to_drm_mode</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.current_mode);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(backend-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref><sp/>||</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!scanout_plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>||</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scanout_plane-&gt;<ref refid="structdrm__plane_1ad21d5cb226c249a87d6622eef178b96a" kindref="member">state_cur</ref>-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a5c8ec8804b66ffd90fbe70206de10c81" kindref="member">strides</ref>[0]<sp/>!=</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a5c8ec8804b66ffd90fbe70206de10c81" kindref="member">strides</ref>[0])<sp/>{</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeSetCrtc(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a6d724f4d0e5490ca4cf5267c190efb15" kindref="member">fb_id</ref>,</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>connectors,<sp/>n_conn,</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;mode-&gt;<ref refid="structdrm__mode_1a66e3572933e343c9d63fa5f4c257c376" kindref="member">mode_info</ref>);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret)<sp/>{</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;set<sp/>mode<sp/>failed:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pinfo<sp/>=<sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a084455e26722659421ec39cfb687a856" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(backend,<sp/></highlight><highlight class="stringliteral">&quot;\t[CRTC:%u,<sp/>PLANE:%u]<sp/>FORMAT:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a65b04e3029b1033d245da4bcf149e595" kindref="member">plane_id</ref>,</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pinfo<sp/>?<sp/>pinfo-&gt;<ref refid="structpixel__format__info_1a3324befd6757b555dbb5954467fb4cc6" kindref="member">drm_format_name</ref><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;UNKNOWN&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(drmModePageFlip(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scanout_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a6d724f4d0e5490ca4cf5267c190efb15" kindref="member">fb_id</ref>,</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_MODE_PAGE_FLIP_EVENT,<sp/><ref refid="structoutput" kindref="compound">output</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;queueing<sp/>pageflip<sp/>failed:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="760"><highlight class="normal"></highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(!<ref refid="structoutput" kindref="compound">output</ref>-&gt;page_flip_pending);</highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;pageflip_timer)</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_event_source_timer_update(<ref refid="structoutput" kindref="compound">output</ref>-&gt;pageflip_timer,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>backend-&gt;<ref refid="structdrm__backend_1a10a90bc390cf2c63bf1b8a58f5b1ef86" kindref="member">pageflip_timeout</ref>);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a2903870dc99824411df261b8a0c2bf4c" kindref="member">drm_output_set_cursor</ref>(state);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>!=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;state_cur-&gt;dpms)<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.head_list,<sp/>base.output_link)<sp/>{</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dpms_prop<sp/>=<sp/>&amp;head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>.<ref refid="structdrm__connector_1a520786262de591ba5b4dadac03309a41" kindref="member">props</ref>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47adf7f47243756ed3dc633bc4c7b9e83a9" kindref="member">WDRM_CONNECTOR_DPMS</ref>];</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dpms_prop-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeConnectorSetProperty(backend-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>.<ref refid="structdrm__connector_1a9a19b388f082e36a49aaa9cf33a663bf" kindref="member">connector_id</ref>,</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dpms_prop-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref>);</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret)<sp/>{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>DPMS:<sp/>failed<sp/>property<sp/>set<sp/>for<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>head-&gt;<ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.<ref refid="structweston__head_1a8539bd24d05dce91d80fa5e389f84db1" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" kindref="member">drm_output_assign_state</ref>(state,<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>);</highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal">err:</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;cursor_view<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1aadf95e25ad6a650a2e0503844ac2b58c" kindref="member">drm_output_state_free</ref>(state);</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="794"><highlight class="normal">}</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(drmModeAtomicReq<sp/>*req,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc,</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7" kindref="member">wdrm_crtc_property</ref><sp/>prop,<sp/>uint64_t<sp/>val)</highlight></codeline>
<codeline lineno="799"><highlight class="normal">{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info<sp/>=<sp/>&amp;crtc-&gt;<ref refid="structdrm__crtc_1a09e419a629a2d4db1d989f0651889019" kindref="member">props_crtc</ref>[prop];</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="805"><highlight class="normal"></highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeAtomicAddProperty(req,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>val);</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(crtc-&gt;<ref refid="structdrm__crtc_1a8211b0cf57c195c9bd03b276871442f8" kindref="member">backend</ref>,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[CRTC:%lu]<sp/>%lu<sp/>(%s)<sp/>-&gt;<sp/>%llu<sp/>(0x%llx)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,<sp/>info-&gt;<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>,</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val);</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(ret<sp/>&lt;=<sp/>0)<sp/>?<sp/>-1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="813"><highlight class="normal">}</highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="816"><highlight class="normal"><ref refid="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" kindref="member">connector_add_prop</ref>(drmModeAtomicReq<sp/>*req,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__connector" kindref="compound">drm_connector</ref><sp/>*connector,</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47" kindref="member">wdrm_connector_property</ref><sp/>prop,<sp/>uint64_t<sp/>val)</highlight></codeline>
<codeline lineno="818"><highlight class="normal">{</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info<sp/>=<sp/>&amp;connector-&gt;<ref refid="structdrm__connector_1a520786262de591ba5b4dadac03309a41" kindref="member">props</ref>[prop];</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>connector_id<sp/>=<sp/>connector-&gt;<ref refid="structdrm__connector_1a9a19b388f082e36a49aaa9cf33a663bf" kindref="member">connector_id</ref>;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="822"><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="825"><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeAtomicAddProperty(req,<sp/>connector_id,<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,<sp/>val);</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(connector-&gt;<ref refid="structdrm__connector_1aa504958a8801a44a95fd96dd83e6b6f9" kindref="member">backend</ref>,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[CONN:%lu]<sp/>%lu<sp/>(%s)<sp/>-&gt;<sp/>%llu<sp/>(0x%llx)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>connector_id,</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,<sp/>info-&gt;<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>,</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val);</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(ret<sp/>&lt;=<sp/>0)<sp/>?<sp/>-1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="832"><highlight class="normal">}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(drmModeAtomicReq<sp/>*req,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane,</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596b" kindref="member">wdrm_plane_property</ref><sp/>prop,<sp/>uint64_t<sp/>val)</highlight></codeline>
<codeline lineno="837"><highlight class="normal">{</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info<sp/>=<sp/>&amp;plane-&gt;<ref refid="structdrm__plane_1abc0a66704df3babfe798c7297ce9dcc3" kindref="member">props</ref>[prop];</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeAtomicAddProperty(req,<sp/>plane-&gt;<ref refid="structdrm__plane_1a65b04e3029b1033d245da4bcf149e595" kindref="member">plane_id</ref>,<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>val);</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(plane-&gt;<ref refid="structdrm__plane_1a2edab895883082a3f29c5cc1b1cf341b" kindref="member">backend</ref>,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[PLANE:%lu]<sp/>%lu<sp/>(%s)<sp/>-&gt;<sp/>%llu<sp/>(0x%llx)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>plane-&gt;<ref refid="structdrm__plane_1a65b04e3029b1033d245da4bcf149e595" kindref="member">plane_id</ref>,</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,<sp/>info-&gt;<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>,</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>val);</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(ret<sp/>&lt;=<sp/>0)<sp/>?<sp/>-1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="851"><highlight class="normal">}</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="854"><highlight class="normal"><ref refid="kms_8c_1ac445c5919f6647e420114c47fcb95298" kindref="member">drm_connector_has_prop</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__connector" kindref="compound">drm_connector</ref><sp/>*connector,</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47" kindref="member">wdrm_connector_property</ref><sp/>prop)</highlight></codeline>
<codeline lineno="856"><highlight class="normal">{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(connector-&gt;<ref refid="structdrm__connector_1a520786262de591ba5b4dadac03309a41" kindref="member">props</ref>[prop].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="861"><highlight class="normal">}</highlight></codeline>
<codeline lineno="862"><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="864"><highlight class="comment"><sp/>*<sp/>This<sp/>function<sp/>converts<sp/>the<sp/>protection<sp/>requests<sp/>from<sp/>weston_hdcp_protection</highlight></codeline>
<codeline lineno="865"><highlight class="comment"><sp/>*<sp/>corresponding<sp/>drm<sp/>values.<sp/>These<sp/>values<sp/>can<sp/>be<sp/>set<sp/>in<sp/>&quot;Content<sp/>Protection&quot;</highlight></codeline>
<codeline lineno="866"><highlight class="comment"><sp/>*<sp/>&amp;<sp/>&quot;HDCP<sp/>Content<sp/>Type&quot;<sp/>connector<sp/>properties.</highlight></codeline>
<codeline lineno="867"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><ref refid="kms_8c_1a565e0e4ee6dce29229c39151a9f90964" kindref="member">get_drm_protection_from_weston</ref>(</highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671" kindref="member">weston_hdcp_protection</ref><sp/>weston_protection,</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62" kindref="member">wdrm_content_protection_state</ref><sp/>*drm_protection,</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843" kindref="member">wdrm_hdcp_content_type</ref><sp/>*drm_cp_type)</highlight></codeline>
<codeline lineno="872"><highlight class="normal">{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(weston_protection)<sp/>{</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671ad11b3fce4f7baccb7a07a1107b23f92e" kindref="member">WESTON_HDCP_DISABLE</ref>:</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_protection<sp/>=<sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62ae146e054e9a83f3343c3870d6acf791d" kindref="member">WDRM_CONTENT_PROTECTION_UNDESIRED</ref>;</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_cp_type<sp/>=<sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a3e4ef5bde37b358fcfa6b57a83ef22c0" kindref="member">WDRM_HDCP_CONTENT_TYPE0</ref>;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671aa54e92658bde3e9e84397251be6b3f3b" kindref="member">WESTON_HDCP_ENABLE_TYPE_0</ref>:</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_protection<sp/>=<sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62a1400d4665d7b85d09fa5aee9c906378c" kindref="member">WDRM_CONTENT_PROTECTION_DESIRED</ref>;</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_cp_type<sp/>=<sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a3e4ef5bde37b358fcfa6b57a83ef22c0" kindref="member">WDRM_HDCP_CONTENT_TYPE0</ref>;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671a56d9cf52a4b090964c1bfc82e71fa85d" kindref="member">WESTON_HDCP_ENABLE_TYPE_1</ref>:</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_protection<sp/>=<sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62a1400d4665d7b85d09fa5aee9c906378c" kindref="member">WDRM_CONTENT_PROTECTION_DESIRED</ref>;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*drm_cp_type<sp/>=<sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a5b24089b472a15f0f1e4cc575e645d27" kindref="member">WDRM_HDCP_CONTENT_TYPE1</ref>;</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(0<sp/>&amp;&amp;<sp/></highlight><highlight class="stringliteral">&quot;bad<sp/>weston_hdcp_protection&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="890"><highlight class="normal">}</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><ref refid="kms_8c_1a6977d8bed59f8c8bba8100c4d75c6768" kindref="member">drm_connector_set_hdcp_property</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__connector" kindref="compound">drm_connector</ref><sp/>*connector,</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="libweston_8h_1a883af45c9ba95a4ce9c18877cc420671" kindref="member">weston_hdcp_protection</ref><sp/>protection,</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeAtomicReq<sp/>*req)</highlight></codeline>
<codeline lineno="896"><highlight class="normal">{</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1acc36d194a71d4bb6b2b81a297485bf62" kindref="member">wdrm_content_protection_state</ref><sp/>drm_protection;</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843" kindref="member">wdrm_hdcp_content_type</ref><sp/>drm_cp_type;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__enum__info" kindref="compound">drm_property_enum_info</ref><sp/>*enum_info;</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>prop_val;</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*props<sp/>=<sp/>connector-&gt;<ref refid="structdrm__connector_1a520786262de591ba5b4dadac03309a41" kindref="member">props</ref>;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a565e0e4ee6dce29229c39151a9f90964" kindref="member">get_drm_protection_from_weston</ref>(protection,<sp/>&amp;drm_protection,</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;drm_cp_type);</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="kms_8c_1ac445c5919f6647e420114c47fcb95298" kindref="member">drm_connector_has_prop</ref>(connector,<sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47acb6b8ba5f75b3f5a37a6aecdb90b96a1" kindref="member">WDRM_CONNECTOR_CONTENT_PROTECTION</ref>))</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="911"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>Content-type<sp/>property<sp/>is<sp/>not<sp/>exposed<sp/>for<sp/>platforms<sp/>not<sp/>supporting</highlight></codeline>
<codeline lineno="912"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>HDCP2.2,<sp/>therefore,<sp/>type-1<sp/>cannot<sp/>be<sp/>supported.<sp/>The<sp/>type-0<sp/>content</highlight></codeline>
<codeline lineno="913"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>still<sp/>can<sp/>be<sp/>supported<sp/>if<sp/>the<sp/>content-protection<sp/>property<sp/>is<sp/>exposed.</highlight></codeline>
<codeline lineno="914"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="kms_8c_1ac445c5919f6647e420114c47fcb95298" kindref="member">drm_connector_has_prop</ref>(connector,<sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drm_cp_type<sp/>!=<sp/><ref refid="drm-internal_8h_1a3905e61ab753483be826e1b48c574843a3e4ef5bde37b358fcfa6b57a83ef22c0" kindref="member">WDRM_HDCP_CONTENT_TYPE0</ref>)</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enum_info<sp/>=<sp/>props[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47acb6b8ba5f75b3f5a37a6aecdb90b96a1" kindref="member">WDRM_CONNECTOR_CONTENT_PROTECTION</ref>].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>;</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prop_val<sp/>=<sp/>enum_info[drm_protection].<ref refid="structdrm__property__enum__info_1a75456ebd33382718c1b41aa40ffaf21a" kindref="member">value</ref>;</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" kindref="member">connector_add_prop</ref>(req,<sp/>connector,</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47acb6b8ba5f75b3f5a37a6aecdb90b96a1" kindref="member">WDRM_CONNECTOR_CONTENT_PROTECTION</ref>,<sp/>prop_val);</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(ret<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="924"><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="kms_8c_1ac445c5919f6647e420114c47fcb95298" kindref="member">drm_connector_has_prop</ref>(connector,<sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>))</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="927"><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enum_info<sp/>=<sp/>props[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>].<ref refid="structdrm__property__info_1a9cb486dce96734362a780465e765f7d3" kindref="member">enum_values</ref>;</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prop_val<sp/>=<sp/>enum_info[drm_cp_type].<ref refid="structdrm__property__enum__info_1a75456ebd33382718c1b41aa40ffaf21a" kindref="member">value</ref>;</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" kindref="member">connector_add_prop</ref>(req,<sp/>connector,</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a48a3d5755ce33a38988bc21cc6ca652f" kindref="member">WDRM_CONNECTOR_HDCP_CONTENT_TYPE</ref>,<sp/>prop_val);</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(ret<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="933"><highlight class="normal">}</highlight></codeline>
<codeline lineno="934"><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="936"><highlight class="normal"><ref refid="kms_8c_1a7b8161b2d45990d6052ecbdb582380b2" kindref="member">drm_output_apply_state_atomic</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*state,</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeAtomicReq<sp/>*req,</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>*<ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref>)</highlight></codeline>
<codeline lineno="939"><highlight class="normal">{</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;crtc;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane__state" kindref="compound">drm_plane_state</ref><sp/>*plane_state;</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__mode" kindref="compound">drm_mode</ref><sp/>*current_mode<sp/>=<sp/><ref refid="drm-internal_8h_1a48fd1efb29c2efbf397cf59c4b587746" kindref="member">to_drm_mode</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.current_mode);</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__head" kindref="compound">drm_head</ref><sp/>*head;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t[atomic]<sp/>%s<sp/>output<sp/>%lu<sp/>(%s)<sp/>state\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(*flags<sp/>&amp;<sp/>DRM_MODE_ATOMIC_TEST_ONLY)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;testing&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;applying&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;base.id,<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;base.name);</highlight></codeline>
<codeline lineno="951"><highlight class="normal"></highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>!=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;state_cur-&gt;dpms)<sp/>{</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[atomic]<sp/>DPMS<sp/>state<sp/>differs,<sp/>modeset<sp/>OK\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*flags<sp/>|=<sp/>DRM_MODE_ATOMIC_ALLOW_MODESET;</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="956"><highlight class="normal"></highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>==<sp/><ref refid="libweston_8h_1a745785f1c5cf40791e2b4c3ef11043c3ad1b8db0fe08ab29dbaa695396cb1c637" kindref="member">WESTON_DPMS_ON</ref>)<sp/>{</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="drm-internal_8h_1a415be6ce3fbc863d03e717976c24609f" kindref="member">drm_mode_ensure_blob</ref>(b,<sp/>current_mode);</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="961"><highlight class="normal"></highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7aaa3791b4f16e891397dee4d059009768" kindref="member">WDRM_CRTC_MODE_ID</ref>,</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_mode-&gt;<ref refid="structdrm__mode_1a4f3b8b563709ecbda9cd5f74ea12c18b" kindref="member">blob_id</ref>);</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7a18532bea4b0b2f07db220e7102648d41" kindref="member">WDRM_CRTC_ACTIVE</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>No<sp/>need<sp/>for<sp/>the<sp/>DPMS<sp/>property,<sp/>since<sp/>it<sp/>is<sp/>implicit<sp/>in</highlight></codeline>
<codeline lineno="967"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>routing<sp/>and<sp/>CRTC<sp/>activity.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.head_list,<sp/><ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.<ref refid="structweston__head_1a21f63bcc97ea0592e94f94c6881a0ed3" kindref="member">output_link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" kindref="member">connector_add_prop</ref>(req,<sp/>&amp;head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>,</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a56a25fb6bda4f871114c5c6a078dde47" kindref="member">WDRM_CONNECTOR_CRTC_ID</ref>,</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>);</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7aaa3791b4f16e891397dee4d059009768" kindref="member">WDRM_CRTC_MODE_ID</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7a18532bea4b0b2f07db220e7102648d41" kindref="member">WDRM_CRTC_ACTIVE</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>No<sp/>need<sp/>for<sp/>the<sp/>DPMS<sp/>property,<sp/>since<sp/>it<sp/>is<sp/>implicit<sp/>in</highlight></codeline>
<codeline lineno="978"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>routing<sp/>and<sp/>CRTC<sp/>activity.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.head_list,<sp/><ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.<ref refid="structweston__head_1a21f63bcc97ea0592e94f94c6881a0ed3" kindref="member">output_link</ref>)</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a994b620d628a21fb1c3e7ed07e4a65c3" kindref="member">connector_add_prop</ref>(req,<sp/>&amp;head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>,</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a56a25fb6bda4f871114c5c6a078dde47" kindref="member">WDRM_CONNECTOR_CRTC_ID</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head,<sp/>&amp;<ref refid="structoutput" kindref="compound">output</ref>-&gt;<ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.head_list,<sp/><ref refid="structdrm__head_1afc6659a8aea64d4d1ebb44ffa3ff3e87" kindref="member">base</ref>.output_link)</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a6977d8bed59f8c8bba8100c4d75c6768" kindref="member">drm_connector_set_hdcp_property</ref>(&amp;head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>,</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;protection,<sp/>req);</highlight></codeline>
<codeline lineno="987"><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;couldn&apos;t<sp/>set<sp/>atomic<sp/>CRTC/connector<sp/>state\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="992"><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(plane_state,<sp/>&amp;state-&gt;<ref refid="structdrm__output__state_1aa72da8a13089f3841d1e77ecad154f18" kindref="member">plane_list</ref>,<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane<sp/>=<sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>;</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structpixel__format__info" kindref="compound">pixel_format_info</ref><sp/>*pinfo<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="996"><highlight class="normal"></highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bad2b8062a854792b323e3ff53dfd0a1c3" kindref="member">WDRM_PLANE_FB_ID</ref>,</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>?<sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a6d724f4d0e5490ca4cf5267c190efb15" kindref="member">fb_id</ref><sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba704a0668e807b595f7e9fda8726759a7" kindref="member">WDRM_PLANE_CRTC_ID</ref>,</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>?<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref><sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596baa6a42b2c7c3f776db5e3a9bb61134862" kindref="member">WDRM_PLANE_SRC_X</ref>,</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a101fb7ab1d3deb9ac3ec67182a521207" kindref="member">src_x</ref>);</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba95709d13f77f9376e83485e1944f4836" kindref="member">WDRM_PLANE_SRC_Y</ref>,</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1af3c8448482dfae7b02c8a44458541d40" kindref="member">src_y</ref>);</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba70c980a8835fd61c6c1e4e328f0939a2" kindref="member">WDRM_PLANE_SRC_W</ref>,</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a9f09e8a40ad4351174df8085eca14692" kindref="member">src_w</ref>);</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596babd5e918516ce184928449f3f04f59bf8" kindref="member">WDRM_PLANE_SRC_H</ref>,</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a18040b750d8d6969dcdc3baf257c648b" kindref="member">src_h</ref>);</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bac58c01db3494d3fb109515e76993cced" kindref="member">WDRM_PLANE_CRTC_X</ref>,</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a70d1e4ec3e8ee540644dcd74f85648f7" kindref="member">dest_x</ref>);</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba8809b4aafd5cec0a81c0ad09f4f8d601" kindref="member">WDRM_PLANE_CRTC_Y</ref>,</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ad117aa4401e9930993e585eb3fcdd851" kindref="member">dest_y</ref>);</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba5c8ca3e4e2dcc4ed31829d2bbf3263d4" kindref="member">WDRM_PLANE_CRTC_W</ref>,</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ab8cbfbec3b3795a28308f80945dcb647" kindref="member">dest_w</ref>);</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bab66991ba381f5104f3f848ef98207c52" kindref="member">WDRM_PLANE_CRTC_H</ref>,</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a95cf58632d3b98a9d82736991e4f61f6" kindref="member">dest_h</ref>);</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane-&gt;<ref refid="structdrm__plane_1abc0a66704df3babfe798c7297ce9dcc3" kindref="member">props</ref>[<ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba71e3e231b7d8361addebf93ec0850cb2" kindref="member">WDRM_PLANE_FB_DAMAGE_CLIPS</ref>].<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba71e3e231b7d8361addebf93ec0850cb2" kindref="member">WDRM_PLANE_FB_DAMAGE_CLIPS</ref>,</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ae2b7c05be5784b6ee852f9184ed95c3f" kindref="member">damage_blob_id</ref>);</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"></highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref><sp/>&amp;&amp;<sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a084455e26722659421ec39cfb687a856" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pinfo<sp/>=<sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a10ec900cdb9ff310d215f589ef214d93" kindref="member">fb</ref>-&gt;<ref refid="structdrm__fb_1a084455e26722659421ec39cfb687a856" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"></highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(plane-&gt;<ref refid="structdrm__plane_1a2edab895883082a3f29c5cc1b1cf341b" kindref="member">backend</ref>,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[PLANE:%lu]<sp/>FORMAT:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>plane-&gt;<ref refid="structdrm__plane_1a65b04e3029b1033d245da4bcf149e595" kindref="member">plane_id</ref>,</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pinfo<sp/>?<sp/>pinfo-&gt;<ref refid="structpixel__format__info_1a3324befd6757b555dbb5954467fb4cc6" kindref="member">drm_format_name</ref><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;UNKNOWN&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"></highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane_state-&gt;<ref refid="structdrm__plane__state_1a7c56c95a62c11f834c99efbcb07027fb" kindref="member">in_fence_fd</ref><sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba91e2dd71de34a7dce93afb47d431a2e2" kindref="member">WDRM_PLANE_IN_FENCE_FD</ref>,</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a7c56c95a62c11f834c99efbcb07027fb" kindref="member">in_fence_fd</ref>);</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>do<sp/>note,<sp/>that<sp/>&apos;invented&apos;<sp/>zpos<sp/>values<sp/>are<sp/>set<sp/>as<sp/>immutable<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(plane_state-&gt;<ref refid="structdrm__plane__state_1a08f1b778522457ee267b353964f06867" kindref="member">zpos</ref><sp/>!=<sp/><ref refid="drm-internal_8h_1adf65f90b1ca224c714d20a786860ba75" kindref="member">DRM_PLANE_ZPOS_INVALID_PLANE</ref><sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1a1c9c640416d187def1692a1e5a854237" kindref="member">zpos_min</ref><sp/>!=<sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1ad72384929460604551a076354baba00d" kindref="member">plane</ref>-&gt;<ref refid="structdrm__plane_1ae7227234b162296dd91f9698115a09a4" kindref="member">zpos_max</ref>)</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba34b67be34600e4edba988b6a9d5e01bc" kindref="member">WDRM_PLANE_ZPOS</ref>,</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plane_state-&gt;<ref refid="structdrm__plane__state_1a08f1b778522457ee267b353964f06867" kindref="member">zpos</ref>);</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;couldn&apos;t<sp/>set<sp/>plane<sp/>state\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1048"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"></highlight></codeline>
<codeline lineno="1054"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><ref refid="kms_8c_1acd386ec3f4686fa6e8fc47f767ce7c5e" kindref="member">drm_pending_state_apply_atomic</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref><sp/>*pending_state,</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749ed" kindref="member">drm_state_apply_mode</ref><sp/>mode)</highlight></codeline>
<codeline lineno="1057"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>pending_state-&gt;<ref refid="structdrm__pending__state_1ac07e076344f30ad91b12c34c874f33fe" kindref="member">backend</ref>;</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*output_state,<sp/>*tmp;</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__plane" kindref="compound">drm_plane</ref><sp/>*plane;</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeAtomicReq<sp/>*req<sp/>=<sp/>drmModeAtomicAlloc();</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>flags;</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"></highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!req)</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"></highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(mode)<sp/>{</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" kindref="member">DRM_STATE_APPLY_SYNC</ref>:</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flags<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>:</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flags<sp/>=<sp/>DRM_MODE_PAGE_FLIP_EVENT<sp/>|<sp/>DRM_MODE_ATOMIC_NONBLOCK;</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda99a96cf36762e16e89f055a9babe51a0" kindref="member">DRM_STATE_TEST_ONLY</ref>:</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flags<sp/>=<sp/>DRM_MODE_ATOMIC_TEST_ONLY;</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structweston__head" kindref="compound">weston_head</ref><sp/>*head_base;</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__head" kindref="compound">drm_head</ref><sp/>*head;</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc;</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>connector_id;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"></highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t[atomic]<sp/>previous<sp/>state<sp/>invalid;<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;starting<sp/>with<sp/>fresh<sp/>state\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we<sp/>need<sp/>to<sp/>reset<sp/>all<sp/>our<sp/>state<sp/>(e.g.<sp/>because<sp/>we&apos;ve</highlight></codeline>
<codeline lineno="1091"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>just<sp/>started,<sp/>or<sp/>just<sp/>been<sp/>VT-switched<sp/>in),<sp/>explicitly</highlight></codeline>
<codeline lineno="1092"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>disable<sp/>all<sp/>the<sp/>CRTCs<sp/>and<sp/>connectors<sp/>we<sp/>aren&apos;t<sp/>using.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(head_base,</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;b-&gt;<ref refid="structdrm__backend_1a39745a9a0a892536a99063caeb5fa6b6" kindref="member">compositor</ref>-&gt;<ref refid="structweston__compositor_1a154cc4c320f1d35ecb9886f2b68b6e27" kindref="member">head_list</ref>,<sp/>compositor_link)<sp/>{</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info;</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__head_1ga8d49a887b440265b363a5075fefff343" kindref="member">weston_head_is_enabled</ref>(head_base))</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>head<sp/>=<sp/><ref refid="drm-internal_8h_1af400abb975722d827a08eda80acd4614" kindref="member">to_drm_head</ref>(head_base);</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>connector_id<sp/>=<sp/>head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>.<ref refid="structdrm__connector_1a9a19b388f082e36a49aaa9cf33a663bf" kindref="member">connector_id</ref>;</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t[atomic]<sp/>disabling<sp/>inactive<sp/>head<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>head_base-&gt;<ref refid="structweston__head_1a8539bd24d05dce91d80fa5e389f84db1" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info<sp/>=<sp/>&amp;head-&gt;<ref refid="structdrm__head_1af92dd7636e627ff569cb3e4b8b0515d9" kindref="member">connector</ref>.<ref refid="structdrm__connector_1a520786262de591ba5b4dadac03309a41" kindref="member">props</ref>[<ref refid="drm-internal_8h_1a401609d6da9e20a9ea33b61c93fd7d47a56a25fb6bda4f871114c5c6a078dde47" kindref="member">WDRM_CONNECTOR_CRTC_ID</ref>];</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/>drmModeAtomicAddProperty(req,<sp/>connector_id,</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t\t[CONN:%lu]<sp/>%lu<sp/>(%s)<sp/>-&gt;<sp/>0\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>connector_id,</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>info-&gt;<ref refid="structdrm__property__info_1ab0805c648bb407ac900c5512c015356f" kindref="member">prop_id</ref>,</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info-&gt;<ref refid="structdrm__property__info_1ae553114535bb2e88a2d1834cf5c0b07c" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>&lt;=<sp/>0)</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(crtc,<sp/>&amp;b-&gt;<ref refid="structdrm__backend_1ab59212253dcf043b51bdf8167c627ed1" kindref="member">crtc_list</ref>,<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__property__info" kindref="compound">drm_property_info</ref><sp/>*info;</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeObjectProperties<sp/>*props;</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>active;</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Ignore<sp/>CRTCs<sp/>that<sp/>are<sp/>in<sp/>use<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(crtc-&gt;<ref refid="structdrm__crtc_1a9321b56e80c7edd4b621c51c46078fcb" kindref="member">output</ref>)</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>can&apos;t<sp/>emit<sp/>a<sp/>disable<sp/>on<sp/>a<sp/>CRTC<sp/>that&apos;s<sp/>already</highlight></codeline>
<codeline lineno="1127"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>off,<sp/>as<sp/>the<sp/>kernel<sp/>will<sp/>refuse<sp/>to<sp/>generate<sp/>an<sp/>event</highlight></codeline>
<codeline lineno="1128"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>for<sp/>an<sp/>off-&gt;off<sp/>state<sp/>and<sp/>fail<sp/>the<sp/>commit.</highlight></codeline>
<codeline lineno="1129"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>props<sp/>=<sp/>drmModeObjectGetProperties(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DRM_MODE_OBJECT_CRTC);</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!props)<sp/>{</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info<sp/>=<sp/>&amp;crtc-&gt;<ref refid="structdrm__crtc_1a09e419a629a2d4db1d989f0651889019" kindref="member">props_crtc</ref>[<ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7a18532bea4b0b2f07db220e7102648d41" kindref="member">WDRM_CRTC_ACTIVE</ref>];</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>active<sp/>=<sp/><ref refid="kms_8c_1a10a6cc59b12c55f8350d2dab4f1edb69" kindref="member">drm_property_get_value</ref>(info,<sp/>props,<sp/>0);</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeFreeObjectProperties(props);</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(active<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t[atomic]<sp/>disabling<sp/>unused<sp/>CRTC<sp/>%lu\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>);</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"></highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7a18532bea4b0b2f07db220e7102648d41" kindref="member">WDRM_CRTC_ACTIVE</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a90b7adedfd3040c8440230840963b20e" kindref="member">crtc_add_prop</ref>(req,<sp/>crtc,<sp/><ref refid="drm-internal_8h_1afc74310ab71a030d84ba54d7b15e0da7aaa3791b4f16e891397dee4d059009768" kindref="member">WDRM_CRTC_MODE_ID</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"></highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Disable<sp/>all<sp/>the<sp/>planes;<sp/>planes<sp/>which<sp/>are<sp/>being<sp/>used<sp/>will</highlight></codeline>
<codeline lineno="1152"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>override<sp/>this<sp/>state<sp/>in<sp/>the<sp/>output-state<sp/>application.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(plane,<sp/>&amp;b-&gt;<ref refid="structdrm__backend_1ae64887d7b3927dfe58c57894972ce9b4" kindref="member">plane_list</ref>,<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;\t\t[atomic]<sp/>starting<sp/>with<sp/>plane<sp/>%lu<sp/>disabled\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<sp/>plane-&gt;<ref refid="structdrm__plane_1a65b04e3029b1033d245da4bcf149e595" kindref="member">plane_id</ref>);</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596ba704a0668e807b595f7e9fda8726759a7" kindref="member">WDRM_PLANE_CRTC_ID</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a74d9715fd2e0fd8437c78ee473646ea9" kindref="member">plane_add_prop</ref>(req,<sp/>plane,<sp/><ref refid="drm-internal_8h_1ab302784094e81d6c84db23c17f93596bad2b8062a854792b323e3ff53dfd0a1c3" kindref="member">WDRM_PLANE_FB_ID</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"></highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref><sp/>|=<sp/>DRM_MODE_ATOMIC_ALLOW_MODESET;</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"></highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(output_state,<sp/>&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>,<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(output_state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>-&gt;<ref refid="structdrm__output_1a659dc9aaa14a65c9d9b366b3584f5235" kindref="member">virtual</ref>)</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>==<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" kindref="member">DRM_STATE_APPLY_SYNC</ref>)</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(output_state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>==<sp/><ref refid="libweston_8h_1a745785f1c5cf40791e2b4c3ef11043c3a3f1ea2fc87236eee5e7a9dc3c00f80a3" kindref="member">WESTON_DPMS_OFF</ref>);</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>|=<sp/><ref refid="kms_8c_1a7b8161b2d45990d6052ecbdb582380b2" kindref="member">drm_output_apply_state_atomic</ref>(output_state,<sp/>req,<sp/>&amp;<ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref>);</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;atomic:<sp/>couldn&apos;t<sp/>compile<sp/>atomic<sp/>state\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"></highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmModeAtomicCommit(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>req,<sp/><ref refid="structdrm__property__info_1a637f9920e8ee41b47434af986d255e37" kindref="member">flags</ref>,<sp/>b);</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;[atomic]<sp/>drmModeAtomicCommit\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"></highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>commits<sp/>do<sp/>not<sp/>take<sp/>ownership<sp/>of<sp/>the<sp/>state;<sp/>return</highlight></codeline>
<codeline lineno="1180"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>without<sp/>freeing<sp/>here.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>==<sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda99a96cf36762e16e89f055a9babe51a0" kindref="member">DRM_STATE_TEST_ONLY</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeAtomicFree(req);</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;atomic:<sp/>couldn&apos;t<sp/>commit<sp/>new<sp/>state:<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strerror(errno));</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>out;</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"></highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(output_state,<sp/>tmp,<sp/>&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>,</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>link)</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" kindref="member">drm_output_assign_state</ref>(output_state,<sp/>mode);</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"></highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"></highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(wl_list_empty(&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>));</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"></highlight></codeline>
<codeline lineno="1200"><highlight class="normal">out:</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeAtomicFree(req);</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a933147336d9ddfff88209fb61c64016e" kindref="member">drm_pending_state_free</ref>(pending_state);</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1204"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"></highlight></codeline>
<codeline lineno="1224"><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><ref refid="kms_8c_1aa1fc0f2bef56ac2d3cb5e7bfb0e3685f" kindref="member">drm_pending_state_test</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref><sp/>*pending_state)</highlight></codeline>
<codeline lineno="1226"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>pending_state-&gt;<ref refid="structdrm__pending__state_1ac07e076344f30ad91b12c34c874f33fe" kindref="member">backend</ref>;</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"></highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>)</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1acd386ec3f4686fa6e8fc47f767ce7c5e" kindref="member">drm_pending_state_apply_atomic</ref>(pending_state,</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda99a96cf36762e16e89f055a9babe51a0" kindref="member">DRM_STATE_TEST_ONLY</ref>);</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"></highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>have<sp/>no<sp/>way<sp/>to<sp/>test<sp/>state<sp/>before<sp/>application<sp/>on<sp/>the<sp/>legacy</highlight></codeline>
<codeline lineno="1234"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>modesetting<sp/>API,<sp/>so<sp/>just<sp/>claim<sp/>it<sp/>succeeded.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1236"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"></highlight></codeline>
<codeline lineno="1245"><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><ref refid="kms_8c_1a21c4ef1aa7126bfd913e3a5b80c9fe21" kindref="member">drm_pending_state_apply</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref><sp/>*pending_state)</highlight></codeline>
<codeline lineno="1247"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>pending_state-&gt;<ref refid="structdrm__pending__state_1ac07e076344f30ad91b12c34c874f33fe" kindref="member">backend</ref>;</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*output_state,<sp/>*tmp;</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc;</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"></highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>)</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1acd386ec3f4686fa6e8fc47f767ce7c5e" kindref="member">drm_pending_state_apply_atomic</ref>(pending_state,</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>);</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"></highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we<sp/>need<sp/>to<sp/>reset<sp/>all<sp/>our<sp/>state<sp/>(e.g.<sp/>because<sp/>we&apos;ve</highlight></codeline>
<codeline lineno="1258"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>just<sp/>started,<sp/>or<sp/>just<sp/>been<sp/>VT-switched<sp/>in),<sp/>explicitly</highlight></codeline>
<codeline lineno="1259"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>disable<sp/>all<sp/>the<sp/>CRTCs<sp/>we<sp/>aren&apos;t<sp/>using.<sp/>This<sp/>also<sp/>disables</highlight></codeline>
<codeline lineno="1260"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>all<sp/>connectors<sp/>on<sp/>these<sp/>CRTCs,<sp/>so<sp/>we<sp/>don&apos;t<sp/>need<sp/>to<sp/>do<sp/>that</highlight></codeline>
<codeline lineno="1261"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>separately<sp/>with<sp/>the<sp/>pre-atomic<sp/>API.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(crtc,<sp/>&amp;b-&gt;<ref refid="structdrm__backend_1ab59212253dcf043b51bdf8167c627ed1" kindref="member">crtc_list</ref>,<sp/><ref refid="structdrm__crtc_1a9b7d60402495668d472938fecf926cda" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(crtc-&gt;<ref refid="structdrm__crtc_1a9321b56e80c7edd4b621c51c46078fcb" kindref="member">output</ref>)</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeSetCrtc(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>0,<sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL,<sp/>0,<sp/>NULL);</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(output_state,<sp/>tmp,<sp/>&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>,</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdrm__crtc_1a9b7d60402495668d472938fecf926cda" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>output_state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"></highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;virtual)<sp/>{</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1afc841dfb1a01d6d157b1a6709812d74a" kindref="member">drm_output_assign_state</ref>(output_state,</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda473cab11f339c92e5d12285125312ade" kindref="member">DRM_STATE_APPLY_ASYNC</ref>);</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"></highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="kms_8c_1a9ddf2bec776193329dcaa6cb4f91921b" kindref="member">drm_output_apply_state_legacy</ref>(output_state);</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Couldn&apos;t<sp/>apply<sp/>state<sp/>for<sp/>output<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;base.name);</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"></highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"></highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(wl_list_empty(&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>));</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a933147336d9ddfff88209fb61c64016e" kindref="member">drm_pending_state_free</ref>(pending_state);</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"></highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1295"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"></highlight></codeline>
<codeline lineno="1304"><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><ref refid="kms_8c_1adc1b74a20dc9a68f57660b68ba2b3300" kindref="member">drm_pending_state_apply_sync</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__pending__state" kindref="compound">drm_pending_state</ref><sp/>*pending_state)</highlight></codeline>
<codeline lineno="1306"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>pending_state-&gt;<ref refid="structdrm__pending__state_1ac07e076344f30ad91b12c34c874f33fe" kindref="member">backend</ref>;</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output__state" kindref="compound">drm_output_state</ref><sp/>*output_state,<sp/>*tmp;</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc;</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"></highlight></codeline>
<codeline lineno="1311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>)</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="kms_8c_1acd386ec3f4686fa6e8fc47f767ce7c5e" kindref="member">drm_pending_state_apply_atomic</ref>(pending_state,</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1a3d188a71238375d39ecfe53a041749eda54c1b0031bad8a22d2ff2441ab238605" kindref="member">DRM_STATE_APPLY_SYNC</ref>);</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"></highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we<sp/>need<sp/>to<sp/>reset<sp/>all<sp/>our<sp/>state<sp/>(e.g.<sp/>because<sp/>we&apos;ve</highlight></codeline>
<codeline lineno="1317"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>just<sp/>started,<sp/>or<sp/>just<sp/>been<sp/>VT-switched<sp/>in),<sp/>explicitly</highlight></codeline>
<codeline lineno="1318"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>disable<sp/>all<sp/>the<sp/>CRTCs<sp/>we<sp/>aren&apos;t<sp/>using.<sp/>This<sp/>also<sp/>disables</highlight></codeline>
<codeline lineno="1319"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>all<sp/>connectors<sp/>on<sp/>these<sp/>CRTCs,<sp/>so<sp/>we<sp/>don&apos;t<sp/>need<sp/>to<sp/>do<sp/>that</highlight></codeline>
<codeline lineno="1320"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>separately<sp/>with<sp/>the<sp/>pre-atomic<sp/>API.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each(crtc,<sp/>&amp;b-&gt;<ref refid="structdrm__backend_1ab59212253dcf043b51bdf8167c627ed1" kindref="member">crtc_list</ref>,<sp/><ref refid="structdrm__crtc_1a9b7d60402495668d472938fecf926cda" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(crtc-&gt;<ref refid="structdrm__crtc_1a9321b56e80c7edd4b621c51c46078fcb" kindref="member">output</ref>)</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmModeSetCrtc(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>crtc-&gt;<ref refid="structdrm__crtc_1aeb932aec0c20ce41fd5c8a57d720cc9a" kindref="member">crtc_id</ref>,<sp/>0,<sp/>0,<sp/>0,</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NULL,<sp/>0,<sp/>NULL);</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wl_list_for_each_safe(output_state,<sp/>tmp,<sp/>&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>,</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdrm__crtc_1a9b7d60402495668d472938fecf926cda" kindref="member">link</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"></highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(output_state-&gt;<ref refid="structdrm__output__state_1a706abaeae61311a859b046c52599821c" kindref="member">dpms</ref><sp/>==<sp/><ref refid="libweston_8h_1a745785f1c5cf40791e2b4c3ef11043c3a3f1ea2fc87236eee5e7a9dc3c00f80a3" kindref="member">WESTON_DPMS_OFF</ref>);</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="kms_8c_1a9ddf2bec776193329dcaa6cb4f91921b" kindref="member">drm_output_apply_state_legacy</ref>(output_state);</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Couldn&apos;t<sp/>apply<sp/>state<sp/>for<sp/>output<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_state-&gt;<ref refid="structdrm__output__state_1a079380ed7811bcbf1aecf219f7209aac" kindref="member">output</ref>-&gt;<ref refid="structdrm__output_1a285bafac36ab348108d8be01e24e451a" kindref="member">base</ref>.<ref refid="structweston__output_1ab65dff659f1d2d38bc253ca1de2b6c04" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1ac954eaca3e234dfe6489eb66fae4b3dc" kindref="member">state_invalid</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(wl_list_empty(&amp;pending_state-&gt;<ref refid="structdrm__pending__state_1acd52dfd911a6a7504d7c244fa53c99ee" kindref="member">output_list</ref>));</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"></highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a933147336d9ddfff88209fb61c64016e" kindref="member">drm_pending_state_free</ref>(pending_state);</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1348"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"></highlight></codeline>
<codeline lineno="1350"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><ref refid="kms_8c_1ab4896bad0a1e02c27d51a42b34650934" kindref="member">drm_output_update_msc</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>seq)</highlight></codeline>
<codeline lineno="1352"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>msc_hi<sp/>=<sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;base.msc<sp/>&gt;&gt;<sp/>32;</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"></highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(seq<sp/>&lt;<sp/>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.msc<sp/>&amp;<sp/>0xffffffff))</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msc_hi++;</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"></highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;base.msc<sp/>=<sp/>(msc_hi<sp/>&lt;&lt;<sp/>32)<sp/>+<sp/>seq;</highlight></codeline>
<codeline lineno="1359"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"></highlight></codeline>
<codeline lineno="1361"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><ref refid="kms_8c_1a397fe6e6e3813de773ef8f670667e03d" kindref="member">page_flip_handler</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frame,</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sec,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>usec,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="1364"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/><ref refid="drm-internal_8h_1a8b3822c0c16326d34de44e3738f19c29" kindref="member">to_drm_backend</ref>(<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.compositor);</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>flags<sp/>=<sp/>WP_PRESENTATION_FEEDBACK_KIND_VSYNC<sp/>|</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WP_PRESENTATION_FEEDBACK_KIND_HW_COMPLETION<sp/>|</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WP_PRESENTATION_FEEDBACK_KIND_HW_CLOCK;</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"></highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1ab4896bad0a1e02c27d51a42b34650934" kindref="member">drm_output_update_msc</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>frame);</highlight></codeline>
<codeline lineno="1372"><highlight class="normal"></highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(!b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>);</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(<ref refid="structoutput" kindref="compound">output</ref>-&gt;page_flip_pending);</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;page_flip_pending<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"></highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1afb55f629c85e3c178506af86c21a7a75" kindref="member">drm_output_update_complete</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>flags,<sp/>sec,<sp/>usec);</highlight></codeline>
<codeline lineno="1378"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"></highlight></codeline>
<codeline lineno="1380"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><ref refid="kms_8c_1a60933b9ef2d5b393216ab5c7e34b2508" kindref="member">atomic_flip_handler</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frame,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sec,</highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>usec,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>crtc_id,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="1383"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__crtc" kindref="compound">drm_crtc</ref><sp/>*crtc;</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__output" kindref="compound">drm_output</ref><sp/>*<ref refid="structoutput" kindref="compound">output</ref>;</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>flags<sp/>=<sp/>WP_PRESENTATION_FEEDBACK_KIND_VSYNC<sp/>|</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WP_PRESENTATION_FEEDBACK_KIND_HW_COMPLETION<sp/>|</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WP_PRESENTATION_FEEDBACK_KIND_HW_CLOCK;</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"></highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structdrm__output_1a7fde42496885a2e205cf40d223332ade" kindref="member">crtc</ref><sp/>=<sp/><ref refid="drm-internal_8h_1a0da1beaa9b89de0ecf8cd77e3c9ecc10" kindref="member">drm_crtc_find</ref>(b,<sp/>crtc_id);</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(<ref refid="structdrm__output_1a7fde42496885a2e205cf40d223332ade" kindref="member">crtc</ref>);</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"></highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref><sp/>=<sp/><ref refid="structdrm__output_1a7fde42496885a2e205cf40d223332ade" kindref="member">crtc</ref>-&gt;<ref refid="structdrm__crtc_1a9321b56e80c7edd4b621c51c46078fcb" kindref="member">output</ref>;</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"></highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>During<sp/>the<sp/>initial<sp/>modeset,<sp/>we<sp/>can<sp/>disable<sp/>CRTCs<sp/>which<sp/>we<sp/>don&apos;t</highlight></codeline>
<codeline lineno="1397"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>actually<sp/>handle<sp/>during<sp/>normal<sp/>operation;<sp/>this<sp/>will<sp/>give<sp/>us<sp/>events</highlight></codeline>
<codeline lineno="1398"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>for<sp/>unknown<sp/>outputs.<sp/>Ignore<sp/>them.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="structoutput" kindref="compound">output</ref><sp/>||<sp/>!<ref refid="structoutput" kindref="compound">output</ref>-&gt;base.enabled)</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"></highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="kms_8c_1ab4896bad0a1e02c27d51a42b34650934" kindref="member">drm_output_update_msc</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>frame);</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"></highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;[atomic][CRTC:%u]<sp/>flip<sp/>processing<sp/>started\n&quot;</highlight><highlight class="normal">,<sp/>crtc_id);</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>);</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>assert(<ref refid="structoutput" kindref="compound">output</ref>-&gt;atomic_complete_pending);</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structoutput" kindref="compound">output</ref>-&gt;atomic_complete_pending<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"></highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1afb55f629c85e3c178506af86c21a7a75" kindref="member">drm_output_update_complete</ref>(<ref refid="structoutput" kindref="compound">output</ref>,<sp/>flags,<sp/>sec,<sp/>usec);</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="drm-internal_8h_1a8f027ebb0007c8fd4f36624544dd5864" kindref="member">drm_debug</ref>(b,<sp/></highlight><highlight class="stringliteral">&quot;[atomic][CRTC:%u]<sp/>flip<sp/>processing<sp/>completed\n&quot;</highlight><highlight class="normal">,<sp/>crtc_id);</highlight></codeline>
<codeline lineno="1411"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"></highlight></codeline>
<codeline lineno="1413"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><ref refid="kms_8c_1a89cf346c4ddb1a71f83323b1e0223825" kindref="member">on_drm_input</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd,<sp/>uint32_t<sp/>mask,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)</highlight></codeline>
<codeline lineno="1415"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b<sp/>=<sp/>data;</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmEventContext<sp/>evctx;</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"></highlight></codeline>
<codeline lineno="1419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(&amp;evctx,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal"><sp/>evctx);</highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evctx.version<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref>)</highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evctx.page_flip_handler2<sp/>=<sp/><ref refid="kms_8c_1a60933b9ef2d5b393216ab5c7e34b2508" kindref="member">atomic_flip_handler</ref>;</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evctx.page_flip_handler<sp/>=<sp/><ref refid="kms_8c_1a397fe6e6e3813de773ef8f670667e03d" kindref="member">page_flip_handler</ref>;</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmHandleEvent(<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>&amp;evctx);</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"></highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1428"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"></highlight></codeline>
<codeline lineno="1430"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><ref refid="kms_8c_1acc628968d33cfc207b6b55a23722238c" kindref="member">init_kms_caps</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structdrm__backend" kindref="compound">drm_backend</ref><sp/>*b)</highlight></codeline>
<codeline lineno="1432"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>cap;</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clockid_t<sp/>clk_id;</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"></highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;using<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1a4b23e09c61acda508420235b41e66a51" kindref="member">filename</ref>);</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"></highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmGetCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CAP_TIMESTAMP_MONOTONIC,<sp/>&amp;cap);</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>cap<sp/>==<sp/>1)</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clk_id<sp/>=<sp/>CLOCK_MONOTONIC;</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clk_id<sp/>=<sp/>CLOCK_REALTIME;</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"></highlight></codeline>
<codeline lineno="1445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__compositor_1gabaca768863a217e3c5fa4d7519676a9a" kindref="member">weston_compositor_set_presentation_clock</ref>(b-&gt;<ref refid="structdrm__backend_1a39745a9a0a892536a99063caeb5fa6b6" kindref="member">compositor</ref>,<sp/>clk_id)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;Error:<sp/>failed<sp/>to<sp/>set<sp/>presentation<sp/>clock<sp/>%d.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clk_id);</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"></highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmGetCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CAP_CURSOR_WIDTH,<sp/>&amp;cap);</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a6604f296567ccd200064cbbb57aed7c2" kindref="member">cursor_width</ref><sp/>=<sp/>cap;</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a6604f296567ccd200064cbbb57aed7c2" kindref="member">cursor_width</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"></highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmGetCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CAP_CURSOR_HEIGHT,<sp/>&amp;cap);</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a680e6639d09d220f29c4790fff478dc7" kindref="member">cursor_height</ref><sp/>=<sp/>cap;</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a680e6639d09d220f29c4790fff478dc7" kindref="member">cursor_height</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"></highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!getenv(</highlight><highlight class="stringliteral">&quot;WESTON_DISABLE_UNIVERSAL_PLANES&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmSetClientCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CLIENT_CAP_UNIVERSAL_PLANES,<sp/>1);</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1af0e3224512911769418403228dbec61c" kindref="member">universal_planes</ref><sp/>=<sp/>(ret<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"></highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="structdrm__backend_1af0e3224512911769418403228dbec61c" kindref="member">universal_planes</ref><sp/>&amp;&amp;<sp/>!getenv(</highlight><highlight class="stringliteral">&quot;WESTON_DISABLE_ATOMIC&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmGetCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CAP_CRTC_IN_VBLANK_EVENT,<sp/>&amp;cap);</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cap<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmSetClientCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CLIENT_CAP_ATOMIC,<sp/>1);</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref><sp/>=<sp/>((ret<sp/>==<sp/>0)<sp/>&amp;&amp;<sp/>(cap<sp/>==<sp/>1));</highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>%s<sp/>atomic<sp/>modesetting\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;supports&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;does<sp/>not<sp/>support&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"></highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!getenv(</highlight><highlight class="stringliteral">&quot;WESTON_DISABLE_GBM_MODIFIERS&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmGetCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CAP_ADDFB2_MODIFIERS,<sp/>&amp;cap);</highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a28508b802dfb22b607e6ca907e7d67d3" kindref="member">fb_modifiers</ref><sp/>=<sp/>cap;</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>%s<sp/>GBM<sp/>modifiers\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a28508b802dfb22b607e6ca907e7d67d3" kindref="member">fb_modifiers</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;supports&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;does<sp/>not<sp/>support&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"></highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drmSetClientCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CLIENT_CAP_WRITEBACK_CONNECTORS,<sp/>1);</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"></highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="1489"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>KMS<sp/>support<sp/>for<sp/>hardware<sp/>planes<sp/>cannot<sp/>properly<sp/>synchronize</highlight></codeline>
<codeline lineno="1490"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>without<sp/>nuclear<sp/>page<sp/>flip.<sp/>Without<sp/>nuclear/atomic,<sp/>hw<sp/>plane</highlight></codeline>
<codeline lineno="1491"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>cursor<sp/>plane<sp/>updates<sp/>would<sp/>either<sp/>tear<sp/>or<sp/>cause<sp/>extra</highlight></codeline>
<codeline lineno="1492"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>waits<sp/>for<sp/>vblanks<sp/>which<sp/>means<sp/>dropping<sp/>the<sp/>compositor<sp/>framerate</highlight></codeline>
<codeline lineno="1493"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>a<sp/>fraction.<sp/>For<sp/>cursors,<sp/>it&apos;s<sp/>not<sp/>so<sp/>bad,<sp/>so<sp/>they<sp/>are</highlight></codeline>
<codeline lineno="1494"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>enabled.</highlight></codeline>
<codeline lineno="1495"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!b-&gt;<ref refid="structdrm__backend_1a9638bccc5761cedc97634d1088e24ccf" kindref="member">atomic_modeset</ref><sp/>||<sp/>getenv(</highlight><highlight class="stringliteral">&quot;WESTON_FORCE_RENDERER&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1a7f7bfe38173dd37acf4498131caf7cbe" kindref="member">sprites_are_broken</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"></highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>drmSetClientCap(b-&gt;<ref refid="structdrm__backend_1aa82b86e30f7e51cb7f6551e1e959e85f" kindref="member">drm</ref>.<ref refid="structdrm__backend_1ab202144207011b5359cb5741fa58fe70" kindref="member">fd</ref>,<sp/>DRM_CLIENT_CAP_ASPECT_RATIO,<sp/>1);</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1af4650954d647fbca6bb61c03cb0d6ffd" kindref="member">aspect_ratio_supported</ref><sp/>=<sp/>(ret<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__wlog_1ga6a7cc2161ce1dad600859022b30162c8" kindref="member">weston_log</ref>(</highlight><highlight class="stringliteral">&quot;DRM:<sp/>%s<sp/>picture<sp/>aspect<sp/>ratio\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b-&gt;<ref refid="structdrm__backend_1af4650954d647fbca6bb61c03cb0d6ffd" kindref="member">aspect_ratio_supported</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;supports&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;does<sp/>not<sp/>support&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"></highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1505"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/home/lzm/Wayland/weston/libweston/backend-drm/kms.c"/>
  </compounddef>
</doxygen>
